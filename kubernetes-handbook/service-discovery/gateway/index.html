<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="宋净超" />

  
  
  
    
  
  <meta name="description" content="注意 本文根据 Gateway API 0.5.1 版本撰写。目前 Gateway API 仅用于处理 Kubernetes 集群中的南北向（入口）流量，未来也有可能处理集群内（东西向）流量。关于使用 Gateway API 处理东西向流量的提议详见此文档。 除了直接使用 Service 和 Ingress 之外，Kubernete" />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/kubernetes-handbook/service-discovery/gateway/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b26eb9b802629dccab300faa82cc98c7.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/kubernetes-handbook/service-discovery/gateway/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="云原生资料库" />
  <meta property="og:url" content="https://lib.jimmysong.io/kubernetes-handbook/service-discovery/gateway/" />
  <meta property="og:title" content="Gateway API | 云原生资料库" />
  <meta property="og:description" content="注意 本文根据 Gateway API 0.5.1 版本撰写。目前 Gateway API 仅用于处理 Kubernetes 集群中的南北向（入口）流量，未来也有可能处理集群内（东西向）流量。关于使用 Gateway API 处理东西向流量的提议详见此文档。 除了直接使用 Service 和 Ingress 之外，Kubernete" /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2022-05-21T00:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-11-15T17:46:34&#43;08:00">
  

  



  

  

  





  <title>Gateway API | 云原生资料库</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="a812253b3484adb64c3e2ce0da208287" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="搜索...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="云原生资料库"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>图书</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>教程</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio 基础教程</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy 基础教程</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>原创</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/blog"><span>译文</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#feed"><span>更新</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>标签</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>关于</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io" target="_blank" rel="noopener"><span>Jimmy Song</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="联系" target="_blank" rel="noopener" aria-label="联系">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="关注" target="_blank" rel="noopener" aria-label="关注">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="主站" aria-label="主站"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="搜索" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="https://github.com/rootsongjc/cloud-native-library/" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="查看源码" aria-label="查看源码" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          服务发现与路由
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      



  
    
    
    
    
      
    
    

    
      <ul class="nav docs-sidenav">
          <li class="level1 "><a href="/kubernetes-handbook/"><i class="fas fa-book pr-1"></i>Kubernetes 基础教程</a></li>
    
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idddb70b11761728986dc6be4250c7562e&#34;)" href="#idddb70b11761728986dc6be4250c7562e" aria-expanded="false" aria-controls="idddb70b11761728986dc6be4250c7562e" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/architecture/">Kubernetes 架构</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#idddb70b11761728986dc6be4250c7562e" aria-expanded="false" aria-controls="idddb70b11761728986dc6be4250c7562e">
    
        <i class="fa-solid fa-angle-right" id="caret-idddb70b11761728986dc6be4250c7562e"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="idddb70b11761728986dc6be4250c7562e">
      



  <li class="child level1 "><a href="/kubernetes-handbook/architecture/perspective/">Kubernetes 的设计理念</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/architecture/etcd/">Etcd 解析</a></li>




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id5235cba80cdfdde5bc9ef639623dd369&#34;)" href="#id5235cba80cdfdde5bc9ef639623dd369" aria-expanded="false" aria-controls="id5235cba80cdfdde5bc9ef639623dd369" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/architecture/open-interfaces/">开放接口</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id5235cba80cdfdde5bc9ef639623dd369" aria-expanded="false" aria-controls="id5235cba80cdfdde5bc9ef639623dd369">
    
        <i class="fa-solid fa-angle-right" id="caret-id5235cba80cdfdde5bc9ef639623dd369"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id5235cba80cdfdde5bc9ef639623dd369">
      



  <li class="child level1 "><a href="/kubernetes-handbook/architecture/open-interfaces/cri/">容器运行时接口（CRI）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/architecture/open-interfaces/cni/">容器网络接口（CNI）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/architecture/open-interfaces/csi/">容器存储接口（CSI）</a></li>

      
        </ul>
      
    

    
      </div>
    




  <li class="child level1 "><a href="/kubernetes-handbook/architecture/pod-state-and-lifecycle/">Pod 状态与生命周期管理</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id528d4c65696def64684891602bf56cea&#34;)" href="#id528d4c65696def64684891602bf56cea" aria-expanded="false" aria-controls="id528d4c65696def64684891602bf56cea" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/objects/">资源对象</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id528d4c65696def64684891602bf56cea" aria-expanded="false" aria-controls="id528d4c65696def64684891602bf56cea">
    
        <i class="fa-solid fa-angle-right" id="caret-id528d4c65696def64684891602bf56cea"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id528d4c65696def64684891602bf56cea">
      



  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-overview/">Pod 概览</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod/">Pod 解析</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/init-containers/">Init 容器</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pause-container/">Pause 容器</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-security-policy/">Pod 安全策略</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-lifecycle/">Pod 的生命周期</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-hook/">Pod Hook</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-preset/">Pod Preset</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/objects/pod-disruption-budget/">Pod 中断与 PDB（Pod 中断预算）</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id5f7947110be68464ddda435f73f486c6&#34;)" href="#id5f7947110be68464ddda435f73f486c6" aria-expanded="false" aria-controls="id5f7947110be68464ddda435f73f486c6" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/cluster/">集群资源管理</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id5f7947110be68464ddda435f73f486c6" aria-expanded="false" aria-controls="id5f7947110be68464ddda435f73f486c6">
    
        <i class="fa-solid fa-angle-right" id="caret-id5f7947110be68464ddda435f73f486c6"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id5f7947110be68464ddda435f73f486c6">
      



  <li class="child level1 "><a href="/kubernetes-handbook/cluster/node/">Node</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/namespace/">Namespace</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/label/">Label</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/annotation/">Annotation</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/taint-and-toleration/">Taint 和 Toleration（污点和容忍）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/garbage-collection/">垃圾收集</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/scheduling/">资源调度</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cluster/qos/">服务质量等级（QoS）</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id3f197055c94b13a8d5b6dadedae045e9&#34;)" href="#id3f197055c94b13a8d5b6dadedae045e9" aria-expanded="false" aria-controls="id3f197055c94b13a8d5b6dadedae045e9" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/controllers/">控制器</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id3f197055c94b13a8d5b6dadedae045e9" aria-expanded="false" aria-controls="id3f197055c94b13a8d5b6dadedae045e9">
    
        <i class="fa-solid fa-angle-right" id="caret-id3f197055c94b13a8d5b6dadedae045e9"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id3f197055c94b13a8d5b6dadedae045e9">
      



  <li class="child level1 "><a href="/kubernetes-handbook/controllers/deployment/">Deployment</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/statefulset/">StatefulSet</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/daemonset/">DaemonSet</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/replicaset/">ReplicationController 和 ReplicaSet</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/job/">Job</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/cronjob/">CronJob</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/ingress-controller/">Ingress 控制器</a></li>




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id1305caed340adca3586fc3ecb621506e&#34;)" href="#id1305caed340adca3586fc3ecb621506e" aria-expanded="false" aria-controls="id1305caed340adca3586fc3ecb621506e" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/controllers/hpa/">Horizontal Pod Autoscaling</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id1305caed340adca3586fc3ecb621506e" aria-expanded="false" aria-controls="id1305caed340adca3586fc3ecb621506e">
    
        <i class="fa-solid fa-angle-right" id="caret-id1305caed340adca3586fc3ecb621506e"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id1305caed340adca3586fc3ecb621506e">
      



  <li class="child level1 "><a href="/kubernetes-handbook/controllers/hpa/custom-metrics-hpa/">自定义指标 HPA</a></li>

      
        </ul>
      
    

    
      </div>
    




  <li class="child level1 "><a href="/kubernetes-handbook/controllers/admission-controller/">准入控制器（Admission Controller）</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id51b39f10b5de042922548deb3e5f2917&#34;)" href="#id51b39f10b5de042922548deb3e5f2917" aria-expanded="false" aria-controls="id51b39f10b5de042922548deb3e5f2917" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/service-discovery/">服务发现与路由</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id51b39f10b5de042922548deb3e5f2917" aria-expanded="false" aria-controls="id51b39f10b5de042922548deb3e5f2917">
    
    <i class="fa-solid fa-angle-down" id="caret-id51b39f10b5de042922548deb3e5f2917"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="id51b39f10b5de042922548deb3e5f2917">
      



  <li class="child level1 "><a href="/kubernetes-handbook/service-discovery/service/">Service</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/service-discovery/topology-aware-routing/">拓扑感知路由</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/service-discovery/ingress/">Ingress</a></li>




  <li class="child level1 active"><a href="/kubernetes-handbook/service-discovery/gateway/">Gateway API</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id83f67bc6ee0cdcfaabe750f2e6b0f2f6&#34;)" href="#id83f67bc6ee0cdcfaabe750f2e6b0f2f6" aria-expanded="false" aria-controls="id83f67bc6ee0cdcfaabe750f2e6b0f2f6" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/auth/">身份与权限认证</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id83f67bc6ee0cdcfaabe750f2e6b0f2f6" aria-expanded="false" aria-controls="id83f67bc6ee0cdcfaabe750f2e6b0f2f6">
    
        <i class="fa-solid fa-angle-right" id="caret-id83f67bc6ee0cdcfaabe750f2e6b0f2f6"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id83f67bc6ee0cdcfaabe750f2e6b0f2f6">
      



  <li class="child level1 "><a href="/kubernetes-handbook/auth/serviceaccount/">ServiceAccount</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/rbac/">基于角色的访问控制（RBAC）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/network-policy/">NetworkPolicy</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/spiffe/">SPIFFE</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/spire/">SPIRE</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/spire-k8s-workload-registar/">SPIRE Kubernetes 工作负载注册器</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/auth/svid/">SVID 身份颁发过程</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id6a059edbd97606180ebe2aaf44081e70&#34;)" href="#id6a059edbd97606180ebe2aaf44081e70" aria-expanded="false" aria-controls="id6a059edbd97606180ebe2aaf44081e70" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/networking/">网络</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id6a059edbd97606180ebe2aaf44081e70" aria-expanded="false" aria-controls="id6a059edbd97606180ebe2aaf44081e70">
    
        <i class="fa-solid fa-angle-right" id="caret-id6a059edbd97606180ebe2aaf44081e70"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id6a059edbd97606180ebe2aaf44081e70">
      



  <li class="child level1 "><a href="/kubernetes-handbook/networking/flannel/">扁平网络 Flannel</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/networking/calico/">非 Overlay 扁平网络 Calico</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/networking/cilium/">基于 eBPF 的网络 Cilium</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id4afd31d71b0044b768ee90d55789b138&#34;)" href="#id4afd31d71b0044b768ee90d55789b138" aria-expanded="false" aria-controls="id4afd31d71b0044b768ee90d55789b138" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/storage/">存储</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id4afd31d71b0044b768ee90d55789b138" aria-expanded="false" aria-controls="id4afd31d71b0044b768ee90d55789b138">
    
        <i class="fa-solid fa-angle-right" id="caret-id4afd31d71b0044b768ee90d55789b138"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id4afd31d71b0044b768ee90d55789b138">
      



  <li class="child level1 "><a href="/kubernetes-handbook/storage/secret/">Secret</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/configmap/">ConfigMap</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/configmap-hot-update/">ConfigMap 的热更新</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/volume/">Volume</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/persistent-volume/">持久化卷（Persistent Volume）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/storageclass/">Storage Class</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/storage/local-persistent-storage/">本地持久化存储</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id0cab44150887dd65000491f8468d000b&#34;)" href="#id0cab44150887dd65000491f8468d000b" aria-expanded="false" aria-controls="id0cab44150887dd65000491f8468d000b" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/extend/">扩展集群</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id0cab44150887dd65000491f8468d000b" aria-expanded="false" aria-controls="id0cab44150887dd65000491f8468d000b">
    
        <i class="fa-solid fa-angle-right" id="caret-id0cab44150887dd65000491f8468d000b"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id0cab44150887dd65000491f8468d000b">
      



  <li class="child level1 "><a href="/kubernetes-handbook/extend/custom-resource/">使用自定义资源扩展 API</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/extend/crd/">使用 CRD 扩展 Kubernetes API</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/extend/aggregated-api-server/">Aggregated API Server</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/extend/apiservice/">APIService</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/extend/service-catalog/">服务目录（Service Catalog）</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id11b1a3d59469083a51bc4a3a260882d0&#34;)" href="#id11b1a3d59469083a51bc4a3a260882d0" aria-expanded="false" aria-controls="id11b1a3d59469083a51bc4a3a260882d0" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/multi-cluster/">多集群管理</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id11b1a3d59469083a51bc4a3a260882d0" aria-expanded="false" aria-controls="id11b1a3d59469083a51bc4a3a260882d0">
    
        <i class="fa-solid fa-angle-right" id="caret-id11b1a3d59469083a51bc4a3a260882d0"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id11b1a3d59469083a51bc4a3a260882d0">
      



  <li class="child level1 "><a href="/kubernetes-handbook/multi-cluster/multi-cluster-services-api/">多集群服务 API（Multi-Cluster Services API）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/multi-cluster/federation/">集群联邦（Cluster Federation）</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id3396c3af7146803a9f677d4b70e50de6&#34;)" href="#id3396c3af7146803a9f677d4b70e50de6" aria-expanded="false" aria-controls="id3396c3af7146803a9f677d4b70e50de6" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/config/">资源对象配置</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id3396c3af7146803a9f677d4b70e50de6" aria-expanded="false" aria-controls="id3396c3af7146803a9f677d4b70e50de6">
    
        <i class="fa-solid fa-angle-right" id="caret-id3396c3af7146803a9f677d4b70e50de6"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id3396c3af7146803a9f677d4b70e50de6">
      



  <li class="child level1 "><a href="/kubernetes-handbook/config/liveness-readiness-probes/">配置 Pod 的 liveness 和 readiness 探针</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/config/service-account/">配置 Pod 的 Service Account</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/config/secret/">Secret 配置</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/config/quota/">管理 namespace 中的资源配额</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id9432cd9464f96ac8fb74b2e54b9e3fb7&#34;)" href="#id9432cd9464f96ac8fb74b2e54b9e3fb7" aria-expanded="false" aria-controls="id9432cd9464f96ac8fb74b2e54b9e3fb7" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/cli/">命令使用</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id9432cd9464f96ac8fb74b2e54b9e3fb7" aria-expanded="false" aria-controls="id9432cd9464f96ac8fb74b2e54b9e3fb7">
    
        <i class="fa-solid fa-angle-right" id="caret-id9432cd9464f96ac8fb74b2e54b9e3fb7"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id9432cd9464f96ac8fb74b2e54b9e3fb7">
      



  <li class="child level1 "><a href="/kubernetes-handbook/cli/docker-cli-to-kubectl/">Docker 用户过渡到 kubectl 命令行指南</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cli/using-kubectl/">Kubectl 命令概览</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cli/kubectl-cheatsheet/">Kubectl 命令技巧大全</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/cli/etcdctl/">使用 etcdctl 访问 Kubernetes 数据</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id1abac824294628e7cff36f41dbb71c3d&#34;)" href="#id1abac824294628e7cff36f41dbb71c3d" aria-expanded="false" aria-controls="id1abac824294628e7cff36f41dbb71c3d" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/security/">集群安全性管理</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id1abac824294628e7cff36f41dbb71c3d" aria-expanded="false" aria-controls="id1abac824294628e7cff36f41dbb71c3d">
    
        <i class="fa-solid fa-angle-right" id="caret-id1abac824294628e7cff36f41dbb71c3d"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id1abac824294628e7cff36f41dbb71c3d">
      



  <li class="child level1 "><a href="/kubernetes-handbook/security/managing-tls-in-a-cluster/">管理集群中的 TLS</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/kubelet-authentication-authorization/">Kublet 的认证授权</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/tls-bootstrapping/">TLS Bootstrap</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/ip-masq-agent/">IP 伪装代理</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/kubectl-user-authentication-authorization/">创建用户认证授权的 kubeconfig 文件</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/auth-with-kubeconfig-or-token/">使用 kubeconfig 或 token 进行用户身份认证</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/authentication/">Kubernetes 中的用户与身份认证授权</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/security/kubernetes-security-best-practice/">Kubernetes 集群安全性配置最佳实践</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id4a9742305255d7165d7d937334668ca7&#34;)" href="#id4a9742305255d7165d7d937334668ca7" aria-expanded="false" aria-controls="id4a9742305255d7165d7d937334668ca7" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/access/">访问集群</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id4a9742305255d7165d7d937334668ca7" aria-expanded="false" aria-controls="id4a9742305255d7165d7d937334668ca7">
    
        <i class="fa-solid fa-angle-right" id="caret-id4a9742305255d7165d7d937334668ca7"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id4a9742305255d7165d7d937334668ca7">
      



  <li class="child level1 "><a href="/kubernetes-handbook/access/methods/">访问集群</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/authenticate-across-clusters-kubeconfig/">使用 kubeconfig 文件配置跨集群认证</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/connecting-to-applications-port-forward/">通过端口转发访问集群中的应用程序</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/service-access-application-cluster/">使用 service 访问群集中的应用程序</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/accessing-kubernetes-pods-from-outside-of-the-cluster/">从外部访问 Kubernetes 中的 Pod</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/lens/">Lens - Kubernetes IDE</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/access/kubernator-kubernetes-ui/">Kubernator - 更底层的 Kubernetes UI</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id2362b5c8e84c9690a86fd2d7ebcf5706&#34;)" href="#id2362b5c8e84c9690a86fd2d7ebcf5706" aria-expanded="false" aria-controls="id2362b5c8e84c9690a86fd2d7ebcf5706" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/devops/">部署应用</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id2362b5c8e84c9690a86fd2d7ebcf5706" aria-expanded="false" aria-controls="id2362b5c8e84c9690a86fd2d7ebcf5706">
    
        <i class="fa-solid fa-angle-right" id="caret-id2362b5c8e84c9690a86fd2d7ebcf5706"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id2362b5c8e84c9690a86fd2d7ebcf5706">
      



  <li class="child level1 "><a href="/kubernetes-handbook/devops/deploy-applications-in-kubernetes/">适用于 Kubernetes 的应用开发部署流程</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/devops/migrating-hadoop-yarn-to-kubernetes/">迁移传统应用到 Kubernetes 步骤详解——以 Hadoop YARN 为例</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/devops/using-statefulset/">使用 StatefulSet 部署有状态应用</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/devops/ci-cd/">持续集成与交付（CI/CD）</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/devops/kustomize/">使用 Kustomize 配置 Kubernetes 应用</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id833067b935f1e6259f9861a83fb17a3a&#34;)" href="#id833067b935f1e6259f9861a83fb17a3a" aria-expanded="false" aria-controls="id833067b935f1e6259f9861a83fb17a3a" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/kubernetes-handbook/develop/">开发指南</a>
    <a class="nav-toogle d-inline level1" aria-hidden="false" data-toggle="collapse" href="#id833067b935f1e6259f9861a83fb17a3a" aria-expanded="false" aria-controls="id833067b935f1e6259f9861a83fb17a3a">
    
        <i class="fa-solid fa-angle-right" id="caret-id833067b935f1e6259f9861a83fb17a3a"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id833067b935f1e6259f9861a83fb17a3a">
      



  <li class="child level1 "><a href="/kubernetes-handbook/develop/sigs-and-working-group/">SIG 和工作组</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/developing-environment/">配置 Kubernetes 开发环境</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/testing/">测试 Kubernetes</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/client-go-sample/">client-go 示例</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/operator/">Operator</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/operator-sdk/">Operator SDK</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/kubebuilder/">Kubebuilder</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/advance-developer/">高级开发指南</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/contribute/">参与 Kubernetes 社区贡献</a></li>




  <li class="child level1 "><a href="/kubernetes-handbook/develop/minikube/">Minikube</a></li>

      
        </ul>
      
    

    
      </div>
    

      
    

    
      </ul>
    

  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#目标">目标</a></li>
    <li><a href="#gateway-api-与-ingress-有什么不同">Gateway API 与 Ingress 有什么不同？</a></li>
    <li><a href="#gateway-相较于-ingress-做了哪些改进">Gateway 相较于 Ingress 做了哪些改进？</a></li>
    <li><a href="#角色划分">角色划分</a></li>
    <li><a href="#资源模型">资源模型</a>
      <ul>
        <li><a href="#gatewayclass">GatewayClass</a></li>
        <li><a href="#gateway">Gateway</a></li>
        <li><a href="#route">Route</a></li>
        <li><a href="#referencegrant">ReferenceGrant</a></li>
      </ul>
    </li>
    <li><a href="#将路由添加到网关">将路由添加到网关</a>
      <ul>
        <li><a href="#路由绑定">路由绑定</a></li>
      </ul>
    </li>
    <li><a href="#策略附件">策略附件</a>
      <ul>
        <li><a href="#策略优先级">策略优先级</a></li>
      </ul>
    </li>
    <li><a href="#引用网关">引用网关</a>
      <ul>
        <li><a href="#限制路由附加">限制路由附加</a></li>
        <li><a href="#gateway---route-附加示例">Gateway - Route 附加示例</a></li>
        <li><a href="#组合类型">组合类型</a></li>
      </ul>
    </li>
    <li><a href="#请求流程">请求流程</a></li>
    <li><a href="#tls-配置">TLS 配置</a>
      <ul>
        <li><a href="#下游-tls">下游 TLS</a></li>
        <li><a href="#监听器和-tls">监听器和 TLS</a></li>
        <li><a href="#示例">示例</a></li>
        <li><a href="#扩展">扩展</a></li>
      </ul>
    </li>
    <li><a href="#扩展点">扩展点</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>

      
<div class="subscribe-module col-12 mt-1">
    <img src="/img/wechat.webp" alt="image" title="Jimmy Song的微信公众号"/>
    <p class="text-center pt-1">扫码联系站长</p>
    
    
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4029167986768912"
     crossorigin="anonymous"></script>
     <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-4029167986768912"
       data-ad-slot="6856371908"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
    
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          主站
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/kubernetes-handbook/">
        
          Kubernetes 基础教程
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/kubernetes-handbook/service-discovery/">
        
          服务发现与路由
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        Gateway API
      </li>
    </ol>
  </nav>




          

          <h1>Gateway API</h1>

          <div class="article-style">
            <div class="alert-note-title">
    <p>注意</p>
</div>
<div class="alert alert-note">
    本文根据 Gateway API 0.5.1 版本撰写。目前 Gateway API 仅用于处理 Kubernetes 集群中的南北向（入口）流量，未来也有可能处理集群内（东西向）流量。关于使用 Gateway API 处理东西向流量的提议详见<a href="https://docs.google.com/document/d/1T_DtMQoq2tccLAtJTpo3c0ohjm25vRS35MsestSL9QU/edit" target="_blank" rel="noopener">此文档</a>。
</div>

<p>除了直接使用 Service 和 Ingress 之外，Kubernetes 社区还发起了 <a href="https://github.com/kubernetes-sigs/gateway-api" target="_blank" rel="noopener">Gateway API 项目</a>，它可以帮助我们将 Kubernetes 中的服务暴露到集群外。</p>
<p>Gateway API 是一个由 <a href="https://github.com/kubernetes/community/tree/master/sig-network" target="_blank" rel="noopener">SIG-NETWORK</a> 管理的开源项目。该项目的目标是在 Kubernetes 生态系统中发展服务网络 API。Gateway API 提供了暴露 Kubernetes 应用的资源——<code>GatewayClass</code>、<code>Gateway</code>、<code>HTTPRoute</code>、<code>TCPRoute</code> 等。</p>
<p>Gateway API 已经得到了大量的网关和服务网格项目支持，请在 Gateway 官方文档中<a href="https://gateway-api.sigs.k8s.io/implementations/" target="_blank" rel="noopener">查看支持状况</a>。</p>
<h2 id="目标">目标</h2>
<p>Gateway API 旨在通过提供表现性的、可扩展的、面向角色的接口来改善服务网络，这些接口由许多厂商实现，并得到了业界的广泛支持。</p>
<p>Gateway API 是一个 API 资源的集合 —— <code>GatewayClass</code>、<code>Gateway</code>、<code>HTTPRoute</code>、<code>TCPRoute</code> 等。使用这些资源共同为各种网络用例建模。</p>
<p>下图中展示的是 Kubernetes 集群中四层和七层的网络配置。从图中可以看到通过将这些资源对象分离，可以实现配置上的解耦，由不同角色的人员来管理，而这也是 Gateway API 的相较于 Ingress 的一大特色。</p>
<p>















<figure  id="figure-kubernetes-gateway-api-简介">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/gateway-api.svg" alt="Kubernetes Gateway API 简介" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Kubernetes Gateway API 简介
    </figcaption></figure>
</p>
<h2 id="gateway-api-与-ingress-有什么不同">Gateway API 与 Ingress 有什么不同？</h2>
<p>Ingress 的主要目标是用简单的、声明性的语法来暴露 HTTP 应用。Gateway API 暴露了一个更通用的代理 API，可以用于更多的协议，而不仅仅是 HTTP，并为更多的基础设施组件建模，为集群运营提供更好的部署和管理选项。</p>
<h2 id="gateway-相较于-ingress-做了哪些改进">Gateway 相较于 Ingress 做了哪些改进？</h2>
<p>以下是 Gateway API 对 Ingress 的改进点。</p>
<p><strong>更具表现力</strong></p>
<p>Gateway 表达了更多的核心功能，比如基于头的匹配、流量加权和其他功能，而这些功能在 Ingress 中只能通过自定义方式实现。</p>
<p><strong>更具扩展性</strong></p>
<p>Gateway API 允许在 API 的各个层次上链接自定义资源。这就允许在 API 结构的适当位置进行更精细的定制。</p>
<p><strong>面向角色</strong></p>
<p>它们被分离成不同的 API 资源，这些资源映射到 Kubernetes 上运行应用程序的常见角色。</p>
<p><strong>通用性</strong></p>
<p>这不是一种改进，而是应该保持不变。正如 Ingress 是一个具有众多实现的通用规范一样，Gateway API 被设计成一个由许多实现支持的可移植规范。</p>
<p><strong>共享网关</strong></p>
<p>它们允许独立的路由资源绑定到同一个网关，从而实现负载均衡器和 VIP 的共享。这允许团队安全地共享基础设施，而不需要直接协调。</p>
<p><strong>类型化后端引用</strong></p>
<p>通过类型化后端引用，Routes 可以引用 Kubernetes 服务，也可以引用任何一种被设计为 Gateway 后端的 Kubernetes 资源。</p>
<p><strong>跨命名空间引用</strong></p>
<p>跨越不同 Namespaces 的路由可以绑定到网关。这样，尽管对工作负载进行了命名空间划分，但仍可共享网络基础设施。</p>
<p><strong>类</strong></p>
<p><code>GatewayClass</code> 将负载均衡实现的类型形式化。这些类使用户可以很容易和明确地了解资源模型本身有什么样的能力。</p>
<p>在了解了 Gateway API 的目的后，接下来我们再看下它的资源模型、请求流程、TLS 配置及扩展点等。</p>
<h2 id="角色划分">角色划分</h2>
<p>Gateway API 开发者为其使用场景定义四类角色：</p>
<ul>
<li>基础设施提供方：如 AWS、GKE 等</li>
<li>集群运维：管理整个集群的计算、存储、网络、安全等</li>
<li>应用程序开发者：为自己开发的应用负责，管理应用的健壮性</li>
<li>应用管理员：不是所有的公司都有，通常在一些复杂系统中会有专门的应用管理员</li>
</ul>
<p>Gateway API 通过 Kubernetes 服务网络的面向角色的设计在分布式灵活性和集中控制之间取得了平衡。使得许多不同的非协调团队可以使用共享网络基础设施（硬件负载均衡器、云网络、集群托管代理等），所有团队都受集群运维设置的策略约束。下图展示了在进行 Gateway 管理时的角色划分。</p>
<p>















<figure  id="figure-gateway-管理中的角色划分图片来自httpsgateway-apisigsk8sio">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/gateway-roles.jpg" alt="Gateway 管理中的角色划分（图片来自：https://gateway-api.sigs.k8s.io/）" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Gateway 管理中的角色划分（图片来自：https://gateway-api.sigs.k8s.io/）
    </figcaption></figure>
</p>
<p>集群运维人员创建从 <a href="https://gateway-api.sigs.k8s.io/api-types/gatewayclass" target="_blank" rel="noopener">GatewayClass</a> 派生的 <a href="https://gateway-api.sigs.k8s.io/api-types/gateway" target="_blank" rel="noopener">Gateway</a> 资源。此 Gateway 部署或配置它所代表的底层网络资源。通过 Gateway 和 Route 之间的<a href="https://gateway-api.sigs.k8s.io/concepts/api-overview#attaching-routes-to-gateways" target="_blank" rel="noopener">路由附加进程</a> ，集群运维人员和特定团队必须就可以附加到此 Gateway 并通过它公开其应用程序的内容达成一致。集群运维人员可以在网关上实施  <a href="https://gateway-api.sigs.k8s.io/guides/tls#downstream-tls" target="_blank" rel="noopener">TLS</a> 集中式策略。同时，Store 和 Site 团队<a href="https://gateway-api.sigs.k8s.io/guides/multiple-ns" target="_blank" rel="noopener">在他们自己的 Namespaces 中</a>运行，但是将他们的 Routes 附加到同一个共享 Gateway，允许他们独立控制自己的<a href="https://gateway-api.sigs.k8s.io/guides/http-routing" target="_blank" rel="noopener">路由逻辑</a>。这种关注点分离允许 Store 队管理自己的<a href="https://gateway-api.sigs.k8s.io/guides/traffic-splitting" target="_blank" rel="noopener">流量拆分部署</a>，同时将集中策略和控制权留给集群运维人员。</p>
<p>这种灵活性技能保持 API 的标准和可移植性，还使其可以适应截然不同的组织模型和实现。</p>
<h2 id="资源模型">资源模型</h2>
<p>注意：资源最初将作为 CRD 存在于 <code>networking.x-k8s.io</code> API 组中。未限定的资源名称将隐含在该 API 组中。</p>
<p>Gateway API 的资源模型中，主要有三种类型的对象：</p>
<ul>
<li><code>GatewayClass</code>：定义了一组具有共同配置和行为的网关。</li>
<li><code>Gateway</code>：流量请求端点，流量从这里被翻译成集群内的服务。</li>
<li><code>Route</code>：描述了通过 Gateway 而来的流量如何映射到服务。</li>
</ul>
<h3 id="gatewayclass">GatewayClass</h3>
<p><code>GatewayClass</code> 定义了一组共享共同配置和行为的 Gateway，每个 <code>GatewayClass</code> 由一个控制器处理，但控制器可以处理多个 <code>GatewayClass</code>。</p>
<p><code>GatewayClass</code> 是一个集群范围的资源。必须至少定义一个 <code>GatewayClass</code>，<code>Gateway</code> 才能够生效。实现 Gateway API 的控制器通过关联的 <code>GatewayClass</code> 资源来实现，用户可以在自己的 <code>Gateway</code> 中引用该资源。</p>
<p>这类似于 <code>Ingress</code> 的 <code>IngressClass</code> 和 <code>PersistentVolumes</code> 的 <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener"><code>StorageClass</code></a>。在 <code>Ingress</code> v1beta1 中，最接近 <code>GatewayClass</code> 的是 <code>ingress-class</code> 注解，而在 Ingress V1 中，它的作用与 <code>IngressClass</code> 一样。</p>
<p>下面是一个 <code>GatewayClass</code> 的配置示例。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">GatewayClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cluster-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">controllerName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;example.net/gateway-controller&#34;</span><span class="w">
</span></span></span></code></pre></div><p><code>GatewayClass</code> 一般由基础设施提供商来创建，用户不需要关注控制器如何实现，只需要了解该 <code>GatewayClass</code> 创建的对应 <code>Gateway</code> 的属性即可。</p>
<p>Gateway API 的提供者还可以开放了一部分参数配置给网关管理员，管理员可以使用 <code>GatewayClass.spec.parametersRef</code> 字段来配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">GatewayClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">internet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">controllerName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;example.net/gateway-controller&#34;</span><span class="w"> </span><span class="c"># 该字段的值应为集群唯一的</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parametersRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">example.net/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">internet-gateway-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">example.net/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">internet-gateway-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ip-address-pool</span><span class="p">:</span><span class="w"> </span><span class="l">internet-vips</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span></code></pre></div><p>建议使用 <code>GatewayClass.spec.parametersRef</code> 自定义资源配置，不过你也可以使用 ConfigMap。</p>
<p>在刚部署 GatewayClass 后，<code>GatewayClass.status</code>  中的状态类型为 <code>Accepted</code> 但是 <code>status</code> 为 <code>False</code>，控制器处理完配置后 <code>status</code> 将变为 <code>True</code>，如果在该过程中出现错误，那么会显示在状态中，如下所示。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">GatewayClass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">conditions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Accepted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Reason</span><span class="p">:</span><span class="w"> </span><span class="l">BadFooBar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Message</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;foobar&#34;</span><span class="w"> </span><span class="l">is an FooBar.</span><span class="w">
</span></span></span></code></pre></div><h3 id="gateway">Gateway</h3>
<p><code>Gateway</code> 描述了如何将流量翻译到集群内的服务。它定义了一个将流量从不了解 Kubernetes 的地方翻译到了解 Kubernetes 的地方的方法。例如，由云负载均衡器、集群内代理或外部硬件负载均衡器发送到 Kubernetes 服务的流量。虽然许多用例的客户端流量源自集群的 &ldquo;外部&rdquo;，但这并不是必需的。</p>
<p><code>Gateway</code> 定义了对实现 <code>GatewayClass</code> 配置和行为约定的特定负载均衡器配置的请求。该资源可以由运维人员直接创建，也可以由处理 <code>GatewayClass</code> 的控制器创建。</p>
<p>由于 <code>Gateway</code> 规范捕获了用户意图，它可能不包含规范中所有属性的完整规范。例如，用户可以省略地址、端口、TLS 设置等字段。这使得管理 <code>GatewayClass</code> 的控制器可以为用户提供这些缺省设置，从而使规范更加可移植。这种行为将通过 <code>GatewayClass</code> 状态对象来明确。</p>
<p>一个 <code>Gateway</code> 可以包含一个或多个 <code>Route</code> 引用，这些 <code>Route</code> 引用的作用是将一个子集的流量引导到一个特定的服务上。</p>
<p><code>Gateway</code> 规范中定义了以下内容：</p>
<ul>
<li><code>GatewayClassName</code>：定义此网关使用的  <code>GatewayClass</code>  对象的名称。</li>
<li><code>Listeners</code>：定义主机名、端口、协议、终止、TLS 设置以及哪些路由可以附加到监听器。</li>
<li><code>Addresses</code>：定义为此 Gateway 请求的网络地址。</li>
</ul>
<p>如果以上规范中的配置无法实现，Gateway 将处于错误状态，状态条件中会显示详细信息。</p>
<p>下面展示的是使用 <a href="https://gateway.envoyproxy.io/" target="_blank" rel="noopener">Envoy Gateway</a> 生成的 Gateway 示例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kubectl.kubernetes.io/last-applied-configuration</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      </span><span class="w">      </span>{<span class="s2">&#34;apiVersion&#34;</span><span class="p">:</span><span class="s2">&#34;gateway.networking.k8s.io/v1beta1&#34;</span><span class="p">,</span><span class="s2">&#34;kind&#34;</span><span class="p">:</span><span class="s2">&#34;Gateway&#34;</span><span class="p">,</span><span class="s2">&#34;metadata&#34;</span><span class="p">:</span>{<span class="s2">&#34;annotations&#34;</span><span class="p">:</span>{}<span class="p">,</span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;eg&#34;</span><span class="p">,</span><span class="s2">&#34;namespace&#34;</span><span class="p">:</span><span class="s2">&#34;default&#34;</span>}<span class="p">,</span><span class="s2">&#34;spec&#34;</span><span class="p">:</span>{<span class="s2">&#34;gatewayClassName&#34;</span><span class="p">:</span><span class="s2">&#34;eg&#34;</span><span class="p">,</span><span class="s2">&#34;listeners&#34;</span><span class="p">:[</span>{<span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;http&#34;</span><span class="p">,</span><span class="s2">&#34;port&#34;</span><span class="p">:</span><span class="m">8080</span><span class="p">,</span><span class="s2">&#34;protocol&#34;</span><span class="p">:</span><span class="s2">&#34;HTTP&#34;</span>}<span class="p">]</span>}}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2022-10-22T07:03:28Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">generation</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">eg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;326707757&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l">20f37614-1814-4c4a-b3ee-8d923a1a78f8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">eg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">allowedRoutes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">Same</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">IPAddress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">11.11.11.11</span><span class="w"> </span><span class="c"># 如果 Envoy Gateway 部署在云上，云会创建一个 LoadBalancer 实例从而获得一个外部 IP，该 IP 为网关 IP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">conditions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2022-10-22T07:03:28Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">The Gateway has been scheduled by Envoy Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">observedGeneration</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l">Scheduled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;True&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Scheduled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2022-10-22T07:04:17Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">Address assigned to the Gateway, 1/1 envoy Deployment replicas available</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">observedGeneration</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l">Ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;True&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">attachedRoutes</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">conditions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2022-10-22T07:03:30Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">Listener is ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">observedGeneration</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l">Ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;True&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">supportedKinds</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span></code></pre></div><p>从上面的示例中我们可以看到 <code>status</code> 中显示了 Gateway 的状态，如网关的 IP 地址，监听器上附着的路由以及更新时间。</p>
<h3 id="route">Route</h3>
<p><code>Route</code> 对象定义了特定协议的规则，用于将请求从 <code>Gateway</code> 映射到 Kubernetes 服务。</p>
<p>从 v1alpha2 开始，Gateway API 中包含四种 <code>Route</code> 资源类型。对于其他协议，鼓励使用特定于实现的自定义路由类型。未来可能会向 API 添加新的路由类型。</p>
<div class="alert-note-title">
    <p>注意</p>
</div>
<div class="alert alert-note">
    目前只有 <code>HTTPRoute</code> 是 Gateway API 正式支持的，其他的路由类型还在实验中，详见<a href="https://gateway-api.sigs.k8s.io/concepts/versioning/" target="_blank" rel="noopener">版本文档</a>。
</div>

<h4 id="httproute">HTTPRoute</h4>
<p><code>HTTPRoute</code> 用于多路复用 HTTP 或终止的 HTTPS 连接。它适用于检查 HTTP 流并使用 HTTP 请求数据进行路由或修改的情况，例如使用 HTTP Header 进行路由或在运行中修改它们。</p>
<p>HTTPRoute 的规范中包括：</p>
<ul>
<li><code>parentRefs</code>：定义此路由要附加到的 Gateway。</li>
<li><code>hostnames</code>（可选）：定义用于匹配 HTTP 请求的主机头的主机名列表。</li>
<li><code>rules</code>：定义规则列表以针对匹配的 HTTP 请求执行操作。每条规则由 <code>matches</code>、<code>filters</code>（可选）和 <code>backendRefs</code>（可选）字段组成。</li>
</ul>
<p>下图展示了流量经过网关和 HTTPRoute 发送到服务中的过程。</p>
<p>















<figure  id="figure-流量经过网关和-httproute-到服务中的过程">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/httproute-basic-example.svg" alt="流量经过网关和 HTTPRoute 到服务中的过程" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      流量经过网关和 HTTPRoute 到服务中的过程
    </figcaption></figure>
</p>
<h4 id="tlsroute">TLSRoute</h4>
<p><code>TLSRoute</code> 用于多路复用 TLS 连接，通过 SNI 进行区分。它适用于使用 SNI 作为主要路由方法的地方，并且对 HTTP 等高级协议的属性不感兴趣。连接的字节流被代理，无需对后端进行任何检查。</p>
<h4 id="tcproute-和-udproute">TCPRoute 和 UDPRoute</h4>
<p><code>TCPRoute</code>（和 <code>UDPRoute</code>）旨在用于将一个或多个端口映射到单个后端。在这种情况下，没有可用于在同一端口上选择不同后端的鉴别器（Discriminator），因此每个 <code>TCPRoute</code> 确实需要监听器上的不同端口。你可以终止 TLS，在这种情况下，未加密的字节流被传递到后端。你可以选择不终止 TLS，在这种情况下，加密的字节流被传递到后端。</p>
<h4 id="grcproute">GRCPRoute</h4>
<p><code>GRPCRoute</code> 用于路由 gRPC 流量。支持 <code>GRPCRoute</code> 的网关需要支持 HTTP/2，而无需从 HTTP/1 进行初始升级，因此可以保证 gRPC 流量正常流动。</p>
<h4 id="route-类型列表">Route 类型列表</h4>
<p>下面的「路由鉴别器」一栏是指可以使用哪些信息来允许多个 Routes 共享 Listener 上的端口。</p>
<table>
<thead>
<tr>
<th style="text-align:left">对象</th>
<th style="text-align:left">OSI 层</th>
<th style="text-align:left">路由鉴别器</th>
<th style="text-align:left">TLS 支持</th>
<th style="text-align:left">目的</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>HTTPRoute</code></td>
<td style="text-align:left">第 7 层</td>
<td style="text-align:left">HTTP 协议中的任何内容</td>
<td style="text-align:left">仅终止</td>
<td style="text-align:left">HTTP 和 HTTPS 路由</td>
</tr>
<tr>
<td style="text-align:left"><code>TLSRoute</code></td>
<td style="text-align:left">第 4 层和第 7 层之间的某个位置</td>
<td style="text-align:left">SNI 或其他 TLS 属性</td>
<td style="text-align:left">直通或终止</td>
<td style="text-align:left">TLS 协议的路由，包括不需要检查 HTTP 流的 HTTPS</td>
</tr>
<tr>
<td style="text-align:left"><code>TCPRoute</code></td>
<td style="text-align:left">第 4 层</td>
<td style="text-align:left">目的端口</td>
<td style="text-align:left">直通或终止</td>
<td style="text-align:left">允许将 TCP 流从 Listener 转发到 Backends</td>
</tr>
<tr>
<td style="text-align:left"><code>UDPRoute</code></td>
<td style="text-align:left">第 4 层</td>
<td style="text-align:left">目的端口</td>
<td style="text-align:left">没有任何</td>
<td style="text-align:left">允许将 UDP 流从监听器转发到后端</td>
</tr>
<tr>
<td style="text-align:left"><code>GRPCRoute</code></td>
<td style="text-align:left">第 7 层</td>
<td style="text-align:left">gRPC 协议中的任何内容</td>
<td style="text-align:left">仅终止</td>
<td style="text-align:left">基于 HTTP/2 和 HTTP/2 明文的 gRPC 路由</td>
</tr>
</tbody>
</table>
<p>请注意，通过 <code>HTTPRoute</code> 和 <code>TCPRoute</code> 路由的流量可以在网关和后端之间进行加密（通常称为重新加密）。无法使用现有的 Gateway API 资源对其进行配置，但实现可以为此提供自定义配置，直到 Gateway API 定义了标准化方法。</p>
<h3 id="referencegrant">ReferenceGrant</h3>
<div class="alert-note-title">
    <p>注意</p>
</div>
<div class="alert alert-note">
    <code>ReferenceGrant</code> 资源仍在实验阶段，更多信息请参考<a href="https://gateway-api.sigs.k8s.io/concepts/versioning" target="_blank" rel="noopener">版本文档</a>。
</div>

<p><code>ReferenceGrant</code> 可用于在 Gateway API 中启用跨命名空间引用。特别是，路由可能会将流量转发到其他命名空间中的后端，或者 Gateway 可能会引用另一个命名空间中的 Secret。</p>
<p>过去，我们已经看到跨命名空间边界转发流量是一种理想的功能，但如果没有 <code>ReferenceGrant</code> 之类的保护措施，就会出现<a href="https://github.com/kubernetes/kubernetes/issues/103675" target="_blank" rel="noopener">漏洞</a>。</p>
<p>如果从其命名空间外部引用一个对象，则该对象的所有者必须创建一个 <code>ReferenceGrant</code> 资源以显式允许该引用，否则跨命名空间引用是无效的。</p>
<h2 id="将路由添加到网关">将路由添加到网关</h2>
<p>将 Route 附加到 Gateway 表示在 Gateway 上应用的配置，用于配置底层负载均衡器或代理。Route 如何以及哪些 Route 附加到 Gateway 由资源本身控制。Route 和 Gateway 资源具有内置控件以允许或限制它们的连接方式。组织可以同时利用 Kubernetes RBAC，实施有关如何公开  Route 以及在公开在哪些 Gateway 上公开的策略。</p>
<p>如何将 Route 附加到网关以实现不同的组织策略和责任范围有很大的灵活性。下面是 Gateway 和 Route 可以具有的关系：</p>
<ul>
<li><strong>一对一</strong>：Gateway 和 Route 可以由单个所有者部署和使用，具有一对一的关系。</li>
<li><strong>一对多</strong>：Gateway 可以绑定许多 Route，这些 Route 由来自不同命名空间的不同团队拥有。</li>
<li><strong>多对一</strong>：Route 也可以绑定到多个 Gateway，允许单个 Route 同时控制跨不同 IP、负载均衡器或网络的应用程序。</li>
</ul>
<h3 id="路由绑定">路由绑定</h3>
<p>当 <code>Route</code> 绑定到 <code>Gateway</code> 时，代表应用在 <code>Gateway</code> 上配置了底层的负载均衡器或代理。哪些 <code>Route</code> 如何绑定到 <code>Gateway</code> 是由资源本身控制的。<code>Route</code> 和 <code>Gateway</code> 资源具有内置的控制，以允许或限制它们之间如何相互选择。这对于强制执行组织策略以确定 <code>Route</code> 如何暴露以及在哪些 <code>Gateway</code> 上暴露非常有用。请看下面的例子。</p>
<p>一个 Kubernetes 集群管理员在 <code>Infra</code> 命名空间中部署了一个名为 <code>shared-gw</code> 的 <code>Gateway</code>，供不同的应用团队使用，以便将其应用暴露在集群之外。团队 A 和团队 B（分别在命名空间 &ldquo;A&rdquo; 和 &ldquo;B&rdquo; 中）将他们的 <code>Route</code> 绑定到这个 <code>Gateway</code>。它们互不相识，只要它们的 <code>Route</code> 规则互不冲突，就可以继续隔离运行。团队 C 有特殊的网络需求（可能是性能、安全或关键业务），他们需要一个专门的 <code>Gateway</code> 来代理。团队 C 在 &ldquo;C&rdquo; 命名空间中部署了自己的 <code>Gateway</code> <code>specialive-gw</code>，该 Gateway 只能由 &ldquo;C&rdquo; 命名空间中的应用使用。</p>
<p>不同命名空间及 <code>Gateway</code> 与 <code>Route</code> 的绑定关系如下图所示。</p>
<p>















<figure  id="figure-路由绑定示意图">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/gateway-api-route-binding.jpg" alt="路由绑定示意图" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      路由绑定示意图
    </figcaption></figure>
</p>
<p>将路由附加到网关包括以下步骤：</p>
<ol>
<li>Route 需要在其 <code>parentRefs</code> 字段中引用 Gateway 的条目；</li>
<li>Gateway 上至少有一个监听器允许其附加。</li>
</ol>
<h2 id="策略附件">策略附件</h2>
<p>策略附件（Policy Attachment）是一种自定义策略资源，例如超时、重试、健康检查等，这些功能在不同的网关实现中的细节各不相同个，为了 Gateway API 的可移植性，我们将这些工作作为插件附加到资源上。</p>
<p>附加到 Gateway API 资源和实施的策略必须使用以下方法来确保 API 实施之间的一致性。此模式包含三个主要组件：</p>
<ul>
<li>将策略附加到资源的标准化方法。</li>
<li>支持在策略资源中配置默认值和覆盖值。</li>
<li>用于说明默认值和覆盖值应如何交互的层次结构。</li>
</ul>
<p>这种标准化不仅可以实现一致的模式，还可以让未来的工具（例如 kubectl 插件）能够可视化已应用于给定资源的所有策略。</p>
<p>你可以使用 <code>targetRef</code> 字段指定策略附件附加到的资源对象，例如下所示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.acme.io/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RetryPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">maxRetries</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">targetRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">networking.acme.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ExternalService</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo.com</span><span class="w">
</span></span></span></code></pre></div><p>该在例子中，为一个外部服务配置了一个重试策略。你可以给几乎任何可以发送、接收流量的对象附加策略，例如 <code>GatewayClass</code>、<code>Gateway</code>、<code>Service</code>、<code>Route</code>、<code>Namespace</code> ，不过附加策略的时候，需要注意其优先级。</p>
<h3 id="策略优先级">策略优先级</h3>
<p>你可以给策略附件指定 <code>override</code> 和 <code>default</code> 值，其在入口和网格内不同资源上的覆盖值和默认值的优先级是如下图所示。</p>
<p>















<figure  id="figure-gateway-api-的默认值和覆盖值的优先层级">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/policy-attachment-level.svg" alt="Gateway API 的默认值和覆盖值的优先层级" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Gateway API 的默认值和覆盖值的优先层级
    </figcaption></figure>
</p>
<p>从图中我们可以看到：</p>
<ul>
<li>
<p>覆盖值：上层覆盖下层</p>
</li>
<li>
<p>默认值：下层覆盖上层</p>
</li>
</ul>
<h2 id="引用网关">引用网关</h2>
<p>Route 可以通过在 <code>parentRef</code> 中指定命名空间（如果 Route 和 Gateway 在同一个名称空间中则该配置是可选的）和 Gateway 的名称来引用 Gateway。Route 可以使用 <code>parentRef</code> 中的以下字段进一步选择 Gateway 下的监听器子集：</p>
<ol>
<li><strong>SectionName</strong>：当设置了 <code>sectionName</code> 时，Route 选择具有指定名称的监听器；</li>
<li><strong>Port</strong>：当设置了 <code>port</code> 时，Route 会选择所有指定的监听端口且协议与此类 Route 兼容的监听器。</li>
</ol>
<p>当设置了多个 <code>parentRef</code> 字段时，Route 选择满足这些字段中指定的所有条件的监听器。例如，当 <code>sectionName</code> 和 <code>port</code> 两者都设置时，Route 选择具有指定名称的监听器并在指定端口上监听。</p>
<h3 id="限制路由附加">限制路由附加</h3>
<p>每个 Gateway 监听器都可以通过以下机制限制其可以附加的路由：</p>
<ol>
<li><strong>Hostname</strong>：如果监听器上设置了 <code>hostname</code> ，附加路由的 <code>hostnames</code> 中必须至少有一个重叠值。</li>
<li><strong>Namespace</strong>：监听器上的 <code>allowedRoutes.namespaces</code> 字段可用于限制可以附加路由的位置。该 <code>namespaces.from</code> 字段支持以下值：
<ul>
<li><code>SameNamespace</code> 是默认选项。只有与该网关相同的命名空间中的路由才会被选择。</li>
<li><code>All</code> 可选择来自所有命名空间的 <code>Route</code>。</li>
<li><code>Selector</code> 意味着该网关将选择由 Namespace 标签选择器选择的 Namespace 子集的 Route。当使用 Selector 时，那么 <code>listeners.route.namespaces.selector</code> 字段可用于指定标签选择器。<code>All</code> 或 <code>SameNamespace</code> 不支持该字段。</li>
</ul>
</li>
<li><strong>Kind</strong>：监听器上的 <code>allowedRoutes.kinds</code> 字段可用于限制可能附加的路由种类。</li>
</ol>
<p>如果未指定上述任何一项，网关监听器将信任从支持监听器协议的同一命名空间附加的路由。</p>
<h3 id="gateway---route-附加示例">Gateway - Route 附加示例</h3>
<p>在下面的例子中 <code>gateway-api-example-ns1</code> 命名空间中的 <code>my-route</code> Route 想要附加到 <code>foo-gateway</code> 中，不会附加到任何其他 Gateway 上。请注意， <code>foo-gateway</code> 位于与 Gateway 不同的命名空间中。<code>foo-gateway</code> 必须允许来自 <code>gateway-api-example-ns2</code> 命名空间中的 HTTPRoute 附加。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-route</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">backendRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></div><p><code>foo-gateway</code> 允许 <code>my-route</code> HTTPRoute 附加。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">foo-lb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prod-web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kinds</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">Selector</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># 该 label 在 Kubernetes 1.22 中自动添加到所有命名空间中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns2</span><span class="w">
</span></span></span></code></pre></div><p>对于一个更宽松的示例，下面的网关将允许所有 HTTPRoute 资源从带有 <code>expose-apps: true</code> 标签的命名空间附加。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prod-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">foo-lb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">prod-web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP    </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kinds</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRoute</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">Selector</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">expose-apps</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span></code></pre></div><h3 id="组合类型">组合类型</h3>
<p><code>GatewayClass</code>、Gateway、<code>xRoute</code> 和 <code>Service</code> 的组合将定义一个可实现的负载均衡器。下图说明了不同资源之间的关系。</p>
<p>















<figure  id="figure-gateway-api-流程图">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/gateway-api-request-flow.png" alt="Gateway API 流程图" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Gateway API 流程图
    </figcaption></figure>
</p>
<h2 id="请求流程">请求流程</h2>
<p>使用反向代理实现的网关的一个典型的客户端 / 网关 API 请求流程如下：</p>
<ol>
<li>客户端向 <code>http://foo.example.com</code> 发出请求。</li>
<li>DNS 将该名称解析为 <code>Gateway</code> 地址。</li>
<li>反向代理在 <code>Listener</code> 上接收请求，并使用 <code>Host</code>  header 来匹配 <code>HTTPRoute</code>。</li>
<li>可选地，反向代理可以根据 <code>HTTPRoute</code> 中的 <code>match</code> 规则执行请求 header 和 / 或路径匹配。</li>
<li>可选地，反向代理可以根据 <code>HTTPRoute</code> 中的 <code>filter</code> 规则修改请求，即添加 / 删除 header。</li>
<li>最后，反向代理可以根据 <code>HTTPRoute</code> 中的 <code>forwardTo</code> 规则，将请求转发到集群中的一个或多个对象，即 <code>Service</code>。</li>
</ol>
<h2 id="tls-配置">TLS 配置</h2>
<p>我们可以在 <code>Gateway</code> 监听器上配置 TLS，还可以跨命名空间引用。</p>
<p>首先我们先说明几个术语：</p>
<ul>
<li>下游：客户端和网关之间的链接。</li>
<li>上游：网关与路由器指定的后端服务之间的链接。</li>
</ul>
<p>其关系如下图所示。</p>
<p>















<figure  id="figure-客户端服务器和-tls">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="../../images/tls-overview.svg" alt="客户端/服务器和 TLS" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      客户端/服务器和 TLS
    </figcaption></figure>
</p>
<p>通过 Gateway API 可以分别对上游或下游的 TLS 进行配置。</p>
<p>根据监听器协议，支持不同的 TLS 模式和路由类型，如下表所示。</p>
<table>
<thead>
<tr>
<th style="text-align:left">监听器协议</th>
<th style="text-align:left">TLS 模式</th>
<th style="text-align:left">支持的路由类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TLS</td>
<td style="text-align:left">直通</td>
<td style="text-align:left">TLSRoute</td>
</tr>
<tr>
<td style="text-align:left">TLS</td>
<td style="text-align:left">终止</td>
<td style="text-align:left">TCPRoute</td>
</tr>
<tr>
<td style="text-align:left">HTTPS</td>
<td style="text-align:left">终止</td>
<td style="text-align:left">HTTPRoute</td>
</tr>
</tbody>
</table>
<p>请注意，在<code>Passthrough</code>（直通）TLS 模式下，没有 TLS 设置生效，因为来自客户端的 TLS 会话不会在网关处终止。本文的其余部分假定 TLS 在网关处终止，这是默认设置。</p>
<h3 id="下游-tls">下游 TLS</h3>
<p>下游 TLS 设置使用网关级别的监听器进行配置。</p>
<h3 id="监听器和-tls">监听器和 TLS</h3>
<p>监听器基于每个域或子域公开 TLS 设置。监听器的 TLS 设置适用于满足 <code>hostname</code> 条件的所有域。</p>
<p>在以下示例中，<code>default-cert</code> Gateway 为所有请求提供 Secret 资源中定义的 TLS 证书。尽管该示例涉及 HTTPS 协议，但也可以将相同的功能用于 TLS-only 协议以及 TLSRoutes。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w"> </span><span class="c"># Other possible value is `TLS`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">Terminate</span><span class="w"> </span><span class="c"># If protocol is `TLS`, `Passthrough` is a possible mode</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">certificateRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">default-cert</span><span class="w">
</span></span></span></code></pre></div><p>如果 <code>hostname.match</code> 设置为<code>Exact</code>，则 TLS 设置仅适用于在 <code>hostname.name</code> 中设置的特定主机名。</p>
<h3 id="示例">示例</h3>
<h4 id="具有不同证书的监听器">具有不同证书的监听器</h4>
<p>在下面的示例中，配置 Gateway 服务于 <code>foo.example.com</code> 和  <code>bar.example.com</code> 域。这些域的证书在 Gateway 中指定。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tls-basic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">acme-lb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">foo.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-example-com-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bar-https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">bar.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">bar-example-com-cert</span><span class="w">
</span></span></span></code></pre></div><h4 id="通配符-tls-监听器">通配符 TLS 监听器</h4>
<p>在下面的示例中，Gateway 为 <code>*.example.com</code> 和 <code>foo.example.com</code> 域配置了不同的通配符证书。由于特定匹配具有优先权，所有对 <code>foo.example.com</code> 的请求将使用 <code>foo-example-com-cert</code>，所有对 <code>exmaple.com</code> 的其他请求使用 <code>wildcard-example-com-cert</code> 证书。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wildcard-tls-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">acme-lb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">foo.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo-example-com-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wildcard-https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.example.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wildcard-example-com-cert</span><span class="w">
</span></span></span></code></pre></div><h4 id="跨命名空间证书引用">跨命名空间证书引用</h4>
<p>在此示例中，配置 Gateway 引用不同命名空间中的证书。在目标命名空间中创建 <code>ReferenceGrant</code> 以允许跨命名空间引用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cross-namespace-tls-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l">acme-lb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*.example.com&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificateRefs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wildcard-example-com-cert</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ReferenceGrant</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">allow-ns1-gateways-to-ref-secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">gateway.networking.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-api-example-ns1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span></code></pre></div><h3 id="扩展">扩展</h3>
<p>网关 TLS 配置提供了一个 <code>options</code> 映射来为特定于实现的功能添加额外的 TLS 设置。此处可能包含的一些功能示例是 TLS 版本限制或要使用的密码。</p>
<h2 id="扩展点">扩展点</h2>
<p>API 中提供了一些扩展点，以灵活处理大量通用 API 无法处理的用例。</p>
<p>以下是 API 中扩展点的摘要。</p>
<ul>
<li><code>BackendRefs</code>：此扩展点应用于将流量转发到核心 Kubernetes 服务资源以外的网络端点。例如 S3 存储桶、Lambda 函数、文件服务器等。</li>
<li><code>HTTPRouteFilter</code>：<code>HTTPRoute</code> 中的这种 API 类型提供了一种挂钩 HTTP 请求的请求 / 响应生命周期的方法。</li>
<li><strong>自定义路由</strong>：如果上述扩展点都不能满足用例的需要，实施者可以选择为 API 当前不支持的协议创建自定义路由资源。自定义路由类型需要共享与核心路由类型相同的字段。这些包含在 <code>CommonRouteSpec</code> 和 <code>RouteStatus</code> 中。</li>
</ul>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://github.com/kubernetes-sigs/gateway-api" target="_blank" rel="noopener">kuberentes-sigs/gateway-api - github.com</a></li>
<li><a href="https://gateway-api.sigs.k8s.io/" target="_blank" rel="noopener">Kubernetes Gateway API 文档 - gateway-api.sigs.k8s.io</a></li>
</ul>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/kubernetes/">Kubernetes</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/kubernetes-handbook/service-discovery/ingress/" rel="next">
    <div class="meta-nav">上一页</div>
    <p>Ingress</p></a>
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 2023-11-15</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/kubernetes-handbook/service-discovery/gateway.md">
    <i class="fas fa-pen pr-2"></i>编辑本页
  </a>
</p>



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    <script>
  let themeNumber = localStorage.getItem('wcTheme');
  var giscusTheme = "light";
  if (themeNumber == 1){
    giscusTheme = "dark";
  }
  console.log(giscusTheme)
  let giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-theme": giscusTheme,
    "data-repo":"rootsongjc/cloud-native-library",
    "data-repo-id":"MDEwOlJlcG9zaXRvcnkyMTQ2MjY2NDg=",
    "data-category":"Announcements",
    "data-category-id":"DIC_kwDODMrxWM4CPL7J",
    "data-mapping":"pathname",
    "data-reactions-enabled":"1",
    "data-emit-metadata":"0",
    "data-input-position":"top",
    "data-theme":giscusTheme,
    "data-lang":"zh-CN",
    "data-loading":"lazy",
    "crossorigin":"anonymous",
    "origins":"https://jimmysong.io",
    "originsRegex":"http://localhost:[0-9]+",
    "async": "",
  };

  let giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.querySelector('#comments').appendChild(giscusScript);
</script>

  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2023 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.46271ef31da3f018e9cd1b59300aa265.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.24983018b0e5661cd5fe1822254286ea.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
