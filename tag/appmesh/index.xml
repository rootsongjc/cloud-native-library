<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>AppMesh | äº‘åŸç”Ÿèµ„æ–™åº“</title>
    <link>https://lib.jimmysong.io/tag/appmesh/</link>
      <atom:link href="https://lib.jimmysong.io/tag/appmesh/index.xml" rel="self" type="application/rss+xml" />
    <description>AppMesh</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 21 Jun 2023 16:00:00 +0800</lastBuildDate>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>AppMesh</title>
      <link>https://lib.jimmysong.io/tag/appmesh/</link>
    </image>
    
    <item>
      <title>AppMesh å¿«é€Ÿå¼€å§‹</title>
      <link>https://lib.jimmysong.io/argo-rollouts/getting-started/appmesh/</link>
      <pubDate>Wed, 21 Jun 2023 16:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/argo-rollouts/getting-started/appmesh/</guid>
      <description>&lt;p&gt;æœ¬æŒ‡å—ä»‹ç»äº†å¦‚ä½•è®© Argo Rollouts ä¸ç”± &lt;a href=&#34;https://docs.aws.amazon.com/app-mesh/latest/userguide/what-is-app-mesh.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS App Mesh&lt;/a&gt; ç®¡ç†çš„æœåŠ¡ç½‘æ ¼é›†æˆã€‚æœ¬æŒ‡å—åŸºäº åŸºæœ¬å…¥é—¨æŒ‡å— çš„æ¦‚å¿µæ„å»ºã€‚&lt;/p&gt;
&lt;p&gt;è¦æ±‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…äº† AWS App Mesh Controller for K8s çš„ Kubernetes é›†ç¾¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ”” æç¤ºï¼šè¯·å‚é˜… &lt;a href=&#34;https://docs.aws.amazon.com/app-mesh/latest/userguide/getting-started-kubernetes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;App Mesh Controler Installation instructions&lt;/a&gt; ä»¥äº†è§£å¦‚ä½•å¼€å§‹ä½¿ç”¨ Kubernetes çš„ App Meshã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-éƒ¨ç½²-rolloutæœåŠ¡å’Œ-app-mesh-crd&#34;&gt;1. éƒ¨ç½² Rolloutã€æœåŠ¡å’Œ App Mesh CRD&lt;/h2&gt;
&lt;p&gt;å½“ App Mesh ç”¨ä½œæµé‡è·¯ç”±å™¨æ—¶ï¼ŒRollout canary ç­–ç•¥å¿…é¡»å®šä¹‰ä»¥ä¸‹å¼ºåˆ¶å­—æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Rollout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-rollout&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;canary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# canaryService å’Œ stableService æ˜¯æŒ‡å‘ Rollout å°†è¦ä¿®æ”¹çš„æœåŠ¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿é’ˆå¯¹é‡‘ä¸é›€ ReplicaSet å’Œç¨³å®š ReplicaSetï¼ˆå‡ä¸ºå¿…éœ€ï¼‰ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;canaryService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-svc-canary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stableService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-svc-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficRouting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;appMesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¼•ç”¨çš„è™šæ‹ŸæœåŠ¡å°†ç”¨äºç¡®å®šè™šæ‹Ÿè·¯ç”±å™¨ï¼Œåè€…å°†è¢«æ“çºµä»¥æ›´æ–°é‡‘ä¸é›€æƒé‡ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è™šæ‹ŸæœåŠ¡ App Mesh CR çš„åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-svc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è¦æ›´æ–°çš„è·¯ç”±çš„å¯é€‰é›†ã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™æ›´æ–°ä¸è™šæ‹ŸæœåŠ¡å…³è”çš„æ‰€æœ‰è·¯ç”±ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;http-primary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# virtualNodeGroup æ˜¯ä¸€ä¸ªç»“æ„ï¼Œç”¨äºå¼•ç”¨ App Mesh è™šæ‹ŸèŠ‚ç‚¹ CRï¼Œè¯¥èŠ‚ç‚¹å¯¹åº”äºé‡‘ä¸é›€å’Œç¨³å®šç‰ˆæœ¬&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtualNodeGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# canaryVirtualNodeRef æŒ‡çš„æ˜¯å¯¹åº”äºé‡‘ä¸é›€ç‰ˆæœ¬çš„è™šæ‹ŸèŠ‚ç‚¹çš„å¼•ç”¨ã€‚Rollouts æ§åˆ¶å™¨å°†ä¼š&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ›´æ–°è¿™ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„ podSelector ä»¥åŒ¹é…æ§åˆ¶å™¨ç”Ÿæˆçš„æœ€æ–°çš„ canary pod-hashã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;canaryVirtualNodeRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-vn-canary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# stableVirtualNodeRef æŒ‡çš„æ˜¯å¯¹åº”äºç¨³å®šç‰ˆæœ¬çš„è™šæ‹ŸèŠ‚ç‚¹çš„å¼•ç”¨ã€‚Rollouts æ§åˆ¶å™¨å°†ä¼š&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ›´æ–°è¿™ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„ podSelector ä»¥åŒ¹é…æ§åˆ¶å™¨ç”Ÿæˆçš„æœ€æ–°çš„ stable pod-hashã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stableVirtualNodeRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-vn-stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;steps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;setWeight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;pause&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ¬æŒ‡å—ä¸­ï¼Œè¿™ä¸¤ä¸ªæœåŠ¡åˆ†åˆ«æ˜¯ï¼š&lt;code&gt;my-svc-canary&lt;/code&gt; å’Œ &lt;code&gt;my-svc-stable&lt;/code&gt;ã€‚è¿™ä¸¤ä¸ªæœåŠ¡å¯¹åº”çš„æ˜¯ä¸¤ä¸ªåä¸º &lt;code&gt;my-vn-canary&lt;/code&gt; å’Œ &lt;code&gt;my-vn-stable&lt;/code&gt; çš„è™šæ‹ŸèŠ‚ç‚¹ CRã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåä¸º &lt;code&gt;rollout-demo-vsvc&lt;/code&gt; çš„è™šæ‹ŸæœåŠ¡ï¼Œå®ƒç”±ä¸€ä¸ªåä¸º &lt;code&gt;rollout-demo-vrouter&lt;/code&gt; çš„è™šæ‹Ÿè·¯ç”±å™¨ CR æä¾›ã€‚è¿™ä¸ªè™šæ‹Ÿè·¯ç”±å™¨éœ€è¦è‡³å°‘æœ‰ä¸€ä¸ªè·¯ç”±ï¼Œç”¨äºå°†æµé‡è½¬å‘åˆ° canary å’Œ stable è™šæ‹ŸèŠ‚ç‚¹ã€‚æœ€åˆï¼Œcanary çš„æƒé‡è®¾ç½®ä¸º 0%ï¼Œè€Œ stable çš„æƒé‡è®¾ç½®ä¸º 100%ã€‚åœ¨éƒ¨ç½²æœŸé—´ï¼Œæ§åˆ¶å™¨å°†æ ¹æ® &lt;code&gt;steps[N].setWeight&lt;/code&gt; ä¸­å®šä¹‰çš„é…ç½®ä¿®æ”¹è·¯ç”±çš„æƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;canary å’Œ stable æœåŠ¡çš„é…ç½®ä¸ºæ— å¤´æœåŠ¡ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿ App Mesh æ­£ç¡®å¤„ç†ç”± canary åˆ° stable é‡æ–°åˆ†é…çš„ pod çš„è¿æ¥æ± ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥éƒ¨ç½²æœåŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ªæœåŠ¡ï¼ˆstable å’Œ canaryï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæœåŠ¡ï¼ˆç”¨äº VIP å’Œ DNS æŸ¥è¯¢ï¼‰&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ª App Mesh è™šæ‹ŸèŠ‚ç‚¹ï¼ˆstable å’Œ canaryï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå…·æœ‰æŒ‡å‘è™šæ‹ŸèŠ‚ç‚¹çš„è·¯ç”±çš„ App Mesh è™šæ‹Ÿè·¯ç”±å™¨&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå¯¹åº” VIP æœåŠ¡çš„ App Mesh è™šæ‹ŸæœåŠ¡&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª rollout&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-rollouts/master/examples/appmesh/canary-service.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-rollouts/master/examples/appmesh/canary-rollout.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-éªŒè¯æœåŠ¡&#34;&gt;2. éªŒè¯æœåŠ¡&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆç¡®ä¿ rollout ç¨³å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl argo rollouts get rollout my-rollout -n argo-examples -w
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n argo-examples port-forward svc/my-svc 8181:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3-éƒ¨ç½²æ–°ç‰ˆæœ¬&#34;&gt;3. éƒ¨ç½²æ–°ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æ˜¯éƒ¨ç½²æ–°ç‰ˆæœ¬çš„æ—¶å€™äº†ã€‚ä½¿ç”¨æ–°é•œåƒæ›´æ–° rolloutã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl argo rollouts &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; image my-rollout &lt;span class=&#34;nv&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;argoproj/rollouts-demo:green -n argo-examples
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Rollout åº”è¯¥ä¼šéƒ¨ç½²ä¸€ä¸ªæ–°çš„ canary ä¿®è®¢ç‰ˆæœ¬ï¼Œå¹¶åœ¨è™šæ‹Ÿè·¯ç”±å™¨ä¸‹æ›´æ–°æƒé‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get -n argo-examples virtualrouter my-vrouter -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s2&#34;&gt;&amp;#34;.spec.routes[0].httpRoute.action.weightedTargets&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualNodeRef&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-vn-canary&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualNodeRef&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;my-vn-stable&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;s2&#34;&gt;&amp;#34;weight&amp;#34;&lt;/span&gt;: &lt;span class=&#34;m&#34;&gt;75&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ‰‹åŠ¨æ‰¹å‡†æ— é™æœŸæš‚åœçš„ rolloutï¼Œå¹¶ç»§ç»­è§‚å¯Ÿè·¯ç”±æ›´æ–°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl argo rollouts promote my-rollout -n argo-examples
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;watch -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;kubectl get -n argo-examples virtualrouter my-vrouter -o json | jq &amp;#34;.spec.routes[0].httpRoute.action.weightedTargets&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
  </channel>
</rss>
