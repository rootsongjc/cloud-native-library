<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>è¯‘æ–‡ | äº‘åŸç”Ÿèµ„æ–™åº“</title>
    <link>https://lib.jimmysong.io/translation/</link>
      <atom:link href="https://lib.jimmysong.io/translation/index.xml" rel="self" type="application/rss+xml" />
    <description>è¯‘æ–‡</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>è¯‘æ–‡</title>
      <link>https://lib.jimmysong.io/translation/</link>
    </image>
    
    <item>
      <title>å¦‚ä½•åœ¨ Istio ä¸­é›†æˆ SPIRE</title>
      <link>https://lib.jimmysong.io/translation/istio-spire-integration/</link>
      <pubDate>Mon, 06 Jun 2022 11:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/istio-spire-integration/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://spiffe.io/docs/latest/spire-about/spire-concepts/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE&lt;/a&gt; æ˜¯ SPIFFE è§„èŒƒçš„ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å®ç°ï¼Œå®ƒå¯ä»¥æ‰§è¡ŒèŠ‚ç‚¹å’Œå·¥ä½œè´Ÿè½½è¯æ˜ï¼Œä»¥ä¾¿å®‰å…¨åœ°å°†åŠ å¯†èº«ä»½å‘ç»™åœ¨å¼‚æ„ç¯å¢ƒä¸­è¿è¡Œçš„å·¥ä½œè´Ÿè½½ã€‚é€šè¿‡ä¸ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/security/secret&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy çš„ SDS API&lt;/a&gt; é›†æˆï¼ŒSPIRE å¯ä»¥è¢«é…ç½®ä¸º Istio å·¥ä½œè´Ÿè½½çš„åŠ å¯†èº«ä»½æ¥æºã€‚Istio å¯ä»¥æ£€æµ‹åˆ°ä¸€ä¸ª UNIX åŸŸå¥—æ¥å­—çš„å­˜åœ¨ï¼Œè¯¥å¥—æ¥å­—åœ¨å®šä¹‰çš„å¥—æ¥å­—è·¯å¾„ä¸Šå®ç°äº† Envoy SDS APIï¼Œå…è®¸ Envoy ç›´æ¥ä»å®ƒé‚£é‡Œè¿›è¡Œé€šä¿¡å’Œè·å–èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ä¸ SPIRE çš„é›†æˆæä¾›äº†çµæ´»çš„è®¤è¯é€‰é¡¹ï¼Œè¿™æ˜¯é»˜è®¤çš„ Istio èº«ä»½ç®¡ç†æ‰€ä¸å…·å¤‡çš„ï¼ŒåŒæ—¶åˆ©ç”¨äº† Istio å¼ºå¤§çš„æœåŠ¡ç®¡ç†ã€‚ä¾‹å¦‚ï¼ŒSPIRE çš„æ’ä»¶æ¶æ„èƒ½å¤Ÿæä¾›å¤šæ ·åŒ–çš„å·¥ä½œè´Ÿè½½è®¤è¯é€‰é¡¹ï¼Œè¶…è¶Š Istio æä¾›çš„ Kubernetes å‘½åç©ºé—´å’ŒæœåŠ¡è´¦æˆ·è®¤è¯ã€‚SPIRE çš„èŠ‚ç‚¹è®¤è¯å°†è®¤è¯æ‰©å±•åˆ°å·¥ä½œè´Ÿè½½è¿è¡Œçš„ç‰©ç†æˆ–è™šæ‹Ÿç¡¬ä»¶ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ç§ SPIRE ä¸ Istio é›†æˆçš„å¿«é€Ÿæ¼”ç¤ºï¼Œè¯·å‚é˜…&lt;a href=&#34;https://github.com/istio/istio/tree/release-1.14/samples/security/spire&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ Envoy çš„ SDS API å°† SPIRE ä½œä¸º CA è¿›è¡Œé›†æˆ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œè¿™ä¸ªé›†æˆéœ€è¦ 1.14 ç‰ˆæœ¬çš„ &lt;code&gt;istioctl&lt;/code&gt; å’Œæ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥é›†æˆä¸ Istio çš„å‡çº§å…¼å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-spire&#34;&gt;å®‰è£… SPIRE&lt;/h2&gt;
&lt;h3 id=&#34;é€‰é¡¹-1-å¿«é€Ÿå¯åŠ¨&#34;&gt;é€‰é¡¹ 1: å¿«é€Ÿå¯åŠ¨&lt;/h3&gt;
&lt;p&gt;Istio æä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„å®‰è£…ç¤ºä¾‹ï¼Œä»¥å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œ SPIREã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f @samples/security/spire/spire-quickstart.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†æŠŠ SPIRE éƒ¨ç½²åˆ°ä½ çš„é›†ç¾¤ä¸­ï¼ŒåŒæ—¶è¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„ç»„ä»¶ï¼š&lt;a href=&#34;https://github.com/spiffe/spiffe-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE CSI é©±åŠ¨&lt;/a&gt; â€”â€” ç”¨äºä¸æ•´ä¸ªèŠ‚ç‚¹çš„å…¶ä»– pod å…±äº« SPIRE Agent çš„ UNIX åŸŸå¥—æ¥å­—ï¼Œä»¥åŠ &lt;a href=&#34;https://github.com/spiffe/spire/tree/main/support/k8s/k8s-workload-registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Kubernetes å·¥ä½œè´Ÿè½½æ³¨å†Œå™¨&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ Kubernetes å†…æ‰§è¡Œè‡ªåŠ¨å·¥ä½œè´Ÿè½½æ³¨å†Œçš„ä¿ƒè¿›å™¨ã€‚å‚è§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; ä»¥é…ç½® Istio å¹¶ä¸ SPIFFE CSI é©±åŠ¨é›†æˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-2é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„-spire-å®‰è£…&#34;&gt;é€‰é¡¹ 2ï¼šé…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„ SPIRE å®‰è£…&lt;/h3&gt;
&lt;p&gt;è¯·å‚é˜… &lt;a href=&#34;https://spiffe.io/docs/latest/try/getting-started-k8s/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE çš„ Kubernetes å¿«é€Ÿå…¥é—¨æŒ‡å—&lt;/a&gt;ï¼Œå°† SPIRE éƒ¨ç½²åˆ° Kubernetes ç¯å¢ƒä¸­ã€‚è¯·å‚é˜… SPIRE &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#spire-ca-integration-prerequisites&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CA é›†æˆå…ˆå†³æ¡ä»¶&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³é…ç½® SPIRE ä»¥ä¸ Istio éƒ¨ç½²é›†æˆçš„æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;spire-ca-é›†æˆçš„å…ˆå†³æ¡ä»¶&#34;&gt;SPIRE CA é›†æˆçš„å…ˆå†³æ¡ä»¶&lt;/h4&gt;
&lt;p&gt;å°† SPIRE éƒ¨ç½²ä¸ Istio é›†æˆï¼Œé…ç½® SPIREï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®¿é—® &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/spire_agent/#agent-configuration-file&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE ä»£ç†å‚è€ƒ&lt;/a&gt;ï¼Œé…ç½® SPIRE ä»£ç†å¥—æ¥å­—è·¯å¾„ï¼Œä»¥åŒ¹é… Envoy SDS å®šä¹‰çš„å¥—æ¥å­—è·¯å¾„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;socket_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds/socket&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡éƒ¨ç½² &lt;a href=&#34;https://github.com/spiffe/spiffe-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIFFE CSI é©±åŠ¨&lt;/a&gt;ï¼Œä¸èŠ‚ç‚¹å†…çš„ pod å…±äº« SPIRE ä»£ç†å¥—æ¥å­—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; ä»¥é…ç½® Istio ä¸ SPIFFE CSI é©±åŠ¨é›†æˆã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œä½ å¿…é¡»åœ¨å°† Istio å®‰è£…åˆ°ä½ çš„ç¯å¢ƒä¸­ä¹‹å‰éƒ¨ç½² SPIREï¼Œä»¥ä¾¿ Istio å¯ä»¥æ£€æµ‹åˆ°å®ƒæ˜¯ä¸€ä¸ª CAã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-istio&#34;&gt;å®‰è£… Istio&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.io/latest/docs/setup/getting-started/#download&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹è½½ Istio 1.14 + ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-spire&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å°† SPIRE éƒ¨ç½²&lt;/a&gt;åˆ°ä½ çš„ç¯å¢ƒä¸­ï¼Œå¹¶éªŒè¯æ‰€æœ‰çš„éƒ¨ç½²éƒ½å¤„äº &lt;code&gt;Ready&lt;/code&gt; çŠ¶æ€åï¼Œä¸º Ingress-gateway ä»¥åŠ istio-proxy å®‰è£… Istio çš„å®šåˆ¶è¡¥ä¸ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ istioctl install --skip-confirmation -f - &amp;lt;&amp;lt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trustDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;global&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This is used to customize the sidecar template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecarInjectorWebhook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                mountPath: /run/secrets/workload-spiffe-uds
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              - name: workload-socket
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                csi:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                  driver: &amp;#34;csi.spiffe.io&amp;#34;          &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;components&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingressGateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;overlays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.volumes.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spec.template.spec.containers.[name:istio-proxy].volumeMounts.[name:workload-socket]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/run/secrets/workload-spiffe-uds&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†ä¸ Ingress Gateway å’Œå°†è¢«æ³¨å…¥å·¥ä½œè´Ÿè½½ pod çš„ sidecars å…±äº« &lt;code&gt;spiffe-csi-driver&lt;/code&gt;ï¼Œå…è®¸å®ƒä»¬è®¿é—® SPIRE Agent çš„ UNIX åŸŸå¥—æ¥å­—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar æ³¨å…¥&lt;/a&gt;ï¼Œå°† &lt;code&gt;istio-proxy&lt;/code&gt; å®¹å™¨æ³¨å…¥åˆ°ç½‘æ ¼å†…çš„ pod ä¸­ã€‚å…³äºå¦‚ä½•å°†è‡ªå®šä¹‰å®šä¹‰çš„ &lt;code&gt;spire&lt;/code&gt; æ¨¡æ¿åº”ç”¨åˆ° &lt;code&gt;istio-proxy&lt;/code&gt; ä¸­çš„ä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#custom-templates-experimental&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰æ¨¡æ¿&lt;/a&gt;ã€‚è¿™ä½¿å¾— CSI é©±åŠ¨èƒ½å¤Ÿåœ¨ sidecar ä¸Šå®‰è£… UDSã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ Ingress-gateway pod çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway-5b45864fd4-lgrxs   0/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          17s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istiod-989f54d9c-sg7sn                  1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          23s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åªæœ‰åœ¨ SPIRE æœåŠ¡å™¨ä¸Šä¸ºå®ƒä»¬åˆ›å»ºäº†ç›¸åº”çš„æ³¨å†Œæ¡ç›®æ—¶ï¼Œæ•°æ®å¹³é¢å®¹å™¨æ‰ä¼šåˆ°è¾¾ &lt;code&gt;Ready&lt;/code&gt;ã€‚ç„¶åï¼ŒEnvoy å°†èƒ½å¤Ÿä» SPIRE è·å–åŠ å¯†èº«ä»½ã€‚è¯·å‚é˜… â€œ&lt;a href=&#34;http://localhost:1313/translation/istio-spire-integration/#register-workloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½&lt;/a&gt; &amp;ldquo;ï¼Œä¸ºä½ çš„ç½‘æ ¼ä¸­çš„æœåŠ¡æ³¨å†Œæ¡ç›®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ³¨å†Œå·¥ä½œè´Ÿè½½&#34;&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚ä»‹ç»åœ¨ SPIRE æœåŠ¡å™¨ä¸­æ³¨å†Œå·¥ä½œè´Ÿè½½çš„å¯ç”¨é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-1ä½¿ç”¨-spire-å·¥ä½œè´Ÿè½½æ³¨å†Œæœºè‡ªåŠ¨ç™»è®°&#34;&gt;é€‰é¡¹ 1ï¼šä½¿ç”¨ SPIRE å·¥ä½œè´Ÿè½½æ³¨å†Œæœºè‡ªåŠ¨ç™»è®°&lt;/h3&gt;
&lt;p&gt;é€šè¿‡å°† &lt;a href=&#34;https://github.com/spiffe/spire/tree/main/support/k8s/k8s-workload-registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Kubernetes Workload Registrar&lt;/a&gt; ä¸ SPIRE æœåŠ¡å™¨ä¸€èµ·éƒ¨ç½²ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„ podï¼Œå°±ä¼šè‡ªåŠ¨æ³¨å†Œæ–°çš„æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜…â€ &lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#verifying-that-identities-were-created-for-workloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éªŒè¯èº«ä»½æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»º&lt;/a&gt; &amp;ldquo;ï¼Œä»¥æ£€æŸ¥å·²å‘å¸ƒçš„èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œåœ¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#option-1:-quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¿«é€Ÿå¯åŠ¨&lt;/a&gt;éƒ¨åˆ†ä½¿ç”¨äº† &lt;code&gt;SPIREå·¥ä½œè´Ÿè½½æ³¨å†Œæœº&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€‰é¡¹-2æ‰‹åŠ¨æ³¨å†Œ&#34;&gt;é€‰é¡¹ 2ï¼šæ‰‹åŠ¨æ³¨å†Œ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æé«˜å·¥ä½œè´Ÿè½½è¯æ˜çš„å®‰å…¨ç¨³å¥æ€§ï¼ŒSPIRE èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„å‚æ•°ï¼Œé’ˆå¯¹ä¸€ç»„é€‰æ‹©å™¨çš„å€¼è¿›è¡ŒéªŒè¯ã€‚å¦‚æœä½ æŒ‰ç…§&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#option-1:-quick-start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¿«é€Ÿå¯åŠ¨&lt;/a&gt;å®‰è£… &lt;code&gt;SPIRE&lt;/code&gt;ï¼Œåˆ™è·³è¿‡è¿™äº›æ­¥éª¤ï¼Œå› ä¸ºå®ƒä½¿ç”¨è‡ªåŠ¨æ³¨å†Œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸º Ingress Gateway ç”Ÿæˆä¸€ä¸ªæ¡ç›®ï¼Œå…¶ä¸­æœ‰ä¸€ç»„é€‰æ‹©å™¨ï¼Œå¦‚ pod åç§°å’Œ pod UIDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;INGRESS_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ingressgateway -n istio-system -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;INGRESS_POD_UID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods -n istio-system &lt;span class=&#34;nv&#34;&gt;$INGRESS_POD&lt;/span&gt; -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.metadata.uid}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å– spire-server podï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SPIRE_SERVER_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;spire-server -n spire -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ SPIRE ä»£ç†æ³¨å†Œä¸€ä¸ªæ¡ç›®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ kubectl exec -n spire $SPIRE_SERVER_POD -- \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/opt/spire/bin/spire-server entry create \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;spiffeID spiffe://example.org/ns/spire/sa/spire-agent \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:cluster:demo-cluster \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:agent_ns:spire \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;selector k8s_psat:agent_sa:spire-agent \&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;-&lt;span class=&#34;l&#34;&gt;node -socketPath /run/spire/sockets/server.sock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Entry ID         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;d38c88d0-7d7a-4957-933c-361a0a3b039c&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;SPIFFE ID        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spiffe://example.org/ns/spire/sa/spire-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Parent ID        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;spiffe://example.org/spire/server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Revision         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;TTL              &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:agent_ns:spire&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:agent_sa:spire-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Selector         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s_psat:cluster:demo-cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸º Ingress-gateway pod æ³¨å†Œä¸€ä¸ªæ¡ç›®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n spire &lt;span class=&#34;nv&#34;&gt;$SPIRE_SERVER_POD&lt;/span&gt; -- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;/opt/spire/bin/spire-server entry create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -spiffeID spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -parentID spiffe://example.org/ns/spire/sa/spire-agent &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8sğŸˆ‚ï¸istio-ingressgateway-service-account &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:ns:istio-system &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:pod-uid:&lt;span class=&#34;nv&#34;&gt;$INGRESS_POD_UID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns &lt;span class=&#34;nv&#34;&gt;$INGRESS_POD&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns istio-ingressgateway.istio-system.svc &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -socketPath /run/spire/sockets/server.sock
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : 6f2fe370-5261-4361-ac36-10aae8d91ff7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:63c2bbf5-a8b1-4b1f-ad64-f62ad2a69807
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8sğŸˆ‚ï¸istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway.istio-system.svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway-5b45864fd4-lgrxs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éƒ¨ç½²ä¸€ä¸ªå·¥ä½œè´Ÿè½½çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl kube-inject --filename @samples/security/spire/sleep-spire.yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œå·¥ä½œè´Ÿè½½å°†éœ€è¦ SPIFFE CSI é©±åŠ¨å·æ¥è®¿é—® SPIRE ä»£ç†å¥—æ¥å­—ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥åˆ©ç”¨&lt;a href=&#34;https://istio.io/latest/docs/ops/integrations/spire/#install-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Istio&lt;/a&gt; éƒ¨åˆ†çš„ &lt;code&gt;spire &lt;/code&gt;pod æ³¨é‡Šæ¨¡æ¿ï¼Œæˆ–å°† CSI å·æ·»åŠ åˆ°å·¥ä½œè´Ÿè½½çš„éƒ¨ç½²è§„èŒƒä¸­ã€‚è¿™ä¸¤ç§æ–¹æ³•åœ¨ä¸‹é¢çš„ç¤ºä¾‹ç‰‡æ®µä¸­éƒ½æœ‰å¼ºè°ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Injects custom sidecar template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inject.istio.io/templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar,spire&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;terminationGracePeriodSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curlimages/curl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/sleep&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3650d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runAsUser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tmp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# CSI volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;workload-socket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;csi.spiffe.io&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å– pod ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD_UID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.metadata.uid}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œå·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -n spire spire-server-0 -- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;/opt/spire/bin/spire-server entry create &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -spiffeID spiffe://example.org/ns/default/sa/sleep &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -parentID spiffe://example.org/ns/spire/sa/spire-agent &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:ns:default &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -selector k8s:pod-uid:&lt;span class=&#34;nv&#34;&gt;$SLEEP_POD_UID&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -dns &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -socketPath /run/spire/sockets/server.sock
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å·¥ä½œè´Ÿè½½çš„ SPIFFE ID å¿…é¡»éµå¾ª Istio SPIFFE ID æ¨¡å¼ï¼š&lt;code&gt;spiffe://&amp;lt;trust.domain&amp;gt;/ns/&amp;lt;namespace&amp;gt;/sa/&amp;lt;service-account&amp;gt;ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¯·å‚é˜… &lt;a href=&#34;https://spiffe.io/docs/latest/deploying/registering/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE å…³äºæ³¨å†Œå·¥ä½œè´Ÿè½½çš„å¸®åŠ©&lt;/a&gt;ï¼Œäº†è§£å¦‚ä½•ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºæ–°æ¡ç›®ï¼Œå¹¶ä½¿ç”¨å¤šä¸ªé€‰æ‹©å™¨åŠ å¼ºéªŒè¯æ ‡å‡†ï¼Œä½¿å…¶å¾—åˆ°éªŒè¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éªŒè¯æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½&#34;&gt;éªŒè¯æ˜¯å¦ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç¡®è®¤ä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºäº†èº«ä»½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t &lt;span class=&#34;nv&#34;&gt;$SPIRE_SERVER_POD&lt;/span&gt; -n spire -c spire-server -- /bin/sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;bin/spire-server entry show -socketPath /run/spire/sockets/server.sock&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; entries
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : c8dfccdc-9762-4762-80d3-5434e5388ae7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/istio-system/sa/istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:88b71387-4641-4d9c-9a89-989c88f7509d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8sğŸˆ‚ï¸istio-ingressgateway-service-account
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : istio-ingressgateway-5b45864fd4-lgrxs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : af7b53dc-4cc9-40d3-aaeb-08abbddd8e54
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/default/sa/sleep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:ns:default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s:pod-uid:ee490447-e502-46bd-8532-5a746b0871d6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS name         : sleep-5f4d47c948-njvpk
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Entry ID         : f0544fd7-1945-4bd1-88dc-0a5513fdae1c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SPIFFE ID        : spiffe://example.org/ns/spire/sa/spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Parent ID        : spiffe://example.org/spire/server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Revision         : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TTL              : default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:agent_ns:spire
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:agent_sa:spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Selector         : k8s_psat:cluster:demo-cluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ Ingress-gateway pod çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pods -n istio-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istio-ingressgateway-5b45864fd4-lgrxs   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          60s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istiod-989f54d9c-sg7sn                  1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          45s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸º Ingress-gateway pod æ³¨å†Œæ¡ç›®åï¼ŒEnvoy ä¼šæ”¶åˆ°ç”± SPIRE ç­¾å‘çš„èº«ä»½ï¼Œå¹¶å°†å…¶ç”¨äºæ‰€æœ‰ TLS å’Œ mTLS é€šä¿¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ£€æŸ¥å·¥ä½œè´Ÿè½½èº«ä»½æ˜¯å¦æ˜¯ç”±-spire-ç­¾å‘çš„&#34;&gt;æ£€æŸ¥å·¥ä½œè´Ÿè½½èº«ä»½æ˜¯å¦æ˜¯ç”± SPIRE ç­¾å‘çš„&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;istioctl proxy-config secret&lt;/code&gt; å‘½ä»¤æ£€ç´¢ sleep çš„ SVID èº«ä»½æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ istioctl proxy-config secret &lt;span class=&#34;nv&#34;&gt;$SLEEP_POD&lt;/span&gt; -o json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.dynamicActiveSecrets[0].secret.tlsCertificate.certificateChain.inlineBytes&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 --decode &amp;gt; chain.pem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ£€æŸ¥è¯ä¹¦å¹¶æ ¸å® SPIRE æ˜¯å‘è¡Œäººã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ openssl x509 -in chain.pem -text &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep SPIRE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Subject: &lt;span class=&#34;nv&#34;&gt;C&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; US, &lt;span class=&#34;nv&#34;&gt;O&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; SPIRE, &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; sleep-5f4d47c948-njvpk
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;spiffe-è”é‚¦&#34;&gt;SPIFFE è”é‚¦&lt;/h2&gt;
&lt;p&gt;SPIRE æœåŠ¡å™¨èƒ½å¤Ÿå¯¹æ¥è‡ªä¸åŒä¿¡ä»»åŸŸçš„ SPIFFE èº«ä»½è¿›è¡Œè®¤è¯ã€‚è¿™è¢«ç§°ä¸º SPIFFE è”é‚¦ã€‚&lt;/p&gt;
&lt;p&gt;SPIRE Agent å¯ä»¥è¢«é…ç½®ä¸ºé€šè¿‡ Envoy SDS API å‘ Envoy æ¨é€è”åˆèº«ä»½åŒ…ï¼Œå…è®¸ Envoy ä½¿ç”¨&lt;a href=&#34;https://spiffe.io/docs/latest/microservices/envoy/#validation-context&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éªŒè¯ä¸Šä¸‹æ–‡&lt;/a&gt;æ¥éªŒè¯å¯¹ç­‰çš„è¯ä¹¦å¹¶ä¿¡ä»»æ¥è‡ªå¦ä¸€ä¸ªä¿¡ä»»åŸŸçš„å·¥ä½œè´Ÿè½½ã€‚ä¸ºäº†ä½¿ Istio èƒ½å¤Ÿé€šè¿‡ SPIRE é›†æˆæ¥è”åˆ SPIFFE èº«ä»½ï¼Œè¯·æŸ¥é˜… &lt;a href=&#34;https://github.com/spiffe/spire/blob/main/doc/spire_agent.md#sds-configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SPIRE Agent SDS é…ç½®&lt;/a&gt;ï¼Œå¹¶ä¸ºä½ çš„ SPIRE Agent é…ç½®æ–‡ä»¶è®¾ç½®ä»¥ä¸‹ SDS é…ç½®å€¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;é…ç½®&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æè¿°&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;èµ„æºåç§°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;code&gt;default_svid_name&lt;/code&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;TLS è¯ä¹¦èµ„æºåç§°ï¼Œç”¨äº Envoy SDS çš„é»˜è®¤ X509-SVIDã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;default&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;code&gt;default_bundle_name&lt;/code&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç”¨äº Envoy SDS çš„é»˜è®¤ X.509 æ†ç»‘åŒ…çš„éªŒè¯ä¸Šä¸‹æ–‡èµ„æºåç§°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;code&gt;default_all_bundles_name&lt;/code&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ‰€æœ‰ä½¿ç”¨ Envoy SDS çš„æ†ç»‘åŒ…ï¼ˆåŒ…æ‹¬è”åˆåŒ…ï¼‰æ‰€ä½¿ç”¨çš„éªŒè¯ä¸Šä¸‹æ–‡èµ„æºåç§°ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ROOTCA&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™è®© Envoy å¯ä»¥ç›´æ¥ä» SPIRE è·å¾—è”åˆæ†ç»‘åŒ…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºè”åˆæ³¨å†Œæ¡ç›®&#34;&gt;åˆ›å»ºè”åˆæ³¨å†Œæ¡ç›®&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ SPIRE Kubernetes å·¥ä½œè´Ÿè½½æ³¨å†Œæœºï¼Œé€šè¿‡å‘æœåŠ¡éƒ¨ç½²è§„èŒƒæ·»åŠ  pod æ³¨é‡Š &lt;code&gt;spiffe.io/federatesWith&lt;/code&gt;ï¼ŒæŒ‡å®šä½ å¸Œæœ› pod ä¸ä¹‹è”åˆçš„ä¿¡ä»»åŸŸï¼Œä¸ºå·¥ä½œè´Ÿè½½åˆ›å»ºè”åˆæ¡ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;podAnnotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spiffe.io/federatesWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;trust.domain&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äºæ‰‹åŠ¨æ³¨å†Œï¼Œè¯·å‚è§&lt;a href=&#34;https://spiffe.io/docs/latest/architecture/federation/readme/#create-registration-entries-for-federation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºè”é‚¦åˆ›å»ºæ³¨å†Œæ¡ç›®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¸…ç†-spire&#34;&gt;æ¸…ç† SPIRE&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨ Istio æä¾›çš„å¿«é€Ÿå¯åŠ¨ SPIRE éƒ¨ç½²æ¥å®‰è£… SPIREï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤è¿™äº› Kubernetes èµ„æºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete CustomResourceDefinition spiffeids.spiffeid.spiffe.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire serviceaccount spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire configmap spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire deployment spire-agent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete csidriver csi.spiffe.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire configmap spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire service spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire serviceaccount spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete -n spire statefulset spire-server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete clusterrole spire-server-trust-role spire-agent-cluster-role
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete clusterrolebinding spire-server-trust-role-binding spire-agent-cluster-role-binding
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl delete namespace spire
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ä¸€é”®å¼€å¯ Kubernetes å¯è§‚æµ‹æ€§â€”â€”å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆå’Œå­˜å‚¨ OpenTelemetry è¿½è¸ª</title>
      <link>https://lib.jimmysong.io/translation/generate-and-store-opentelemetry-traces-automatically/</link>
      <pubDate>Mon, 30 May 2022 11:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/generate-and-store-opentelemetry-traces-automatically/</guid>
      <description>&lt;p&gt;OpenTelemetry è¿½è¸ªåŒ…å«äº†ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿå’Œæ’é™¤æ•…éšœçš„ä¿¡æ¯å®åº“ â€”â€” ä½†ä½ çš„æœåŠ¡å¿…é¡»é¦–å…ˆè¢«æŒ‡æ ‡åŒ–ï¼Œä»¥å‘å°„ OpenTelemetry è¿½è¸ªæ¥å®ç°è¿™ä¸€ä»·å€¼ã€‚ç„¶åï¼Œè¿™äº›è¿½è¸ªä¿¡æ¯éœ€è¦è¢«å‘é€åˆ°ä¸€ä¸ªå¯è§‚å¯Ÿçš„åç«¯ï¼Œä½¿ä½ èƒ½å¤Ÿè·å¾—å…³äºè¿™äº›æ•°æ®çš„ä»»æ„é—®é¢˜çš„ç­”æ¡ˆã€‚å¯è§‚æµ‹æ€§æ˜¯ä¸€ä¸ªåˆ†æé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬å‘¨æ—©äº›æ—¶å€™ï¼Œæˆ‘ä»¬éƒ¨åˆ†è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®£å¸ƒ&lt;a href=&#34;https://www.timescale.com/blog/observability-powered-by-sql-understand-your-systems-like-never-before-with-opentelemetry-traces-and-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Promscale ä¸­æ™®éæä¾› OpenTelemetry è¿½è¸ªæ”¯æŒ&lt;/a&gt;ï¼Œå°†ç”± SQL é©±åŠ¨çš„å¯è§‚æµ‹æ€§å¸¦ç»™æ‰€æœ‰å¼€å‘è€…ã€‚éšç€å¯¹åˆ†æè¯­è¨€ â€”â€”SQL çš„å…¨é¢æ”¯æŒï¼Œæˆ‘ä»¬è§£å†³äº†åˆ†æçš„é—®é¢˜ã€‚ä½†æˆ‘ä»¬ä»ç„¶éœ€è¦è§£å†³ç¬¬ä¸€éƒ¨åˆ†çš„é—®é¢˜ï¼šæµ‹é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ çš„æœåŠ¡å‘å‡ºè¿½è¸ªæ•°æ®ï¼Œä½ å¿…é¡»æ‰‹åŠ¨æ·»åŠ  OpenTelemetry æµ‹é‡å·¥å…·åˆ°ä»£ç ä¸­ã€‚è€Œä¸”ä½ å¿…é¡»é’ˆå¯¹æ‰€æœ‰æœåŠ¡å’Œä½ ä½¿ç”¨çš„æ‰€æœ‰æ¡†æ¶æ¥åšï¼Œå¦åˆ™ä½ å°†æ— æ³•çœ‹åˆ°æ¯ä¸ªè¯·æ±‚çš„æ‰§è¡Œæƒ…å†µã€‚ä½ è¿˜éœ€è¦éƒ¨ç½² OpenTelemetry æ”¶é›†å™¨æ¥æ¥æ”¶æ‰€æœ‰æ–°çš„è¿½è¸ªï¼Œå¤„ç†å®ƒä»¬ï¼Œæ‰¹å¤„ç†å®ƒä»¬ï¼Œå¹¶æœ€ç»ˆå°†å®ƒä»¬å‘é€åˆ°ä½ çš„å¯è§‚æµ‹æ€§åç«¯ã€‚è¿™éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸éœ€è¦åšæ‰€æœ‰è¿™äº›æ‰‹å·¥å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…è€Œä¸æ˜¯å‡ å°æ—¶ç”šè‡³å‡ å¤©å†…å¯åŠ¨å’Œè¿è¡Œå‘¢ï¼Ÿå¦‚æœä½ è¿˜èƒ½å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„å¯è§‚æµ‹æ€§æŠ€æœ¯æ ˆå¹¶è‡ªåŠ¨è¿æ¥æ‰€æœ‰çš„ç»„ä»¶å‘¢ï¼Ÿå¦‚æœæˆ‘å‘Šè¯‰ä½ ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªå‘½ä»¤å®Œæˆæ‰€æœ‰è¿™äº›å·¥ä½œå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸æ˜¯ç–¯å­ã€‚æˆ‘åªæ˜¯ä¸€ä¸ª &lt;a href=&#34;https://docs.timescale.com/promscale/latest/tobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tobs&lt;/a&gt; ç”¨æˆ·ğŸ˜ã€‚&lt;/p&gt;
&lt;p&gt;Tobs æ˜¯ Kubernetes çš„å¯è§‚æµ‹æ€§æŠ€æœ¯æ ˆï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨æ¥&lt;a href=&#34;https://www.timescale.com/blog/introducing-tobs-deploy-a-full-observability-suite-for-kubernetes-in-two-minutes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨å‡ åˆ†é’Ÿå†…åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„å¯è§‚æµ‹æ€§æŠ€æœ¯æ ˆ&lt;/a&gt;çš„å·¥å…·ã€‚è¯¥æ ˆåŒ…æ‹¬ OpenTelemetry Operatorã€OpenTelemetry Collectorã€Promscale å’Œ Grafanaã€‚å®ƒè¿˜éƒ¨ç½²äº†å…¶ä»–å‡ ä¸ªå·¥å…·ï¼Œå¦‚ Prometheusï¼Œä»¥æ”¶é›† Kubernetes é›†ç¾¤çš„æŒ‡æ ‡ï¼Œå¹¶å°†å…¶å‘é€åˆ° Promscaleã€‚&lt;a href=&#34;https://github.com/timescale/tobs/releases/tag/0.10.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨æˆ‘ä»¬çš„æœ€æ–°ç‰ˆæœ¬ä¸­&lt;/a&gt;ï¼Œtobs åŒ…æ‹¬æ”¯æŒé€šè¿‡ OpenTelemetry Operator ç”¨ OpenTelemetry è¿½è¸ªè‡ªåŠ¨æ£€æµ‹ä½ çš„ Pythonã€Java å’Œ Node.js æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼šè‡ªåŠ¨ï¼ä½ ä¸éœ€è¦æ”¹å˜æœåŠ¡ä¸­çš„ä»»ä½•ä¸€è¡Œä»£ç ï¼Œå°±å¯ä»¥è®©å®ƒä»¬è¢«æ£€æµ‹å‡ºæ¥ã€‚é”¦ä¸Šæ·»èŠ±çš„æ˜¯ä»€ä¹ˆï¼Ÿä½ å¯ä»¥é€šè¿‡æ‰§è¡Œ helm å‘½ä»¤æ¥éƒ¨ç½²ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº† tobsï¼Œä½ å¯ä»¥å®‰è£…ä½ çš„å¯è§‚æµ‹æ€§æŠ€æœ¯æ ˆï¼Œåªéœ€å‡ æ­¥å°±èƒ½æå®šä½ çš„ OpenTelemetry æŒ‡æ ‡åŒ–çš„ç¬¬ä¸€å±‚ã€‚å‘Šåˆ«ç¹ççš„é…ç½®å·¥ä½œï¼Œå› ä¸ºä½ çš„æ¡†æ¶ä¼šè‡ªå·±æ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·ç»§ç»­é˜…è¯»æœ¬åšæ–‡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†è§£é‡Šä¸€åˆ‡æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œå‰–æ OpenTelemetry Operator åœ¨å†…éƒ¨çš„çœŸæ­£ä½œç”¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªä¾‹å­æ¼”ç¤ºå¦‚ä½•å°†å…¶ç›´æ¥ä»˜è¯¸å®è·µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬å°†é€šè¿‡ tobs åœ¨æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤ä¸­å®‰è£…ä¸€ä¸ªå®Œæ•´çš„å¯è§‚æµ‹æ€§æŠ€æœ¯æ ˆã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ªäº‘åŸç”Ÿ Python åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å°†æ£€æŸ¥æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•è¢« OpenTelemetry è¿½è¸ªå™¨è‡ªåŠ¨æ£€æµ‹åˆ°çš„ï¼Œè¿™è¦å½’åŠŸäº tobs å’Œ OpenTelemetry Operator æ‰€åšçš„é­”æœ¯ğŸª„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;opentelemetry-operator&#34;&gt;OpenTelemetry Operator&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://opentelemetry.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTelemetry&lt;/a&gt; æ˜¯ä¸€ä¸ªå¼€æºçš„æ¡†æ¶ï¼Œå¯ä»¥æ•è·ã€è½¬æ¢å’Œè·¯ç”±æ‰€æœ‰ç±»å‹çš„ä¿¡å·ï¼ˆè¿½è¸ªã€æ—¥å¿—å’ŒæŒ‡æ ‡ï¼‰ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¼šä½¿ç”¨ &lt;a href=&#34;https://open-telemetry.github.io/opentelemetry-js/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTelemetry SDK&lt;/a&gt; æ¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºä»£ç ä¸­ç”Ÿæˆè¿™äº›ä¿¡å·ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒOpenTelemetry å¯ä»¥è‡ªåŠ¨æ£€æµ‹ä½ çš„ä»£ç  â€”â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ çš„åº”ç”¨æ¡†æ¶è¢«æ”¯æŒï¼Œå¹¶ä¸”ä½ ä½¿ç”¨çš„è¯­è¨€æ˜¯ OpenTelemetry å¯ä»¥æ³¨å…¥ä»£ç çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„ç³»ç»Ÿå°†å¼€å§‹äº§ç”Ÿé¥æµ‹ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¦äº†è§£ OpenTelemetry æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†Ÿæ‚‰ &lt;a href=&#34;https://github.com/open-telemetry/opentelemetry-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTelemetry Operator&lt;/a&gt;ã€‚OpenTelemetry Operator æ˜¯ä¸€ä¸ªå®ç° &lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/operator/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Operator æ¨¡å¼&lt;/a&gt;çš„åº”ç”¨ç¨‹åºï¼Œä¸ Kubernetes é›†ç¾¤ä¸­çš„ä¸¤ä¸ª CustomResourceDefinitionsï¼ˆCRDï¼‰äº’åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾ç¤ºè¯´æ˜-opentelemetry-opertator-å¦‚ä½•ä¸-kubernetesäº’åŠ¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ç¤ºè¯´æ˜ OpenTelemetry Operator å¦‚ä½•ä¸ Kubernetes äº’åŠ¨&#34; srcset=&#34;
               /translation/generate-and-store-opentelemetry-traces-automatically/otel-operator-kubernetes_hu9eaea35c1c3da37ce10befac350865f4_54425_89510390ea80e6b60d8a5067819ad3e1.webp 400w,
               /translation/generate-and-store-opentelemetry-traces-automatically/otel-operator-kubernetes_hu9eaea35c1c3da37ce10befac350865f4_54425_67c2a525aead983718379ac249f37412.webp 760w,
               /translation/generate-and-store-opentelemetry-traces-automatically/otel-operator-kubernetes_hu9eaea35c1c3da37ce10befac350865f4_54425_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/generate-and-store-opentelemetry-traces-automatically/otel-operator-kubernetes_hu9eaea35c1c3da37ce10befac350865f4_54425_89510390ea80e6b60d8a5067819ad3e1.webp&#34;
               width=&#34;760&#34;
               height=&#34;481&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ç¤ºè¯´æ˜ OpenTelemetry Opertator å¦‚ä½•ä¸ Kubernetesäº’åŠ¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº CustomResourceDefinitionsï¼ˆCRD&lt;/a&gt;ï¼‰å®ä¾‹çš„å˜åŒ–ï¼ŒOperator ä¸ºæˆ‘ä»¬ç®¡ç†ä»¥ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºå’Œåˆ é™¤ OpenTelemetry Collector å®ä¾‹&lt;/li&gt;
&lt;li&gt;å°† OpenTelemetry è‡ªåŠ¨æµ‹é‡æ‰€éœ€çš„åº“å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥æ³¨å…¥åˆ°ä½ çš„ pod ä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è§£è¯»è¿™ä¸¤é¡¹ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç®¡ç†-opentelemetry-collector&#34;&gt;ç®¡ç† OpenTelemetry Collector&lt;/h2&gt;
&lt;p&gt;OpenTelemetry Operator çš„é¦–è¦ä»»åŠ¡æ˜¯éƒ¨ç½² &lt;a href=&#34;https://opentelemetry.io/docs/collector/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTelemetry Collector&lt;/a&gt; å®ä¾‹ã€‚è¿™äº›å®ä¾‹å°†è¢«ç”¨æ¥æŠŠä¿¡å·ä»æºå¤´ï¼ˆä½ çš„å·¥ä½œè´Ÿè½½å’Œ Kubernetes æœ¬èº«ï¼‰è·¯ç”±åˆ°å®ƒä»¬çš„ç›®æ ‡ï¼ˆæ”¯æŒ OpenTelemetry åè®®çš„å­˜å‚¨ç³»ç»Ÿæˆ–é›†ç¾¤å¤–çš„å¦ä¸€ä¸ªé‡‡é›†å™¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é‡‡é›†å™¨å¯ä»¥ä»¥ä¸‰ç§ä¸åŒçš„æ–¹å¼éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½œä¸º Kubernetes Deploymentï¼šè¿™æ˜¯é»˜è®¤é€‰é¡¹ï¼Œå®ƒå…è®¸é‡‡é›†å™¨æ ¹æ®éœ€è¦åœ¨èŠ‚ç‚¹ä¹‹é—´ç§»åŠ¨ï¼Œæ”¯æŒå‘ä¸Šå’Œå‘ä¸‹æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸º Kubernetes Daemonsetï¼šè¿™ä¸ªé€‰é¡¹å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªé‡‡é›†å™¨ï¼Œå½“ä½ æƒ³ç¡®ä¿ä½ çš„ä¿¡å·åœ¨æ²¡æœ‰ä»»ä½•ç½‘ç»œå¼€é”€çš„æƒ…å†µä¸‹è¢«å¤„ç†æ—¶ï¼Œå®ƒå¯èƒ½å¾ˆæœ‰ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºä¸€ä¸ª Sidecarï¼šè¢«æ³¨å…¥åˆ°ä»»ä½•æ–°çš„æ³¨é‡Šçš„ pod ä¸­ï¼ˆä½¿ç”¨ &lt;code&gt;sidecar.opentelemetry.io/inject: true&lt;/code&gt;ï¼‰ã€‚å½“é‡‡é›†å™¨éœ€è¦ä¸€ä¸ª pod çš„ç‰¹å®šé…ç½®æ—¶ï¼Œè¿™å¯èƒ½æ˜¯å¾ˆå¥½çš„ï¼ˆä¾‹å¦‚ï¼Œä¹Ÿè®¸å®ƒéœ€è¦ä¸€äº›ä¸“é—¨çš„è½¬æ¢ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æ··åˆå’ŒåŒ¹é…è¿™äº›æ”¶é›†å™¨æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¾ç½®ä¸€ä¸ª sidecarï¼Œä¸ºéƒ¨ç½²ä¸­çš„ pod åšä¸€äº›è½¬æ¢ï¼Œç„¶åå°†å®ƒä»¬å‘é€åˆ°ä¸€ä¸ªå…¨å±€æ”¶é›†å™¨ï¼Œä¸ä½ çš„å…¶ä»–å·¥ä½œè´Ÿè½½å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;å®šä¹‰è¿™äº›æ”¶é›†å™¨å®ä¾‹çš„é…ç½®åœ¨æ”¶é›†å™¨ CRDï¼ˆ&lt;code&gt;opentelemetrycollectors.opentelemetry.io&lt;/code&gt;ï¼‰ä¸­è¿›è¡Œå»ºæ¨¡ã€‚å…è®¸å¤šä¸ªå®ä¾‹æ¥å®ç°æ›´å¤æ‚çš„æ¨¡å¼ã€‚éƒ¨ç½²ç±»å‹æ˜¯é€šè¿‡ &lt;code&gt;mode&lt;/code&gt; è®¾ç½®æ¥é€‰æ‹©çš„ï¼Œä¼´éšç€ä¸€ä¸ªåŸå§‹çš„é…ç½®å­—ç¬¦ä¸²ï¼Œå®ƒè¢«é€å­—ä¼ é€’ç»™æ§åˆ¶å™¨ï¼Œå¹¶ä½œä¸ºé…ç½®åŠ è½½ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ Deployment æ¨¡å¼åˆ›å»º Operator çš„ CRD çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;opentelemetry.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OpenTelemetryCollector&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tobs-tobs-opentelemetry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    receivers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      jaeger:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        protocols:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          grpc:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          thrift_http:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      otlp:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        protocols:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          grpc:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          http:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    exporters:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      logging:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      otlp:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        endpoint: &amp;#34;tobs-promscale-connector.default.svc:9202&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        compression: none
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        tls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          insecure: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      prometheusremotewrite:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        endpoint: &amp;#34;tobs-promscale-connector.default.svc:9201/write&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        tls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          insecure: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    processors:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      batch:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;    service:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      pipelines:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        traces:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          receivers: [jaeger, otlp]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          exporters: [logging, otlp]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          processors: [batch]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        metrics:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          receivers: [otlp]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          processors: [batch]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          exporters: [prometheusremotewrite]    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚æˆ‘ä»¬åœ¨åé¢çš„ä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œå½“ä½ ä½¿ç”¨ &lt;a href=&#34;https://docs.timescale.com/promscale/latest/tobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tobs&lt;/a&gt; æ—¶ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒæ‰€æœ‰è¿™äº›é…ç½®ç»†èŠ‚ã€‚tobs çš„å¥½å¤„ä¹‹ä¸€æ˜¯å®ƒä¼šä¸ºä½ å®‰è£…ä¸€ä¸ªé‡‡é›†å™¨ï¼Œå®ƒå°†ç›´æ¥æŠŠæ•°æ®å‘é€åˆ°æœ¬åœ°çš„ Promscale å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨-kubernetes-ä¸­æ·»åŠ -opentelemetry-è‡ªåŠ¨ç›‘æµ‹ç³»ç»Ÿ&#34;&gt;åœ¨ Kubernetes ä¸­æ·»åŠ  OpenTelemetry è‡ªåŠ¨ç›‘æµ‹ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;Operator çš„ç¬¬äºŒä¸ªå…³æ³¨ç‚¹æ˜¯å°† OpenTelemetry è‡ªåŠ¨æµ‹é‡æ‰€éœ€çš„åº“å’ŒäºŒè¿›åˆ¶æ–‡ä»¶æ³¨å…¥åˆ° pod ä¸­ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¿™äº› pod éœ€è¦å®¹çº³ Javaã€Python æˆ– Node.js åº”ç”¨ç¨‹åºï¼ˆOpenTelemetry å°†æ¥ä¼šæ”¯æŒæ›´å¤šè¯­è¨€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨äºéƒ¨ç½²è¿™äº› pod çš„ Kubernetes æ¸…å•æ–‡ä»¶å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªæ³¨é‡Šï¼Œä»¥æŒ‡ç¤º OpenTelemetry Operator å¯¹å…¶è¿›è¡Œæ£€æµ‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;instrumentation.opentelemetry.io/inject-&amp;lt;language&amp;gt;: &amp;#34;true&amp;#34;   
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;language&lt;/code&gt; å¯ä»¥æ˜¯ &lt;code&gt;python&lt;/code&gt;ã€&lt;code&gt;java&lt;/code&gt; æˆ– &lt;code&gt;nodejs&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ³¨è§£çš„ pod å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª &lt;code&gt;init&lt;/code&gt; å®¹å™¨ï¼Œæ³¨å…¥æ‰€éœ€çš„ä»£ç å¹¶æ”¹å˜ pod è¿è¡Œä»£ç çš„æ–¹å¼ï¼Œä½¿ç”¨æ­£ç¡®çš„ OpenTelemetry è‡ªåŠ¨æ¢æµ‹æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€åœ¨ä½¿ç”¨ Kubernetes æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç å°±å¯ä»¥è·å¾—è‡ªåŠ¨ç›‘æµ‹çš„å¥½å¤„ã€‚è¯¥é…ç½®è¿˜å®šä¹‰äº† OpenTelemetry Collector ç«¯ç‚¹ï¼Œè¿™äº›è¿½è¸ªå°†è¢«å‘é€åˆ°è¯¥ç«¯ç‚¹ï¼Œä¼ æ’­çš„ä¿¡æ¯ç±»å‹ï¼Œä»¥åŠæˆ‘ä»¬ç”¨æ¥é‡‡æ ·è¿½è¸ªçš„æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰(å…³äº &lt;a href=&#34;https://github.com/open-telemetry/opentelemetry-operator/blob/main/docs/api.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD çš„å…¨éƒ¨ç»†èŠ‚ï¼Œè¯·çœ‹æ–‡æ¡£&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸º Pythonã€Java å’Œ Node.js åº”ç”¨ç¨‹åºæä¾›è‡ªåŠ¨æµ‹é‡çš„è‡ªå®šä¹‰èµ„æºçš„ä¾‹å­æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;opentelemetry.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Instrumentation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tobs-auto-instrumentation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exporter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http://tobs-opentelemetry-collector.default.svc:4318 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;propagators&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;tracecontext&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;baggage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;b3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sampler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.25&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;parentbased_traceidratio&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†ä¸€æ¬¡ï¼Œå¦‚æœä½ ä½¿ç”¨ &lt;a href=&#34;https://docs.timescale.com/promscale/latest/tobs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tobs&lt;/a&gt;ï¼Œä½ å°†ä¸éœ€è¦è‡ªå·±åˆ›å»ºè¿™äº›è‡ªå®šä¹‰èµ„æºã€‚Tobs å°†ç¡®ä¿é›†ç¾¤è¢«è‡ªåŠ¨é…ç½®æˆå¯¹ä»»ä½•æœ‰æ³¨é‡Šçš„ pod è¿›è¡Œæ£€æµ‹ï¼Œè€Œä¸éœ€è¦ä½ åšä»»ä½•æ“ä½œã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ä½ æƒ³æ”¶é›†è¿½è¸ªçš„ pod ä¸­æ·»åŠ ä»¥ä¸‹æ³¨é‡Šä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;instrumentation.opentelemetry.io/inject-java: &amp;#34;true&amp;#34;
instrumentation.opentelemetry.io/inject-nodejs: &amp;#34;true&amp;#34;
instrumentation.opentelemetry.io/inject-python:&amp;#34;true&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­çœ‹çœ‹è¿™åœ¨å®è·µä¸­æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-opentelemetry-operator-å’Œ-tobs&#34;&gt;ä½¿ç”¨ OpenTelemetry Operator å’Œ Tobs&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„&lt;a href=&#34;https://github.com/timescale/opentelemetry-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡æ¼”ç¤ºåº”ç”¨ç¨‹åº&lt;/a&gt;ï¼Œå®ƒç”±ä¸€ä¸ªè¿‡åº¦å·¥ç¨‹åŒ–çš„å¯†ç ç”Ÿæˆå™¨åº”ç”¨ç¨‹åºç»„æˆã€‚&lt;a href=&#34;https://github.com/timescale/opentelemetry-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ repo ä¸­&lt;/a&gt;ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå·²æµ‹é‡çš„ç‰ˆæœ¬å’Œä¸€ä¸ªæœªæµ‹é‡çš„ç‰ˆæœ¬ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­è¦ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;è¦è¿è¡Œè¿™ä¸ªï¼Œä½ é¦–å…ˆéœ€è¦ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå®‰è£…äº† cert-managerï¼Œé…ç½®äº†é€šè¿‡ &lt;code&gt;kubectl&lt;/code&gt;ï¼ˆè‡³å°‘éœ€è¦ 1.21.0 ç‰ˆæœ¬ï¼‰çš„è®¿é—®ï¼Œå¹¶å®‰è£…äº† &lt;a href=&#34;https://helm.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm&lt;/a&gt;ã€‚ä¸ºäº†éƒ¨ç½²å’Œè¿è¡Œæ‰€æœ‰ä¸åŒçš„ç»„ä»¶ï¼Œä½ å°†éœ€è¦åœ¨ä½ çš„ Kubernetes é›†ç¾¤ä¸­æä¾›å¤§çº¦ 4 æ ¸ CPU å’Œ 8GB çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„é›†ç¾¤ä¸­æ²¡æœ‰ cert-managerï¼Œä½ å°†éœ€è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®‰è£…å®ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;https://github.com/cert-manager/cert-manager/releases/download/v1.8.0/cert-manager.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‡†å¤‡å¥½åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Timescale Helm Chart æ¥å®‰è£… tobsã€‚åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm repo add timescale https://charts.timescale.com/ --force-update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;helm install --wait --timeout 10m tobs timescale/tobs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Tobs éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ¥å®‰è£…ï¼Œä½†æœ€ç»ˆï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#helm install --wait tobs timescale/tobs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME: tobs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;LAST DEPLOYED: Thu May &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; 11:22:19 &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAMESPACE: default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STATUS: deployed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REVISION: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NOTES:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;###############################################################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ‘‹ğŸ½ Welcome to tobs, The Observability Stack &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; Kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ¨ Auto-configured and deployed:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ”¥ Kube-Prometheus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ¯ TimescaleDB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ¤ Promscale
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ§ PromLens
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ“ˆ Grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸš€ OpenTelemetry
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ğŸ¯ Jaeger
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;###################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ‘‰ æ•…éšœæ’é™¤æç¤ºï¼šå¦‚æœä½ å¾—åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯ &lt;code&gt;INSTALLATION FAILED: rate:Wait(n=1) would exceed context deadline&lt;/code&gt;ï¼Œè¿™å¾ˆå¯èƒ½è¡¨æ˜ä½ çš„é›†ç¾¤ä¸­æ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ tobs çš„å®‰è£…å®Œæˆï¼Œæ£€æŸ¥ä½ çš„ Kubernetes é›†ç¾¤ï¼Œç¡®è®¤æ‰€æœ‰çš„ç»„ä»¶éƒ½å·²æ­£ç¡®éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get podes --all-namespaces &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;tobs-&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ‘‰æ•…éšœæ’é™¤æç¤ºï¼šå¦‚æœæŸäº› pod å¤„äºå¾…å®šæˆ–é”™è¯¯çŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl describe pod &amp;lt;pod-name&amp;gt;&lt;/code&gt; æˆ– &lt;code&gt;kubectl logs &amp;lt;pod-name&amp;gt;&lt;/code&gt; æ¥äº†è§£å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä» &lt;a href=&#34;https://github.com/timescale/opentelemetry-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTelemetry Demo GitHub repo&lt;/a&gt; ä¸­å¯¼å…¥æœªæµ‹é‡çš„ Kubernetes å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å›é¡¾ä¸€ä¸‹ &lt;code&gt;uninstrumented&lt;/code&gt; æ–‡ä»¶å¤¹ä¸­çš„ä»£ç ï¼Œä½ ä¼šå‘ç°å®ƒæ²¡æœ‰æåˆ° OpenTelemetryã€‚ä¾‹å¦‚ï¼Œçœ‹ä¸€ä¸‹ &lt;code&gt;load&lt;/code&gt; å¾®æœåŠ¡çš„ Python æ–‡ä»¶ï¼ˆè¿™ä¸ªæœåŠ¡é€šè¿‡å‘å‡ºå¯†ç è¯·æ±‚æ¥é©±åŠ¨å…¶ä»–æœåŠ¡çš„æµé‡ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;__name__&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å°†è¿™äº›å¾®æœåŠ¡å¯¼å…¥å®‰è£…äº† tobs çš„é›†ç¾¤ä¸­ï¼Œå®ƒä»¬å°†è‡ªåŠ¨è·å¾— OpenTelemetry è¿½è¸ªçš„æµ‹é‡å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;è¦è°ƒå‡ºæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œè¯·è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -k &lt;span class=&#34;s1&#34;&gt;&amp;#39;http://github.com/timescale/opentelemetry-demo/yaml/app&amp;#39;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“è¿™ä¸ªè¿‡ç¨‹ç»“æŸï¼Œåº”ç”¨ç¨‹åºè¢«éƒ¨ç½²æ—¶ï¼Œå®ƒå°†å·²ç»è¢« OpenTelemetry è¿½è¸ªå™¨æ‰€è®°å½•ã€‚è¿½è¸ªç°åœ¨æ­£åœ¨ç”Ÿæˆå¹¶è‡ªåŠ¨å‘é€åˆ° Promscaleã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§é­”æ³•æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸€ä¸ªæ€»ç»“æ€§çš„è§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª pod éƒ½è¢«æ³¨è§£ä¸º &lt;code&gt;instrumentation.opentelemetry.io/inject-python: &amp;quot;true&amp;quot;&lt;/code&gt;ï¼Œæ‰€ä»¥å½“å®ƒä»¬å¯åŠ¨æ—¶ï¼Œä¼šè¢« OpenTelemetry Operator æ³¨æ„åˆ°ã€‚&lt;/li&gt;
&lt;li&gt;æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªçªå˜çš„ webhook æ·»åŠ ä¸€ä¸ª init å®¹å™¨ï¼Œæ³¨å…¥ Python åº“å’Œå¯ç”¨æµ‹é‡å·¥å…·æ‰€éœ€çš„ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œè¿½è¸ªæ•°æ®è¢«å‘é€åˆ° Instrumentation CRD ä¸­æ³¨æ˜çš„ OpenTelemetry Collectorã€‚&lt;/li&gt;
&lt;li&gt;OpenTelemetry Collector å°†æ•°æ®å‘é€åˆ° Promscaleï¼ˆå’Œ TimescaleDBï¼‰ï¼Œä»é‚£é‡Œå¯ä»¥ç›´æ¥ç”¨ SQL æŸ¥è¯¢æˆ–ç”¨ Grafana ç­‰å·¥å…·è¿›è¡Œå¯è§†åŒ–è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ç›´æ¥ä» Grafanaï¼ˆtobs ä¹Ÿè‡ªåŠ¨å®‰è£…åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸­ï¼‰è‡ªåŠ¨ç”Ÿæˆçš„è¿½è¸ªã€‚&lt;/p&gt;
&lt;p&gt;è¦è·å¾— Grafana å®ä¾‹çš„ç®¡ç†ç”¨æˆ·çš„å¯†ç ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get secret tobs-grafana -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.data.admin-password}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 -d 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward svc/tobs-grafana 3000:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œå¯¼èˆªåˆ° http://localhost:3000/d/vBhEewLnkï¼Œä½¿ç”¨ä½ åˆšåˆšæ‰¾å›çš„å¯†ç ï¼Œä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½ç™»å½•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.timescale.com/promscale/latest/visualize-data/apm-experience/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Promscale åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰ä»ªè¡¨ç›˜&lt;/a&gt;å°†æ˜¾ç¤ºå‡ºæ¥ï¼Œå‘ä½ å±•ç¤ºå…³äºæ¼”ç¤ºåº”ç”¨çš„æ´å¯ŸåŠ›ã€‚Tobs ç›´æ¥å¯¼å…¥è¿™å¥—å¼€ç®±å³ç”¨ã€å¯ç”¨äºç”Ÿäº§çš„ä»ªè¡¨ç›˜ï¼Œæˆ‘ä»¬åœ¨ Grafana ä¸­ä½¿ç”¨ SQL æŸ¥è¯¢å¯¹è¿½è¸ªæ•°æ®è¿›è¡Œæ„å»ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ç”±æ¼”ç¤ºå¾®æœåŠ¡è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å…¶ä¸­ä¸€ä¸ªä»ªè¡¨ç›˜ â€”â€”â€œæœåŠ¡è¯¦æƒ…â€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ç”¨æ¼”ç¤ºåº”ç”¨ç¨‹åºçš„è¿½è¸ªæ•°æ®å¡«å……çš„æœåŠ¡ç»†èŠ‚ä»ªè¡¨ç›˜httpsdocstimescalecompromscalelatestvisualize-dataapm-experience&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ç”¨æ¼”ç¤ºåº”ç”¨ç¨‹åºçš„è¿½è¸ªæ•°æ®å¡«å……çš„&amp;lt;a href=&amp;#34;https://docs.timescale.com/promscale/latest/visualize-data/apm-experience/&amp;#34; target=&amp;#34;_blank&amp;#34; rel=&amp;#34;noopener&amp;#34;&amp;gt;æœåŠ¡ç»†èŠ‚ä»ªè¡¨ç›˜&amp;lt;/a&amp;gt;&#34; srcset=&#34;
               /translation/generate-and-store-opentelemetry-traces-automatically/service-overview_hu7b2370ea432b5684d50aba5f5c723790_152700_e987cee28e5586d3309d943b90593978.webp 400w,
               /translation/generate-and-store-opentelemetry-traces-automatically/service-overview_hu7b2370ea432b5684d50aba5f5c723790_152700_38fa9f225f71344d9cc7cadc07a0349a.webp 760w,
               /translation/generate-and-store-opentelemetry-traces-automatically/service-overview_hu7b2370ea432b5684d50aba5f5c723790_152700_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/generate-and-store-opentelemetry-traces-automatically/service-overview_hu7b2370ea432b5684d50aba5f5c723790_152700_e987cee28e5586d3309d943b90593978.webp&#34;
               width=&#34;760&#34;
               height=&#34;390&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ç”¨æ¼”ç¤ºåº”ç”¨ç¨‹åºçš„è¿½è¸ªæ•°æ®å¡«å……çš„&lt;a href=&#34;https://docs.timescale.com/promscale/latest/visualize-data/apm-experience/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç»†èŠ‚ä»ªè¡¨ç›˜&lt;/a&gt;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äºè¿™äº›é¢„å»ºä»ªè¡¨ç›˜çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·&lt;a href=&#34;https://www.timescale.com/blog/observability-powered-by-sql-understand-your-systems-like-never-before-with-opentelemetry-traces-and-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹è¿™ç¯‡åšæ–‡&lt;/a&gt;ï¼ˆå¯¼èˆªåˆ° â€œé›†æˆåˆ° Grafana çš„ç°ä»£ APM ä½“éªŒâ€ ä¸€èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»å¾—åˆ°äº†æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œè€Œåœ¨ä»»ä½• Python æœåŠ¡ä¸­éƒ½æ²¡æœ‰æµ‹é‡å·¥å…·ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;OpenTelemetry è¿½è¸ªä»æœªåƒç°åœ¨è¿™æ ·æ–¹ä¾¿ã€‚&lt;a href=&#34;https://opentelemetry.io/docs/collector/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚æœä½ çš„å¾®æœåŠ¡æ˜¯ç”¨ OpenTelemetry Operator ç›®å‰æ”¯æŒçš„è¯­è¨€ä¹‹ä¸€ç¼–å†™çš„&lt;/a&gt;ï¼Œä½ å¯ä»¥ç«‹å³å¼€å§‹æ”¶é›†å’Œå­˜å‚¨è¿½è¸ªæ•°æ®ï¼Œåªéœ€è¦å¾ˆå°‘çš„æ‰‹åŠ¨å·¥ä½œã€‚ä½ åªéœ€é‡‡å–ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/timescale/tobs/blob/master/chart/README.md#install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ Helm åœ¨ä½ çš„ Kubernetes é›†ç¾¤ä¸­å®‰è£… tobs&lt;/a&gt;(è¯·æ³¨æ„ï¼Œä½ å¿…é¡»ä½¿ç”¨ Helm æ¥å®‰è£… tobsï¼Œæ‰èƒ½ä½¿è¿™ä¸ªæœ€æ–°ç‰ˆæœ¬å‘æŒ¥ä½œç”¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ CLI)ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œç»™ä½ æƒ³æ”¶é›†è¿½è¸ªæ•°æ®çš„å¾®æœåŠ¡ pods æ·»åŠ &lt;a href=&#34;https://github.com/open-telemetry/opentelemetry-operator#opentelemetry-auto-instrumentation-injection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ³¨è§£&lt;/a&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;instrumentation.opentelemetry.io/inject-python: &amp;quot;true&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ çš„å¾®æœåŠ¡å°†è‡ªåŠ¨è¢« OpenTelemetry è¿½è¸ªå™¨æ£€æµ‹ï¼Œä½ çš„è¿½è¸ªå™¨å°†è‡ªåŠ¨å­˜å‚¨åœ¨ Promscale ä¸­ï¼ŒPromscale æ˜¯å»ºç«‹åœ¨ PostgreSQL å’Œ TimescaleDB ä¸Šçš„ç»Ÿä¸€çš„æŒ‡æ ‡å’Œè¿½è¸ªå™¨çš„å¯è§‚æµ‹æ€§åç«¯ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;a href=&#34;https://docs.timescale.com/promscale/latest/visualize-data/apm-experience/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Promscale é¢„å…ˆå»ºç«‹çš„ APM ä»ªè¡¨ç›˜&lt;/a&gt;ï¼Œä½ å°†ç«‹å³äº†è§£åˆ°ä½ çš„ç³»ç»Ÿæ€§èƒ½å¦‚ä½•ï¼Œå¹¶ä¸”ä½ å°†èƒ½å¤Ÿ&lt;a href=&#34;https://www.timescale.com/blog/observability-powered-by-sql-understand-your-systems-like-never-before-with-opentelemetry-traces-and-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ SQL æŸ¥è¯¢ä½ çš„è¿½è¸ª&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ··æ²Œå·¥ç¨‹å’Œè§†è§‰éšå–»çš„å¯è§‚æµ‹æ€§</title>
      <link>https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/</link>
      <pubDate>Tue, 24 May 2022 10:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/</guid>
      <description>&lt;h2 id=&#34;ä¸»è¦æ”¶è·&#34;&gt;ä¸»è¦æ”¶è·&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºç°ä»£è½¯ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œå¯è§‚æµ‹æ€§ä¸æ˜¯å…³äºæ•°å­¦æ–¹ç¨‹ã€‚å®ƒæ˜¯å…³äºäººç±»å¦‚ä½•ä¸å¤æ‚çš„ç³»ç»Ÿäº’åŠ¨å¹¶è¯•å›¾ç†è§£å®ƒä»¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ··æ²Œå·¥ç¨‹åˆ©ç”¨äº†å¯è§‚æµ‹æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥æ£€æµ‹åˆ°ç³»ç»Ÿç¨³å®šçŠ¶æ€çš„åå·®ã€‚æ··æ²Œå·¥ç¨‹å€ŸåŠ©å¯è§‚æµ‹æ€§å¯ä»¥å‘ç°å’Œå…‹æœç³»ç»Ÿçš„å¼±ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯è§‚æµ‹æ€§ä¾èµ–äºç³»ç»Ÿæ‰€å‘å‡ºçš„ä¿¡å·ï¼Œè¿™äº›ä¿¡å·æä¾›äº†å…³äºç³»ç»Ÿè¡Œä¸ºçš„åŸå§‹æ•°æ®ã€‚ç„¶è€Œï¼Œå¯è§‚æµ‹æ€§ä¸ä»…å—é™äºè¿™äº›ä¿¡å·çš„è´¨é‡ï¼Œè¿˜å—é™äºè¿™äº›ä¿¡å·çš„å¯è§†åŒ–å’Œè§£é‡Šçš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è€ƒè™‘åˆ°æ··æ²Œå·¥ç¨‹ã€å¯è§‚æµ‹æ€§å’Œå¯è§†åŒ–æ¶‰åŠåˆ°äººç±»è‡ªæˆ‘çš„è§£é‡Šï¼Œä»ªè¡¨ç›˜çš„è®¾è®¡è€…å¯èƒ½ä¼šå¯¹è¿™äº›è§£é‡Šäº§ç”Ÿåå·®ï¼Œè¿™æ˜¯ä¸€ä¸ªäº‹å®ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œè§†è§‰éšå–»å¹¶ä¸èƒ½ä¿è¯æˆ‘ä»¬ä»¥æ­£ç¡®çš„æ–¹å¼è§£é‡Šè¿™äº›æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºè§†è§‰éšå–»çš„ä»ªè¡¨ç›˜å¯ä»¥æä¾›æ¯”ç»å…¸çš„å¯è§†åŒ–æ›´æœ‰ç”¨çš„æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§ç­–ç•¥éƒ½å¾ˆå®¹æ˜“äº§ç”Ÿåå·®ï¼›ä¾‹å¦‚ï¼Œåœ¨ä¸€é¡¹ç ”ç©¶ä¸­ï¼Œå¤§å¤šæ•°å‚ä¸è€…éƒ½æ³¨æ„åˆ°ï¼Œç”±äºæ˜¾ç¤ºäº†ç³Ÿç³•çš„æŸ±çŠ¶å›¾å’Œçº¿çŠ¶å›¾ï¼Œæ²¡æœ‰åœ¨å›¾ä¸­æ˜¾ç¤ºå‡ºé‡è¦çš„åˆ†ç•Œç‚¹ï¼Œå› æ­¤æ•´ä½“ç»“æœæ˜¯æœ‰åå·®çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡ªä» Netflixã€Slack å’Œ Linkedin ç­‰é¢†å…ˆçš„æŠ€æœ¯å…¬å¸é‡‡ç”¨æ··æ²Œå·¥ç¨‹æ¥æŠµå¾¡ç”Ÿäº§ä¸­çš„æ„å¤–ä¸­æ–­åï¼Œè¿™é—¨å­¦ç§‘åœ¨è¿‘æ¥å·²ç»æˆä¸ºä¸»æµã€‚åœ¨è¿™æ¡é“è·¯ä¸Šï¼Œå¯è§‚æµ‹æ€§å‘æŒ¥äº†å…³é”®ä½œç”¨ï¼Œä¸ºå·¥ç¨‹å¸ˆä»¬å¸¦æ¥äº†æ•°æ®å’Œç›‘æ§çš„åŠ›é‡ï¼Œä»–ä»¬ç°åœ¨æœ‰äº†äº†è§£è‡ªå·±ç³»ç»Ÿçš„ç­–ç•¥ï¼Œç¡®å®šå½“æŸäº›ä¸œè¥¿å‘ç”Ÿæ•…éšœæ—¶å®ƒä»¬å°†å¦‚ä½•è¡¨ç°ï¼Œå¹¶å¢åŠ å¤åŸåŠ›å’Œå¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§æ˜¯ä¸¤ä¸ªå¯†åˆ‡ç›¸å…³çš„å­¦ç§‘ã€‚æ ¹æ® Russ Miles çš„è¯´æ³•ï¼Œ&amp;quot;å¯è§‚æµ‹æ€§åŸåˆ™å°†ç³»ç»Ÿå˜æˆäº†å¯æ£€æŸ¥å’Œå¯è°ƒè¯•çš„æ¡ˆå‘ç°åœºï¼Œè€Œæ··æ²Œå·¥ç¨‹é¼“åŠ±å¹¶åˆ©ç”¨å¯è§‚æµ‹æ€§ï¼Œå› ä¸ºå®ƒè¯•å›¾å¸®åŠ©é¢„å…ˆå‘ç°å¹¶å…‹æœç³»ç»Ÿçš„å¼±ç‚¹ &amp;quot;ã€‚æ··æ²Œå·¥ç¨‹é¼“åŠ±å¹¶è¦æ±‚å¯è§‚æµ‹æ€§ï¼Œå› ä¸ºè¦è‡ªä¿¡åœ°æ‰§è¡Œæ··æ²Œå®éªŒï¼Œå¯è§‚æµ‹æ€§å¿…é¡»æ£€æµ‹ç³»ç»Ÿä½•æ—¶æ­£å¸¸ï¼Œä»¥åŠåœ¨æ‰§è¡Œæ–¹æ³•å®éªŒæ—¶å¦‚ä½•åç¦»è¯¥ç¨³å®šçŠ¶æ€ã€‚è§å›¾ 1 ä¸­çš„è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1-æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1. æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f1_huf280a69d36e74c95041d917268dd5fcf_36322_5d7fb018e0e824d2448996f75ff4f637.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f1_huf280a69d36e74c95041d917268dd5fcf_36322_b2bb9661845b41200cb05c69a2d66c51.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f1_huf280a69d36e74c95041d917268dd5fcf_36322_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f1_huf280a69d36e74c95041d917268dd5fcf_36322_5d7fb018e0e824d2448996f75ff4f637.webp&#34;
               width=&#34;760&#34;
               height=&#34;399&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1. æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å­¦æœ¯ç•Œå’Œç§‘æŠ€ç•Œéƒ½åšå‡ºäº†å·¨å¤§çš„åŠªåŠ›ï¼Œä¸ºå®è·µæ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§æä¾›äº†å·¥å…·ã€‚ç„¶è€Œï¼ŒæŒ‡æ ‡çš„å¯è§†åŒ–å’Œè§†è§‰ç­–ç•¥çš„é€‚å½“é€‰æ‹©ä»ç„¶æ˜¯æœ‰é™çš„ã€‚æœ¬æ–‡å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è§’è‰²ï¼šè§†è§‰éšå–»ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæä¾›äº†æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§çš„æ¦‚å¿µåŸºç¡€ï¼Œä»‹ç»äº†å¸‚åœºä¸Šå¯ç”¨çš„å¯è§†åŒ–æŠ€æœ¯çš„ç°çŠ¶ï¼Œå¹¶å±•ç¤ºäº†æ ‘çŠ¶å›¾ã€ä»ªè¡¨å›¾ã€åœ°ç†å›¾å’ŒåŸå¸‚éšå–»æ˜¯å¦‚ä½•ä¸°å¯Œè§‚å¯Ÿæ··æ²Œçš„è§†è§‰ç­–ç•¥çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§çš„åŸºç¡€&#34;&gt;æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§çš„åŸºç¡€&lt;/h2&gt;
&lt;p&gt;å…³äºæ··æ²Œå·¥ç¨‹ï¼šæ··æ²Œã€å¼¹æ€§å’Œå¯é æ€§æ˜¯å…³é”®çš„æ¦‚å¿µï¼Œè€Œå…³äºå¯è§‚æµ‹æ€§ï¼Œå½“äººç±»æƒ³è¦è§‚å¯Ÿä»–ä»¬çš„ç³»ç»Ÿæ—¶ï¼Œç›‘æ§ã€åº¦é‡å’Œä»ªè¡¨ç›˜æ˜¯è‡³å…³é‡è¦çš„ã€‚å› æ­¤ï¼Œåœ¨æ·±å…¥ç ”ç©¶æ··æ²Œå·¥ç¨‹å’Œå¯è§‚æµ‹æ€§ä¹‹é—´çš„å…³ç³»ä¹‹å‰ï¼Œæ˜ç¡®è¿™äº›å®šä¹‰å¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;æ··æ²Œå·¥ç¨‹æ ¹æ®æ··æ²ŒåŸç†å®šä¹‰ä¸ºä¸€é—¨åœ¨ç³»ç»Ÿä¸Šè¿›è¡Œå®éªŒçš„å­¦ç§‘ï¼Œä»¥å»ºç«‹å¯¹ç³»ç»Ÿåœ¨ç”Ÿäº§ä¸­æ‰¿å—åŠ¨è¡æ¡ä»¶èƒ½åŠ›çš„ä¿¡å¿ƒã€‚ä¸ºäº†å…·ä½“è§£å†³å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸ç¡®å®šæ€§ï¼Œæ··æ²Œå·¥ç¨‹æä¾›äº†ä¸€ç§åŸºäºå®éªŒçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å››ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€ä¸ªæ­¥éª¤åŒ…æ‹¬å®šä¹‰ç¨³å®šçŠ¶æ€ï¼Œè¿™æ˜¯ç³»ç»Ÿçš„ä¸€ä¸ªå¯æµ‹é‡çš„è¾“å‡ºï¼Œè¡¨ç¤ºæ­£å¸¸è¡Œä¸ºã€‚ç¬¬äºŒæ­¥æ˜¯ä¸å‡è®¾ç›¸å…³çš„ï¼Œå®ƒæå‡ºäº†ä¸€ä¸ªæ”¹å˜ç¨³æ€çš„åæœçš„å¥å­ã€‚æœ‰äº†è¿™ä¸ªå‡è®¾ï¼Œå°±è¯¥å¼•å…¥ç°å®ä¸–ç•Œçš„äº‹ä»¶ï¼Œå¦‚æœåŠ¡å™¨å´©æºƒæˆ–ç¡¬ç›˜æ•…éšœï¼Œä»¥è¯å®æˆ–åé©³è¿™ä¸ªå‡è®¾ã€‚æœ€åï¼Œç›®æ ‡æ˜¯å»ºç«‹æ§åˆ¶ç»„å’Œå®éªŒç»„ä¹‹é—´ç¨³å®šçŠ¶æ€çš„å·®å¼‚åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;å¯è§‚æµ‹æ€§æ˜¯æŒ‡èƒ½å¤Ÿå®Œå…¨ç†è§£ä¸€ä¸ªç³»ç»Ÿã€‚åœ¨æ§åˆ¶ç†è®ºä¸­ï¼Œå®ƒè¢«å®šä¹‰ä¸ºè¡¡é‡ä¸€ä¸ªç³»ç»Ÿçš„å†…éƒ¨çŠ¶æ€å¯ä»¥ä»å…¶å¤–éƒ¨è¾“å‡ºçš„çŸ¥è¯†ä¸­æ¨æ–­å‡ºæ¥çš„ç¨‹åº¦ã€‚ç‰¹åˆ«æ˜¯åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œå¯è§‚æµ‹æ€§å¯ä»¥è¢«æè¿°ä¸ºæå‡ºé€‚å½“çš„é—®é¢˜ã€æä¾›æ­£ç¡®çš„ç­”æ¡ˆä»¥åŠç”¨æ”¶é›†åˆ°çš„æ•°æ®å»ºç«‹çŸ¥è¯†çš„è‰ºæœ¯ã€‚&lt;/p&gt;
&lt;p&gt;ç›‘æ§ä¸å¯è§‚æµ‹æ€§æ˜¯ä¸åŒçš„ï¼Œç†è§£ä¸¤è€…çš„åŒºåˆ«å¾ˆé‡è¦ã€‚ç›‘æ§æ˜¯å…³äºæ”¶é›†ã€å¤„ç†ã€æ±‡æ€»å’Œæ˜¾ç¤ºç³»ç»Ÿçš„å®æ—¶å®šé‡æ•°æ®ï¼›è€Œå¯è§‚æµ‹æ€§æ˜¯å…³äºå¤„ç†å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œè®©å›¢é˜Ÿä¸»åŠ¨ç†è§£å’Œè°ƒè¯•ç³»ç»Ÿçš„è¡Œä¸ºã€‚å¯¹äºç°ä»£è½¯ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œå¯è§‚æµ‹æ€§ä¸æ˜¯å…³äºæ•°å­¦å…¬å¼ã€‚å®ƒæ˜¯å…³äºäººä»¬å¦‚ä½•ä¸å¤æ‚çš„ç³»ç»Ÿäº’åŠ¨å¹¶è¯•å›¾ç†è§£å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œç›‘æ§æ¶‰åŠåˆ°é€šè¿‡æ•°å­—è¯»å–ç³»ç»Ÿå‘å‡ºçš„ä¿¡å·ï¼Œè¿™äº›æ•°å­—è¢«å‘½åä¸ºåº¦é‡ã€‚æŒ‡æ ‡æ˜¯ä¸€ä¸ªå•ä¸€çš„æ•°å­—ï¼Œå¯ä»¥é€‰æ‹©é™„åŠ æ ‡ç­¾è¿›è¡Œåˆ†ç»„å’Œæœç´¢ï¼Œæ¯”å¦‚æŸ¥è¯¢æ¬¡æ•°å’Œç±»å‹ã€é”™è¯¯æ¬¡æ•°å’Œç±»å‹ã€å¤„ç†æ—¶é—´æˆ–æœåŠ¡å™¨å¯¿å‘½ã€‚è¿™äº›æ•°å€¼åœ¨ä»ªè¡¨ç›˜ä¸­è¢«å¯è§†åŒ–ï¼Œä»ªè¡¨ç›˜æ˜¯æä¾›æœåŠ¡æ ¸å¿ƒæŒ‡æ ‡çš„æ‘˜è¦è§†å›¾çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿçš„ä»ªè¡¨ç›˜æ˜¯å»ºç«‹åœ¨æŠ˜çº¿å›¾ã€é¥¼å›¾æˆ–æŸ±çŠ¶å›¾ä¸Šçš„ã€‚è€ƒè™‘åˆ°å¯è§‚æµ‹æ€§å–å†³äºç³»ç»Ÿå‘å‡ºçš„ä¿¡å·ä»¥åŠè¿™äº›ä¿¡å·è¢«å¯è§†åŒ–å’Œè§£é‡Šçš„è´¨é‡ï¼Œæä¾›æœ€å¥½çš„å·¥å…·å’Œè®¾è®¡æ˜¯å¾ˆé‡è¦çš„ã€‚å¦‚æœé¢œè‰²ã€å›¾ä¾‹å’Œæ¯”ä¾‹ä½¿ç”¨ä¸å½“ï¼Œä¸€äº›å¯è§†åŒ–å¯èƒ½ä¼šå¯¹æ“ä½œè€…é€ æˆé™åˆ¶å’Œå›°æƒ‘ã€‚ä¸‹ä¸€èŠ‚æä¾›äº†ç›‘æ§å’Œå¯è§‚æµ‹æ€§çš„æŠ€æœ¯çŠ¶å†µï¼Œå¹¶æ›´è¯¦ç»†åœ°æè¿°äº†å…¶ä¸­çš„ä¸€äº›é™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›‘æ§å’Œå¯è§‚æµ‹æ€§&#34;&gt;ç›‘æ§å’Œå¯è§‚æµ‹æ€§&lt;/h2&gt;
&lt;p&gt;ç›‘æ§å’Œå¯è§‚æµ‹æ€§å·²ç»æˆä¸ºå·¥ç¨‹å›¢é˜Ÿå’Œä¸€èˆ¬ç°ä»£æ•°å­—ä¼ä¸šæœ€åŸºæœ¬çš„èƒ½åŠ›ä¹‹ä¸€ï¼Œä»–ä»¬å¸Œæœ›åœ¨ä»–ä»¬çš„è§£å†³æ–¹æ¡ˆä¸­æä¾›å“è¶Šã€‚ç”±äºç›‘æ§å’Œè§‚å¯Ÿç³»ç»Ÿæœ‰å¾ˆå¤šåŸå› ï¼Œè°·æ­Œè®°å½•äº†å››ä¸ªé»„é‡‘ä¿¡å·æˆ–æŒ‡æ ‡ï¼Œå®ƒä»¬å®šä¹‰äº†ç³»ç»Ÿå¥åº·çš„å«ä¹‰ï¼Œæ˜¯å¯è§‚æµ‹æ€§å’Œç›‘æ§å¹³å°ç°çŠ¶çš„åŸºç¡€ã€‚è¿™å››ä¸ªæŒ‡æ ‡æè¿°å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å»¶è¿Ÿï¼ˆLatencyï¼‰æ˜¯æŒ‡ä¸€ä¸ªæœåŠ¡ä¸ºä¸€ä¸ªè¯·æ±‚æä¾›æœåŠ¡æ‰€éœ€çš„æ—¶é—´ã€‚å®ƒåŒ…æ‹¬ç”±äºä¸æ•°æ®åº“æˆ–å…¶ä»–å…³é”®åç«¯å¤±å»è¿æ¥è€Œè§¦å‘çš„ HTTP 500 é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å¯èƒ½ä¸ä¼šå¾ˆå¿«å¾—åˆ°æœåŠ¡ã€‚å»¶è¿Ÿæ˜¯ä¸€ä¸ªåŸºæœ¬æŒ‡æ ‡ï¼Œå› ä¸ºæ…¢çš„é”™è¯¯ç”šè‡³æ¯”å¿«çš„é”™è¯¯æ›´ç³Ÿç³•ã€‚&lt;/p&gt;
&lt;p&gt;æµé‡ï¼ˆTrafficï¼‰æ˜¯è¡¡é‡å¯¹ç³»ç»Ÿçš„éœ€æ±‚æœ‰å¤šå¤§ã€‚å®ƒå†³å®šäº†ç³»ç»Ÿåœ¨æŸä¸€ç‰¹å®šæ—¶é—´å†…ä»ç”¨æˆ·æˆ–é€šè¿‡æœåŠ¡è¿è¡Œçš„äº‹åŠ¡ä¸­æ‰¿å—å¤šå¤§çš„å‹åŠ›ã€‚ä»¥ç½‘ç»œæœåŠ¡ä¸ºä¾‹ï¼Œè¿™ç§æµ‹é‡é€šå¸¸æ˜¯æ¯ç§’çš„ HTTP è¯·æ±‚ã€‚é€šè¿‡ç›‘æ§åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ä¸­çš„çœŸå®ç”¨æˆ·äº’åŠ¨å’Œæµé‡ï¼Œå·¥ç¨‹å›¢é˜Ÿå¯ä»¥çœ‹åˆ°ç³»ç»Ÿå¦‚ä½•æ”¯æŒéœ€æ±‚çš„å˜åŒ–ï¼Œä»¥åŠä»–ä»¬åº”è¯¥å¦‚ä½•æ‰©å±•èµ„æºä»¥æ»¡è¶³éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;é”™è¯¯ï¼ˆErrorï¼‰ä¸è¯·æ±‚å¤±è´¥çš„æ¯”ç‡æœ‰å…³ï¼Œæ— è®ºæ˜¯æ˜¾æ€§çš„è¿˜æ˜¯éšæ€§çš„ã€‚æ ¹æ®ç³»ç»Ÿå’Œå‘ç”Ÿæ•…éšœçš„ç»„ä»¶ï¼Œç›‘æ§é”™è¯¯æƒ…å†µå¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå·¥ç¨‹å›¢é˜Ÿéœ€è¦ç›‘æ§æ•´ä¸ªç³»ç»Ÿçš„é”™è¯¯å‘ç”Ÿç‡ï¼Œä½†ä¹Ÿéœ€è¦ç›‘æ§å•ä¸ªæœåŠ¡å±‚é¢çš„é”™è¯¯å‘ç”Ÿç‡çš„åŸå› ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œè¦ä¼˜å…ˆè€ƒè™‘å“ªäº›é”™è¯¯æ˜¯å…³é”®çš„ï¼Œå“ªäº›é”™è¯¯æ˜¯ä¸å¤ªå±é™©çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œé¥±å’Œåº¦ï¼ˆSaturationï¼‰æ˜¯ç³»ç»Ÿå¯¹èµ„æºåˆ©ç”¨çš„ä¿¡å·ï¼Œå¦‚å†…å­˜ã€I/O æˆ– CPUã€‚è€ƒè™‘åˆ°è®¸å¤šç³»ç»Ÿåœ¨è¾¾åˆ° 100% çš„åˆ©ç”¨ç‡ä¹‹å‰å°±ä¼šå‡ºç°æ€§èƒ½ä¸‹é™çš„æƒ…å†µï¼Œæ‹¥æœ‰ä¸€ä¸ªé¥±å’Œåº¦ç›®æ ‡æ˜¯éå¸¸é‡è¦çš„ã€‚å®ƒå…è®¸æˆ‘ä»¬å›ç­”è¿™æ ·çš„é—®é¢˜ï¼šæœåŠ¡è¿˜æœ‰å¤šå°‘å®¹é‡ï¼Ÿä»€ä¹ˆæ°´å¹³çš„é¥±å’Œåº¦èƒ½ä¿è¯å®¢æˆ·çš„æœåŠ¡æ€§èƒ½å’Œå¯ç”¨æ€§ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;ç”¨äºç›‘æ§çš„ä¼ ç»Ÿå¯è§†åŒ–æ–¹æ³•&#34;&gt;ç”¨äºç›‘æ§çš„ä¼ ç»Ÿå¯è§†åŒ–æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸Šä¸€èŠ‚æ‰€è¿°çš„å››ä¸ªé»„é‡‘ä¿¡å·æ˜¯ç”¨ä¼ ç»Ÿæ–¹æ³•ç›‘æ§çš„ï¼Œå¦‚æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾æˆ–é¥¼çŠ¶å›¾ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚å›¾ 2 æ‰€ç¤ºï¼ŒæŠ˜çº¿å›¾æ˜¯å°†ç³»ç»Ÿçš„å››ä¸ªé»„é‡‘ä¿¡å·çš„è¡Œä¸ºåœ¨æ—¶é—´ä¸Šå¯è§†åŒ–çš„æœ€å¸¸ç”¨ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-è™šæ„é¡¹ç›®ä¸­çš„æŠ˜çº¿å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2. è™šæ„é¡¹ç›®ä¸­çš„æŠ˜çº¿å›¾&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f2_hu88aeb9acab18176e9eb3c67caa5e4d41_26588_a7071667ac1f1e2b91f04ef67672971c.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f2_hu88aeb9acab18176e9eb3c67caa5e4d41_26588_0c8c4496e612c4a2c59bdf77da85218f.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f2_hu88aeb9acab18176e9eb3c67caa5e4d41_26588_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f2_hu88aeb9acab18176e9eb3c67caa5e4d41_26588_a7071667ac1f1e2b91f04ef67672971c.webp&#34;
               width=&#34;760&#34;
               height=&#34;362&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2. è™šæ„é¡¹ç›®ä¸­çš„æŠ˜çº¿å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;çº¿å½¢å›¾åœ¨é¢œè‰²ã€å›¾ä¾‹ã€è½´å’Œç³»åˆ—çš„æ ‡é¢˜æ–¹é¢æå‡ºäº†ä¸åŒçš„æŒ‘æˆ˜ï¼Œå› ä¸ºå˜é‡ä¼šèšã€äº¤å‰ï¼Œè€Œä¸”é€šå¸¸ä¼šçº ç¼ åœ¨ä¸€èµ·ã€‚å¦‚æœä»ªè¡¨ç›˜çš„åˆ›å»ºè€…æ²¡æœ‰ä½¿ç”¨é€‚å½“çš„è§†è§‰èµ„äº§ï¼Œè¿™ç§ç±»å‹çš„å›¾å½¢å¯èƒ½ä¼šå˜æˆæœ€ä»¤äººå›°æƒ‘çš„å›¾è¡¨ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªå¸¸è§çš„å›¾è¡¨æ˜¯æŸ±çŠ¶å›¾ï¼Œå®ƒæ˜¯ç”¨é«˜åº¦æˆ–é•¿åº¦ä¸æ‰€ä»£è¡¨çš„æ•°å€¼æˆæ­£æ¯”çš„çŸ©å½¢æ¡æ¥è¡¨ç¤ºåˆ†ç±»æ•°æ®ã€‚å¦‚å›¾ 3 æ‰€ç¤ºï¼Œä¸€äº›äº‘ä¾›åº”å•†ç”¨å®ƒä»¬æ¥è¡¨ç¤ºæ—¥å¿—çš„åˆ†ç±»æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3-ä¸€ä¸ªè™šæ„çš„é¡¹ç›®ä¸­çš„æŸ±çŠ¶å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3. ä¸€ä¸ªè™šæ„çš„é¡¹ç›®ä¸­çš„æŸ±çŠ¶å›¾&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f3_huec1427940dfdc13893b83265e8be3044_20366_f171ab2438faaf52e91c84f8323a02f9.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f3_huec1427940dfdc13893b83265e8be3044_20366_5bb59c44a456b6ffb7869609155d97d6.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f3_huec1427940dfdc13893b83265e8be3044_20366_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f3_huec1427940dfdc13893b83265e8be3044_20366_f171ab2438faaf52e91c84f8323a02f9.webp&#34;
               width=&#34;760&#34;
               height=&#34;315&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3. ä¸€ä¸ªè™šæ„çš„é¡¹ç›®ä¸­çš„æŸ±çŠ¶å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå°½ç®¡è¾ƒå°‘ä½¿ç”¨ï¼Œé¥¼å›¾æ˜¯è¡¨ç¤ºå’Œæ¯”è¾ƒæ•°æ®åˆ†å¸ƒä¸­çš„æ¯”ä¾‹çš„ä¸€ç§ç®€å•æ–¹æ³•ã€‚å½“ä¸€ä¸ªæ¯”ä¾‹å ä¸»å¯¼åœ°ä½â€”â€”ä¸€åŠæˆ–å››åˆ†ä¹‹ä¸‰æ—¶ï¼Œå®ƒä»¬æ˜¯æœ€æœ‰æ•ˆçš„ã€‚è¶…è¿‡å‡ ç§é¢œè‰²çš„æ¥”å½¢å›¾ä¼šåœ¨æ¥”å½¢å›¾ä¹‹é—´äº§ç”ŸåŒä¸€æ€§ï¼Œä½¿å…¶éš¾ä»¥æ¯”è¾ƒæ•°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°è¿™äº›å±€é™æ€§ï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»ä¸€ç§ä¸åŒçš„æ–¹å¼æ¥å¯è§†åŒ–è¿™å››ä¸ªé»„é‡‘æŒ‡æ ‡ã€‚ç”±äºæœ¬æ–‡æ˜¯å…³äºæ··æ²Œå·¥ç¨‹çš„ï¼Œè¿™ç§æŠ€æœ¯æ˜¯åœ¨æŠ¥å‘Šäº‹ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œåˆ†æçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§†è§‰éšå–»ä½œä¸ºè§†è§‰åŒ–æ··æ²Œçš„ä¸€ç§å»ºè®®&#34;&gt;è§†è§‰éšå–»ä½œä¸ºè§†è§‰åŒ–æ··æ²Œçš„ä¸€ç§å»ºè®®&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å…‹æœå‰é¢æåˆ°çš„å±€é™æ€§ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„ç­–ç•¥ï¼Œå°†ç”Ÿäº§ä¸­çš„æ··ä¹±ç°è±¡å¯è§†åŒ–ã€‚è¿™ä¸ªå»ºè®®æ˜¯åŸºäºå…¶ä»–ç§‘å­¦é¢†åŸŸçš„ä¸€ä¸ªæ¦‚å¿µï¼šè§†è§‰éšå–»ã€‚è§†è§‰éšå–»æ˜¯ä¸€ç§ç­–ç•¥ï¼Œå°†ä¸€ä¸ªåº”ç”¨é¢†åŸŸçš„æ¦‚å¿µå’Œå¯¹è±¡æ˜ å°„åˆ°ä¸€ä¸ªç›¸ä¼¼æ€§å’Œç±»æ¯”çš„ç³»ç»Ÿä¸­ã€‚è®¡ç®—æœºéšå–»æ˜¯äº¤äº’å¼è§†è§‰å¯¹è±¡å’Œæ¨¡å‹å¯¹è±¡ä¹‹é—´åŒåŒ–çš„åŸºæœ¬æ€æƒ³ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¿ƒè¿›å¯¹å¯¹è±¡çš„è¯­ä¹‰çš„æ›´å¥½ç†è§£ã€‚ä¸€ä¸ªç†Ÿæ‚‰çš„ä¾‹å­å¯ä»¥æ˜¯åœ¨è·‘è½¦çš„å›¾ç‰‡å‰ä½¿ç”¨ä¸€åªè±¹å­ï¼Œæš—ç¤ºè¯¥äº§å“å…·æœ‰é€Ÿåº¦ã€åŠ›é‡å’Œè€åŠ›ç­‰å¯æ¯”æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›ä¾‹å­åŒ…æ‹¬ï¼šåœ°å›¾ã€åŸå¸‚å’Œå‡ ä½•åœºæ™¯ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚è¯¥å›¾æ˜¾ç¤ºäº†åŸå¸‚éšå–»ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå¯è§†åŒ–ç¨‹åºä»£ç å±æ€§çš„æµè¡Œæ–¹æ³•ã€‚è®¸å¤šé¡¹ç›®éƒ½é‡‡ç”¨äº†è¿™ç§éšå–»æ¥å¯è§†åŒ–è½¯ä»¶åº“çš„å±æ€§ï¼Œæ¯”å¦‚è¯´ã€‚ç°æœ‰çš„ç ”ç©¶å·²ç»è¢«ç”¨æ¥ç”¨åŒ…æ¥æ˜ å°„è¡—åŒºï¼Œç”¨å»ºç­‘æ¥æ˜ å°„ç±»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4-ä¸€ä¸ªè™šæ„é¡¹ç›®ä¸­çš„åŸå¸‚éšå–»æ¥è‡ªè¿™é‡Œhttpswwwresearchgatenetpublication224503826_visual_exploration_of_large-scale_evolving_software&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4. ä¸€ä¸ªè™šæ„é¡¹ç›®ä¸­çš„åŸå¸‚éšå–»ï¼Œæ¥è‡ª&amp;lt;a href=&amp;#34;https://www.researchgate.net/publication/224503826_Visual_Exploration_of_Large-Scale_Evolving_Software&amp;#34; target=&amp;#34;_blank&amp;#34; rel=&amp;#34;noopener&amp;#34;&amp;gt;è¿™é‡Œ&amp;lt;/a&amp;gt;&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f4_hu88c9b151cfdb4b13fa315b0869397f32_20182_639d60ca309b4fa0a9f1d6248f19003d.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f4_hu88c9b151cfdb4b13fa315b0869397f32_20182_aa172a266c11157371240586a8a2dc60.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f4_hu88c9b151cfdb4b13fa315b0869397f32_20182_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f4_hu88c9b151cfdb4b13fa315b0869397f32_20182_639d60ca309b4fa0a9f1d6248f19003d.webp&#34;
               width=&#34;500&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4. ä¸€ä¸ªè™šæ„é¡¹ç›®ä¸­çš„åŸå¸‚éšå–»ï¼Œæ¥è‡ª&lt;a href=&#34;https://www.researchgate.net/publication/224503826_Visual_Exploration_of_Large-Scale_Evolving_Software&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªéšå–»æŠŠç±»è¡¨ç¤ºä¸ºå»ºç­‘ç‰©ï¼ŒæŠŠåŒ…è¡¨ç¤ºä¸ºå»ºç­‘ç‰©æ‰€å¤„çš„é‚»åŸŸã€‚å»ºç­‘ç‰©çš„æ¯ä¸ªè¾¹ç¼˜éƒ½è¢«ç”¨æ¥æ˜ å°„ç±»çš„å±æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æå‡ºä¸€ä¸ªå°†äº‹ä»¶å¯è§†åŒ–çš„å®éªŒ&#34;&gt;æå‡ºä¸€ä¸ªå°†äº‹ä»¶å¯è§†åŒ–çš„å®éªŒ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ç¡®å®šå‚ä¸è¿è¥æ´»åŠ¨çš„å·¥ç¨‹å›¢é˜Ÿçš„çœ‹æ³•ï¼Œæˆ‘ä»¬å¯¹ä»–ä»¬ä¸­çš„ 28 äººè¿›è¡Œäº†å…³äºä¼ ç»Ÿä»ªè¡¨ç›˜å’Œè§†è§‰éšå–»çš„è°ƒæŸ¥ã€‚å…·ä½“æ¥è¯´ï¼Œä»–ä»¬è¢«é—®åŠä½¿ç”¨ç»å…¸ä»ªè¡¨ç›˜å’Œè§†è§‰éšå–»å¯¹å››ä¸ªé»„é‡‘æŒ‡æ ‡ï¼ˆé”™è¯¯ã€å»¶è¿Ÿã€æµé‡å’Œé¥±å’Œåº¦ï¼‰è¿›è¡Œå¯è§†åŒ–çš„äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é¡¹ç ”ç©¶ç”±å…³äºä¸€ä¸ªäº‹ä»¶çš„å…·ä½“é—®é¢˜ç»„æˆï¼Œå…¶ä¸­æä¾›äº†ä¸¤ç§å¯è§†åŒ–ï¼šä¸€ç§æ˜¯ä¼ ç»Ÿçš„å›¾è¡¨ï¼Œå¦ä¸€ç§æ˜¯è§†è§‰éšå–»ã€‚å¯¹äºæ¯ä¸€ç§æƒ…å†µï¼Œéƒ½åˆ†æäº†æ¯ç§å¯è§†åŒ–çš„ä»·å€¼ã€‚åœ¨æ¥ä¸‹æ¥çš„æ®µè½ä¸­ï¼Œå°†ä»‹ç»æ¯ä¸ªé—®é¢˜å’Œåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;å…³äºäººå£ç»Ÿè®¡å­¦ï¼Œå…±æœ‰ 28 åå‚ä¸è€…ï¼Œå…¶èƒŒæ™¯åˆ†å¸ƒåœ¨åç«¯ã€å‰ç«¯å’Œå…¨æ ˆå·¥ç¨‹å¸ˆã€è½¯ä»¶æ¶æ„å¸ˆã€æ•°æ®å·¥ç¨‹å¸ˆå’Œç½‘ç«™å¯é æ€§å·¥ç¨‹å¸ˆã€‚å¦‚å›¾ 5 æ‰€ç¤ºï¼Œå‚ä¸äººæ•°æœ€å¤šçš„æ˜¯åç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5-äººå£ç»Ÿè®¡å­¦æ•°æ®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5. äººå£ç»Ÿè®¡å­¦æ•°æ®&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f5_hud694102797a2daf59095aa51e0491a3e_41428_6fc1f3923bd515b4cb18185818326384.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f5_hud694102797a2daf59095aa51e0491a3e_41428_ca77edf6b3ca05bf5b1d10acd1c83280.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f5_hud694102797a2daf59095aa51e0491a3e_41428_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f5_hud694102797a2daf59095aa51e0491a3e_41428_6fc1f3923bd515b4cb18185818326384.webp&#34;
               width=&#34;760&#34;
               height=&#34;424&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5. äººå£ç»Ÿè®¡å­¦æ•°æ®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å…³äº é¥±å’Œä¿¡å·ã€‚åŸºæœ¬ä¸Šï¼Œä½¿ç”¨äº†ä¸¤ä¸ªä»ªè¡¨ç›˜â€”â€”ä¸€ä¸ªæŠ˜çº¿å›¾å’Œä¸€ä¸ªåŸå¸‚éšå–»æ¥è¯¢é—®äº”ä¸ªå¾®æœåŠ¡çš„çŠ¶æ€ï¼š&lt;code&gt;ms_authentication&lt;/code&gt;ã€&lt;code&gt;ms_patients&lt;/code&gt;ã€&lt;code&gt;ms_payments&lt;/code&gt;ã€&lt;code&gt;ms_medications&lt;/code&gt; å’Œ &lt;code&gt;ms_appointments&lt;/code&gt;ã€‚è¿™äº›å¾®æœåŠ¡æ˜¯ä¸€ä¸ªè™šæ„çš„åŒ»ç–—ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œé—®é¢˜æ˜¯ï¼šä½¿ç”¨ä¼ ç»Ÿçš„ä»ªè¡¨æ¿ï¼ˆè§å›¾ 6ï¼‰å’Œè§†è§‰éšå–»ï¼ˆè§å›¾ 7ï¼‰ï¼Œå“ªä¸ªå¾®æœåŠ¡å—åˆ°å½±å“ï¼Ÿæ­£ç¡®ç­”æ¡ˆæ˜¯ &lt;code&gt;ms_authentication&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6-ä¼ ç»Ÿçš„æŠ˜çº¿å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6. ä¼ ç»Ÿçš„æŠ˜çº¿å›¾&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f6_hu5590d6aeee985513de58bd4f08a66814_30036_1ee9e729212ec6cb4d9f654db74dd193.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f6_hu5590d6aeee985513de58bd4f08a66814_30036_13da0e1ea8b702da78230414f4c32386.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f6_hu5590d6aeee985513de58bd4f08a66814_30036_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f6_hu5590d6aeee985513de58bd4f08a66814_30036_1ee9e729212ec6cb4d9f654db74dd193.webp&#34;
               width=&#34;760&#34;
               height=&#34;470&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6. ä¼ ç»Ÿçš„æŠ˜çº¿å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7-å¯è§†åŒ–çš„åŸå¸‚æ¯”å–»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7. å¯è§†åŒ–çš„åŸå¸‚æ¯”å–»&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f7_hu06c9486b33bb5f5571cb6cfa8753345a_53008_849a632ac66913cbb50b1d54977118c9.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f7_hu06c9486b33bb5f5571cb6cfa8753345a_53008_f5caa61c40cac053a9e8748f658fc86b.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f7_hu06c9486b33bb5f5571cb6cfa8753345a_53008_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f7_hu06c9486b33bb5f5571cb6cfa8753345a_53008_849a632ac66913cbb50b1d54977118c9.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7. å¯è§†åŒ–çš„åŸå¸‚æ¯”å–»
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚å›¾ 8 æ‰€ç¤ºï¼Œå½“ä»–ä»¬ä½¿ç”¨è§†è§‰éšå–»æ—¶ï¼Œä¸€äº›å‚ä¸è€…çš„ç­”æ¡ˆæ”¹å˜äº†ï¼Œé€‰æ‹©äº†æ­£ç¡®çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-8-ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»çš„å‚ä¸è€…çš„å›ç­”&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 8. ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»çš„å‚ä¸è€…çš„å›ç­”&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f8_hu5bcc871e02eba00554a68ce49cf38a36_18330_ca0ae0f9fd58663980ac08bb34025b9a.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f8_hu5bcc871e02eba00554a68ce49cf38a36_18330_179f3b49e5d007a9cd7dd4c0e446ddbe.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f8_hu5bcc871e02eba00554a68ce49cf38a36_18330_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f8_hu5bcc871e02eba00554a68ce49cf38a36_18330_ca0ae0f9fd58663980ac08bb34025b9a.webp&#34;
               width=&#34;760&#34;
               height=&#34;320&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 8. ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»çš„å‚ä¸è€…çš„å›ç­”
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å‚ä¸è€…éƒ½è®¤ä¸ºï¼Œå— CPU é«˜åˆ©ç”¨ç‡å½±å“çš„å¾®æœåŠ¡æ˜¯è®¤è¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§†è§‰éšå–»æ¯”ä¼ ç»Ÿçš„å›¾è¡¨æ›´æœ‰ç”¨ï¼Œå› ä¸ºå›¾è¡¨çº¿å¾ˆæ··ä¹±ï¼Œè€Œä¸”é¢œè‰²ã€å½¢çŠ¶å’Œå¤§å°éƒ½ä¸å¥½ï¼Œæ”¹å˜äº†å‚ä¸è€…çš„çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºé”™è¯¯ä¿¡å·ï¼Œæˆ‘ä»¬ç”¨ç»å…¸çš„æŸ±çŠ¶å›¾å’Œæ ‘çŠ¶å›¾æ¥è¦æ±‚å‚ä¸è€…è®¡ç®—æ¯ä¸ªå¾®æœåŠ¡çš„å¹³å‡é”™è¯¯ï¼Œå¦‚å›¾ 9 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9-ç”¨äºå¯è§†åŒ–è¯¯å·®çš„ä¼ ç»ŸæŸ±çŠ¶å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9. ç”¨äºå¯è§†åŒ–è¯¯å·®çš„ä¼ ç»ŸæŸ±çŠ¶å›¾&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f9_hu559d840f31751b1167744030403ab852_30166_971d7e48c9f2a61b10d467821226c341.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f9_hu559d840f31751b1167744030403ab852_30166_b77ff086fff6e5f915ee9a79adec1483.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f9_hu559d840f31751b1167744030403ab852_30166_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f9_hu559d840f31751b1167744030403ab852_30166_971d7e48c9f2a61b10d467821226c341.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9. ç”¨äºå¯è§†åŒ–è¯¯å·®çš„ä¼ ç»ŸæŸ±çŠ¶å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10-ç”¨äºå¯è§†åŒ–é”™è¯¯çš„å¯è§†åŒ–æ ‘çŠ¶å›¾éšå–»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 10. ç”¨äºå¯è§†åŒ–é”™è¯¯çš„å¯è§†åŒ–æ ‘çŠ¶å›¾éšå–»&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f10_hua3195c7c96c70dd3c846b12d78cb14a9_18716_ddc62a921dc2aff3227ae56fdc16329d.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f10_hua3195c7c96c70dd3c846b12d78cb14a9_18716_fb541186e99cf3cc9b08ae4cfe7f652b.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f10_hua3195c7c96c70dd3c846b12d78cb14a9_18716_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f10_hua3195c7c96c70dd3c846b12d78cb14a9_18716_ddc62a921dc2aff3227ae56fdc16329d.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 10. ç”¨äºå¯è§†åŒ–é”™è¯¯çš„å¯è§†åŒ–æ ‘çŠ¶å›¾éšå–»
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­£ç¡®çš„ç­”æ¡ˆæ˜¯ &lt;code&gt;ms_appointments&lt;/code&gt;ï¼Œè™½ç„¶æœ‰äº›å‚ä¸è€…æ²¡æœ‰é€‰æ‹©å®ƒï¼Œä½†å½“ä»–ä»¬ä½¿ç”¨è§†è§‰éšå–»æ—¶ï¼Œè®¸å¤šäººæ”¹å˜äº†ä»–ä»¬çš„ç­”æ¡ˆã€‚å›¾ 11 è¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-11-å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–é”™è¯¯çš„ç­”æ¡ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 11. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–é”™è¯¯çš„ç­”æ¡ˆ&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f11_hufb52c87f4f746414a891e3a6678ca879_17740_1872b7f97e3073fc67fc96da84d3ebef.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f11_hufb52c87f4f746414a891e3a6678ca879_17740_9eeb70bde9ec5d18ae643d93f31f345f.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f11_hufb52c87f4f746414a891e3a6678ca879_17740_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f11_hufb52c87f4f746414a891e3a6678ca879_17740_1872b7f97e3073fc67fc96da84d3ebef.webp&#34;
               width=&#34;760&#34;
               height=&#34;320&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 11. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–é”™è¯¯çš„ç­”æ¡ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…³äºæµé‡ä¿¡å·ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç»å…¸çš„æŸ±çŠ¶å›¾å’Œä¸€ä¸ªåœ°ç†ä¸­å¿ƒçš„éšå–»æ¥è¯¢é—®å‚ä¸è€…å“ªä¸ªç¬¬ä¸‰æ–¹æœåŠ¡çš„æµé‡æ›´å¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸæœ‰çš„å¾®æœåŠ¡å’Œæ–°çš„å››ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡ï¼š&lt;code&gt;srv_ldap&lt;/code&gt;ã€&lt;code&gt;srv_goverment&lt;/code&gt;ã€&lt;code&gt;srv_assurance&lt;/code&gt; å’Œ &lt;code&gt;srv_authentication&lt;/code&gt; ä¹‹é—´çš„äº’åŠ¨è¢«åˆ†æäº†ã€‚å›¾ 12 ç”¨æŸ±çŠ¶å›¾æ˜¾ç¤ºäº†è¿™ç§æ•´åˆï¼Œå›¾ 13 ç”¨åœ°ç†ä¸­å¿ƒçš„éšå–»æ˜¾ç¤ºäº†ç›¸åŒçš„æµé‡å€¼ã€‚åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œåœ†åœˆä»£è¡¨æœåŠ¡å’Œå¾®æœåŠ¡ï¼Œçº¿æ¡è¿æ¥å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12-ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„ä¼ ç»ŸæŸ±çŠ¶å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 12. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„ä¼ ç»ŸæŸ±çŠ¶å›¾&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f12_hu1e2b96f432e1eb414b09ea0182bcbb6b_16406_6dd60bbb299279159e708431f5278dc5.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f12_hu1e2b96f432e1eb414b09ea0182bcbb6b_16406_5e76b95d1820fd6044312887fa31e2e6.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f12_hu1e2b96f432e1eb414b09ea0182bcbb6b_16406_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f12_hu1e2b96f432e1eb414b09ea0182bcbb6b_16406_6dd60bbb299279159e708431f5278dc5.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 12. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„ä¼ ç»ŸæŸ±çŠ¶å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-13-ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„å¯è§†åŒ–åœ°ç†ä¸­å¿ƒéšå–»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 13. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„å¯è§†åŒ–åœ°ç†ä¸­å¿ƒéšå–»&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f13_hua57f5e5c08bf33cf890b28d0bdfb0e25_21180_dd7b9d20afbc634fbd73d38f1b50ac84.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f13_hua57f5e5c08bf33cf890b28d0bdfb0e25_21180_fc95584fa2e09b78c209d0382eebdaa5.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f13_hua57f5e5c08bf33cf890b28d0bdfb0e25_21180_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f13_hua57f5e5c08bf33cf890b28d0bdfb0e25_21180_dd7b9d20afbc634fbd73d38f1b50ac84.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 13. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµé‡çš„å¯è§†åŒ–åœ°ç†ä¸­å¿ƒéšå–»
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å°½ç®¡æœ‰çº¿æ¡å’Œå¤§å°æ¥ä»£è¡¨å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„è¿æ¥å’Œæµé‡è´Ÿè½½ï¼Œä½†è¿™ä¸ªæ¯”å–»å¯¹å‚ä¸è€…æ¥è¯´æ˜¯æ··ä¹±çš„ã€‚åœ†åœˆçš„å¤§å°å¯èƒ½ä¸ &lt;code&gt;srv_ldap&lt;/code&gt; çš„æœ€å°ç™¾åˆ†æ¯”æœ‰å…³ï¼Œè€Œ &lt;code&gt;srv_ldap&lt;/code&gt; æ˜¯æ­£ç¡®çš„ç­”æ¡ˆï¼Œå®ƒåœ¨é¥¼ä¸­ç”±ç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºï¼ˆè§å›¾ 14ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-14-å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»å¯¹å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„æµé‡è¿›è¡Œå¯è§†åŒ–çš„ç­”æ¡ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 14. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»å¯¹å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„æµé‡è¿›è¡Œå¯è§†åŒ–çš„ç­”æ¡ˆã€‚&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f14_hu1b3794456f447f451be1b6c121834963_14664_775bfa66179990f0526e69b01cceb5a9.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f14_hu1b3794456f447f451be1b6c121834963_14664_5f79a6e8736454681951a1a343353fde.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f14_hu1b3794456f447f451be1b6c121834963_14664_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f14_hu1b3794456f447f451be1b6c121834963_14664_775bfa66179990f0526e69b01cceb5a9.webp&#34;
               width=&#34;760&#34;
               height=&#34;320&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 14. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»å¯¹å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„æµé‡è¿›è¡Œå¯è§†åŒ–çš„ç­”æ¡ˆã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬ç”¨æŸ±çŠ¶å›¾çš„è§†è§‰åŒ–å’Œä»ªè¡¨çš„æ¯”å–»æ¥åˆ†æ&lt;strong&gt;å»¶è¿Ÿä¿¡å·&lt;/strong&gt;ã€‚å›¾ 15 å’Œå›¾ 16 åˆ†åˆ«è¯´æ˜äº†è¿™ä¸¤ç§å¯è§†åŒ–æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-15-ç”¨äºå¯è§†åŒ–å»¶è¿Ÿä¿¡å·çš„ä¼ ç»ŸæŸ±çŠ¶å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 15. ç”¨äºå¯è§†åŒ–å»¶è¿Ÿä¿¡å·çš„ä¼ ç»ŸæŸ±çŠ¶å›¾ã€‚&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f15_hu6c80e74a88a6647574d6d6d203cf39b3_12496_a7a2aa61d99536a844016d68f20d893e.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f15_hu6c80e74a88a6647574d6d6d203cf39b3_12496_4e9ed215760e368102e54b9329ea069e.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f15_hu6c80e74a88a6647574d6d6d203cf39b3_12496_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f15_hu6c80e74a88a6647574d6d6d203cf39b3_12496_a7a2aa61d99536a844016d68f20d893e.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 15. ç”¨äºå¯è§†åŒ–å»¶è¿Ÿä¿¡å·çš„ä¼ ç»ŸæŸ±çŠ¶å›¾ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-16-ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡çš„å»¶è¿Ÿçš„å¯è§†åŒ–ä»ªè¡¨éšå–»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 16. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡çš„å»¶è¿Ÿçš„å¯è§†åŒ–ä»ªè¡¨éšå–»ã€‚&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f16_hu4d6fbb306e89aee71862c91585351943_13066_2ca0bbcf6f7b32d0e1594dd7c8ba72ac.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f16_hu4d6fbb306e89aee71862c91585351943_13066_b5edc29fe68b56aa6464afa5dbba7c14.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f16_hu4d6fbb306e89aee71862c91585351943_13066_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f16_hu4d6fbb306e89aee71862c91585351943_13066_2ca0bbcf6f7b32d0e1594dd7c8ba72ac.webp&#34;
               width=&#34;500&#34;
               height=&#34;375&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 16. ç”¨äºå¯è§†åŒ–å¾®æœåŠ¡çš„å»¶è¿Ÿçš„å¯è§†åŒ–ä»ªè¡¨éšå–»ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ç§æƒ…å†µï¼Œè¿™ä¸ªéšå–»è‚¯å®šæ²¡æœ‰ä¸ºå‚ä¸è€…æä¾›ä»·å€¼ï¼Œå› ä¸ºæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ &lt;code&gt;ms_patients&lt;/code&gt;ï¼Œè¿™åœ¨å›¾ 17 ä¸­æœ‰è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-17-å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿçš„ç­”æ¡ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 17. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿçš„ç­”æ¡ˆã€‚&#34; srcset=&#34;
               /translation/chaos-engineering-observability-visual-metaphors/f17_huf3269a68215f055f9e1d893057adf56a_15438_e9e4644b5b090d4ff1d18293e733753e.webp 400w,
               /translation/chaos-engineering-observability-visual-metaphors/f17_huf3269a68215f055f9e1d893057adf56a_15438_b34fee8578d57da90b06724ec34cabfd.webp 760w,
               /translation/chaos-engineering-observability-visual-metaphors/f17_huf3269a68215f055f9e1d893057adf56a_15438_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/chaos-engineering-observability-visual-metaphors/f17_huf3269a68215f055f9e1d893057adf56a_15438_e9e4644b5b090d4ff1d18293e733753e.webp&#34;
               width=&#34;760&#34;
               height=&#34;320&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 17. å‚ä¸è€…ä½¿ç”¨ä¼ ç»Ÿå›¾è¡¨ä¸è§†è§‰éšå–»æ¥å¯è§†åŒ–å¾®æœåŠ¡å’Œç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿçš„ç­”æ¡ˆã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¼•å…¥è§†è§‰éšå–»çš„ç»“è®º&#34;&gt;å¼•å…¥è§†è§‰éšå–»çš„ç»“è®º&lt;/h2&gt;
&lt;p&gt;æ··æ²Œçš„å¯è§†åŒ–ï¼Œç‰¹åˆ«æ˜¯ç”Ÿäº§äº‹æ•…çš„å¯è§†åŒ–ï¼Œç»™ä¸“æ³¨äºå¯è§‚æµ‹æ€§çš„å·¥ä¸šå’Œå­¦æœ¯ç•Œå¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ‰€å±•ç¤ºçš„ï¼Œç”±äºæ··æ²Œå·¥ç¨‹ã€å¯è§‚æµ‹æ€§å’Œå¯è§†åŒ–æ¶‰åŠåˆ°äººä¸æœºå™¨çš„äº’åŠ¨ï¼Œè§£é‡Šä¸­çš„åå·®æ˜¯ä¸€ä¸ªæŒç»­çš„é£é™©ã€‚é€šè¿‡ä¸€é¡¹ç ”ç©¶ï¼Œ28 ä½å·¥ç¨‹å¸ˆå›ç­”äº†ä¸ç»å…¸ä»ªè¡¨ç›˜å’Œè§†è§‰éšå–»æœ‰å…³çš„ 12 ä¸ªé—®é¢˜ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¯è§‚æµ‹æ€§ä¸ä»…å—åˆ°è¿™äº›ä¿¡å·çš„æ•°é‡å’Œè´¨é‡çš„é™åˆ¶ï¼Œè€Œä¸”å—åˆ°è¿™äº›ä¿¡å·çš„å¯è§†åŒ–å’Œè§£é‡Šæ–¹å¼çš„é™åˆ¶ã€‚ç»“è®ºæ˜¯ï¼Œè§†è§‰éšå–»å¯èƒ½æ¯”ä¼ ç»Ÿçš„ä»ªè¡¨ç›˜è¡¨ç°å¾—æ›´å¥½ï¼Œç„¶è€Œï¼Œç”±äºä¸¤è€…éƒ½æ¶‰åŠåˆ°äººï¼Œæ‰€ä»¥éƒ½ä¸èƒ½ä¿è¯æ“ä½œäººå‘˜ä»¥æ­£ç¡®çš„æ–¹å¼è§£é‡Šäº‹æ•…ä¸­çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ‰å…´è¶£äº†è§£æ›´å¤šå…³äºæ··æ²Œå·¥ç¨‹ä¸­çš„å¯è§‚æµ‹æ€§å—&#34;&gt;æœ‰å…´è¶£äº†è§£æ›´å¤šå…³äºæ··æ²Œå·¥ç¨‹ä¸­çš„å¯è§‚æµ‹æ€§å—ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æˆ‘æƒ³æ¨èè¿™ä¸‰æœ¬ä¹¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘çš„ç¬¬ä¸€ä¸ªæ¨èæ˜¯ Russ Miles çš„ã€Š&lt;a href=&#34;https://www.humio.com/chaos-observability/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··æ²Œå·¥ç¨‹å¯è§‚æµ‹æ€§&lt;/a&gt;ã€‹ä¸€ä¹¦ã€‚åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œä½œè€…æ¼”ç¤ºäº†å¦‚ä½•å°†ä½ çš„æ··æ²Œå®éªŒå¸¦å…¥ç³»ç»Ÿå¯è§‚æµ‹æ€§çš„ä¸–ç•Œã€‚æ··æ²Œå¯è§‚æµ‹æ€§èƒ½å¤Ÿä½¿æ•´ä¸ªç³»ç»Ÿçš„æ··æ²Œå®éªŒå®æ—¶åœ°æµ®ç°ã€è°ƒè¯•å’Œå¯è§†åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒæ˜¯ Charity Majorsã€Liz Fong-Jones å’Œ George
Miranda çš„ã€Š&lt;a href=&#34;https://learning.oreilly.com/library/view/observability-engineering/9781492076438/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯è§‚æµ‹æ€§å·¥ç¨‹&lt;/a&gt;ã€‹ä¸€ä¹¦ï¼Œä»–ä»¬åœ¨ä¸€å®¶åä¸º Honeycomb çš„å…¬å¸å·¥ä½œï¼Œæ­£æ˜¯ä¸“é—¨ä»äº‹å¯è§‚æµ‹æ€§çš„å·¥ä½œã€‚æˆ‘å–œæ¬¢è¿™æœ¬ä¹¦ï¼Œå› ä¸ºåœ¨ä¹¦ä¸­ï¼Œå¯è§‚æµ‹æ€§è¢«å½“ä½œä¸€ä¸ªå·¥ç¨‹é¢†åŸŸã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œå¯è§‚æµ‹æ€§å¯¹äºå·¥ç¨‹ã€ç®¡ç†å’Œæ”¹è¿›å¤æ‚çš„å…³é”®ä¸šåŠ¡ç³»ç»Ÿè‡³å…³é‡è¦ï¼Œæ‰€ä»¥å®ƒåº”è¯¥è¢«è§†ä¸ºä¸€é—¨å­¦ç§‘ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªç»„ç»‡å†…éƒ¨çš„è§’è‰²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘æƒ³æåˆ°ä¸€æœ¬ä¸“æ³¨äº &lt;a href=&#34;https://www.manning.com/books/chaos-engineering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ··æ²Œå·¥ç¨‹&lt;/a&gt; çš„å‚è€ƒä¹¦ã€‚æˆ‘è¯´çš„æ˜¯ Mikolaj
Pawlikowski çš„ä¸€æœ¬å®ç”¨ä¹¦ï¼Œç”±æ›¼å®å…¬å¸å‡ºç‰ˆã€‚è¯¥ä¹¦è®°å½•äº†æ¨¡æ‹Ÿç°å®ç”Ÿæ´»ä¸­çš„å¤±è´¥çš„å®éªŒå®¤å’Œå®é™…å®éªŒã€‚ä½œè€…é€šè¿‡å­¦ä¹ åƒæ··æ²Œå·¥ç¨‹å¸ˆé‚£æ ·æ€è€ƒï¼Œæœ€å¤§é™åº¦åœ°å‘æŒ¥äº†æ··æ²Œå·¥ç¨‹çš„ä¼˜åŠ¿ï¼Œæä¾›äº†æ¶µç›–æ•´ä¸ªè½¯ä»¶é¢†åŸŸçš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Envoy API Gatewayâ€”â€”æ¨åŠ¨ç½‘å…³çš„è¿›ä¸€æ­¥å‘å±•</title>
      <link>https://lib.jimmysong.io/translation/the-gateway-to-a-new-frontier/</link>
      <pubDate>Tue, 17 May 2022 11:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/the-gateway-to-a-new-frontier/</guid>
      <description>&lt;p&gt;ä»Šå¤©ï¼ŒEnvoy ç¤¾åŒº&lt;a href=&#34;https://www.cncf.io/blog/2022/05/16/introducing-envoy-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒäº†&lt;/a&gt;ä¸€ä¸ªä»¤äººå…´å¥‹çš„æ–°é¡¹ç›®ã€‚ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt;ã€‚è¯¥é¡¹ç›®å°†è¡Œä¸šé¢†å¯¼è€…è”åˆèµ·æ¥ï¼Œç²¾ç®€ç”± Envoy é©±åŠ¨çš„åº”ç”¨ç½‘å…³çš„å¥½å¤„ã€‚è¿™ç§æ–¹æ³•ä½¿ Envoy Gateway èƒ½å¤Ÿç«‹å³ä¸ºå¿«é€Ÿåˆ›æ–°æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚è¯¥é¡¹ç›®å°†æä¾›ä¸€å¥—æœåŠ¡æ¥ç®¡ç† Envoy ä»£ç†æœºç¾¤ï¼Œé€šè¿‡æ˜“ç”¨æ€§æ¥æ¨åŠ¨é‡‡ç”¨ï¼Œå¹¶é€šè¿‡å®šä¹‰æ˜ç¡®çš„æ‰©å±•æœºåˆ¶æ¥æ”¯æŒä¼—å¤šçš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åš&#34;&gt;æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Tetrate æ˜¯ Envoy Proxy çš„ç¬¬ä¸€è´¡çŒ®è€…ï¼ˆæŒ‰æäº¤é‡è®¡ç®—ï¼‰ï¼Œä¹Ÿæ˜¯ Envoy Gateway æŒ‡å¯¼å°ç»„çš„æˆå‘˜ï¼Œå…¶è´¡çŒ®è€…æ¶µç›–æŠ€æœ¯å’Œç®¡ç†é¢†åŸŸã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œæˆ‘ä»¬å¼ºå¤§çš„ä¼™ä¼´å…³ç³»å’Œåœ¨å¼€æºè½¯ä»¶æ–¹é¢çš„æ·±åšç»éªŒå°†æœ‰åŠ©äºç¡®ä¿ Envoy Gateway çš„æˆåŠŸã€‚Tetrate æ¨åŠ¨äº† EG è®¡åˆ’ï¼Œå› ä¸ºæˆ‘ä»¬è‡´åŠ›äºä¸Šæ¸¸é¡¹ç›®ï¼Œå› ä¸ºæˆ‘ä»¬ç›¸ä¿¡è¿™å°†é™ä½ Envoy Proxy ç”¨æˆ·çš„è¿›å…¥é—¨æ§›ï¼Œä¹Ÿå› ä¸ºè¿™ä¸æˆ‘ä»¬å¼€å‘æœåŠ¡ç½‘æ ¼ä½œä¸ºé›¶ä¿¡ä»»æ¶æ„åŸºç¡€çš„ä½¿å‘½ç›¸ä¸€è‡´ã€‚Tetrate å°†å¤§åŠ›æŠ•èµ„å»ºè®¾ Envoy Gateway çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æŒ OAuth2 å’Œ &lt;a href=&#34;https://letsencrypt.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Letâ€™s Encrypt&lt;/a&gt; é›†æˆç­‰ API åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¹ä¸Šæ¸¸é¡¹ç›®çš„æ‰¿è¯º&#34;&gt;å¯¹ä¸Šæ¸¸é¡¹ç›®çš„æ‰¿è¯º&lt;/h3&gt;
&lt;p&gt;Tetrate ä»ç¬¬ä¸€å¤©èµ·å°±ç«™åœ¨æœåŠ¡ç½‘æ ¼çš„æœ€å‰æ²¿ï¼Œå§‹ç»ˆç›¸ä¿¡ä¸Šæ¸¸é¡¹ç›®å’Œå®ƒä»¬çš„ç¤¾åŒºã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸º Istio å’Œ Envoy çš„ä¸Šæ¸¸é¡¹ç›®æä¾›å¸®åŠ©å’Œæ”¯æŒã€‚æˆ‘ä»¬çœ‹åˆ°ä¸åŒçš„äººåœ¨ä½¿ç”¨ Envoyï¼Œå¹¶åˆ›å»ºä»–ä»¬è‡ªå·±çš„æ§åˆ¶å¹³é¢å’Œ API ç½‘å…³å®ç°ï¼Œå¯¼è‡´ç¢ç‰‡åŒ–ï¼Œåˆ›æ–°é€Ÿåº¦æ…¢ï¼ŒåŠŸèƒ½å·®è·å¤§ï¼Œä»¥åŠç¼ºä¹å¯¹ä¸€ä¸ªä»£ç åº“çš„æ”¯æŒã€‚ç”±äºæˆ‘ä»¬ä¸ Matt Klein å’Œ Envoy ç¤¾åŒºé•¿æœŸä»¥æ¥å…³ç³»å¯†åˆ‡ï¼Œå½“æˆ‘ä»¬æè®®å°†å…¶çº³å…¥ Envoy çš„æ ‡å‡†åŒ–å®ç°ï¼Œå¹¶å°†å…¶æ•´åˆåˆ°ä¸€ä¸ªå®˜æ–¹çš„ä¸Šæ¸¸å®ç°ä¸­æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº† Matt å’Œå…¶ä»– CNCF é¡¹ç›®çš„å¼ºçƒˆæ”¯æŒã€‚æˆ‘ä»¬ä¸€ç›´åœ¨å¹•åä¸å…¶ä»–æŒ‡å¯¼å§”å‘˜ä¼šæˆå‘˜ï¼ˆ&lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ã€&lt;a href=&#34;https://www.fidelity.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity Investments&lt;/a&gt;ã€&lt;a href=&#34;https://projectcontour.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Project Contour&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt; è¾›å‹¤å·¥ä½œï¼Œä»¥å®šä¹‰ Envoy Gatewayã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œè‰°è‹¦çš„å·¥ä½œæ‰åˆšåˆšå¼€å§‹ï¼Œæˆ‘ä»¬è‡´åŠ›äºè¿™ä¸ªé¡¹ç›®ä»¥åŠ CNCF å†…å…¶ä»–å‡ ä¸ªé¡¹ç›®çš„é•¿æœŸæˆåŠŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®ç°æ§åˆ¶å¹³é¢çš„æ ‡å‡†åŒ–&#34;&gt;å®ç°æ§åˆ¶å¹³é¢çš„æ ‡å‡†åŒ–&lt;/h3&gt;
&lt;p&gt;åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ŒEnvoy å·²ç»æˆä¸ºç°ä»£äº‘åŸç”Ÿåº”ç”¨çš„é¦–é€‰ç½‘ç»œå±‚ã€‚éšç€ Envoy è·å¾—å…³æ³¨ï¼Œå¤§é‡çš„ä¸Šæ¸¸é¡¹ç›®å¼€å§‹åˆ©ç”¨å®ƒæ¥å®ç°æœåŠ¡ç½‘æ ¼ã€å…¥å£ã€å‡ºå£å’Œ API ç½‘å…³åŠŸèƒ½ã€‚è¿™äº›é¡¹ç›®ä¸­æœ‰è®¸å¤šèƒ½åŠ›é‡å ã€åŠŸèƒ½å·®è·ã€ä¸“æœ‰ç‰¹æ€§ï¼Œæˆ–è€…ç¼ºä¹ç¤¾åŒºå¤šæ ·æ€§ã€‚è¿™ç§æ”¯ç¦»ç ´ç¢çš„çŠ¶æ€æ˜¯ç”±äº Envoy ç¤¾åŒºæ²¡æœ‰æä¾›æ§åˆ¶å¹³é¢çš„å®ç°è€Œäº§ç”Ÿçš„å‰¯ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œåˆ›æ–°çš„é€Ÿåº¦é™ä½äº†ï¼Œä¼ä¸šè¢«è¦æ±‚è¾¨åˆ«åˆ©ç”¨ Envoy ä½œä¸ºå…¶åº”ç”¨ç½‘ç»œæ•°æ®å¹³é¢çš„æœ€ä½³æ–¹æ³•ã€‚ç°åœ¨ï¼Œç¤¾åŒºæ­£åœ¨æä¾› Envoy Gatewayï¼Œæ›´å¤šçš„ç”¨æˆ·å¯ä»¥äº«å— Envoy çš„å¥½å¤„ï¼Œè€Œæ— éœ€å†³å®šæ§åˆ¶å¹³é¢ã€‚Envoy Gateway çš„&lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/GOALS.md#goals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›®æ ‡&lt;/a&gt;æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;&amp;hellip;&amp;hellip; é€šè¿‡æ”¯æŒä¼—å¤šå…¥å£å’Œ L7/L4 æµé‡è·¯ç”±ä½¿ç”¨æ¡ˆä¾‹çš„è¡¨è¾¾å¼ã€å¯æ‰©å±•ã€é¢å‘è§’è‰²çš„ APIï¼Œé™ä½é‡‡ç”¨éšœç¢ï¼Œå¸å¼•æ›´å¤šç”¨æˆ·ä½¿ç”¨ Envoyï¼›å¹¶ä¸ºä¾›åº”å•†å»ºç«‹å¢å€¼äº§å“æä¾›å…±åŒåŸºç¡€ï¼Œè€Œæ— éœ€é‡æ–°è®¾è®¡åŸºæœ¬äº¤äº’ã€‚&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ˜“ç”¨æ€§å’Œè¿è¥æ•ˆç‡&#34;&gt;æ˜“ç”¨æ€§å’Œè¿è¥æ•ˆç‡&lt;/h3&gt;
&lt;p&gt;Envoy Proxy æ˜¯ç”± &lt;a href=&#34;https://github.com/cncf/xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS API&lt;/a&gt; é©±åŠ¨çš„ï¼Œè¿™äº› APIs æš´éœ²äº†å¤§é‡çš„åŠŸèƒ½ï¼Œå¹¶è¢«æ§åˆ¶å¹³é¢å¹¿æ³›é‡‡ç”¨ã€‚è™½ç„¶è¿™äº› API åŠŸèƒ½ä¸°å¯Œï¼Œä½†å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¦å¿«é€Ÿå­¦ä¹ å¹¶å¼€å§‹åˆ©ç”¨ Envoy çš„åŠŸèƒ½æ˜¯éå¸¸å›°éš¾çš„ã€‚Envoy Gateway å°†ä¸ºç”¨æˆ·æŠ½è±¡å‡ºè¿™äº›å¤æ‚çš„åŠŸèƒ½ï¼ŒåŒæ—¶æ”¯æŒç°æœ‰çš„è¿è¥å’Œåº”ç”¨ç®¡ç†æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;Envoy Gateway å°†åˆ©ç”¨ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt; æ¥å®ç°è¿™äº›ç›®æ ‡ï¼Œè€Œä¸æ˜¯å¼€å‘ä¸€ä¸ªæ–°çš„é¡¹ç›®ä¸“ç”¨ APIã€‚Gateway API æ˜¯ä¸€ä¸ªç”± &lt;a href=&#34;https://github.com/kubernetes/community/tree/master/sig-network&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç½‘ç»œç‰¹åˆ«å…´è¶£å°ç»„&lt;/a&gt;ç®¡ç†çš„é¡¹ç›®ï¼Œæ­£åœ¨è¿…é€Ÿæˆä¸ºæä¾›ç”¨æˆ·æ¥å£ä»¥ç®¡ç†åº”ç”¨ç½‘ç»œåŸºç¡€è®¾æ–½å’Œæµé‡è·¯ç”±çš„é¦–é€‰æ–¹æ³•ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®æœ‰ä¸€ä¸ªä¸°å¯Œã€å¤šæ ·çš„ç¤¾åŒºï¼Œæœ‰å‡ ä¸ªçŸ¥åçš„å®æ–½æ–¹æ¡ˆã€‚æˆ‘ä»¬æœŸå¾…ç€ä½œä¸ºç¤¾åŒºçš„ä¸€éƒ¨åˆ†å¼€å±•å·¥ä½œï¼Œä½¿ Envoy Gateway æˆä¸ºä¸šç•Œé¦–é€‰çš„ç½‘å…³ API å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¿™æ¯”ä¼ ç»Ÿçš„-api-ç½‘å…³æ›´å¥½&#34;&gt;ä¸ºä»€ä¹ˆè¿™æ¯”ä¼ ç»Ÿçš„ API ç½‘å…³æ›´å¥½ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¼ ç»Ÿçš„ä»£ç†ä¸æ˜¯è½»é‡çº§çš„ã€å¼€æ”¾çš„ï¼Œä¹Ÿä¸æ˜¯åŠ¨æ€å¯ç¼–ç¨‹çš„ã€ç±»ä¼¼ xDS çš„ APIï¼Œå› æ­¤ Envoy å¾ˆé€‚åˆæˆä¸ºå½“ä»ŠåŠ¨æ€åç«¯çš„ API ç½‘å…³ â€”â€” å°¤å…¶æ˜¯åœ¨å¢åŠ å®‰å…¨åŠŸèƒ½çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬è®¾æƒ³å°† Envoy ç½‘å…³ä½œä¸ºä¸æ–­å‘å±•çš„ API ç®¡ç†é¢†åŸŸçš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†ã€‚API ç½‘å…³æ˜¯ API ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›é€æ˜åœ°ç­–ç•¥æ‰§è¡Œå’Œç”Ÿæˆè¯¦ç»†é¥æµ‹æ•°æ®çš„åŠŸèƒ½ã€‚è¿™ç§é¥æµ‹æŠ€æœ¯æä¾›äº†å¼ºå¤§çš„å¯è§‚æµ‹æ€§ï¼Œä¸ºä¼ä¸šæä¾›äº†æ›´å¥½çš„æ´å¯ŸåŠ›ï¼Œä»¥æ’é™¤æ•…éšœã€ç»´æŠ¤å’Œä¼˜åŒ–å…¶ APIã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œç”±äº Envoy çš„è®¾è®¡ã€åŠŸèƒ½è®¾ç½®ã€å®‰è£…åŸºç¡€å’Œç¤¾åŒºï¼Œå®ƒæ˜¯ä¸šå†…æœ€å¥½çš„ API ç½‘å…³ã€‚æœ‰äº† Envoy Gatewayï¼Œä¼ä¸šå¯ä»¥åœ¨å°† Envoy åµŒå…¥å…¶ API ç®¡ç†ç­–ç•¥æ–¹é¢å¢åŠ ä¿¡å¿ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ— è¾¹ç•Œçš„é›¶ä¿¡ä»»&#34;&gt;æ— è¾¹ç•Œçš„é›¶ä¿¡ä»»&lt;/h3&gt;
&lt;p&gt;å½“ä½ çš„æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½åœ¨ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ä¸­è¿è¡Œæ—¶ï¼Œå®ç°&lt;a href=&#34;https://www.tetrate.io/zero-trust/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›¶ä¿¡ä»»æ¶æ„&lt;/a&gt;å°±ä¸é‚£ä¹ˆéš¾äº†ã€‚ç„¶è€Œï¼Œç°å®ä¸­ä¸éƒ½æ˜¯æœåŠ¡ç½‘æ ¼ã€‚æœåŠ¡åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œï¼Œåœ¨æ— ä»£ç†å®¹å™¨ä¸­è¿è¡Œï¼Œä½œä¸ºæ— æœåŠ¡å™¨å‡½æ•°è¿è¡Œï¼Œç­‰ç­‰ã€‚Envoy Gateway å°†çªç ´è¿™äº›è¿è¡Œæ—¶çš„ç•Œé™ï¼Œä¸ºè·¨å¼‚æ„ç¯å¢ƒçš„ç»Ÿä¸€ç­–ç•¥æ‰§è¡Œæä¾›åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€åŸºç¡€çš„å…³é”®æ˜¯ Envoy Gateway çš„å¯æ‰©å±•æ€§ï¼Œå®ƒæä¾›äº†æš´éœ² Envoy å’Œé Envoy å®‰å…¨åŠŸèƒ½çš„çµæ´»æ€§ã€‚è¿™äº›æ‰©å±•ç‚¹å°†è¢«ç”¨æ¥æä¾›å®ç°é›¶ä¿¡ä»»æ¶æ„æ‰€éœ€çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œåº”ç”¨è®¤è¯ã€æˆæƒã€åŠ å¯†å’Œé€Ÿç‡é™åˆ¶ã€‚Envoy Gateway å°†å¾ˆå¿«æˆä¸ºå¯»æ±‚å®ç°é›¶ä¿¡ä»»æ¶æ„çš„ç»„ç»‡çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·ï¼ŒTetrate è‡´åŠ›äºä¸Šæ¸¸é¡¹ç›®å’Œå®ƒä»¬çš„é•¿æœŸå¯è¡Œæ€§ã€‚è¿™ä¸€ä¸¾æªåˆä¸€æ¬¡è¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œå¹¶è¡¨æ˜ä¸Šæ¸¸çš„ Envoy å’Œ Istio ç°åœ¨æ­£æˆä¸ºæ„å»ºæœåŠ¡ç½‘æ ¼çš„äº‹å®ä¸Šçš„æ”¯æŸ±ã€‚Envoy Gateway å°†ä½¿æœåŠ¡ç½‘æ ¼æˆä¸ºä¸»æµï¼Œæ¶æ„å¸ˆä»¬åº”è¯¥æŠŠç½‘æ ¼çœ‹ä½œæ˜¯ ZTA çš„åŸºç¡€ã€‚ä¸ºäº†å¸®åŠ©æ¶æ„å¸ˆè¿›è¡Œè®ºè¯ï¼Œæˆ‘ä»¬æœ€è¿‘å‡ºç‰ˆäº†ã€Š&lt;a href=&#34;https://www.tetrate.io/service-mesh-handbook/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ‰‹å†Œ&lt;/a&gt;ã€‹ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå‘å¸ƒä¸€ç§å¸¦æœ‰ä¸Šæ¸¸ Envoy Gateway å’Œ Istio çš„æ¶æ„æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä½ çš„åº”ç”¨ç½‘ç»œçš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¢ç´¢-envoy-gateway&#34;&gt;æ¢ç´¢ Envoy Gateway&lt;/h3&gt;
&lt;p&gt;åœ¨ Tetrateï¼Œæˆ‘ä»¬æ­£åœ¨é¢†å¯¼åŸºäº Envoy Gateway å’Œ Istio çš„é›¶ä¿¡ä»»æ¶æ„çš„å®šä¹‰ï¼Œå¹¶å°†åœ¨åç»­åšæ–‡ä¸­é˜è¿°è®¾æƒ³çš„æ¶æ„ã€‚å¦‚æœä½ æƒ³å’Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºæ¶æ„ï¼Œå¹¶äº†è§£æ›´å¤šå…³äºå¦‚ä½•ä¸ºä¼ ç»Ÿå’Œäº‘åŸç”Ÿåº”ç”¨ç¨‹åºè¿›è¡Œæ¶æ„ï¼Œè¯·åŠ å…¥ &lt;a href=&#34;http://tetrate-community.slack.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetrate-community&lt;/a&gt; Slack é¢‘é“ã€‚&lt;/p&gt;
&lt;p&gt;è¦äº†è§£æ›´å¤šå…³äº Tetrate çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® &lt;a href=&#34;https://www.tetrate.io/envoy-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetrate.io&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¼€æºé¡¹ç›® Envoy Gateway ç®€ä»‹</title>
      <link>https://lib.jimmysong.io/translation/introducing-envoy-gateway/</link>
      <pubDate>Mon, 16 May 2022 13:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/introducing-envoy-gateway/</guid>
      <description>&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ &lt;a href=&#34;https://github.com/envoyproxy/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Gateway&lt;/a&gt; æˆä¸º Envoy ä»£ç†å®¶æ—çš„æ–°æˆå‘˜ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨å¤§å¹…é™ä½å°† Envoy ä½œä¸º API ç½‘å…³çš„ä½¿ç”¨é—¨æ§›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†å²&#34;&gt;å†å²&lt;/h2&gt;
&lt;p&gt;Envoy &lt;a href=&#34;https://medium.com/lyft-engineering/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ 2016 å¹´ç§‹å¤©å¼€æº&lt;/a&gt;ï¼Œä»¤æˆ‘ä»¬æƒŠè®¶çš„æ˜¯ï¼Œå®ƒå¾ˆå¿«å°±å¼•é¢†äº†æ•´ä¸ªè¡Œä¸šã€‚ç”¨æˆ·è¢«è¿™ä¸ªé¡¹ç›®çš„è®¸å¤šä¸åŒæ–¹é¢æ‰€å¸å¼•ï¼ŒåŒ…æ‹¬å®ƒçš„åŒ…å®¹æ€§ç¤¾åŒºã€å¯æ‰©å±•æ€§ã€API é©±åŠ¨çš„é…ç½®æ¨¡å‹ã€å¼ºå¤§çš„å¯è§‚æµ‹æ€§è¾“å‡ºå’Œè¶Šæ¥è¶Šå¹¿æ³›çš„åŠŸèƒ½é›†ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡åœ¨å…¶æ—©æœŸå†å²ä¸­ï¼ŒEnvoy æˆä¸ºäº†&lt;strong&gt;æœåŠ¡ç½‘æ ¼&lt;/strong&gt;çš„ä»£åè¯ï¼Œä½†å®ƒåœ¨ Lyft çš„é¦–æ¬¡ä½¿ç”¨å®é™…ä¸Šæ˜¯ä½œä¸º API ç½‘å…³ / è¾¹ç¼˜ä»£ç†ï¼Œæä¾›æ·±å…¥çš„å¯è§‚æµ‹æ€§è¾“å‡ºï¼Œå¸®åŠ© Lyft ä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ 5 å¹´å¤šæ—¶é—´é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° Envoy è¢«å¤§é‡çš„ç»ˆç«¯ç”¨æˆ·é‡‡ç”¨ï¼Œæ—¢å¯ä»¥ä½œä¸º API ç½‘å…³ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæœåŠ¡ç½‘æ ¼ä¸­çš„ sidecar ä»£ç†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å›´ç»• Envoy å‡ºç°äº†ä¸€ä¸ªåºå¤§çš„ä¾›åº”å•†ç”Ÿæ€ç³»ç»Ÿï¼Œåœ¨å¼€æºå’Œä¸“æœ‰é¢†åŸŸæä¾›äº†å¤§é‡çš„è§£å†³æ–¹æ¡ˆã€‚Envoy çš„ä¾›åº”å•†ç”Ÿæ€ç³»ç»Ÿå¯¹é¡¹ç›®çš„æˆåŠŸè‡³å…³é‡è¦ï¼›å¦‚æœæ²¡æœ‰å¯¹æ‰€æœ‰åœ¨ Envoy ä¸Šå…¼èŒæˆ–å…¨èŒå·¥ä½œçš„å‘˜å·¥çš„èµ„åŠ©ï¼Œè¿™ä¸ªé¡¹ç›®è‚¯å®šä¸ä¼šæœ‰ä»Šå¤©çš„æˆå°±ã€‚&lt;/p&gt;
&lt;p&gt;Envoy ä½œä¸ºè®¸å¤šä¸åŒçš„æ¶æ„ç±»å‹å’Œä¾›åº”å•†è§£å†³æ–¹æ¡ˆçš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶æˆåŠŸçš„å¦ä¸€é¢æ˜¯å®ƒæœ¬è´¨ä¸Šä½äºæ¶æ„åº•å±‚ï¼›Envoy å¹¶ä¸æ˜¯ä¸€ä¸ªå®¹æ˜“å­¦ä¹ çš„è½¯ä»¶ã€‚è™½ç„¶è¯¥é¡¹ç›®åœ¨ä¸–ç•Œå„åœ°çš„å¤§å‹å·¥ç¨‹ç»„ç»‡ä¸­å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œä½†åœ¨è¾ƒå°å’Œè¾ƒç®€å•çš„ç”¨ä¾‹ä¸­ï¼Œå®ƒåªè¢«è½»åº¦é‡‡ç”¨ï¼Œåœ¨è¿™äº›ç”¨ä¾‹ä¸­ï¼Œ&lt;a href=&#34;https://nginx.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nginx&lt;/a&gt; å’Œ &lt;a href=&#34;http://www.haproxy.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt; ä»å ä¸»å¯¼åœ°ä½ã€‚&lt;/p&gt;
&lt;p&gt;Envoy Gateway é¡¹ç›®çš„è¯ç”Ÿæ˜¯å‡ºäºè¿™æ ·çš„ä¿¡å¿µï¼šå°† Envoy ä½œä¸º API ç½‘å…³çš„è§’è‰²æ¨å‘å¤§ä¼—éœ€è¦ä¸¤ä¸ªä¸»è¦æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç®€åŒ–çš„éƒ¨ç½²æ¨¡å‹å’Œ API å±‚ï¼Œæ—¨åœ¨æ»¡è¶³è½»é‡çº§ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å°†ç°æœ‰çš„ &lt;a href=&#34;https://www.cncf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt; API ç½‘å…³é¡¹ç›®ï¼ˆ&lt;a href=&#34;https://projectcontour.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Contour&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/emissary-ingress/emissary&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Emissary&lt;/a&gt;ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªå…±åŒçš„æ ¸ï¼Œå¯ä»¥æä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä»ç„¶å…è®¸ä¾›åº”å•†åœ¨ Envoy Proxy å’Œ Envoy Gateway çš„åŸºç¡€ä¸Šå»ºç«‹å¢å€¼è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬åšä¿¡ï¼Œå¦‚æœç¤¾åŒºæ±‡èšåœ¨å•ä¸€çš„ä»¥ Envoy ä¸ºæ ¸å¿ƒçš„ API ç½‘å…³å‘¨å›´ï¼Œå®ƒå°†ä¼šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘å›´ç»•å®‰å…¨ã€æ§åˆ¶å¹³é¢æŠ€æœ¯ç»†èŠ‚å’Œå…¶ä»–å…±åŒå…³åˆ‡çš„é‡å¤å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;å…è®¸ä¾›åº”å•†ä¸“æ³¨äºåœ¨ Envoy Proxy å’Œ Envoy Gateway çš„åŸºç¡€ä¸Šä»¥æ‰©å±•ã€ç®¡ç†å¹³é¢ UI ç­‰å½¢å¼åˆ†å±‚æä¾›å¢å€¼åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¼—äººæ‹¾æŸ´ç«ç„°é«˜ï¼Œè®©å…¨ä¸–ç•Œæ›´å¤šçš„ç”¨æˆ·äº«å—åˆ° Envoy çš„å¥½å¤„ï¼Œæ— è®ºç»„ç»‡çš„å¤§å°ã€‚æ›´å¤šçš„ç”¨æˆ·ä¸ºæ›´å¤šçš„æ½œåœ¨å®¢æˆ·æä¾›äº†è‰¯æ€§å¾ªç¯ï¼Œä¸º Envoy çš„æ ¸å¿ƒé¡¹ç›®æä¾›äº†æ›´å¤šçš„æ”¯æŒï¼Œä¹Ÿä¸ºæ‰€æœ‰äººæä¾›äº†æ›´å¥½çš„æ•´ä½“ä½“éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¡¹ç›®æ¦‚è¦&#34;&gt;é¡¹ç›®æ¦‚è¦&lt;/h2&gt;
&lt;p&gt;æ€»å¾—æ¥è¯´ï¼ŒEnvoy Gateway å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Envoy Proxy æ ¸å¿ƒçš„ä¸€ä¸ªå°è£…å™¨ã€‚å®ƒä¸ä¼šä»¥ä»»ä½•æ–¹å¼æ”¹å˜æ ¸å¿ƒä»£ç†ã€&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/envoyproxy/go-control-plane&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go-control-plane&lt;/a&gt; ç­‰ï¼ˆé™¤äº†æ½œåœ¨çš„é©±åŠ¨åŠŸèƒ½ã€bug ä¿®å¤å’Œä¸€èˆ¬æ”¹è¿›ä»¥å¤–ï¼‰ã€‚å®ƒå°†æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºç½‘å…³ç”¨ä¾‹æä¾›ç®€åŒ–çš„ APIã€‚è¯¥ API å°†æ˜¯å¸¦æœ‰ä¸€äº› Envoy ç‰¹å®šæ‰©å±•çš„ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt;ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©è¿™ä¸ª APIï¼Œæ˜¯å› ä¸ºåœ¨ Kubernetes ä¸Šä½œä¸º Ingress Controller éƒ¨ç½²æ˜¯è¯¥é¡¹ç›®æœ€åˆçš„é‡ç‚¹ï¼Œè€Œä¸”è¯¥ API å¾—åˆ°äº†ä¸šç•Œçš„å¹¿æ³›è®¤å¯ã€‚&lt;/li&gt;
&lt;li&gt;å¼€ç®±å³ç”¨ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå°½å¯èƒ½å¿«åœ°å¯åŠ¨å’Œè¿è¡Œã€‚è¿™åŒ…æ‹¬æä¾›æ§åˆ¶å™¨èµ„æºã€æ§åˆ¶å¹³é¢èµ„æºã€ä»£ç†å®ä¾‹ç­‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯æ‰©å±•çš„ API å¹³é¢ã€‚è™½ç„¶è¯¥é¡¹ç›®å°†è‡´åŠ›äºä½¿å¸¸è§çš„ API ç½‘å…³åŠŸèƒ½å¼€ç®±å³ç”¨ï¼ˆä¾‹å¦‚ï¼Œé€Ÿç‡é™åˆ¶ã€è®¤è¯ã€&lt;a href=&#34;https://letsencrypt.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Letâ€™s Encrypt&lt;/a&gt; é›†æˆç­‰ï¼‰ï¼Œä½†ä¾›åº”å•†å°†èƒ½å¤Ÿæä¾›æ‰€æœ‰ API çš„ SaaS ç‰ˆæœ¬ï¼Œæä¾›é¢å¤–çš„ API å’Œå¢å€¼åŠŸèƒ½ï¼Œå¦‚ WAFã€å¢å¼ºçš„å¯è§‚æµ‹æ€§ã€æ··ä¹±å·¥ç¨‹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é«˜è´¨é‡çš„æ–‡æ¡£å’Œå…¥é—¨æŒ‡å—ã€‚æˆ‘ä»¬å¯¹ Envoy Gateway çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿æœ€å¸¸è§çš„ç½‘å…³ç”¨ä¾‹å¯¹æ™®é€šç”¨æˆ·æ¥è¯´å¯ä»¥ä¿¡æ‰‹æ‹ˆæ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äº APIï¼Œæˆ‘ä»¬è®¤ä¸ºå¯¼è‡´æ··ä¹±çš„ä¸»è¦æ˜¯åœ¨é’ˆå¯¹é«˜çº§ç”¨ä¾‹æ—¶ï¼Œåœ¨å…¶ä»–é¡¹ç›®ä¸­æœ‰æ•ˆåœ°é‡æ–°å®ç° Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS&lt;/a&gt; APIã€‚è¿™ç§æ¨¡å¼å¯¼è‡´ç”¨æˆ·ä¸å¾—ä¸å­¦ä¹ å¤šä¸ªå¤æ‚çš„ APIï¼ˆæœ€ç»ˆè½¬åŒ–ä¸º xDSï¼‰ï¼Œæ‰èƒ½å®Œæˆå·¥ä½œã€‚å› æ­¤ï¼ŒEnvoy Gateway è‡´åŠ›äº &amp;ldquo;ç¡¬æ€§è§„å®š&amp;rdquo;ï¼Œå³ Kubernetes Gateway APIï¼ˆä»¥åŠè¯¥ API ä¸­ä»»ä½•å…è®¸çš„æ‰©å±•ï¼‰æ˜¯&lt;strong&gt;å”¯ä¸€&lt;/strong&gt;è¢«æ”¯æŒçš„é¢å¤– APIã€‚æ›´é«˜çº§çš„ç”¨ä¾‹å°†ç”± &amp;ldquo;xDS æ¨¡å¼&amp;rdquo; æä¾›æœåŠ¡ï¼Œå…¶ä¸­ç°æœ‰çš„ API èµ„æºå°†ä¸ºæœ€ç»ˆç”¨æˆ·è‡ªåŠ¨ç¿»è¯‘ï¼Œç„¶åä»–ä»¬å¯ä»¥åˆ‡æ¢åˆ°ç›´æ¥åˆ©ç”¨ xDS APIã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªæ›´æ¸…æ™°çš„ä¸» APIï¼ŒåŒæ—¶ä¸ºé‚£äº›å¯èƒ½è¶…è¶Šä¸» API çš„è¡¨è¾¾èƒ½åŠ›å¹¶å¸Œæœ›é€šè¿‡ xDS åˆ©ç”¨ Envoy çš„å…¨éƒ¨åŠŸèƒ½çš„ç»„ç»‡æä¾›äº†è·¯å¾„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äº-api-çš„æ ‡å‡†åŒ–&#34;&gt;å…³äº API çš„æ ‡å‡†åŒ–&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Envoy Gateway çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œä»¥ä¾¿åœ¨ Kubernetes ä¸­ä½œä¸º Ingress Controller è½»æ¾è¿è¡Œ Envoyï¼Œä½†è¿™é¡¹å·¥ä½œæœ€ä¸»è¦çš„ç›®çš„æ˜¯ &lt;strong&gt;API æ ‡å‡†åŒ–&lt;/strong&gt;ã€‚éšç€è¡Œä¸šåœ¨ç‰¹å®šçš„ Envoy Kubernetes Gateway API æ‰©å±•ä¸Šçš„è¶‹åŒï¼Œå®ƒå°†å…è®¸ä¾›åº”å•†è½»æ¾åœ°æä¾›æ›¿ä»£çš„ SaaS å®ç°ï¼Œå¦‚æœç”¨æˆ·è¶…è¶Šäº†å‚è€ƒå®ç°ï¼Œæƒ³è¦é¢å¤–çš„æ”¯æŒå’ŒåŠŸèƒ½ç­‰ï¼Œè¿™å¯èƒ½æ˜¯æœ€å¥½çš„ã€‚æ˜¾ç„¶ï¼Œå›´ç»•å®šä¹‰ API æ‰©å±•ï¼Œç¡®å®šå“ªäº› API æ˜¯å¿…éœ€çš„ï¼Œå“ªäº›æ˜¯å¯é€‰çš„ï¼Œç­‰ç­‰ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚è¿™æ˜¯æˆ‘ä»¬æ ‡å‡†åŒ–ä¹‹æ—…çš„å¼€å§‹ï¼Œæˆ‘ä»¬æ¸´æœ›ä¸æ‰€æœ‰æ„Ÿå…´è¶£çš„äººä¸€èµ·æ·±å…¥ç ”ç©¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¥ä¸‹æ¥çš„è®¡åˆ’&#34;&gt;æ¥ä¸‹æ¥çš„è®¡åˆ’&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬æ„Ÿè°¢ Envoy Gateway çš„æœ€åˆèµåŠ©å•†ï¼ˆ&lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ã€&lt;a href=&#34;https://www.fidelity.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fidelity&lt;/a&gt;ã€&lt;a href=&#34;https://www.tetrate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt;ï¼‰ï¼Œå¾ˆé«˜å…´èƒ½ä¸å¤§å®¶ä¸€èµ·å¼€å§‹è¿™ä¸ªæ–°çš„æ—…ç¨‹ã€‚è¯¥é¡¹ç›®æ˜¯éå¸¸æ—©æœŸçš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢çš„é‡ç‚¹æ˜¯å•†å®š &lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/GOALS.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›®æ ‡&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/envoyproxy/gateway/blob/main/docs/design/SYSTEM_DESIGN.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é«˜æ°´å¹³çš„è®¾è®¡&lt;/a&gt;ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯å‚ä¸çš„å¥½æ—¶æœºï¼Œæ— è®ºæ˜¯ä½œä¸ºç»ˆç«¯ç”¨æˆ·è¿˜æ˜¯ä½œä¸ºç³»ç»Ÿé›†æˆå•†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜æƒ³éå¸¸æ¸…æ¥šåœ°è¯´æ˜ï¼ŒContour å’Œ Emissary çš„ç°æœ‰ç”¨æˆ·ä¸ä¼šè¢«æŠ›åœ¨åé¢ã€‚è¯¥é¡¹ç›®ï¼ˆä»¥åŠ &lt;a href=&#34;https://www.vmware.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMware&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.getambassador.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ambassador Labs&lt;/a&gt;ï¼‰å®Œå…¨è‡´åŠ›äºç¡®ä¿è¿™äº›é¡¹ç›®çš„ç”¨æˆ·æœ€ç»ˆèƒ½å¤Ÿé¡ºåˆ©åœ°è¿ç§»åˆ° Envoy Gatewayï¼Œæ— è®ºæ˜¯é€šè¿‡ç¿»è¯‘å’Œæ›¿æ¢ï¼Œè¿˜æ˜¯é€šè¿‡è¿™äº›é¡¹ç›®æˆä¸º Envoy Gateway æ ¸å¿ƒçš„åŒ…è£…ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹é€šè¿‡ Envoy Gateway é¡¹ç›®å°† Envoy å¸¦ç»™æ›´å¤§çš„ç”¨æˆ·ç¾¤æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ èƒ½&lt;a href=&#34;https://github.com/envoyproxy/gateway#contact&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥æˆ‘ä»¬&lt;/a&gt;çš„æ—…ç¨‹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ WebAssembly éªŒè¯è¯·æ±‚è´Ÿè½½</title>
      <link>https://lib.jimmysong.io/translation/validating-a-request-payload-with-wasm/</link>
      <pubDate>Fri, 13 May 2022 13:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/validating-a-request-payload-with-wasm/</guid>
      <description>&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯-wasm-æ’ä»¶&#34;&gt;ä»€ä¹ˆæ˜¯ Wasm æ’ä»¶ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ Wasm æ’ä»¶åœ¨æ•°æ®è·¯å¾„ä¸Šæ·»åŠ è‡ªå®šä¹‰ä»£ç ï¼Œè½»æ¾åœ°æ‰©å±•æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½ã€‚å¯ä»¥ç”¨ä½ é€‰æ‹©çš„è¯­è¨€ç¼–å†™æ’ä»¶ã€‚ç›®å‰ï¼Œæœ‰ AssemblyScriptï¼ˆTypeScript-ishï¼‰ã€C++ã€Rustã€Zig å’Œ Go è¯­è¨€çš„ Proxy-Wasm SDKã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•ä½¿ç”¨ Wasm æ’ä»¶æ¥éªŒè¯ä¸€ä¸ªè¯·æ±‚çš„æœ‰æ•ˆè½½è·ã€‚è¿™æ˜¯ Wasm ä¸ Istio çš„ä¸€ä¸ªé‡è¦ç”¨ä¾‹ï¼Œä¹Ÿæ˜¯ä½ å¯ä»¥ä½¿ç”¨ Wasm æ‰©å±• Istio çš„è®¸å¤šæ–¹æ³•çš„ä¸€ä¸ªä¾‹å­ã€‚æ‚¨å¯èƒ½æœ‰å…´è¶£é˜…è¯»æˆ‘ä»¬å…³äº&lt;a href=&#34;https://www.tetrate.io/blog/category/wasm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Istio ä¸­ä½¿ç”¨ Wasm çš„åšæ–‡&lt;/a&gt;ï¼Œå¹¶è§‚çœ‹æˆ‘ä»¬å…³äºåœ¨ Istio å’Œ Envoy ä¸­ä½¿ç”¨ Wasm çš„å…è´¹ç ”è®¨ä¼šçš„å½•éŸ³ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½•æ—¶ä½¿ç”¨-wasm-æ’ä»¶&#34;&gt;ä½•æ—¶ä½¿ç”¨ Wasm æ’ä»¶ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å½“ä½ éœ€è¦æ·»åŠ  Envoy æˆ– Istio ä¸æ”¯æŒçš„è‡ªå®šä¹‰åŠŸèƒ½æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ Wasm æ’ä»¶ã€‚ä½¿ç”¨ Wasm æ’ä»¶æ¥æ·»åŠ è‡ªå®šä¹‰éªŒè¯ã€è®¤è¯ã€æ—¥å¿—æˆ–ç®¡ç†é…é¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºå’Œè¿è¡Œä¸€ä¸ª Wasm æ’ä»¶ï¼ŒéªŒè¯è¯·æ±‚ body æ˜¯ JSONï¼Œå¹¶åŒ…å«ä¸¤ä¸ªå¿…è¦çš„é”® â€”â€”&lt;code&gt;id&lt;/code&gt; å’Œ &lt;code&gt;token&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼–å†™-wasm-æ’ä»¶&#34;&gt;ç¼–å†™ Wasm æ’ä»¶&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨ &lt;a href=&#34;https://tinygo.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tinygo&lt;/a&gt; æ¥ç¼–è¯‘æˆ Wasmã€‚ç¡®ä¿ä½ å·²ç»å®‰è£…äº† &lt;a href=&#34;https://tinygo.org/getting-started/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tinygo ç¼–è¯‘å™¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é…ç½®-wasm-ä¸Šä¸‹æ–‡&#34;&gt;é…ç½® Wasm ä¸Šä¸‹æ–‡&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆé…ç½® Wasm ä¸Šä¸‹æ–‡ï¼Œè¿™æ · tinygo æ–‡ä»¶æ‰èƒ½æ“ä½œ HTTP è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm/types&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/tidwall/gjson&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// SetVMContext æ˜¯é…ç½®æ•´ä¸ª Wasm VM çš„å…¥å£ã€‚è¯·ç¡®ä¿è¯¥å…¥å£åœ¨ main å‡½æ•°ä¸­è°ƒç”¨ï¼Œå¦åˆ™ VM å°†å¯åŠ¨å¤±è´¥ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SetVMContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// vmContext å®ç° proxy-wasm-go SDK çš„ types.VMContext æ¥å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„è™šæ‹Ÿæœºç¯å¢ƒï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultVMContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultVMContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vmContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewPluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;contextID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginContext å®ç° proxy-wasm-go SDK çš„ types.PluginContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡Œä¾µå…¥é»˜è®¤çš„æ’ä»¶ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultPluginContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultPluginContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewHttpContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;contextID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HttpContext&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// payloadValidationContext å®ç° proxy-wasm-go SDK çš„ types.HttpContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„æ ¹ http ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°æ‰€æœ‰æ–¹æ³•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultHttpContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;éªŒè¯è´Ÿè½½&#34;&gt;éªŒè¯è´Ÿè½½&lt;/h4&gt;
&lt;p&gt;å†…å®¹ç±»å‹å¤´æ˜¯é€šè¿‡å®ç° &lt;code&gt;OnHttpRequestHeaders&lt;/code&gt; æ¥éªŒè¯çš„ï¼Œä¸€æ—¦ä»å®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚å¤´ï¼Œå°±ä¼šè°ƒç”¨è¯¥å¤´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;proxywasm.SendHttpResponse&lt;/code&gt; ç”¨äºå“åº” 403 forbidden çš„é”™è¯¯ä»£ç å’Œä¿¡æ¯ï¼Œå¦‚æœå†…å®¹ç±»å‹ä¸¢å¤±çš„è¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numHeaders&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;contentType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetHttpRequestHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;content-type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;contentType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœ header æ²¡æœ‰æœŸæœ›çš„ content typeï¼Œè¿”å› 403 å“åº”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;content-type must be provided&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send the 403 response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ç»ˆæ­¢ ActionPause å¯¹æµé‡çš„è¿›ä¸€æ­¥å¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ActionContinue è®©ä¸»æœºç»§ç»­å¤„ç† body
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ±‚ä¸»ä½“æ˜¯é€šè¿‡å®ç° &lt;code&gt;OnHttpRequestBody&lt;/code&gt; æ¥éªŒè¯çš„ï¼Œæ¯æ¬¡ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯·æ±‚çš„ä¸€ä¸ªå—æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥è¯·æ±‚ã€‚è¿™æ˜¯é€šè¿‡ç­‰å¾…ç›´åˆ° &lt;code&gt;endOfStream&lt;/code&gt; ä¸ºçœŸå¹¶è®°å½•æ‰€æœ‰æ”¶åˆ°çš„å—çš„æ€»å¤§å°æ¥å®Œæˆçš„ã€‚ä¸€æ—¦æ”¶åˆ°æ•´ä¸ªä¸»ä½“ï¼Œå°±ä¼šä½¿ç”¨ &lt;code&gt;proxywasm.GetHttpRequestBody&lt;/code&gt; è¯»å–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ golang è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­ä½¿ç”¨ &lt;code&gt;gjson&lt;/code&gt;ï¼Œå› ä¸º tinygo ä¸æ”¯æŒ golang çš„é»˜è®¤ JSON åº“ã€‚å®ƒæ£€æŸ¥æœ‰æ•ˆè½½è·æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ JSONï¼Œä»¥åŠé”® &lt;code&gt;id&lt;/code&gt; å’Œ &lt;code&gt;token&lt;/code&gt; æ˜¯å¦å­˜åœ¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bodySize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bodySize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// OnHttpRequestBody ç­‰å¾…æ”¶åˆ°åˆ° body çš„å…¨éƒ¨æ‰å¼€å§‹å¤„ç†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetHttpRequestBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;totalRequestBodySize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to get request body: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœéªŒè¯å¤±è´¥ï¼Œå‘é€ 403 å“åº”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invalid payload&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send the 403 response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ç»ˆæ­¢æµé‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// validatePayload éªŒè¯ç»™å®šçš„ json è´Ÿè½½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¯¥å‡½æ•°ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;body is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// éªŒè¯ jsonã€‚æ£€æŸ¥ç¤ºä¾‹ä¸­æ˜¯å¦å­˜åœ¨å¿…é¡»çš„é”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;required key (%v) is missing: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ç¼–è¯‘æˆ-wasm&#34;&gt;ç¼–è¯‘æˆ Wasm&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ tinygo ç¼–è¯‘å™¨ç¼–è¯‘æˆ Wasmï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tinygo build -o main.wasm -scheduler&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;none -target&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;wasi main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²-wasm-æ’ä»¶&#34;&gt;éƒ¨ç½² Wasm æ’ä»¶&lt;/h3&gt;
&lt;h4 id=&#34;æ‰“åŒ…åˆ°-docker-ä¸­éƒ¨ç½²åˆ°-envoy&#34;&gt;æ‰“åŒ…åˆ° Docker ä¸­éƒ¨ç½²åˆ° Envoy&lt;/h4&gt;
&lt;p&gt;å¯¹äºå¼€å‘ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥åœ¨ Docker ä¸­éƒ¨ç½²åˆ° Envoyã€‚ä¸‹é¢çš„ Envoy é…ç½®æ–‡ä»¶å°†è®¾ç½® Envoy ç›‘å¬ &lt;code&gt;localhost:18000&lt;/code&gt;ï¼Œè¿è¡Œæ‰€æä¾›çš„ Wasm æ’ä»¶ï¼Œå¹¶åœ¨æˆåŠŸåå“åº” HTTP 200 å’Œæ–‡æœ¬ &lt;code&gt;hello from server&lt;/code&gt;ã€‚çªå‡ºæ˜¾ç¤ºçš„éƒ¨åˆ†æ˜¯é…ç½® Wasm æ’ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;static_resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;18000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./main.wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;staticreply&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127.0.0.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8099&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter_chains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.http_connection_manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;stat_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress_http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;codec_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;auto&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;virtual_hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;local_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;domains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;direct_response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inline_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello from the server\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.router&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connect_timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;25s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;STATIC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lb_policy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ROUND_ROBIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;load_assignment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mock_service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;lb_endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;127.0.0.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8099&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;access_log_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;socket_address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8001&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œ Docker å®¹å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker run --rm -p 18000:18000 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;/envoy.yaml:/envoy.yaml &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -v &lt;span class=&#34;nv&#34;&gt;$PWD&lt;/span&gt;/main.wasm:/main.wasm &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --entrypoint envoy containers.istio.tetratelabs.com/proxyv2:1.9.7-tetrate-v0 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -l debug &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  -c /envoy.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ curl æµ‹è¯•ã€‚é¦–å…ˆï¼Œæ²¡æœ‰è®¾ç½®å†…å®¹ç±»å‹ï¼Œå°†è¿”å› 403ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:13:37 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type must be provided
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œè¯·æ±‚ body ä¸æ˜¯ JSONï¼ŒåŒæ ·è¿”å› 403ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;not JSON&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:15:53 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invalid payload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;JSON è´Ÿè½½ä¸­æ²¡æœ‰ &lt;code&gt;token&lt;/code&gt; å­—æ®µï¼Œè¿˜æ˜¯è¿”å› 403ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:17:18 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invalid payload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ id å’Œ token å­—æ®µéƒ½è¢«æä¾›æ—¶ï¼Œå°†è¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -i -X POST localhost:18000 -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;token&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;anotherField&amp;#34;: &amp;#34;yyy&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Sun, &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:18:37 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hello from the server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²åˆ°-istio&#34;&gt;éƒ¨ç½²åˆ° Istio&lt;/h3&gt;
&lt;h4 id=&#34;éƒ¨ç½²-istio-å’Œ-httpbin-ç¤ºä¾‹åº”ç”¨&#34;&gt;éƒ¨ç½² Istio å’Œ httpbin ç¤ºä¾‹åº”ç”¨&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://kind.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kind&lt;/a&gt; æ¥åˆ›å»ºæµ‹è¯•é›†ç¾¤ï¼Œå¯¹äºå…¶ä»–æ–¹å¼åˆ›å»ºçš„ Kubernetes é›†ç¾¤åŒæ ·é€‚ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind create cluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é›†ç¾¤åˆ›å»ºå®Œæ¯•åï¼Œå®‰è£… Istioï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Istio 1.12.3ï¼Œå®‰è£… &lt;a href=&#34;https://github.com/istio/istio/tree/master/samples/httpbin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio httpbin ç¤ºä¾‹åº”ç”¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.12/samples/httpbin/httpbin.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.12/samples/httpbin/httpbin-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œå°† Ingress ç½‘å…³çš„ 80 ç«¯å£è½¬å‘åˆ°ä½ æœ¬åœ°æœºå™¨çš„ 8080 ç«¯å£ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl port-forward -n istio-system svc/istio-ingressgateway 8080:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘é€ curl è¯·æ±‚ï¼Œæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼Œä½ åº”è¯¥åº”è¯¥çœ‹åˆ°æˆåŠŸçš„å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST -i http://localhost:8080/post
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼åœ¨ Istio ä¸­å®‰è£… Wasm æ¨¡å—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äº Istio 1.12 å’Œæ›´æ–°ç‰ˆæœ¬çš„ Istioï¼Œæ”¯æŒ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; èµ„æº&lt;/li&gt;
&lt;li&gt;å¯¹äºè€ç‰ˆæœ¬çš„ Istioï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/networking/envoy-filter/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EnvoyFilter&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;ä½¿ç”¨-wasmplugin-å®‰è£…&#34;&gt;ä½¿ç”¨ WasmPlugin å®‰è£…&lt;/h4&gt;
&lt;p&gt;WasmPlugin èµ„æºä»é•œåƒä»“åº“ä¸­æå– wasm æ¨¡å—ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä¸ºæˆ‘ä»¬çš„ wasm æ¨¡å—æ„å»ºå¹¶æ¨é€ä¸€ä¸ª Docker é•œåƒã€‚ä¸‹é¢çš„ Docker æ–‡ä»¶å…è®¸ä»ä½ çš„ wasm æ¨¡å—å»ºç«‹ä¸€ä¸ª Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Docker&#34; data-lang=&#34;Docker&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; scratch&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; main.wasm ./&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºé•œåƒï¼Œæ¨é€åˆ°é•œåƒä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;HUB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;your_registry &lt;span class=&#34;c1&#34;&gt;# e.g. docker.io/tetrate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build . -t &lt;span class=&#34;nv&#34;&gt;$HUB&lt;/span&gt;/json-validation:v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push &lt;span class=&#34;nv&#34;&gt;$HUB&lt;/span&gt;/json-validation:v1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬åˆ›å»º &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt; èµ„æºã€‚è¿™å°†é€‚ç”¨äºæ‰€æœ‰é€šè¿‡ Istio Ingress ç½‘å…³æš´éœ²çš„è·¯ç”±ï¼Œå¹¶å¯¹å…¶åº”ç”¨æˆ‘ä»¬çš„éªŒè¯ã€‚ç¡®ä¿ä½ æŠŠ &lt;code&gt;{your_registry}&lt;/code&gt; æ›¿æ¢ä¸ºä½ ä¸Šä¼  wasm é•œåƒçš„é•œåƒä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://{your_registry}/json-validation:v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;phase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTHN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ä½¿ç”¨-envoyfilter-å®‰è£…&#34;&gt;ä½¿ç”¨ EnvoyFilter å®‰è£…&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†ä½¿ç”¨ EnvoyFilterï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«å·²ç¼–è¯‘çš„ Wasm æ’ä»¶çš„ ConfigMapï¼Œå°† ConfigMap æŒ‚è½½åˆ°ç½‘å…³ pod ä¸­ï¼Œç„¶åé€šè¿‡ EnvoyFilter é…ç½® Envoyï¼Œä»æœ¬åœ°æ–‡ä»¶åŠ è½½ Wasm æ’ä»¶ã€‚è¿™ç§æ–¹æ³•çš„é™åˆ¶æ˜¯ï¼Œæ›´å¤§å’Œæ›´å¤æ‚çš„ Wasm æ¨¡å—å¯èƒ½è¶…å‡º ConfigMap 1MB çš„å¤§å°é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ç¼–è¯‘å¥½çš„ Wasm æ¨¡å—çš„ ConfigMapï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system create configmap wasm-plugins --from-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;main.wasm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ Istio Ingress ç½‘å…³éƒ¨ç½²ä¸­æ‰“è¡¥ä¸ï¼ŒæŒ‚è½½è¿™ä¸ª ConfigMapã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n istio-system patch deployment istio-ingressgateway --patch&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;  template:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;      containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        - name: istio-proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;          volumeMounts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            - name: wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              mountPath: /var/local/lib/wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              readOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;      volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        - name: wasm-plugins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;          configMap:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;            name: wasm-plugins&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ Wasm æ¨¡å—å°±æŒ‚è½½åˆ°äº†ç½‘å…³ Pod ä¸­ï¼Œåº”ç”¨è¿™ä¸ª EnvoyFilterã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GATEWAY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/local/lib/wasm-plugins/main.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æµ‹è¯•-wasm-æ’ä»¶&#34;&gt;æµ‹è¯• Wasm æ’ä»¶&lt;/h4&gt;
&lt;p&gt;é‡å¤ä¹‹å‰çš„ curl è¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% curl -X POST -i http://localhost:8080/post
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; Mar &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; 22:04:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: istio-envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type must be provided
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæä¾›äº†å†…å®¹ç±»å‹å’Œ json è´Ÿè½½çš„è¯ï¼Œè¯·æ±‚å°†ä¼šæˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -i http://localhost:8080/post  -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; --data &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;id&amp;#34;: &amp;#34;xxx&amp;#34;, &amp;#34;token&amp;#34;: &amp;#34;xxx&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è®©å¿…å¡«å­—æ®µå¯é…ç½®&#34;&gt;è®©å¿…å¡«å­—æ®µå¯é…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸å…¶åœ¨ç¼–è¯‘çš„ golang ä»£ç ä¸­ç¡¬ç¼–ç æ‰€éœ€çš„ JSON å­—æ®µï¼Œä¸å¦‚å…è®¸é€šè¿‡ Envoy é…ç½®æ¥é…ç½®è¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;å½“åœ¨ Docker ä¸­è¿è¡Œ Envoy æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘ä¹‹å‰åˆ›å»ºçš„ Wasm &lt;code&gt;http_filter&lt;/code&gt; æ·»åŠ é…ç½®æ¥å®ç°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http_filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.filters.http.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/udpa.type.v1.TypedStruct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                                            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                            &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;requiredKeys&amp;#34;: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.wasm.runtime.v8&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./main.wasm&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ä½¿ç”¨ WasmPluginï¼Œåœ¨ &lt;code&gt;pluginConfig&lt;/code&gt; å­—æ®µä¸­é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://{your_registry}/json-validation:v3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;phase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AUTHN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pluginConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requiredKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œå½“ä½¿ç”¨ EnvoyFilter æ—¶ï¼Œå°†å®ƒæ·»åŠ åˆ° filter é…ç½®ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;type.googleapis.com/google.protobuf.StringValue&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                                &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                &lt;/span&gt;{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;requiredKeys&amp;#34;: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/local/lib/wasm-plugins/main.wasm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.wasm.runtime.v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;vm_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-validation&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä»£ç ä¸­ï¼Œå®ç° &lt;code&gt;OnPluginStart&lt;/code&gt;ï¼Œä½¿ç”¨ &lt;code&gt;proxywasm.GetPluginConfiguration&lt;/code&gt; åŠ è½½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginContext å®ç° proxy-wasm-go SDK ä¸­çš„ types.PluginContext æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åœ¨è¿™é‡ŒåµŒå…¥é»˜è®¤çš„ plugin ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·å°±ä¸ç”¨å®ç°æ‰€æœ‰æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultPluginContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// pluginConfiguration ä»£è¡¨è¿™ä¸ª wasm æ’ä»¶ä¸­çš„ç¤ºä¾‹é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ç¤ºä¾‹é…ç½®å­—æ®µï¼Œæ’ä»¶å°†éªŒè¯ json è´Ÿè½½ä¸­æ˜¯å¦å­˜åœ¨è¿™äº›å­—æ®µã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¤å†™ types.DefaultPluginContext
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnPluginStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfigurationSize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetPluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error reading plugin configuration: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusFailed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;parsePluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error parsing plugin configuration: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusFailed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OnPluginStartStatusOK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// parsePluginConfiguration è§£æ json æ’ä»¶é…ç½®å¹¶è¿”å› pluginConfiguration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ https://github.com/mailru/easyjsonï¼Œæ”¯æŒè§£æä¸ºç»“æ„ä½“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;parsePluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;the plugin configuration is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;requiredKeys&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å®ƒä»¬è¢«åŒ…å«åœ¨ &lt;code&gt;pluginConfiguration&lt;/code&gt; ç»“æ„ä¸­ï¼Œå®ƒä»¬å¯ä»¥åƒå…¶ä»–å­—æ®µä¸€æ ·åœ¨éªŒè¯è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// validatePayload éªŒè¯ç»™å®šçš„ json è´Ÿè½½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¯¥å‡½æ•°ä½¿ç”¨ gjson è§£æ jsonï¼Œå› ä¸º TinyGo ä¸æ”¯æŒ encoding/json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;payloadValidationContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;validatePayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ValidBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;body is not a valid json: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gjson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParseBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// éªŒè¯ jsonã€‚æ£€æŸ¥ç¤ºä¾‹ä¸­æ˜¯å¦åŒ…å«å¿…é¡»çš„é”®ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å¿…é¡»çš„é”®é€šè¿‡æ’ä»¶é…ç½®ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;required key (%v) is missing: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requiredKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;jsonData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå¯ä»¥ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„å‘½ä»¤å¯¹å…¶è¿›è¡Œç¼–è¯‘å’Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œè¦åœ¨ Istio 1.12 å’Œæ›´æ–°çš„ç‰ˆæœ¬ä¸Šä½¿ç”¨ Wasm æ’ä»¶ï¼Œéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä½ é€‰æ‹©çš„è¯­è¨€ä¸­å®ç°æ’ä»¶çš„åŠŸèƒ½ã€‚æˆ‘åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ Golangã€‚&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘ Wasm æ’ä»¶å¹¶æ¨é€åˆ°é•œåƒä»“åº“ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½® Istio ä»¥åŠ è½½å’Œä½¿ç”¨é•œåƒä»“åº“ä¸­çš„æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯¥æ•™ç¨‹è¿˜è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Docker åœ¨ Envoy å®¹å™¨ä¸­è¿è¡Œ Wasm æ’ä»¶ï¼Œä»¥åŠ å¿«å¼€å‘é€Ÿåº¦ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°æ—§çš„ Istio ç‰ˆæœ¬ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Slack å°†æ•°ç™¾ä¸‡ä¸ªå¹¶å‘çš„ Websockets è¿ç§»åˆ° Envoy ä¸Šç»éªŒåˆ†äº«</title>
      <link>https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/</link>
      <pubDate>Fri, 08 Apr 2022 13:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/</guid>
      <description>&lt;p&gt;Slack æœ‰ä¸€ä¸ªå…¨çƒå®¢æˆ·ç¾¤ï¼Œåœ¨é«˜å³°æœŸæœ‰æ•°ç™¾ä¸‡åŒæ—¶è¿æ¥çš„ç”¨æˆ·ã€‚ç”¨æˆ·ä¹‹é—´çš„å¤§éƒ¨åˆ†é€šä¿¡æ¶‰åŠåˆ°å‘å¯¹æ–¹å‘é€å¤§é‡çš„å¾®å°ä¿¡æ¯ã€‚åœ¨ Slack çš„å¤§éƒ¨åˆ†å†å²ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨ &lt;a href=&#34;https://www.haproxy.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt; ä½œä¸ºæ‰€æœ‰ä¼ å…¥æµé‡çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºæˆ‘ä»¬åœ¨ä½¿ç”¨ HAProxy æ—¶æ‰€é¢ä¸´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt; æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œè¿ç§»æ‰€æ¶‰åŠçš„æ­¥éª¤ï¼Œä»¥åŠç»“æœæ˜¯ä»€ä¹ˆã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;slack-çš„-websockets&#34;&gt;&lt;strong&gt;Slack çš„ Websockets&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å³æ—¶ä¼ é€’ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://tools.ietf.org/html/rfc6455&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;websocket è¿æ¥&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ç§åŒå‘çš„é€šä¿¡é“¾æ¥ï¼Œè´Ÿè´£è®©ä½ çœ‹åˆ° &amp;ldquo;æœ‰å‡ ä¸ªäººåœ¨æ‰“å­—&amp;hellip;&amp;hellip;&amp;quot;ï¼Œç„¶åæ˜¯ä»–ä»¬æ‰“çš„ä¸œè¥¿ï¼Œé€Ÿåº¦å‡ ä¹æ˜¯å…‰é€Ÿçš„ã€‚websocket è¿æ¥è¢«æ‘„å–åˆ°ä¸€ä¸ªå«åš &amp;ldquo;wss&amp;rdquo;ï¼ˆWebSocket æœåŠ¡ï¼‰çš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;wss-primary.slack.com&lt;/code&gt; å’Œ &lt;code&gt;wss-backup.slack.com&lt;/code&gt;ï¼ˆè¿™ä¸æ˜¯ç½‘ç«™ï¼Œå¦‚æœå»è®¿é—®ï¼Œåªä¼šå¾—åˆ°ä¸€ä¸ª HTTP 404ï¼‰ä»äº’è”ç½‘ä¸Šè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ˜¾ç¤ºwebsocketså·¥ä½œåŸç†çš„å›¾è¡¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ˜¾ç¤ºwebsocketså·¥ä½œåŸç†çš„å›¾è¡¨&#34; srcset=&#34;
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu7458e3ce3021aedb0c1d1cc83687f4c6_15076_2a20b78aa8df46485340ee7bf498c68b.webp 400w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu7458e3ce3021aedb0c1d1cc83687f4c6_15076_781b2428de2b829327547b72bb64879e.webp 760w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu7458e3ce3021aedb0c1d1cc83687f4c6_15076_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277posyqj20cg0b8dfz_hu7458e3ce3021aedb0c1d1cc83687f4c6_15076_2a20b78aa8df46485340ee7bf498c68b.webp&#34;
               width=&#34;448&#34;
               height=&#34;404&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ˜¾ç¤ºwebsocketså·¥ä½œåŸç†çš„å›¾è¡¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Websocket è¿æ¥ä¸€å¼€å§‹æ˜¯æ™®é€šçš„ HTTPS è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å‘å‡ºåè®®åˆ‡æ¢è¯·æ±‚ï¼Œå°†è¿æ¥å‡çº§ä¸º Websocketã€‚åœ¨ Slackï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„ websocket æœåŠ¡ï¼Œä¸“é—¨ç”¨äºæ¶ˆæ¯ã€åœ¨çº¿ï¼ˆåˆ—å‡ºå“ªäº›è”ç³»äººåœ¨çº¿ï¼‰å’Œå…¶ä»–æœåŠ¡ã€‚å…¶ä¸­ä¸€ä¸ª websocket ç«¯ç‚¹æ˜¯ä¸“é—¨ä¸ºéœ€è¦ä¸ Slack äº’åŠ¨çš„åº”ç”¨ç¨‹åºåˆ¶ä½œçš„ï¼ˆå› ä¸ºåº”ç”¨ç¨‹åºä¹Ÿæƒ³è¦å®æ—¶é€šä¿¡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾&#34; srcset=&#34;
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu6c596f20948c0eb170c82391812cb7ee_26299_ac7a9665cdcf26846a29601422c04bdc.webp 400w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu6c596f20948c0eb170c82391812cb7ee_26299_143cad29b11983523c6bbda9a9b7c2ad.webp 760w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu6c596f20948c0eb170c82391812cb7ee_26299_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277nk5l3j20hr0bbq3e_hu6c596f20948c0eb170c82391812cb7ee_26299_ac7a9665cdcf26846a29601422c04bdc.webp&#34;
               width=&#34;639&#34;
               height=&#34;407&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è§£é‡Šæµé‡å¦‚ä½•è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡çš„æµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿‡å»ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ª &lt;a href=&#34;https://aws.amazon.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS&lt;/a&gt; Region æœ‰ä¸€ç»„ä¸“é—¨ç”¨äº websockets çš„ HAProxy å®ä¾‹ï¼Œä»¥ç»ˆæ­¢é è¿‘ç”¨æˆ·çš„ websocket è¿æ¥ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„åç«¯æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿ç§»åˆ°-envoy-proxy-çš„åŠ¨æœº&#34;&gt;&lt;strong&gt;è¿ç§»åˆ° Envoy Proxy çš„åŠ¨æœº&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è™½ç„¶æˆ‘ä»¬ä» Slack å¼€å§‹å°±ä¸€ç›´åœ¨ä½¿ç”¨ HAproxyï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•å¤§è§„æ¨¡åœ°æ“ä½œå®ƒï¼Œä½†æœ‰ä¸€äº›æ“ä½œä¸Šçš„æŒ‘æˆ˜è®©æˆ‘ä»¬è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ Envoy Proxyã€‚&lt;/p&gt;
&lt;h3 id=&#34;çƒ­é‡å¯&#34;&gt;&lt;strong&gt;çƒ­é‡å¯&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨ Slackï¼Œåç«¯æœåŠ¡ç«¯ç‚¹åˆ—è¡¨çš„å˜åŒ–æ˜¯ä¸€ä¸ªå¸¸è§çš„äº‹ä»¶ï¼ˆç”±äºå®ä¾‹è¢«æ·»åŠ æˆ–åˆ é™¤ï¼‰ã€‚HAProxy æä¾›ä¸¤ç§æ–¹æ³•æ¥æ›´æ–°å…¶é…ç½®ï¼Œä»¥é€‚åº”ç«¯ç‚¹åˆ—è¡¨çš„å˜åŒ–ã€‚ä¸€ç§æ˜¯ä½¿ç”¨ HAProxy Runtime APIã€‚æˆ‘ä»¬åœ¨å…¶ä¸­ä¸€å¥— HAProxy å®ä¾‹ä¸­ä½¿ç”¨äº†è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çš„ç»éªŒåœ¨å¦ä¸€ç¯‡åšæ–‡ä¸­æœ‰æ‰€æè¿° â€”â€” &lt;a href=&#34;https://slack.engineering/a-terrible-horrible-no-good-very-bad-day-at-slack/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ Slack çš„å¯æ€•çš„ã€ææ€–çš„ã€æ²¡æœ‰å¥½å¤„çš„ã€éå¸¸ç³Ÿç³•çš„ä¸€å¤©&lt;/a&gt;ã€‚å¦ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ç”¨äº websockets è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰ï¼Œæ˜¯å°†åç«¯æ¸²æŸ“åˆ° HAProxy é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé‡æ–°åŠ è½½ HAProxyã€‚&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ HAProxy é‡è½½æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ç»„æ–°çš„è¿›ç¨‹æ¥å¤„ç†æ–°è¿›å…¥çš„è¿æ¥ã€‚æˆ‘ä»¬ä¼šè®©æ—§çš„è¿›ç¨‹æŒç»­è¿è¡Œå¾ˆå¤šå°æ—¶ï¼Œä»¥ä¾¿è®©é•¿å¯¿çš„ websocket è¿æ¥è€—å°½ï¼Œé¿å…ç”¨æˆ·é¢‘ç¹æ–­å¼€è¿æ¥ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½æœ‰å¤ªå¤šçš„ HAProxy è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è¿è¡Œç€å®ƒè‡ªå·± &amp;ldquo;å½“æ—¶&amp;rdquo; çš„é…ç½®å‰¯æœ¬ â€”â€” æˆ‘ä»¬å¸Œæœ›å®ä¾‹èƒ½æ›´å¿«åœ°æ±‡èšåˆ°æ–°ç‰ˆæœ¬çš„é…ç½®ä¸Šã€‚æˆ‘ä»¬ä¸å¾—ä¸å®šæœŸæ”¶å‰²æ—§çš„ HAProxy è¿›ç¨‹ï¼Œå¹¶é™åˆ¶ HAProxy é‡æ–°åŠ è½½çš„é¢‘ç‡ï¼Œä»¥é˜²åº•å±‚åç«¯å‡ºç°æ··ä¹±ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ä¸€äº›é¢å¤–çš„åŸºç¡€è®¾æ–½æ¥ç®¡ç† HAProxy çš„é‡æ–°åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;Envoy å…è®¸æˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-eds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€é…ç½®çš„é›†ç¾¤å’Œç«¯ç‚¹&lt;/a&gt;ï¼Œè¿™æ„å‘³ç€å¦‚æœç«¯ç‚¹åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä¸éœ€è¦é‡æ–°åŠ è½½ã€‚å¦‚æœä»£ç æˆ–é…ç½®ç¡®å®å‘ç”Ÿäº†å˜åŒ–ï¼ŒEnvoy æœ‰èƒ½åŠ›åœ¨ä¸æ”¾å¼ƒä»»ä½•è¿æ¥çš„æƒ…å†µä¸‹&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/hot_restart&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çƒ­é‡å¯&lt;/a&gt;è‡ªå·±ã€‚Envoy é€šè¿‡ &lt;a href=&#34;https://en.wikipedia.org/wiki/Inotify&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inotify&lt;/a&gt; è§‚å¯Ÿæ–‡ä»¶ç³»ç»Ÿé…ç½®çš„æ›´æ–°ã€‚åœ¨çƒ­é‡å¯è¿‡ç¨‹ä¸­ï¼ŒEnvoy è¿˜å°†ç»Ÿè®¡æ•°æ®ä»çˆ¶è¿›ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œå› æ­¤ä»ªè¡¨å’Œè®¡æ•°å™¨ä¸ä¼šè¢«é‡ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€åˆ‡éƒ½ä½¿ Envoy çš„è¿è¥å¼€é”€å¤§å¤§å‡å°‘ï¼Œè€Œä¸”ä¸éœ€è¦é¢å¤–çš„æœåŠ¡æ¥ç®¡ç†é…ç½®å˜åŒ–æˆ–é‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡åŠŸèƒ½&#34;&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡åŠŸèƒ½&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Envoy æä¾›äº†ä¸€äº›å…ˆè¿›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…ç½®æ”¯æŒåŒºåŸŸæ„ŸçŸ¥è·¯ç”±çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼‚å¸¸å€¼æ£€æµ‹&lt;/a&gt;è¿›è¡Œè¢«åŠ¨å¥åº·æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/panic_threshold&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ææ…Œè·¯ç”±&lt;/a&gt;ï¼šEnvoy é€šå¸¸åªå°†æµé‡è·¯ç”±åˆ°å¥åº·çš„åç«¯ï¼Œä½†æ˜¯å¦‚æœå¥åº·ä¸»æœºçš„ç™¾åˆ†æ¯”ä½äºæŸä¸ªé˜ˆå€¼ï¼Œå®ƒå¯ä»¥è¢«é…ç½®ä¸ºå°†æµé‡å‘é€åˆ°æ‰€æœ‰çš„åç«¯ï¼Œä¸ç®¡æ˜¯å¥åº·çš„è¿˜æ˜¯ä¸å¥åº·çš„ã€‚è¿™åœ¨æˆ‘ä»¬ &lt;a href=&#34;https://slack.engineering/slacks-outage-on-january-4th-2021/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2021 å¹´ 1 æœˆ 4 æ—¥çš„æ•…éšœ&lt;/a&gt;ä¸­éå¸¸æœ‰å¸®åŠ©ï¼Œè¿™æ¬¡æ•…éšœæ˜¯ç”±æˆ‘ä»¬åŸºç¡€è®¾æ–½ä¸­çš„ä¸€ä¸ªå¹¿æ³›çš„ç½‘ç»œé—®é¢˜å¼•èµ·çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºä¸Šè¿°åŸå› ï¼Œåœ¨ 2019 å¹´ï¼Œæˆ‘ä»¬å†³å®šå°†æˆ‘ä»¬çš„å…¥å£è´Ÿè½½å‡è¡¡å±‚ä» HAproxy è¿ç§»åˆ° Envoy Proxyï¼Œä» websockets å †æ ˆå¼€å§‹ã€‚è¿ç§»çš„ä¸»è¦ç›®æ ‡æ˜¯æé«˜å¯æ“ä½œæ€§ï¼Œè·å¾— Envoy æä¾›çš„æ–°åŠŸèƒ½ï¼Œä»¥åŠæ›´åŠ æ ‡å‡†åŒ–ã€‚é€šè¿‡åœ¨æ•´ä¸ª Slack ä¸­ä» HAProxy è¿ç§»åˆ° Envoyï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿå°†ä¸å†éœ€è¦äº†è§£ä¸¤ä¸ªè½¯ä»¶çš„æ€ªå¼‚ä¹‹å¤„ï¼Œä¸å†éœ€è¦ç»´æŠ¤ä¸¤ç§ä¸åŒçš„é…ç½®ï¼Œä¸å†éœ€è¦ç®¡ç†ä¸¤ä¸ªæ„å»ºå’Œå‘å¸ƒç®¡é“ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚é‚£æ—¶ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨ Envoy Proxy ä½œä¸ºæˆ‘ä»¬æœåŠ¡ç½‘æ ¼ä¸­çš„&lt;a href=&#34;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•°æ®å¹³é¢&lt;/a&gt;ã€‚æˆ‘ä»¬å†…éƒ¨ä¹Ÿæœ‰ç»éªŒä¸°å¯Œçš„ Envoy å¼€å‘äººå‘˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥éšæ—¶è·å¾— Envoy çš„ä¸“ä¸šçŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿæˆ-envoy-é…ç½®&#34;&gt;ç”Ÿæˆ Envoy é…ç½®&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¡è¿ç§»çš„ç¬¬ä¸€æ­¥æ˜¯å®¡æŸ¥æˆ‘ä»¬ç°æœ‰çš„ websocket å±‚é…ç½®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒç­‰çš„ Envoy é…ç½®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œç®¡ç† Envoy é…ç½®æ˜¯æˆ‘ä»¬æœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€ã€‚Envoy æœ‰ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œå…¶é…ç½®ä¸ HAProxy çš„é…ç½®æœ‰å¾ˆå¤§çš„ä¸åŒã€‚Envoy é…ç½®æ¶‰åŠå››ä¸ªä¸»è¦æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Listener&lt;/strong&gt;ï¼Œæ¥æ”¶è¯·æ±‚ï¼Œåˆç§° TCP å¥—æ¥å­—ã€SSL å¥—æ¥å­—æˆ– unix åŸŸå¥—æ¥å­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cluster&lt;/strong&gt;ï¼Œä»£è¡¨æˆ‘ä»¬å‘é€è¯·æ±‚çš„å†…éƒ¨æœåŠ¡ï¼Œå¦‚æ¶ˆæ¯æœåŠ¡å™¨å’Œå­˜åœ¨æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Route&lt;/strong&gt;ï¼Œå°† Listener å’Œ Cluster è¿æ¥åœ¨ä¸€èµ·&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Filter&lt;/strong&gt;ï¼Œå®ƒå¯¹è¯·æ±‚è¿›è¡Œæ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Slack çš„é…ç½®ç®¡ç†ä¸»è¦æ˜¯é€šè¿‡ &lt;a href=&#34;https://www.chef.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chef&lt;/a&gt; å®Œæˆçš„ã€‚å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ Envoy æ—¶ï¼Œæˆ‘ä»¬æŠŠ Envoy é…ç½®ä½œä¸º &lt;a href=&#34;https://docs.chef.io/resources/template/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;chef æ¨¡æ¿æ–‡ä»¶&lt;/a&gt;æ¥éƒ¨ç½²ï¼Œä½†å®ƒçš„ç®¡ç†å˜å¾—å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºç«‹äº† chef åº“å’Œ&lt;a href=&#34;https://docs.chef.io/custom_resources_notes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰èµ„æº&lt;/a&gt;æ¥ç”Ÿæˆ Envoy é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-chef-èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Chef èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾&#34; srcset=&#34;
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu1a8a6e23511e109899703f5399d437e1_11452_ed8077e3cbc9a68c6ebcb54e4a282838.webp 400w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu1a8a6e23511e109899703f5399d437e1_11452_3d8eaad58a869ab183ad8adf659b179f.webp 760w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu1a8a6e23511e109899703f5399d437e1_11452_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277ob5drj20hs07wq2z_hu1a8a6e23511e109899703f5399d437e1_11452_ed8077e3cbc9a68c6ebcb54e4a282838.webp&#34;
               width=&#34;640&#34;
               height=&#34;284&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Chef èµ„æºçš„ç»“æ„å’Œæµç¨‹å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Chef å†…éƒ¨ï¼Œé…ç½®æ˜¯ä¸€ä¸ª&lt;a href=&#34;https://en.wikipedia.org/wiki/Singleton_pattern&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å•ä¾‹&lt;/a&gt;ï¼Œæ¨¡æ‹Ÿäº†æ¯ä¸ªä¸»æœºåªæœ‰ä¸€ä¸ª Envoy é…ç½®çš„æƒ…å†µã€‚æ‰€æœ‰çš„ Chef èµ„æºéƒ½åœ¨è¿™ä¸ªå•ä¾‹ä¸Šæ“ä½œï¼Œæ·»åŠ ç›‘å¬å™¨ã€è·¯ç”±æˆ–é›†ç¾¤ã€‚åœ¨ Chef è¿è¡Œçš„æœ€åï¼Œ&lt;code&gt;envoy.yaml&lt;/code&gt; è¢«ç”Ÿæˆã€éªŒè¯ï¼Œç„¶åå®‰è£… â€”â€” æˆ‘ä»¬ä»ä¸å†™ä¸­é—´é…ç½®ï¼Œå› ä¸ºè¿™äº›é…ç½®å¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªæœ‰ä¸¤æ¡è·¯ç”±çš„ HTTP ç›‘å¬å™¨ï¼Œå°†æµé‡è·¯ç”±åˆ°ä¸¤ä¸ª&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#endpoint-discovery-service-eds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ¨æ€&lt;/a&gt;é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è°ƒç”¨chefèµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è°ƒç”¨Chefèµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­&#34; srcset=&#34;
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hud2ebd77a55ed41b5f8de579721b3ba03_23114_32e50a982040c604228080e85164bf26.webp 400w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hud2ebd77a55ed41b5f8de579721b3ba03_23114_2cdc116dd2cbbc9049f235c69f90387b.webp 760w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hud2ebd77a55ed41b5f8de579721b3ba03_23114_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277otk25j20hs0ao74o_hud2ebd77a55ed41b5f8de579721b3ba03_23114_32e50a982040c604228080e85164bf26.webp&#34;
               width=&#34;640&#34;
               height=&#34;384&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è°ƒç”¨Chefèµ„æºä»¥åˆ›å»ºå¸¦æœ‰é›†ç¾¤å’Œè·¯ç”±çš„ç›‘å¬å™¨çš„ä¾‹å­
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¦åœ¨ Envoy ä¸­å¤åˆ¶æˆ‘ä»¬å¤æ‚çš„ HAProxy é…ç½®éœ€è¦ä¸€äº›åŠªåŠ›ã€‚å¤§éƒ¨åˆ†éœ€è¦çš„åŠŸèƒ½åœ¨ Envoy ä¸­å·²ç»æœ‰äº†ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ chef åº“ä¸­åŠ å…¥å¯¹å®ƒçš„æ”¯æŒå°±å¯ä»¥äº†ã€‚æˆ‘ä»¬å®ç°äº†ä¸€äº›ç¼ºå¤±çš„ Envoy åŠŸèƒ½ï¼ˆæœ‰äº›æ˜¯&lt;a href=&#34;https://github.com/envoyproxy/envoy/pull/12206&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸Šæ¸¸&lt;/a&gt;è´¡çŒ®çš„ï¼Œæœ‰äº›æ˜¯å†…éƒ¨ç»´æŠ¤çš„æ‰©å±•ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹æˆ‘ä»¬çš„æ–°é…ç½®è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯&#34;&gt;å¯¹æˆ‘ä»¬çš„æ–°é…ç½®è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•æ–°çš„ Envoy websockets å±‚æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ç»å¸¸ç”¨æ‰‹å·¥ç¼–ç çš„ Envoy é…ç½®åšåŸå‹ï¼Œå¹¶åœ¨æœ¬åœ°çš„å¼€å‘æœºå™¨ä¸Šæµ‹è¯•ï¼Œæ¯ä¸ªç›‘å¬å™¨ã€è·¯ç”±å’Œé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªã€‚æ‰‹å·¥ç¼–ç çš„ä¿®æ”¹ä¸€æ—¦æˆåŠŸï¼Œå°±ä¼šè¢«ç§»åˆ° chef åº“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;HTTP è·¯ç”±æ˜¯ç”¨ &lt;a href=&#34;https://curl.se/docs/manpage.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;curl&lt;/a&gt; æµ‹è¯•çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºå¤´å’Œ cookie çš„ç‰¹å®šè·¯ç”±åˆ°ç‰¹å®šåç«¯&lt;/li&gt;
&lt;li&gt;åŸºäºè·¯å¾„ã€å‰ç¼€å’ŒæŸ¥è¯¢å‚æ•°çš„è·¯ç”±åˆ°ç‰¹å®šåç«¯&lt;/li&gt;
&lt;li&gt;SSL è¯ä¹¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“äº‹æƒ…æ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœæ—¶ï¼Œæˆ‘ä»¬åœ¨æœºå™¨ä¸Šä½¿ç”¨ Envoy è°ƒè¯•æ—¥å¿—ã€‚è°ƒè¯•æ—¥å¿—æ¸…æ¥šåœ°è§£é‡Šäº†ä¸ºä»€ä¹ˆ Envoy é€‰æ‹©å°†ä¸€ä¸ªç‰¹å®šçš„è¯·æ±‚è·¯ç”±åˆ°ä¸€ä¸ªç‰¹å®šçš„é›†ç¾¤ã€‚Envoy çš„è°ƒè¯•æ—¥å¿—éå¸¸æœ‰ç”¨ï¼Œä½†ä¹Ÿå¾ˆå†—é•¿ï¼Œè€Œä¸”å¾ˆæ˜‚è´µï¼ˆä½ çœŸçš„ä¸æƒ³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼‰ã€‚è°ƒè¯•æ—¥å¿—å¯ä»¥é€šè¿‡ Curl å¯ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -X POST http://localhost:&amp;lt;envoy_admin_port&amp;gt;/logging?level&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;debug
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy ç®¡ç†æ¥å£åœ¨åˆå§‹è°ƒè¯•æ—¶ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯è¿™äº›ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;clusters&lt;/strong&gt;ï¼šæ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„é›†ç¾¤ï¼ŒåŒ…æ‹¬æ¯ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰ä¸Šæ¸¸ä¸»æœºçš„ä¿¡æ¯ä»¥åŠæ¯ä¸ªä¸»æœºçš„ç»Ÿè®¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;/certs&lt;/strong&gt;ï¼šä»¥ JSON æ ¼å¼æ˜¾ç¤ºæ‰€æœ‰åŠ è½½çš„ TLS è¯ä¹¦ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€åºåˆ—å·ã€ä¸»ä½“æ›¿ä»£åç§°å’Œåˆ°æœŸå‰çš„å¤©æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;/listeners&lt;/strong&gt;ï¼šæ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„ç›‘å¬å™¨åŠå…¶åç§°å’Œåœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„ Chef åº“ä½¿ç”¨ &lt;code&gt;-mode validate&lt;/code&gt; å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œ Envoyï¼Œä½œä¸ºä¸€ä¸ªéªŒè¯æ­¥éª¤ï¼Œä»¥é˜²æ­¢å®‰è£…æ— æ•ˆçš„é…ç½®ã€‚è¿™ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /path/to/envoy/binary -c &amp;lt;/path/to/envoy.yaml&amp;gt; --mode validate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Envoy æä¾› JSON æ ¼å¼çš„ç›‘å¬å™¨æ—¥å¿—ã€‚æˆ‘ä»¬å°†è¿™äº›æ—¥å¿—å½•å…¥æˆ‘ä»¬çš„æ—¥å¿—ç®¡é“ï¼ˆå½“ç„¶æ˜¯åœ¨å¯¹æ—¥å¿—è¿›è¡Œ &lt;a href=&#34;https://en.wikipedia.org/wiki/Personal_data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PII&lt;/a&gt; å¤„ç†åï¼‰ï¼Œè¿™å¯¹è°ƒè¯•å·¥ä½œç»å¸¸å¾ˆæœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å¯¹å¼€å‘ç¯å¢ƒä¸­çš„é…ç½®æœ‰ä¿¡å¿ƒï¼Œæˆ‘ä»¬å°±å‡†å¤‡åšä¸€äº›æ›´å¤šçš„æµ‹è¯• &amp;ndash; åœ¨ç”Ÿäº§ä¸­ï¼&amp;quot;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿ç§»è‡³ç”Ÿäº§&#34;&gt;è¿ç§»è‡³ç”Ÿäº§&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å°†è¿ç§»è¿‡ç¨‹ä¸­çš„é£é™©é™åˆ°æœ€ä½ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªæ–°çš„ Envoy websocket æ ˆï¼Œå…¶é…ç½®ä¸ç°æœ‰çš„ HAProxy å±‚ç›¸å½“ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€æ­¥ã€æœ‰æ§åˆ¶åœ°å°†æµé‡è½¬ç§»åˆ°æ–°çš„ Envoy å †æ ˆï¼Œå¹¶ä¸”åœ¨å¿…è¦æ—¶å¯ä»¥å¿«é€Ÿåˆ‡æ¢å› HAProxyã€‚ç¼ºç‚¹æ˜¯æˆ‘ä»¬çš„ AWS æˆæœ¬ â€”â€” æˆ‘ä»¬åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä½¿ç”¨äº†åŒå€çš„èµ„æºï¼Œä½†æˆ‘ä»¬æ„¿æ„èŠ±è´¹æ—¶é—´å’Œèµ„æºä¸ºæˆ‘ä»¬çš„å®¢æˆ·é€æ˜åœ°è¿›è¡Œè¿ç§»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ &lt;a href=&#34;https://ns1.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NS1&lt;/a&gt; ç®¡ç†æˆ‘ä»¬çš„ DNS è®°å½• &lt;strong&gt;wss-primary.slack.com&lt;/strong&gt; å’Œ &lt;strong&gt;wss-backup.slack.com&lt;/strong&gt;ã€‚æˆ‘ä»¬ä½¿ç”¨åŠ æƒè·¯ç”±å°†æµé‡ä» &lt;strong&gt;haproxy-wss&lt;/strong&gt; è½¬ç§»åˆ° &lt;strong&gt;envoy-wss&lt;/strong&gt; &lt;a href=&#34;https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NLB&lt;/a&gt; DNS åç§°ã€‚ç¬¬ä¸€æ‰¹åŒºåŸŸæ˜¯ä»¥ 10%ã€25%ã€50%ã€75% å’Œ 100% çš„æ­¥éª¤å•ç‹¬ä¸Šçº¿çš„ã€‚ç”±äºæˆ‘ä»¬å¯¹æ–°çš„ Envoy å±‚å’Œä¸Šçº¿è¿‡ç¨‹æœ‰ä¿¡å¿ƒï¼Œæ‰€ä»¥æœ€åçš„åŒºåŸŸä¸Šçº¿é€Ÿåº¦æ›´å¿«ï¼ˆ25%ã€50%ã€75%ã€100% åªéœ€ä¸¤å¤©ï¼Œè€Œä¹‹å‰çš„ä¸€ä¸ªåŒºåŸŸéœ€è¦ä¸€å‘¨çš„æ—¶é—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¿ç§»å·¥ä½œå¾ˆé¡ºåˆ©ï¼Œæ²¡æœ‰å‡ºç°æ•…éšœï¼Œä½†è¿˜æ˜¯å‡ºç°äº†ä¸€äº›å°é—®é¢˜ï¼Œæ¯”å¦‚è¶…æ—¶å€¼å’Œ header çš„å·®å¼‚ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡æ¢å¤ã€ä¿®å¤ï¼Œå¹¶å†æ¬¡ä¸Šçº¿ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµç¨‹å›¾æ˜¾ç¤ºdnsè¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµç¨‹å›¾æ˜¾ç¤ºDNSè¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤&#34; srcset=&#34;
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_hu8dbdeb8b10fd6b75b776536dab81c36d_16804_f56f3b4b7df6d9bab4f21c0b62d40875.webp 400w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_hu8dbdeb8b10fd6b75b776536dab81c36d_16804_15a07482708b9585e83ff83d618596d9.webp 760w,
               /translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_hu8dbdeb8b10fd6b75b776536dab81c36d_16804_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/migrating-millions-of-concurrent-websockets-to-envoy/e6c9d24ely1h1277p8k19j20hs07c3yp_hu8dbdeb8b10fd6b75b776536dab81c36d_16804_f56f3b4b7df6d9bab4f21c0b62d40875.webp&#34;
               width=&#34;640&#34;
               height=&#34;264&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµç¨‹å›¾æ˜¾ç¤ºDNSè¿ç§»è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç»„ä»¶å’Œæ­¥éª¤
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»è¿‡æ¼«é•¿è€Œæ¿€åŠ¨äººå¿ƒçš„ 6 ä¸ªæœˆï¼Œè¿ç§»å®Œæˆäº†ï¼Œæ•´ä¸ª HAProxy websocket å †æ ˆåœ¨å…¨çƒèŒƒå›´å†…è¢« Envoy Proxy å–ä»£ï¼Œå¯¹å®¢æˆ·çš„&lt;strong&gt;å½±å“ä¸ºé›¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å“ªäº›è¿›å±•é¡ºåˆ©å“ªäº›ä¸é¡ºåˆ©&#34;&gt;å“ªäº›è¿›å±•é¡ºåˆ©ï¼Œå“ªäº›ä¸é¡ºåˆ©&lt;/h2&gt;
&lt;p&gt;è¿ç§»æœ¬èº«æ˜¯ç›¸å¯¹å¹³æ·¡å’Œæ— èŠçš„ã€‚&lt;strong&gt;æ¯ç‡¥æ˜¯ä¸€ä»¶å¥½äº‹&lt;/strong&gt;ï¼šåˆºæ¿€æ„å‘³ç€äº‹æƒ…çš„ä¸­æ–­ï¼Œæ¯ç‡¥æ„å‘³ç€ä¸€åˆ‡é¡ºåˆ©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘ç°ï¼Œæ—§çš„ HAProxy é…ç½®éšç€æ—¶é—´çš„æ¨ç§»è€Œæœ‰æœºåœ°å¢é•¿ã€‚å®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”± HAProxy ä½¿ç”¨çš„æ¨¡å‹å½¢æˆçš„ â€”â€” ä¸€ä¸ªåŒ…æ‹¬æ‰€æœ‰ç›‘å¬å™¨çš„å¤§å‹é…ç½®ã€‚Envoy çš„é…ç½®æ¨¡å‹æ¯” HAProxy çš„æ¨¡å‹ä½¿ç”¨æ›´å¤šçš„å®šä¹‰èŒƒå›´ã€‚ä¸€æ—¦ä¸€ä¸ªç›‘å¬å™¨è¢«è¾“å…¥ï¼Œåªæœ‰è¯¥ç›‘å¬å™¨å†…çš„è§„åˆ™é€‚ç”¨äºè¯·æ±‚ã€‚ä¸€æ—¦è¾“å…¥ä¸€ä¸ªè·¯ç”±ï¼Œåªæœ‰è¯¥è·¯ç”±ä¸Šçš„è§„åˆ™é€‚ç”¨ã€‚è¿™ä½¿å¾—å°†è§„åˆ™ä¸ç›¸å…³çš„è¯·æ±‚è”ç³»èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬èŠ±äº†å¾ˆé•¿æ—¶é—´ä»æ—§çš„ HAProxy é…ç½®ä¸­æå–é‡è¦çš„ä¸œè¥¿ï¼Œè¿™å®é™…ä¸Šæ˜¯æŠ€æœ¯å€ºåŠ¡ã€‚é€šå¸¸å¾ˆéš¾å¼„æ¸…æ¥šä¸ºä»€ä¹ˆä¼šæœ‰æŸä¸ªè§„åˆ™ï¼Œå“ªäº›æ˜¯æœ‰æ„çš„ï¼Œå“ªäº›æ˜¯æ— æ„çš„ï¼Œä»¥åŠå…¶ä»–æœåŠ¡æ‰€ä¾èµ–çš„è¡Œä¸ºæ˜¯ä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œæœ‰äº›æœåŠ¡åº”è¯¥åªåœ¨ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostsï¼‰ä¸­çš„ä¸€ä¸ªä¸‹ï¼Œä½†å®é™…ä¸Šåœ¨ HAProxy çš„ä¸¤ä¸ª vhosts ä¸‹éƒ½å¯ç”¨ã€‚æˆ‘ä»¬ä¸å¾—ä¸å¤åˆ¶è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºç°æœ‰çš„ä»£ç ä¾èµ–äºè¿™ç§è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ HAProxy å †æ ˆä¸­é”™è¿‡äº†ä¸€äº›ç»†å¾®çš„ä¸œè¥¿ã€‚æœ‰æ—¶è¿™äº›æ˜¯å¾ˆé‡è¦çš„ â€”â€” æˆ‘ä»¬ç ´åäº† Slack çš„æ¯æ—¥æ´»è·ƒç”¨æˆ·ï¼ˆDAUï¼‰æŒ‡æ ‡ï¼ˆå“å‘€ï¼ï¼‰ã€‚ä¹Ÿæœ‰å¾ˆå¤šå°é—®é¢˜éœ€è¦è§£å†³ã€‚è´Ÿè½½å‡è¡¡å™¨çš„è¡Œä¸ºå¾ˆå¤æ‚ï¼Œé™¤äº†èŠ±æ—¶é—´è°ƒè¯•å¤–ï¼Œæ²¡æœ‰çœŸæ­£çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¼€å§‹è¿ç§»æ—¶ï¼Œæ²¡æœ‰ä¸ºè´Ÿè½½å‡è¡¡å™¨çš„é…ç½®æä¾›æµ‹è¯•æ¡†æ¶ã€‚æˆ‘ä»¬æ²¡æœ‰è‡ªåŠ¨æµ‹è¯•æ¥éªŒè¯æµ‹è¯•çš„ URL è·¯ç”±åˆ°æ­£ç¡®çš„ç«¯ç‚¹ä»¥åŠä¸è¯·æ±‚å’Œå“åº”å¤´ç›¸å…³çš„è¡Œä¸ºï¼Œè€Œæ˜¯æœ‰&amp;hellip;&amp;hellip; ä¸€ä¸ª HAProxy é…ç½®ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æä¾›å¾ˆå¤šå…³äºé¢„æœŸè¡Œä¸ºçš„åŸå› çš„èƒŒæ™¯ã€‚å› ä¸ºæˆ‘ä»¬ç¼ºä¹æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¸å¾—ä¸å‘æœåŠ¡æ‰€æœ‰è€…è¯¢é—®ï¼Œä»¥äº†è§£ä»–ä»¬æ‰€ä¾èµ–çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºç«‹çš„ Chef èµ„æºæœ‰æ„åªæ”¯æŒ Envoy åŠŸèƒ½çš„ä¸€ä¸ªå­é›†ã€‚è¿™ä½¿æˆ‘ä»¬çš„åº“æ›´ç®€å• â€”â€” æˆ‘ä»¬åªéœ€è¦è€ƒè™‘æˆ‘ä»¬å®é™…ä½¿ç”¨çš„åŠŸèƒ½ã€‚ç¼ºç‚¹æ˜¯ï¼Œæ¯æ¬¡æˆ‘ä»¬æƒ³ä½¿ç”¨æ–°çš„ Envoy åŠŸèƒ½æ—¶ï¼Œéƒ½å¿…é¡»åœ¨æˆ‘ä»¬çš„ Chef åº“ä¸­æ·»åŠ å¯¹è¿™äº›åŠŸèƒ½çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Server_Name_Indication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SNI&lt;/a&gt;ï¼ˆhttpsï¼‰ç›‘å¬å™¨æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç¼–å†™çš„ï¼Œå½“æ—¶æˆ‘ä»¬è®¤ä¸ºè¿™æ¯”å‘ç°æœ‰çš„ç›‘å¬å™¨æ·»åŠ æ”¯æŒæ›´ç®€å•ã€‚ç„¶è€Œï¼Œå½“æ¶‰åŠåˆ° vhost æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬å·²ç»å¼€å‘äº†å¾ˆå¤šä»£ç å¹¶åœ¨ä½¿ç”¨ä¸­ï¼Œé‡æ„æ•´ä¸ªå…¬å¸å…¶ä»–åœ°æ–¹æ­£åœ¨ä½¿ç”¨çš„èµ„æºå°†èŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚æˆ‘ä»¬çš„ Chef åº“ä¸­çš„ vhost æ”¯æŒæ˜¯ä¸€ä¸ª hackï¼ˆå¾ˆå¿«æœ‰ä¸€å¤©æˆ‘ä»¬ä¼šä¿®å¤å®ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿æ”¹å˜ Envoy èµ„æº Chef åº“æ›´åŠ å®‰å…¨ï¼Œæ¢å¥è¯è¯´ï¼Œç¡®ä¿æˆ‘ä»¬ä¸ä¼šç ´åå…¶ä»–ä½¿ç”¨æˆ‘ä»¬åº“çš„å›¢é˜Ÿï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€å¥—å…¨é¢çš„æµ‹è¯•ï¼Œç”Ÿæˆè¿™äº›å›¢é˜Ÿçš„æ•´ä¸ªé…ç½®ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ›´æ–° Envoy Chef èµ„æºæ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆçš„æ‰€æœ‰ Envoy é…ç½®ä¼šï¼ˆæˆ–ä¸ä¼šï¼‰å—åˆ°ä»€ä¹ˆå½±å“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡è¿ç§»ï¼ˆå’Œå…¶ä»–è¿ç§»ä¸€æ ·ï¼‰çš„å…³é”®äº‹é¡¹ä¹‹ä¸€æ˜¯æ²Ÿé€šã€‚æˆ‘ä»¬åŠªåŠ›è®©æ¯ä¸ªäººéƒ½äº†è§£å¹¶é…åˆæˆ‘ä»¬æ­£åœ¨è¿›è¡Œçš„æ”¹å˜ã€‚æˆ‘ä»¬çš„å®¢æˆ·ä½“éªŒï¼ˆCEï¼‰å›¢é˜Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆä½œä¼™ä¼´ â€”â€” ä»–ä»¬èƒ½å¤Ÿç›‘æ§ä¼ å…¥çš„å·¥å•ï¼Œä»¥å‘ç°ä»»ä½•å¯èƒ½è¡¨æ˜ç”¨æˆ·å› è¿™æ¬¡è¿ç§»è€Œå—åˆ°å½±å“çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ&#34;&gt;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å°½ç®¡å¶å°”ä¼šé‡åˆ°ä¸€äº›å°æŒ«æŠ˜ï¼Œä½† envoy websocket çš„è¿ç§»è¿˜æ˜¯éå¸¸æˆåŠŸçš„ã€‚æˆ‘ä»¬å·²ç»è·Ÿè¿›ï¼Œå°†å¦ä¸€ä¸ªå…³é”®çš„ Slack æœåŠ¡ï¼Œå³æˆ‘ä»¬çš„è½¯ä»¶å®¢æˆ·ç«¯æŒ‡æ ‡æ‘„å–ç®¡é“ â€”â€” ä¸æˆ‘ä»¬çš„å…¶ä»–å…¥å£è´Ÿè½½å‡è¡¡å™¨éš”ç¦» â€”â€” è¿ç§»åˆ° Envoy Proxyã€‚æˆ‘ä»¬å‡ ä¹å·²ç»å®Œæˆäº†å°†æˆ‘ä»¬çš„ç½‘ç»œå’Œ API æµé‡çš„å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨è¿ç§»åˆ° Envoyã€‚è¿™åœºå²è¯—èˆ¬çš„è¿ç§»çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å°†æˆ‘ä»¬çš„ï¼ˆå¸¸è§„çš„ã€é websocket çš„ï¼‰HTTP å †æ ˆä» HAProxy è¿ç§»åˆ° Envoyï¼Œè¿™ä¹Ÿæ˜¯æ­£åœ¨è¿›è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯åœ¨å…¥å£è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸Šå®ç° Envoy Proxy çš„æ ‡å‡†åŒ–ï¼Œè¿™å°†å¤§å¤§é™ä½å›¢é˜Ÿçš„è®¤çŸ¥è´Ÿè·å’Œæ“ä½œå¤æ‚æ€§ï¼Œå¹¶ä½¿ Envoy çš„å…ˆè¿›åŠŸèƒ½åœ¨æˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡åŸºç¡€è®¾æ–½ä¸­å¾—åˆ°åº”ç”¨ã€‚è‡ªä»è¿ç§»åˆ° Envoy åï¼Œæˆ‘ä»¬å·²ç»å¤§å¤§è¶…è¿‡äº†ä»¥å‰çš„å³°å€¼è´Ÿè½½ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å‘Šåˆ« Sidecarâ€”â€”ä½¿ç”¨ eBPF è§£é”å†…æ ¸çº§æœåŠ¡ç½‘æ ¼</title>
      <link>https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/</link>
      <pubDate>Thu, 09 Dec 2021 21:03:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡ä½œè€…æ˜¯ Isovalent è”åˆåˆ›å§‹äºº&amp;amp;CTOï¼ŒåŸæ–‡æ ‡é¢˜ &lt;a href=&#34;https://isovalent.com/blog/post/2021-12-08-ebpf-servicemesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How eBPF will solve Service Mesh - Goodbye Sidecars&lt;/a&gt;ï¼Œä½œè€…å›é¡¾äº†Linux å†…æ ¸çš„è¿æ¥æ€§ï¼Œå®ç°æœåŠ¡ç½‘æ ¼çš„å‡ ç§æ¨¡å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ eBPF å®ç°æ—  Sidecar çš„æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&#34;&gt;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;éšç€åˆ†å¸ƒå¼åº”ç”¨çš„å¼•å…¥ï¼Œé¢å¤–çš„å¯è§æ€§ã€è¿æ¥æ€§å’Œå®‰å…¨æ€§è¦æ±‚ä¹Ÿæµ®å‡ºæ°´é¢ã€‚åº”ç”¨ç¨‹åºç»„ä»¶é€šè¿‡ä¸å—ä¿¡ä»»çš„ç½‘ç»œè·¨è¶Šäº‘å’Œé›†ç¾¤è¾¹ç•Œè¿›è¡Œé€šä¿¡ï¼Œè´Ÿè½½å‡è¡¡ã€å¼¹æ€§å˜å¾—è‡³å…³é‡è¦ï¼Œå®‰å…¨å¿…é¡»å‘å±•åˆ°å‘é€è€…å’Œæ¥æ”¶è€…éƒ½å¯ä»¥éªŒè¯å½¼æ­¤çš„èº«ä»½çš„æ¨¡å¼ã€‚åœ¨åˆ†å¸ƒå¼åº”ç”¨çš„æ—©æœŸï¼Œè¿™äº›è¦æ±‚æ˜¯é€šè¿‡ç›´æ¥å°†æ‰€éœ€çš„é€»è¾‘åµŒå…¥åˆ°åº”ç”¨ä¸­æ¥è§£å†³çš„ã€‚æœåŠ¡ç½‘æ ¼å°†è¿™äº›åŠŸèƒ½ä»åº”ç”¨ç¨‹åºä¸­æå–å‡ºæ¥ï¼Œä½œä¸ºåŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†æä¾›ç»™æ‰€æœ‰åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå› æ­¤ä¸å†éœ€è¦ä¿®æ”¹æ¯ä¸ªåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æœåŠ¡ç½‘æ ¼ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æœåŠ¡ç½‘æ ¼ç¤ºæ„å›¾&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx_hu6485f23e60e2e8e9568294bae27898e8_104054_8698f632d2f6bd2d13968093c75d0a57.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx_hu6485f23e60e2e8e9568294bae27898e8_104054_7ccad9cc60d4af9f3a79ee25730411ce.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx_hu6485f23e60e2e8e9568294bae27898e8_104054_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyna8jsj32e20sojtx_hu6485f23e60e2e8e9568294bae27898e8_104054_8698f632d2f6bd2d13968093c75d0a57.webp&#34;
               width=&#34;760&#34;
               height=&#34;253&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æœåŠ¡ç½‘æ ¼ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;çºµè§‚ä»Šå¤©æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½è®¾ç½®ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼¹æ€§è¿æ¥&lt;/strong&gt;ï¼šæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¿…é¡»èƒ½å¤Ÿè·¨è¶Šè¾¹ç•Œï¼Œå¦‚äº‘ã€é›†ç¾¤å’Œåœºæ‰€ã€‚é€šä¿¡å¿…é¡»æ˜¯æœ‰å¼¹æ€§çš„å’Œå®¹é”™çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;L7 æµé‡ç®¡ç†&lt;/strong&gt;ï¼šè´Ÿè½½å‡è¡¡ã€é€Ÿç‡é™åˆ¶å’Œå¼¹æ€§å¿…é¡»æ˜¯ L7 æ„ŸçŸ¥çš„ï¼ˆHTTPã€RESTã€gRPCã€WebSocket ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºèº«ä»½çš„å®‰å…¨&lt;/strong&gt;ï¼šä¾é ç½‘ç»œæ ‡è¯†ç¬¦æ¥å®ç°å®‰å…¨å·²ç»ä¸å¤Ÿäº†ï¼Œå‘é€å’Œæ¥æ”¶æœåŠ¡éƒ½å¿…é¡»èƒ½å¤Ÿæ ¹æ®èº«ä»½è€Œä¸æ˜¯ç½‘ç»œæ ‡è¯†ç¬¦æ¥éªŒè¯å¯¹æ–¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§å’Œè·Ÿè¸ª&lt;/strong&gt;ï¼šè¿½è¸ªå’ŒæŒ‡æ ‡å½¢å¼çš„å¯è§‚æµ‹æ€§å¯¹äºç†è§£ã€ç›‘æ§å’Œæ’é™¤åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€æ€§èƒ½å’Œå¯ç”¨æ€§è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€æ˜&lt;/strong&gt;ï¼šè¯¥åŠŸèƒ½å¿…é¡»ä»¥é€æ˜çš„æ–¹å¼æä¾›ç»™åº”ç”¨ç¨‹åºï¼Œå³ä¸éœ€è¦æ”¹å˜åº”ç”¨ç¨‹åºä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æ—©æœŸï¼ŒæœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½é€šå¸¸æ˜¯ä»¥åº“çš„å½¢å¼å®ç°çš„ï¼Œè¦æ±‚ç½‘æ ¼ä¸­çš„æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¦é“¾æ¥åˆ°ä»¥åº”ç”¨ç¨‹åºçš„è¯­è¨€æ¡†æ¶ç¼–å†™çš„åº“ã€‚ç±»ä¼¼çš„äº‹æƒ…ä¹Ÿå‘ç”Ÿåœ¨äº’è”ç½‘çš„æ—©æœŸï¼šæ›¾å‡ ä½•æ—¶ï¼Œåº”ç”¨ç¨‹åºè¿˜éœ€è¦è¿è¡Œè‡ªå·±çš„ TCP/IP åè®®æ ˆï¼æ­£å¦‚æˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºçš„é‚£æ ·ï¼ŒæœåŠ¡ç½‘æ ¼æ­£åœ¨å‘å±•æˆä¸ºä¸€ç§å†…æ ¸è´£ä»»ï¼Œå°±åƒç½‘ç»œå †æ ˆä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäºåº“çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäºåº“çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p_hu6485f23e60e2e8e9568294bae27898e8_99590_b6959dbf34a33344768fc560384a13ac.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p_hu6485f23e60e2e8e9568294bae27898e8_99590_a06ed52554d7eaf0205dac367f5b8e87.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p_hu6485f23e60e2e8e9568294bae27898e8_99590_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyowb55j31pi0k076p_hu6485f23e60e2e8e9568294bae27898e8_99590_b6959dbf34a33344768fc560384a13ac.webp&#34;
               width=&#34;760&#34;
               height=&#34;247&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäºåº“çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ï¼ŒæœåŠ¡ç½‘æ ¼é€šå¸¸ä½¿ç”¨ä¸€ç§å«åš sidecar æ¨¡å‹çš„æ¶æ„æ¥å®ç°ã€‚è¿™ç§æ¶æ„å°†å®ç°ä¸Šè¿°åŠŸèƒ½çš„ä»£ç å°è£…åˆ°ç¬¬å››å±‚ä»£ç†ä¸­ï¼ŒæœåŠ¡é—´çš„æµé‡è¢«é‡å®šå‘åˆ°è¿™ä¸ªæ‰€è°“çš„ sidecar ä»£ç†ã€‚å®ƒä¹‹æ‰€ä»¥è¢«ç§°ä¸º â€œæŒæ–—â€ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªä»£ç†ï¼Œå°±åƒæŒæ–—é™„ç€åœ¨æ‘©æ‰˜è½¦ä¸Šä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäº-sidecar-çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäº Sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h_hu6485f23e60e2e8e9568294bae27898e8_104187_f7ccbefbb801fe00eda32bba825017a1.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h_hu6485f23e60e2e8e9568294bae27898e8_104187_2417ae65f785189b2c9b3f5d5bd778c1.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h_hu6485f23e60e2e8e9568294bae27898e8_104187_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyqsefhj31pe0moq5h_hu6485f23e60e2e8e9568294bae27898e8_104187_f7ccbefbb801fe00eda32bba825017a1.webp&#34;
               width=&#34;760&#34;
               height=&#34;281&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäº Sidecar çš„æœåŠ¡ç½‘æ ¼æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§æ¶æ„çš„ä¼˜ç‚¹æ˜¯ï¼ŒæœåŠ¡ä¸å†éœ€è¦è‡ªå·±å®ç°æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½ã€‚å¦‚æœè®¸å¤šæœåŠ¡æ˜¯ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™éƒ¨ç½²çš„ï¼Œæˆ–è€…å¦‚æœä½ æ­£åœ¨è¿è¡Œä¸å¯å˜çš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œè¿™å°±å¾ˆæœ‰å¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹æ˜¯æœ‰å¤§é‡çš„ä»£ç†ï¼Œè®¸å¤šé¢å¤–çš„ç½‘ç»œè¿æ¥ï¼Œä»¥åŠå¤æ‚çš„é‡å®šå‘é€»è¾‘ï¼Œå°†ç½‘ç»œæµé‡è¾“å…¥ä»£ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä»€ä¹ˆç±»å‹çš„ç½‘ç»œæµé‡å¯ä»¥è¢«é‡å®šå‘åˆ°ç¬¬å››å±‚ä»£ç†ä¸Šä¹Ÿæœ‰é™åˆ¶ã€‚ä»£ç†ï¼ˆProxyï¼‰åœ¨å…¶èƒ½æ”¯æŒçš„ç½‘ç»œåè®®æ–¹é¢æ˜¯æœ‰é™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿æ¥æ€§è½¬ç§»åˆ°å†…æ ¸ä¸­çš„å†å²&#34;&gt;è¿æ¥æ€§è½¬ç§»åˆ°å†…æ ¸ä¸­çš„å†å²&lt;/h2&gt;
&lt;p&gt;å‡ åå¹´æ¥ï¼Œåœ¨åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å®‰å…¨å¯é çš„è¿æ¥ä¸€ç›´æ˜¯æ“ä½œç³»ç»Ÿçš„è´£ä»»ã€‚æœ‰äº›äººå¯èƒ½è¿˜è®°å¾—æ—©æœŸ Unix å’Œ Linux æ—¶ä»£çš„ &lt;a href=&#34;https://en.wikipedia.org/wiki/TCP_Wrappers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP åŒ…è£…å™¨&lt;/a&gt;å’Œ tcpdã€‚tcpd å…è®¸ç”¨æˆ·åœ¨ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹é€æ˜åœ°æ·»åŠ æ—¥å¿—ã€è®¿é—®æ§åˆ¶ã€ä¸»æœºåéªŒè¯å’Œæ¬ºéª—ä¿æŠ¤ã€‚å®ƒä½¿ç”¨äº† libwrapï¼Œè€Œä¸”ï¼Œåœ¨ä¸€ä¸ªæœ‰è¶£çš„å¹³è¡ŒäºæœåŠ¡ç½‘æ ¼çš„æ•…äº‹ä¸­ï¼Œè¿™ä¸ªåº“ä¹Ÿæ˜¯ä»¥å‰åº”ç”¨ç¨‹åºæä¾›è¿™äº›åŠŸèƒ½çš„é“¾æ¥å¯¹è±¡ã€‚tcpd æ‰€å¸¦æ¥çš„æ˜¯èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ç°æœ‰åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å°†è¿™äº›åŠŸèƒ½é€æ˜åœ°æ·»åŠ åˆ°ç°æœ‰åº”ç”¨ç¨‹åºä¸­ã€‚æœ€ç»ˆï¼Œæ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½è¿›å…¥äº† Linux æœ¬èº«ï¼Œå¹¶ä»¥ä¸€ç§æ›´æœ‰æ•ˆã€æ›´å¼ºå¤§çš„æ–¹å¼æä¾›ç»™æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚ä»Šå¤©ï¼Œè¿™å·²ç»å‘å±•åˆ°äº†æˆ‘ä»¬æ‰€çŸ¥é“çš„ iptablesã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œiptables æ˜¾ç„¶ä¸é€‚åˆè§£å†³ç°ä»£åº”ç”¨çš„è¿æ¥æ€§ã€å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§è¦æ±‚ï¼Œå› ä¸ºå®ƒåªåœ¨ç½‘ç»œå±‚é¢ä¸Šæ“ä½œï¼Œå¯¹åº”ç”¨åè®®å±‚ç¼ºä¹ä»»ä½•äº†è§£ã€‚è‡ªç„¶ï¼Œé˜»åŠ›æœ€å°çš„è·¯å¾„æ˜¯å›åˆ°åº“æ¨¡å‹ï¼Œç„¶åæ˜¯ sidecar æ¨¡å‹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ­£å¤„äºè¿™æ ·ä¸€ä¸ªé˜¶æ®µï¼šä¸ºäº†æœ€ä½³çš„é€æ˜åº¦ã€æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­åŸç”Ÿåœ°æ”¯æŒè¿™ç§æ¨¡å¼æ˜¯æœ‰æ„ä¹‰çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æœåŠ¡ç½‘æ ¼çš„è¿›åŒ–&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æœåŠ¡ç½‘æ ¼çš„è¿›åŒ–&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_0e49b885a5d8058e66656bbfb77f3024.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_871e8e56078e2f8d2d170e8cf6e0aa58.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8ybphhj31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_0e49b885a5d8058e66656bbfb77f3024.webp&#34;
               width=&#34;760&#34;
               height=&#34;429&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æœåŠ¡ç½‘æ ¼çš„è¿›åŒ–
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ tcpd æ—¶ä»£ï¼Œæ›¾ç»çš„è¿æ¥è®°å½•ç°åœ¨æ˜¯è¿½è¸ªã€‚IP å±‚é¢çš„è®¿é—®æ§åˆ¶å·²ç»æ¼”å˜æˆåº”ç”¨åè®®å±‚é¢çš„æˆæƒï¼Œä¾‹å¦‚ä½¿ç”¨ JWTã€‚ä¸»æœºåéªŒè¯å·²è¢«æ›´å¼ºå¤§çš„è®¤è¯æ‰€å–ä»£ï¼Œå¦‚ mTLSã€‚ç½‘ç»œè´Ÿè½½å‡è¡¡å·²ç»æ‰©å±•åˆ° L7 æµé‡ç®¡ç†ã€‚HTTP é‡è¯•æ˜¯æ–°çš„ TCP é‡ä¼ ã€‚è¿‡å»ç”¨é»‘æ´è·¯ç”±è§£å†³çš„é—®é¢˜ä»Šå¤©è¢«ç§°ä¸ºæ–­è·¯ã€‚è¿™äº›éƒ½ä¸æ˜¯æ ¹æœ¬æ€§çš„æ–°é—®é¢˜ï¼Œä½†æ‰€éœ€çš„ç¯å¢ƒå’Œæ§åˆ¶å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•å†…æ ¸å‘½åç©ºé—´æ¦‚å¿µ&#34;&gt;æ‰©å±•å†…æ ¸å‘½åç©ºé—´æ¦‚å¿µ&lt;/h2&gt;
&lt;p&gt;Linux å†…æ ¸å·²ç»æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥å…±äº«å…±åŒçš„åŠŸèƒ½ï¼Œå¹¶ä½¿å…¶å¯¹ç³»ç»Ÿä¸Šè¿è¡Œçš„è®¸å¤šåº”ç”¨ç¨‹åºå¯ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºå‘½åç©ºé—´ï¼ˆNamespaceï¼‰ï¼Œå®ƒæ„æˆäº†æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥çš„å®¹å™¨æŠ€æœ¯çš„åŸºç¡€ã€‚å‘½åç©ºé—´ï¼ˆå†…æ ¸çš„é‚£ç§ï¼Œä¸æ˜¯ Kubernetes çš„å‘½åç©ºé—´ï¼‰å­˜åœ¨äºå„ç§æŠ½è±¡ä¸­ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·ç®¡ç†ã€æŒ‚è½½è®¾å¤‡ã€è¿›ç¨‹ã€ç½‘ç»œç­‰ã€‚è¿™å°±æ˜¯å…è®¸å•ä¸ªå®¹å™¨å‘ˆç°ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€ä¸åŒçš„ç”¨æˆ·é›†ï¼Œä»¥åŠå…è®¸å¤šä¸ªå®¹å™¨ç»‘å®šåˆ°å•ä¸ªä¸»æœºä¸Šçš„åŒä¸€ç½‘ç»œç«¯å£ã€‚åœ¨ cgroups çš„å¸®åŠ©ä¸‹ï¼Œè¿™ä¸ªæ¦‚å¿µå¾—åˆ°äº†æ‰©å±•ï¼Œå¯ä»¥å¯¹ CPUã€å†…å­˜å’Œç½‘ç»œç­‰èµ„æºè¿›è¡Œç®¡ç†å’Œä¼˜å…ˆæ’åºã€‚ä»äº‘åŸç”Ÿåº”ç”¨å¼€å‘è€…çš„è§’åº¦æ¥çœ‹ï¼Œcgroups å’Œèµ„æºè¢«ç´§å¯†åœ°æ•´åˆåˆ°æˆ‘ä»¬æ‰€çŸ¥çš„ &amp;ldquo;å®¹å™¨&amp;rdquo; æ¦‚å¿µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¦åˆé€»è¾‘çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è®¤ä¸ºæœåŠ¡ç½‘æ ¼æ˜¯æ“ä½œç³»ç»Ÿçš„è´£ä»»ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ç¬¦åˆå¹¶æ•´åˆå‘½åç©ºé—´å’Œ cgroup çš„æ¦‚å¿µã€‚è¿™çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-service-mesh-namespace&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Service Mesh Namespace&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75_hu3818cf23d00bafc73ec955949ff96cef_165657_0b4f2aeba8526e8de04d93ca7c65ed74.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75_hu3818cf23d00bafc73ec955949ff96cef_165657_a1b71240819d57b1f178864488358330.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75_hu3818cf23d00bafc73ec955949ff96cef_165657_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wypvr2zj31p20q0q75_hu3818cf23d00bafc73ec955949ff96cef_165657_0b4f2aeba8526e8de04d93ca7c65ed74.webp&#34;
               width=&#34;760&#34;
               height=&#34;324&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Service Mesh Namespace
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸å‡ºæ‰€æ–™ï¼Œè¿™çœ‹èµ·æ¥éå¸¸è‡ªç„¶ï¼Œè€Œä¸”å¯èƒ½æ˜¯å¤§å¤šæ•°ç”¨æˆ·ä»ç®€å•çš„è§’åº¦æ‰€æœŸæœ›çš„ã€‚åº”ç”¨ç¨‹åºä¿æŒä¸å˜ï¼Œå®ƒä»¬ç»§ç»­ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œé€šä¿¡ï¼Œå°±åƒä»¥å‰é‚£æ ·ã€‚ç†æƒ³çš„æœåŠ¡ç½‘æ ¼æ˜¯ä½œä¸º Linux çš„ä¸€éƒ¨åˆ†é€æ˜åœ°æä¾›çš„ã€‚å®ƒå°±åœ¨é‚£é‡Œï¼Œå°±åƒä»Šå¤©çš„ TCP ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ³¨å…¥-sidecar-çš„æˆæœ¬&#34;&gt;æ³¨å…¥ Sidecar çš„æˆæœ¬&lt;/h3&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹ sidecar æ¨¡å‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒå®é™…ä¸Šæ˜¯åœ¨è¯•å›¾æ¨¡ä»¿è¿™ç§æ¨¡å‹ã€‚åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨å¥—æ¥å­—ï¼Œä¸€åˆ‡éƒ½è¢«å¡è¿› Linux å†…æ ¸çš„ç½‘ç»œå‘½åç©ºé—´ã€‚ç„¶è€Œï¼Œè¿™æ¯”å®ƒçœ‹èµ·æ¥è¦å¤æ‚å¾—å¤šï¼Œéœ€è¦è®¸å¤šé¢å¤–çš„æ­¥éª¤æ¥é€æ˜åœ°æ³¨å…¥ sidecar ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ³¨å…¥-sidecar-çš„æˆæœ¬&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ³¨å…¥ Sidecar çš„æˆæœ¬&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_847fc4ec166d83ad0cc298e00f911b6a.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_a9df07945aba0b0019129964807deb93.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8nu479j31h30u041s_hu6485f23e60e2e8e9568294bae27898e8_131248_847fc4ec166d83ad0cc298e00f911b6a.webp&#34;
               width=&#34;760&#34;
               height=&#34;429&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ³¨å…¥ Sidecar çš„æˆæœ¬
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ç§é¢å¤–çš„å¤æ‚æ€§åœ¨å»¶è¿Ÿå’Œé¢å¤–èµ„æºæ¶ˆè€—æ–¹é¢ä»˜å‡ºäº†å·¨å¤§çš„ä»£ä»·ã€‚æ—©æœŸçš„åŸºå‡†æµ‹è¯•è¡¨æ˜ï¼Œè¿™å¯¹å»¶è¿Ÿçš„å½±å“é«˜è¾¾ 3-4 å€ï¼Œè€Œä¸”æ‰€æœ‰ä»£ç†éƒ½éœ€è¦å¤§é‡çš„é¢å¤–å†…å­˜ã€‚åœ¨è¿™ç¯‡æ–‡ç« çš„åé¢ï¼Œæˆ‘ä»¬å°†ç ”ç©¶è¿™ä¸¤ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å°†å…¶ä¸åŸºäº eBPF çš„æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”¨-ebpf-è§£é”å†…æ ¸æœåŠ¡ç½‘æ ¼&#34;&gt;ç”¨ eBPF è§£é”å†…æ ¸æœåŠ¡ç½‘æ ¼&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»¥å‰æ²¡æœ‰åœ¨å†…æ ¸ä¸­åˆ›å»ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼Ÿæœ‰äº›äººåŠå¼€ç©ç¬‘åœ°è¯´ï¼Œkube-proxy æ˜¯æœ€åˆçš„æœåŠ¡ç½‘æ ¼ï¼ˆè§&lt;a href=&#34;https://www.youtube.com/watch?v=lUF88T16YqY&amp;amp;ab_channel=CloudNativeRejekts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬å·²ç»æ„å»ºäº†ç›¸å½“å¤šçš„æœåŠ¡ç½‘æ ¼ - Tim Hockin, Google&lt;/a&gt;ï¼‰ã€‚è¿™å¥è¯æ˜¯æœ‰ä¸€å®šé“ç†çš„ã€‚Kube-proxy æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜äº† Linux å†…æ ¸åœ¨ä¾é ä¼ ç»Ÿçš„åŸºäºç½‘ç»œçš„ iptables åŠŸèƒ½å®ç°æœåŠ¡ç½‘æ ¼æ—¶ï¼Œå¯ä»¥è¾¾åˆ°å¤šä¹ˆæ¥è¿‘ã€‚ç„¶è€Œï¼Œè¿™è¿˜ä¸å¤Ÿï¼ŒL7 ä¸Šä¸‹æ–‡æ˜¯ç¼ºå¤±çš„ã€‚Kube-proxy å®Œå…¨åœ¨ç½‘ç»œæ•°æ®åŒ…å±‚é¢è¿ä½œã€‚ç°ä»£åº”ç”¨éœ€è¦ L7 æµé‡ç®¡ç†ã€è·Ÿè¸ªã€è®¤è¯å’Œé¢å¤–çš„å¯é æ€§ä¿è¯ã€‚Kube-proxy ä¸èƒ½åœ¨ç½‘ç»œå±‚é¢ä¸Šæä¾›è¿™äº›ã€‚&lt;/p&gt;
&lt;p&gt;eBPF æ”¹å˜äº†è¿™ä¸ªæ¨¡å¼ã€‚å®ƒå…è®¸åŠ¨æ€åœ°æ‰©å±• Linux å†…æ ¸çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ eBPF ä¸º Cilium å»ºç«‹ä¸€ä¸ªé«˜æ•ˆçš„ç½‘ç»œã€å®‰å…¨å’Œå¯è§‚æµ‹æ€§æ•°æ®é€šè·¯ï¼Œå¹¶å°†å…¶ç›´æ¥åµŒå…¥åˆ° Linux å†…æ ¸ã€‚åº”ç”¨è¿™ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å†…æ ¸å±‚é¢ä¸Šè§£å†³æœåŠ¡ç½‘æ ¼çš„è¦æ±‚ã€‚äº‹å®ä¸Šï¼ŒCilium å·²ç»å®ç°äº†å„ç§æ‰€éœ€çš„æ¦‚å¿µï¼Œå¦‚åŸºäºèº«ä»½çš„å®‰å…¨ã€L3-L7 å¯è§‚æµ‹æ€§å’Œæˆæƒã€åŠ å¯†å’Œè´Ÿè½½å‡è¡¡ã€‚ç¼ºå°‘çš„éƒ¨åˆ†ç°åœ¨æ­£åœ¨å‘ Cilium æ¶Œæ¥ã€‚åœ¨æœ¬åšå®¢çš„æœ«å°¾ï¼Œä½ ä¼šå‘ç°å¦‚ä½•åŠ å…¥ç”± Cilium ç¤¾åŒºæ¨åŠ¨çš„ Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•é¡¹ç›®çš„ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ebpf-æœåŠ¡ç½‘æ ¼æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;eBPF æœåŠ¡ç½‘æ ¼æ¶æ„&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o_hu95fbdda1588b2cb70033d94862f03125_148213_242cf49ce50a46a6227b80ac57581596.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o_hu95fbdda1588b2cb70033d94862f03125_148213_e9d578b8cecafb87b52464e52af33848.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o_hu95fbdda1588b2cb70033d94862f03125_148213_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyrufdyj31w90u0q6o_hu95fbdda1588b2cb70033d94862f03125_148213_242cf49ce50a46a6227b80ac57581596.webp&#34;
               width=&#34;760&#34;
               height=&#34;334&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      eBPF æœåŠ¡ç½‘æ ¼æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ‰äººå¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ Linux å†…æ ¸ç¤¾åŒºä¸ç›´æ¥è§£å†³è¿™äº›éœ€æ±‚&lt;/strong&gt;ã€‚eBPF æœ‰ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ï¼ŒeBPF ä»£ç å¯ä»¥åœ¨è¿è¡Œæ—¶æ’å…¥åˆ°ç°æœ‰çš„ Linux å†…æ ¸ä¸­ï¼Œç±»ä¼¼äº Linux å†…æ ¸æ¨¡å—ï¼Œä½†ä¸å†…æ ¸æ¨¡å—ä¸åŒï¼Œå®ƒå¯ä»¥ä»¥å®‰å…¨å’Œå¯ç§»æ¤çš„æ–¹å¼è¿›è¡Œã€‚è¿™ä½¿å¾— eBPF çš„å®ç°èƒ½å¤Ÿéšç€æœåŠ¡ç½‘æ ¼ç¤¾åŒºçš„å‘å±•è€Œç»§ç»­å‘å±•ã€‚&lt;strong&gt;æ–°çš„å†…æ ¸ç‰ˆæœ¬éœ€è¦å‡ å¹´æ—¶é—´æ‰èƒ½è¿›å…¥ç”¨æˆ·æ‰‹ä¸­&lt;/strong&gt;ã€‚eBPF æ˜¯ä¸€é¡¹å…³é”®æŠ€æœ¯ï¼Œå®ƒä½¿ Linux å†…æ ¸èƒ½å¤Ÿè·Ÿä¸Šå¿«é€Ÿå‘å±•çš„äº‘åŸç”ŸæŠ€æœ¯æ ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ— -sidecar-çš„åŸºäº-ebpf-çš„-l7-è¿½è¸ªå’Œåº¦é‡&#34;&gt;æ—  Sidecar çš„åŸºäº eBPF çš„ L7 è¿½è¸ªå’Œåº¦é‡&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹ L7 è¿½è¸ªå’ŒæŒ‡æ ‡å¯è§‚æµ‹æ€§ï¼Œä½œä¸ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œè¯´æ˜åŸºäº eBPF çš„æœåŠ¡ç½‘æ ¼å¯¹ä¿æŒä½å»¶è¿Ÿå’Œæé«˜è§‚å¯Ÿæ€§æœ‰å·¨å¤§çš„å½±å“ã€‚åº”ç”¨ç¨‹åºå›¢é˜Ÿä¾é åº”ç”¨ç¨‹åºçš„å¯è§æ€§å’Œç›‘æ§ä½œä¸ºåŸºæœ¬è¦æ±‚è¿™äº›ï¼Œè¿™åŒ…æ‹¬è¯·æ±‚è·Ÿè¸ªã€HTTP å“åº”ç‡å’ŒæœåŠ¡å»¶è¿Ÿä¿¡æ¯ç­‰èƒ½åŠ›ã€‚ç„¶è€Œï¼Œè¿™ç§å¯è§‚æµ‹æ€§åº”è¯¥æ²¡æœ‰æ˜æ˜¾çš„æˆæœ¬ï¼ˆå»¶è¿Ÿã€å¤æ‚æ€§ã€èµ„æºâ€¦ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäº-ebpf-çš„å¯è§†æ€§&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäº eBPF çš„å¯è§†æ€§&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1_hu62b90eeb5ee5534c340e669e97e0a510_173583_f5ae6a5325dc8e98a65230ef2cdb698d.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1_hu62b90eeb5ee5534c340e669e97e0a510_173583_7c6e37711bde414eb340ad829e2fb56f.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1_hu62b90eeb5ee5534c340e669e97e0a510_173583_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wysxpr4j31ne0iugq1_hu62b90eeb5ee5534c340e669e97e0a510_173583_f5ae6a5325dc8e98a65230ef2cdb698d.webp&#34;
               width=&#34;760&#34;
               height=&#34;241&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäº eBPF çš„å¯è§†æ€§
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—©æœŸçš„æµ‹é‡ç»“æœï¼Œå³é€šè¿‡ eBPF æˆ– sidecar æ–¹æ³•å®ç° HTTP å¯è§æ€§å¯¹å»¶è¿Ÿçš„å½±å“ã€‚è¯¥è®¾ç½®æ˜¯åœ¨ä¸¤ä¸ªä¸åŒèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸¤ä¸ª pod ä¹‹é—´é€šè¿‡å›ºå®šæ•°é‡çš„è¿æ¥æ¯ç§’ç¨³å®šè¿è¡Œ 10K ä¸ª HTTP è¯·æ±‚ï¼Œå¹¶æµ‹é‡è¯·æ±‚çš„å¹³å‡å»¶æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäº-ebpf-çš„å»¶è¿ŸåŸºå‡†æµ‹è¯•-vs-åŸºäº-sidecar-çš„-l7-å¯è§†æ€§&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäº eBPF çš„å»¶è¿ŸåŸºå‡†æµ‹è¯• vs åŸºäº Sidecar çš„ L7 å¯è§†æ€§&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw_hu61d1337f5211a474b2cf5da3f2f69ed3_62404_061d886ef61599a4368a85f4642ecd11.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw_hu61d1337f5211a474b2cf5da3f2f69ed3_62404_af8db5d152499e3be34dcdcef9fa6e43.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw_hu61d1337f5211a474b2cf5da3f2f69ed3_62404_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyt6izdj31ns0rawfw_hu61d1337f5211a474b2cf5da3f2f69ed3_62404_061d886ef61599a4368a85f4642ecd11.webp&#34;
               width=&#34;760&#34;
               height=&#34;347&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäº eBPF çš„å»¶è¿ŸåŸºå‡†æµ‹è¯• vs åŸºäº Sidecar çš„ L7 å¯è§†æ€§
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ•…æ„ä¸æè¿™äº›æµ‹é‡ä¸­ä½¿ç”¨çš„å…·ä½“ä»£ç†ï¼Œå› ä¸ºå®ƒå¹¶ä¸é‡è¦ã€‚å¯¹äºæˆ‘ä»¬æµ‹è¯•è¿‡çš„æ‰€æœ‰ä»£ç†ï¼Œç»“æœå‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¦æ˜ç¡®çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å…³äº Envoyã€Linkerdã€Nginx æˆ–å…¶ä»–ä»£ç†æ˜¯å¦æ›´å¿«ã€‚æ‰€æåˆ°çš„ä»£ç†æœ‰å·®å¼‚ï¼Œä½†ä¸é¦–å…ˆæ³¨å…¥ä»£ç†çš„æˆæœ¬ç›¸æ¯”ï¼Œå®ƒä»¬æ˜¯å¾®ä¸è¶³é“çš„ã€‚&lt;strong&gt;å‡ ä¹æ²¡æœ‰å¼€é”€æ˜¯æ¥è‡ªä»£ç†æœ¬èº«çš„é€»è¾‘ã€‚å¼€é”€æ˜¯é€šè¿‡æ³¨å…¥ä»£ç†ï¼Œå°†ç½‘ç»œæµé‡é‡å®šå‘åˆ°å®ƒï¼Œç»ˆæ­¢è¿æ¥å’Œå¯åŠ¨æ–°çš„è¿æ¥è€Œå¢åŠ çš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™äº›æ—©æœŸçš„æµ‹é‡ç»“æœè¡¨æ˜ï¼ŒåŸºäº eBPF çš„å†…æ ¸æ–¹æ³•æ˜¯éå¸¸æœ‰å‰é€”çš„ï¼Œå¯ä»¥å®ç°å®Œå…¨é€æ˜çš„æœåŠ¡ç½‘æ ¼çš„æ„¿æœ›ï¼Œè€Œä¸”æ²¡æœ‰æ˜æ˜¾çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨-ebpf-åŠ é€Ÿçš„-per-node-ä»£ç†&#34;&gt;ä½¿ç”¨ eBPF åŠ é€Ÿçš„ per-node ä»£ç†&lt;/h2&gt;
&lt;p&gt;è¶Šæ¥è¶Šå¤šçš„ç”¨ä¾‹å¯ä»¥ç”¨è¿™ç§ä»…æœ‰ eBPF çš„æ–¹æ³•æ¥è¦†ç›–ï¼Œä»è€Œå®Œå…¨å–æ¶ˆ L4 ä»£ç†ã€‚æœ‰äº›ç”¨ä¾‹ï¼Œä»ç„¶éœ€è¦ä»£ç†ã€‚ä¾‹å¦‚ï¼Œå½“è¿æ¥éœ€è¦æ‹¼æ¥æ—¶ï¼Œå½“ TLS ç»ˆæ­¢è¢«æ‰§è¡Œæ—¶ï¼Œæˆ–å¯¹äºæŸäº›å½¢å¼çš„ HTTP æˆæƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ eBPF æœåŠ¡ç½‘æ ¼å·¥ä½œå°†ç»§ç»­å…³æ³¨é‚£äº›ä»æ€§èƒ½è§’åº¦å¯ä»¥è·å¾—æœ€å¤§æ”¶ç›Šçš„é¢†åŸŸã€‚å¦‚æœä½ å¿…é¡»æ‰§è¡Œ TLS ç»ˆæ­¢ï¼Œä½ å¯èƒ½ä¸ä»‹æ„åœ¨æµé‡æµå…¥é›†ç¾¤æ—¶ç”¨ä»£ç†ç»ˆæ­¢ä¸€æ¬¡è¿æ¥ã€‚ç„¶è€Œï¼Œä½ ä¼šæ›´å…³å¿ƒåœ¨æ¯ä¸ªè¿æ¥çš„è·¯å¾„ä¸­æ³¨å…¥ä¸¤ä¸ªä»£ç†çš„å½±å“ï¼Œä»¥æå– HTTP æŒ‡æ ‡å’Œè·Ÿè¸ªæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç”¨ä¾‹ä¸èƒ½ç”¨çº¯ eBPF çš„æ–¹æ³•æ¥å®ç°æ—¶ï¼Œç½‘æ ¼å¯ä»¥å›é€€åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ä»£ç†æ¨¡å‹ï¼Œç›´æ¥å°†ä»£ç†ä¸å†…æ ¸çš„å¥—æ¥å­—å±‚ç»“åˆèµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ebpf-per-node-proxy&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;eBPF per-node Proxy&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87_huc33bebe813fd43a8fe56eef115f9fbb4_204555_62d0c958911366c682a9bfc3936f8504.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87_huc33bebe813fd43a8fe56eef115f9fbb4_204555_6f918f3a791f9e1add359ebdd6932d14.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87_huc33bebe813fd43a8fe56eef115f9fbb4_204555_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyvrfmfj31vq0u0q87_huc33bebe813fd43a8fe56eef115f9fbb4_204555_62d0c958911366c682a9bfc3936f8504.webp&#34;
               width=&#34;760&#34;
               height=&#34;337&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      eBPF per-node Proxy
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;eBPF ä¸ä¾èµ–ç½‘ç»œçº§çš„é‡å®šå‘ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å¥—æ¥å­—çº§åˆ«æ³¨å…¥ä»£ç†ï¼Œä¿æŒè·¯å¾„çŸ­ã€‚åœ¨ Cilium çš„æ¡ˆä¾‹ä¸­ï¼Œæ­£åœ¨ä½¿ç”¨ Envoy ä»£ç†ï¼Œå°½ç®¡ä»æ¶æ„çš„è§’åº¦æ¥çœ‹ï¼Œä»»ä½•ä»£ç†éƒ½å¯ä»¥è¢«æ•´åˆåˆ°è¿™ä¸ªæ¨¡å‹ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™å…è®¸å°† Linux å†…æ ¸ç½‘ç»œå‘½åç©ºé—´çš„æ¦‚å¿µç›´æ¥æ‰©å±•åˆ° Envoy ç›‘å¬å™¨é…ç½®çš„æ¦‚å¿µï¼Œå¹¶å°† Envoy å˜æˆä¸€ä¸ªå¤šç”¨æˆ·ä»£ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-ä¸-per-node-ä»£ç†&#34;&gt;Sidecar ä¸ per-Node ä»£ç†&lt;/h2&gt;
&lt;p&gt;å³ä½¿éœ€è¦ä»£ç†ï¼Œä»£ç†çš„æˆæœ¬ä¹Ÿä¼šæ ¹æ®éƒ¨ç½²çš„æ¶æ„è€Œæœ‰æ‰€ä¸åŒã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„ä»£ç†æ¨¡å¼ä¸ sidecar æ¨¡å¼çš„æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¯ä¸ªè¿æ¥çš„ä»£ç†&#34;&gt;æ¯ä¸ªè¿æ¥çš„ä»£ç†&lt;/h3&gt;
&lt;p&gt;æ‰€éœ€çš„ç½‘ç»œè¿æ¥æ•°å°†å› æ˜¯å¦æœ‰ä»£ç†è€Œä¸åŒã€‚æœ€ç®€å•çš„æƒ…å†µæ˜¯æ—  sidecar æ¨¡å¼ï¼Œè¿™æ„å‘³ç€ç½‘ç»œè¿æ¥çš„æ•°é‡æ²¡æœ‰å˜åŒ–ã€‚ä¸€ä¸ªå•ä¸€çš„è¿æ¥å°†ä¸ºè¯·æ±‚æä¾›æœåŠ¡ï¼ŒeBPF å°†æä¾›æœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼Œå¦‚è·Ÿè¸ªæˆ–ç°æœ‰è¿æ¥ä¸Šçš„è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäº-ebpf-çš„æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäº eBPF çš„æ¨¡å‹&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9_hu6485f23e60e2e8e9568294bae27898e8_75684_e7abdef857f749e1da71f7e036064a17.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9_hu6485f23e60e2e8e9568294bae27898e8_75684_ca0b4a28b32d4275c9a964bc89041965.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9_hu6485f23e60e2e8e9568294bae27898e8_75684_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyy16o4j32960kcwg9_hu6485f23e60e2e8e9568294bae27898e8_75684_e7abdef857f749e1da71f7e036064a17.webp&#34;
               width=&#34;760&#34;
               height=&#34;191&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäº eBPF çš„æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”¨ sidecar æ¨¡å‹æä¾›åŒæ ·çš„åŠŸèƒ½éœ€è¦åœ¨è¿æ¥ä¸­æ³¨å…¥ä¸¤æ¬¡ä»£ç†ï¼Œè¿™å¯¼è‡´éœ€è¦ç»´æŠ¤ä¸‰ä¸ªè¿æ¥ã€‚è¿™å¯¼è‡´äº†å¼€é”€çš„å¢åŠ å’Œæ‰€æœ‰é¢å¤–çš„å¥—æ¥å­—ç¼“å†²åŒºæ‰€éœ€å†…å­˜çš„å€å¢ï¼Œè¡¨ç°ä¸ºæ›´é«˜çš„æœåŠ¡é—´å»¶è¿Ÿã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ—  sidecar L7 å¯è§æ€§éƒ¨åˆ†çœ‹åˆ°çš„ sidecar å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åŸºäº-sidecar-ä»£ç†çš„æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åŸºäº Sidecar ä»£ç†çš„æ¨¡å‹&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3_huf6a82c318c1d0879d8dbb2be4a3b19b1_101863_bee2a69eca8646cc0ca7f5dcf09414cb.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3_huf6a82c318c1d0879d8dbb2be4a3b19b1_101863_d98aa97a7180ddb93b2cd137cdae1836.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3_huf6a82c318c1d0879d8dbb2be4a3b19b1_101863_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz3o1f6j32860lego3_huf6a82c318c1d0879d8dbb2be4a3b19b1_101863_bee2a69eca8646cc0ca7f5dcf09414cb.webp&#34;
               width=&#34;760&#34;
               height=&#34;203&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åŸºäº Sidecar ä»£ç†çš„æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åˆ‡æ¢åˆ° per-node çš„ä»£ç†æ¨¡å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‘†è„±å…¶ä¸­ä¸€ä¸ªä»£ç†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†ä¾èµ–åœ¨æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­è¿è¡Œä¸€ä¸ª sidecarã€‚æ¯”èµ·ä¸éœ€è¦é¢å¤–çš„è¿æ¥ï¼Œè¿™è¿˜æ˜¯ä¸å¤Ÿç†æƒ³ï¼Œä½†æ¯”èµ·æ€»æ˜¯éœ€è¦ä¸¤ä¸ªé¢å¤–çš„è¿æ¥è¦å¥½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-per-node-ä»£ç†æ¨¡å¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Per-node ä»£ç†æ¨¡å¼&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz_hu6485f23e60e2e8e9568294bae27898e8_89504_8a54cca8228d7a6a3add627487a6d73b.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz_hu6485f23e60e2e8e9568294bae27898e8_89504_14525a8ea5c80cfded1a8c70b85dae3d.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz_hu6485f23e60e2e8e9568294bae27898e8_89504_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wyx2lulj32980o4dhz_hu6485f23e60e2e8e9568294bae27898e8_89504_8a54cca8228d7a6a3add627487a6d73b.webp&#34;
               width=&#34;760&#34;
               height=&#34;225&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Per-node ä»£ç†æ¨¡å¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ‰€éœ€çš„ä»£ç†æ€»æ•°&#34;&gt;æ‰€éœ€çš„ä»£ç†æ€»æ•°&lt;/h3&gt;
&lt;p&gt;åœ¨æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­è¿è¡Œä¸€ä¸ª sidecar ä¼šå¯¼è‡´å¤§é‡çš„ä»£ç†ã€‚å³ä½¿æ¯ä¸ªå•ç‹¬çš„ä»£ç†å®ä¾‹åœ¨å…¶å†…å­˜å ç”¨æ–¹é¢æ˜¯ç›¸å½“ä¼˜åŒ–çš„ï¼Œä½†å®ä¾‹çš„æ•°é‡ä¹‹å¤šå°†å¯¼è‡´æ€»çš„å½±å“å¾ˆå¤§ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªä»£ç†ç»´æŠ¤çš„æ•°æ®ç»“æ„ï¼Œå¦‚è·¯ç”±å’Œç«¯ç‚¹è¡¨ï¼Œéšç€é›†ç¾¤çš„å¢é•¿è€Œå¢é•¿ï¼Œæ‰€ä»¥é›†ç¾¤è¶Šå¤§ï¼Œæ¯ä¸ªä»£ç†çš„å†…å­˜æ¶ˆè€—å°±è¶Šé«˜ã€‚ä»Šå¤©ï¼Œä¸€äº›æœåŠ¡ç½‘æ ¼è¯•å›¾é€šè¿‡å°†éƒ¨åˆ†è·¯ç”±è¡¨æ¨é€ç»™å•ä¸ªä»£ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™åˆ¶å®ƒä»¬å¯ä»¥è·¯ç”±åˆ°å“ªé‡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ä»£ç†æ•°é‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ä»£ç†æ•°é‡&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n_hu6485f23e60e2e8e9568294bae27898e8_147190_e5e6f2c7d1de4f5108e2f0c65c63633b.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n_hu6485f23e60e2e8e9568294bae27898e8_147190_2648ed10ae21eaef48205e7b5665caec.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n_hu6485f23e60e2e8e9568294bae27898e8_147190_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7y8synvej31z40oiq6n_hu6485f23e60e2e8e9568294bae27898e8_147190_e5e6f2c7d1de4f5108e2f0c65c63633b.webp&#34;
               width=&#34;760&#34;
               height=&#34;262&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ä»£ç†æ•°é‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å‡è®¾åœ¨ä¸€ä¸ª 500 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ 30 ä¸ª podï¼Œä¸€ä¸ªåŸºäº sidecar çš„æ¶æ„å°†éœ€è¦è¿è¡Œ 15K ä¸ªä»£ç†ã€‚åœ¨æ¯ä¸ªä»£ç†æ¶ˆè€— 70MB å†…å­˜çš„æƒ…å†µä¸‹ï¼ˆå‡è®¾å·²ç»ç»è¿‡æè‡´ä¼˜åŒ–è¿‡çš„è·¯ç”±è¡¨ï¼‰ï¼Œè¿™ä»ç„¶å¯¼è‡´é›†ç¾¤ä¸­æ‰€æœ‰ sidecar æ¶ˆè€— 1.5TB çš„å†…å­˜ã€‚åœ¨ per-node æ¨¡å‹ä¸­ï¼Œå‡è®¾æ¯ä¸ªä»£ç†çš„å†…å­˜è¶³è¿¹ç›¸åŒï¼Œ500 ä¸ªä»£ç†å°†æ¶ˆè€—ä¸è¶…è¿‡ 34GB çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤šç§Ÿæˆ·&#34;&gt;å¤šç§Ÿæˆ·&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬ä» sidecar æ¨¡å‹è½¬å‘ per-node æ¨¡å‹æ—¶ï¼Œä»£ç†å°†ä¸ºå¤šä¸ªåº”ç”¨ç¨‹åºæä¾›è¿æ¥ã€‚ä»£ç†å¿…é¡»å…·æœ‰å¤šç§Ÿæˆ·æ„ŸçŸ¥ã€‚è¿™ä¸æˆ‘ä»¬ä»ä½¿ç”¨å•ä¸ªè™šæ‹Ÿæœºè½¬å‘ä½¿ç”¨å®¹å™¨æ—¶å‘ç”Ÿçš„è¿‡æ¸¡å®Œå…¨ç›¸åŒã€‚ç”±äºæˆ‘ä»¬ä¸å†ä½¿ç”¨åœ¨æ¯ä¸ªè™šæ‹Ÿæœºä¸­è¿è¡Œçš„å®Œå…¨ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿå‰¯æœ¬ï¼Œè€Œå¼€å§‹ä¸å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«æ“ä½œç³»ç»Ÿï¼ŒLinux å¿…é¡»å…·æœ‰å¤šç§Ÿæˆ·æ„ŸçŸ¥ã€‚è¿™å°±æ˜¯å‘½åç©ºé—´å’Œ cgroup å­˜åœ¨çš„åŸå› ã€‚å¦‚æœæ²¡æœ‰å®ƒä»¬ï¼Œä¸€ä¸ªå®¹å™¨å¯èƒ½ä¼šæ¶ˆè€—ä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰èµ„æºï¼Œå®¹å™¨å¯èƒ½ä¼šä»¥ä¸å—æ§åˆ¶çš„æ–¹å¼è®¿é—®å¯¹æ–¹çš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-envoy-namespace&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Envoy Namespace&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs_hu1685d2cc6375f0429462180152f17634_156084_0202d25a062eeb6c9bd0f4c364e01907.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs_hu1685d2cc6375f0429462180152f17634_156084_2f64eeb1fa64882906103c2cdc01534e.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs_hu1685d2cc6375f0429462180152f17634_156084_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7z3klyfhj31hx0u0djs_hu1685d2cc6375f0429462180152f17634_156084_0202d25a062eeb6c9bd0f4c364e01907.webp&#34;
               width=&#34;760&#34;
               height=&#34;423&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Envoy Namespace
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿™åœ¨æœåŠ¡ç½‘æ ¼çº§åˆ«çš„ç½‘ç»œèµ„æºä¸Šè¡¨ç°å¾—å®Œå…¨ä¸€æ ·ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼ŸEnvoy å·²ç»æœ‰äº†å‘½åç©ºé—´çš„åˆæ­¥æ¦‚å¿µï¼Œå®ƒä»¬è¢«ç§°ä¸ºç›‘å¬å™¨ã€‚ç›‘å¬å™¨å¯ä»¥æºå¸¦å•ç‹¬çš„é…ç½®å¹¶ç‹¬ç«‹è¿è¡Œã€‚è¿™å°†å¼€å¯å…¨æ–°çš„å¯èƒ½æ€§ï¼šçªç„¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ§åˆ¶èµ„æºæ¶ˆè€—ï¼Œå»ºç«‹å…¬å¹³çš„æ’é˜Ÿè§„åˆ™ï¼Œå¹¶å°†å¯ç”¨çš„èµ„æºå¹³ç­‰åœ°åˆ†é…ç»™æ‰€æœ‰çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è€…æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™åˆ†é…ã€‚è¿™å¯ä»¥è€Œä¸”åº”è¯¥ä¸æˆ‘ä»¬ä»Šå¤©åœ¨ Kubernetes ä¸­å®šä¹‰åº”ç”¨ç¨‹åºçš„ CPU å’Œå†…å­˜çº¦æŸçš„æ–¹å¼å®Œå…¨ä¸€æ ·ã€‚å¦‚æœä½ æƒ³äº†è§£è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘æ›¾åœ¨ EnvoyCon ä¸Šè®²è¿‡è¿™ä¸ªé—®é¢˜ï¼ˆ&lt;a href=&#34;https://www.youtube.com/watch?v=08opgZkdYIw&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Namespace - ä»¥æ›´å°çš„ä»£ä»·è¿ç»´åŸºäº Envoy çš„æœåŠ¡ç½‘æ ¼ï¼ŒThomas Grafï¼ŒEnvoyCon 2019&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æƒ³å‚ä¸å…¶ä¸­å—--åŠ å…¥-cilium-æœåŠ¡ç½‘æ ¼æµ‹è¯•ç‰ˆ&#34;&gt;æƒ³å‚ä¸å…¶ä¸­å—ï¼Ÿ- åŠ å…¥ Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•ç‰ˆ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµ‹è¯•ç‰ˆ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµ‹è¯•ç‰ˆ&#34; srcset=&#34;
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm_hu6485f23e60e2e8e9568294bae27898e8_186816_9579dd5154dfdfe8956fce6548befa07.webp 400w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm_hu6485f23e60e2e8e9568294bae27898e8_186816_8b798598a3603599a1424b953b9574d1.webp 760w,
               /translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm_hu6485f23e60e2e8e9568294bae27898e8_186816_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/ebpf-solve-service-mesh-sidecar/008i3skNly1gx7wz1obexj327t0u0dkm_hu6485f23e60e2e8e9568294bae27898e8_186816_9579dd5154dfdfe8956fce6548befa07.webp&#34;
               width=&#34;760&#34;
               height=&#34;286&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµ‹è¯•ç‰ˆ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¼´éšç€å³å°†å‘å¸ƒçš„ Cilium 1.11 ç‰ˆæœ¬ï¼ŒCilium ç¤¾åŒºæ­£åœ¨ä¸¾åŠä¸€ä¸ªæ–°çš„ Cilium Service Mesh æµ‹è¯•è®¡åˆ’ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä¸€ä¸ªæ–°çš„æ„å»ºï¼Œå°†ä½¿ä»¥ä¸‹åŠŸèƒ½å¯ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;L7 æµé‡ç®¡ç†å’Œè´Ÿè½½å‡è¡¡ï¼ˆHTTPï¼ŒgRPCï¼Œâ€¦ï¼‰&lt;/li&gt;
&lt;li&gt;è·¨é›†ç¾¤ã€äº‘å’Œé›†ç¾¤çš„æ‹“æ‰‘æ„ŸçŸ¥è·¯ç”±&lt;/li&gt;
&lt;li&gt;TLS ç»ˆæ­¢&lt;/li&gt;
&lt;li&gt;é€šè¿‡ Envoy é…ç½®çš„é‡‘ä¸é›€å‘å¸ƒã€é‡è¯•ã€é€Ÿç‡é™åˆ¶ã€æ–­è·¯ç­‰&lt;/li&gt;
&lt;li&gt;ç”¨ OpenTelemetry å’Œ Jaeger é›†æˆè¿›è¡Œè¿½è¸ª&lt;/li&gt;
&lt;li&gt;å†…ç½® Kubernetes Ingress æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šè¿°æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/cilium/cilium&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/cilium/cilium&lt;/a&gt; åŠŸèƒ½åˆ†æ”¯ä¸­æ‰¾åˆ°ã€‚æµ‹è¯•è®¡åˆ’å…è®¸ Cilium ç»´æŠ¤è€…ç›´æ¥ä¸ç”¨æˆ·æ¥è§¦ï¼Œäº†è§£ä»–ä»¬çš„éœ€æ±‚ã€‚è¦æ³¨å†Œï¼Œä½ å¯ä»¥ç›´æ¥å¡«å†™ &lt;a href=&#34;https://forms.gle/j9fwhAC6HnHRJQKeA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ªè¡¨æ ¼&lt;/a&gt;ï¼Œæˆ–è€…ä½ å¯ä»¥åœ¨ Cilium ç¤¾åŒºçš„&lt;a href=&#34;https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¬å‘Š&lt;/a&gt;ä¸­é˜…è¯»æ›´å¤šå…³äºè¯¥è®¡åˆ’çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;eBPF æ˜¯æä¾›æœ¬åœ°å’Œé«˜æ•ˆçš„æœåŠ¡ç½‘æ ¼å®ç°çš„ç­”æ¡ˆã€‚å®ƒå°†æŠŠæˆ‘ä»¬ä» sidecar æ¨¡å‹ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¹¶å…è®¸å°†ç°æœ‰çš„ä»£ç†æŠ€æœ¯æ•´åˆåˆ°ç°æœ‰çš„å†…æ ¸å‘½åæ¦‚å¿µä¸­ï¼Œä½¿å®ƒä»¬æˆä¸ºæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„å®¹å™¨æŠ½è±¡çš„ä¸€éƒ¨åˆ†ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒeBPF å°†èƒ½å¤Ÿå¸è½½è¶Šæ¥è¶Šå¤šçš„ç›®å‰ç”±ä»£ç†æ‰§è¡Œçš„åŠŸèƒ½ï¼Œä»¥è¿›ä¸€æ­¥å‡å°‘å¼€é”€å’Œå¤æ‚æ€§ã€‚é€šè¿‡æ•´åˆå‡ ä¹ä»»ä½•ç°æœ‰çš„ä»£ç†ï¼Œè¯¥æ¶æ„ä¹Ÿå…è®¸ä¸å¤§å¤šæ•°ç°æœ‰çš„æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ï¼ˆIstioã€SMIã€Linkerdâ€¦ï¼‰æ•´åˆã€‚è¿™å¯ä»¥å°† eBPF çš„å¥½å¤„æä¾›ç»™å¹¿å¤§çš„ç»ˆç«¯ç”¨æˆ·ï¼ŒåŒæ—¶å°†æ•°æ®é€šè·¯çš„æ•ˆç‡å’Œå¼€é”€çš„è®¨è®ºä¸æ§åˆ¶å¹³é¢æ–¹é¢ç›¸åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æœ‰å…´è¶£æ¢ç´¢è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘ä»¬å¾ˆæƒ³å¬åˆ°ä½ çš„æ„è§ã€‚è¯·éšæ—¶é€šè¿‡ &lt;a href=&#34;https://twitter.com/tgraf__&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt; æˆ– &lt;a href=&#34;http://ebpf.io/slack&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF &amp;amp; Cilium Slack è”ç³»æˆ‘ä»¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ä¸€æ­¥é˜…è¯»&#34;&gt;è¿›ä¸€æ­¥é˜…è¯»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://lib.jimmysong.io/blog/how-ebpf-streamlines-the-service-mesh/&#34;&gt;eBPF å¦‚ä½•ç®€åŒ–æœåŠ¡ç½‘æ ¼&lt;/a&gt;ï¼ŒLiz Riceï¼ŒThe New Stack&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium æœåŠ¡ç½‘æ ¼æµ‹è¯•è®¡åˆ’&lt;/a&gt;ï¼ŒCilium ç¤¾åŒº&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cilium.io/learn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº†è§£æ›´å¤šå…³äº Cilium çš„ä¿¡æ¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Istio 1.12 å¼•å…¥ Wasm æ’ä»¶é…ç½® API ç”¨äºæ‰©å±• Istio ç”Ÿæ€</title>
      <link>https://lib.jimmysong.io/translation/istio-wasm-extensions-and-ecosystem/</link>
      <pubDate>Wed, 24 Nov 2021 18:03:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/istio-wasm-extensions-and-ecosystem/</guid>
      <description>&lt;p&gt;Istio 1.12 ä¸­æ–°çš„ WebAssembly åŸºç¡€è®¾æ–½ä½¿å…¶èƒ½å¤Ÿè½»æ¾åœ°å°†é¢å¤–çš„åŠŸèƒ½æ³¨å…¥ç½‘æ ¼éƒ¨ç½²ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸‰å¹´çš„åŠªåŠ›ï¼ŒIstio ç°åœ¨æœ‰äº†ä¸€ä¸ªå¼ºå¤§çš„æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰å’Œç¬¬ä¸‰æ–¹ Wasm æ¨¡å—æ·»åŠ åˆ°ç½‘æ ¼ä¸­çš„ sidecarã€‚Tetrate å·¥ç¨‹å¸ˆ&lt;a href=&#34;https://github.com/mathetake&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç±³ç”°æ­¦ï¼ˆTakeshi Yonedaï¼‰&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/lizan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘¨ç¤¼èµï¼ˆLizan Zhouï¼‰&lt;/a&gt;åœ¨å®ç°è¿™ä¸€ç›®æ ‡æ–¹é¢å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚è¿™ç¯‡æ–‡ç« å°†ä»‹ç» Istio ä¸­ Wasm çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Œç„¶åæ˜¯å…³äºå»ºç«‹è‡ªå·±çš„ Wasm æ’ä»¶å¹¶å°†å…¶éƒ¨ç½²åˆ°ç½‘æ ¼çš„ç®€çŸ­æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆ-istio-ä¸­çš„-wasm-å¾ˆé‡è¦&#34;&gt;ä¸ºä»€ä¹ˆ Istio ä¸­çš„ Wasm å¾ˆé‡è¦&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ Wasmï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å®¹æ˜“çš„æ‰©å±•ç½‘æ ¼å’Œç½‘å…³ã€‚åœ¨ Tetrateï¼Œæˆ‘ä»¬ç›¸ä¿¡è¿™é¡¹æŠ€æœ¯æ­£åœ¨è¿…é€Ÿæˆç†Ÿï¼Œå› æ­¤æˆ‘ä»¬ä¸€ç›´åœ¨æŠ•èµ„ä¸Šæ¸¸çš„ Istioï¼Œä½¿é…ç½® APIã€åˆ†å‘æœºåˆ¶å’Œä» Go å¼€å§‹çš„å¯æ‰©å±•æ€§ä½“éªŒæ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™å°†ä½¿ Istio æœ‰ä¸€ä¸ªå…¨æ–°çš„æ–¹å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ‰ä½•æœŸå¾…æ–°çš„æ’ä»¶é…ç½®-apiå¯é çš„è·å–å’Œå®‰è£…æœºåˆ¶&#34;&gt;æœ‰ä½•æœŸå¾…ï¼šæ–°çš„æ’ä»¶é…ç½® APIï¼Œå¯é çš„è·å–å’Œå®‰è£…æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªæ–°çš„é¡¶çº§ APIï¼Œå«åš &lt;a href=&#34;https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WasmPlugin&lt;/a&gt;ï¼Œå¯ä»¥è®©ä½ é…ç½®è¦å®‰è£…å“ªäº›æ’ä»¶ï¼Œä»å“ªé‡Œè·å–å®ƒä»¬ï¼ˆOCI é•œåƒã€å®¹å™¨æœ¬åœ°æ–‡ä»¶æˆ–è¿œç¨‹ HTTP èµ„æºï¼‰ï¼Œåœ¨å“ªé‡Œå®‰è£…å®ƒä»¬ï¼ˆé€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/type/workload-selector/#WorkloadSelector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Workload é€‰æ‹©å™¨&lt;/a&gt;ï¼‰ï¼Œä»¥åŠä¸€ä¸ªé…ç½®ç»“æ„ä½“æ¥ä¼ é€’ç»™æ’ä»¶å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;istio-agent ä¸­çš„é•œåƒæå–æœºåˆ¶ï¼ˆåœ¨ Istio 1.9 ä¸­å¼•å…¥ï¼‰ï¼Œä»è¿œç¨‹ HTTP æºå¯é åœ°æ£€ç´¢ Wasm äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå·²è¢«æ‰©å±•åˆ°æ”¯æŒä»ä»»ä½• OCI æ³¨å†Œå¤„æ£€ç´¢ Wasm OCI é•œåƒï¼ŒåŒ…æ‹¬ Docker Hubã€Google Container Registryï¼ˆGCRï¼‰ã€Amazon Elastic Container Registryï¼ˆAmazon ECRï¼‰å’Œå…¶ä»–åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„ Wasm æ’ä»¶ï¼Œæˆ–è€…ä»ä»»ä½•æ³¨å†Œå¤„é€‰æ‹©ç°æˆçš„æ’ä»¶ï¼Œåªéœ€å‡ è¡Œé…ç½®å°±å¯ä»¥æ‰©å±• Istio çš„åŠŸèƒ½ã€‚Istio ä¼šåœ¨å¹•ååšæ‰€æœ‰çš„å·¥ä½œï¼Œä¸ºä½ è·å–ã€éªŒè¯ã€å®‰è£…å’Œé…ç½®å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;istio-wasm-æ‰©å±•&#34;&gt;Istio Wasm æ‰©å±•&lt;/h2&gt;
&lt;p&gt;Istio çš„æ‰©å±•æœºåˆ¶ä½¿ç”¨ &lt;a href=&#34;https://github.com/proxy-wasm/spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxy-Wasm åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰&lt;/a&gt;è§„èŒƒï¼Œè¯¥è§„èŒƒç”±å‘¨ç¤¼èµå’Œç±³ç”°æ­¦å¸¦å¤´åˆ¶å®šï¼Œæä¾›äº†ä¸€å¥—ä»£ç†æ— å…³çš„æµåª’ä½“ API å’Œå®ç”¨åŠŸèƒ½ï¼Œå¯ä»¥ç”¨ä»»ä½•æœ‰åˆé€‚ SDK çš„è¯­è¨€æ¥å®ç°ã€‚æˆªè‡³ç›®å‰ï¼ŒProxy-Wasm çš„ SDK æœ‰ AssemblyScriptï¼ˆç±»ä¼¼ TypeScriptï¼‰ã€C++ã€Rustã€Zig å’Œ Goï¼ˆä½¿ç”¨ TinyGo WebAssembly ç³»ç»Ÿæ¥å£ã€ŒWASIã€ï¼Œç±³ç”°æ­¦ä¹Ÿæ˜¯å…¶ä¸»è¦è´¡çŒ®è€…ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•è·å–tetrate-istio-distro&#34;&gt;å¦‚ä½•è·å–ï¼šTetrate Istio Distro&lt;/h2&gt;
&lt;p&gt;è·å¾— Istio çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Tetrate çš„å¼€æº &lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;get-mesh&lt;/code&gt; CLI å’Œ Tetrate Istio Distro&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•ã€å®‰å…¨çš„ä¸Šæ¸¸ Istio çš„ä¼ä¸šçº§å‘è¡Œç‰ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;wasm-å®æˆ˜æ„å»ºä½ è‡ªå·±çš„é€Ÿç‡é™åˆ¶-webassembly-æ’ä»¶&#34;&gt;Wasm å®æˆ˜ï¼šæ„å»ºä½ è‡ªå·±çš„é€Ÿç‡é™åˆ¶ WebAssembly æ’ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ä¹‹å‰å…³äº &lt;a href=&#34;https://www.tetrate.io/blog/wasm-modules-and-envoy-extensibility-explained-part-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­çš„ Wasm æ‰©å±•&lt;/a&gt;çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•å¼€å‘ WebAssembly æ’ä»¶æ¥å¢å¼ºæœåŠ¡ç½‘æ ¼çš„èƒ½åŠ›ã€‚æ–°çš„ Wasm æ‰©å±• API è®©å®ƒå˜å¾—æ›´åŠ ç®€å•ã€‚æœ¬æ•™ç¨‹å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ Istio Wasm æ‰©å±• API æ¥å®ç° Golang ä¸­çš„é€Ÿç‡é™åˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰ &lt;a href=&#34;https://www.tetrate.io/blog/wasm-modules-and-envoy-extensibility-explained-part-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio å’Œ Envoy ä¸­çš„ Wasm&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®‰è£… &lt;a href=&#34;https://tinygo.org/getting-started/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TinyGo 0.21.0&lt;/a&gt; å¹¶ä½¿ç”¨ Golang æ„å»º Wasm æ‰©å±•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¯´æ˜&#34;&gt;è¯´æ˜&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼ˆsleep å’Œ httpbinï¼‰ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªå®¹å™¨å‘å¦ä¸€ä¸ªå®¹å™¨å‘é€å‡ ä¸ªè¯·æ±‚ï¼Œè€Œä¸éƒ¨ç½²ä»»ä½• Wasm æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ Go ä¸­åˆ›å»ºä¸€ä¸ª Wasm æ¨¡å—ï¼Œä¸ºå“åº”æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å¤´ï¼Œå¹¶æ‹’ç»ä»»ä½•è¯·æ±‚ç‡è¶…è¿‡æ¯ç§’ä¸¤ä¸ªçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æŠŠ Wasm æ¨¡å—æ¨é€åˆ° Docker é•œåƒä»“åº“ï¼Œå¹¶ä½¿ç”¨æ–°çš„ WasmPlugin èµ„æºï¼Œå‘Šè¯‰ Istio ä»å“ªé‡Œä¸‹è½½ Wasm æ¨¡å—ï¼Œä»¥åŠå°†è¯¥æ¨¡å—åº”ç”¨äºå“ªäº›å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-1-æ­¥å®‰è£…-istio-å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åº&#34;&gt;ç¬¬ 1 æ­¥ï¼šå®‰è£… Istio å¹¶éƒ¨ç½²åº”ç”¨ç¨‹åº&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸‹è½½å¹¶å®‰è£… Istio 1.12ï¼Œå¹¶æ ‡è®° Kubernetes çš„ default å‘½åç©ºé—´ï¼Œä»¥ä¾¿è‡ªåŠ¨æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -L https://git.io/getLatestIstio &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ISTIO_VERSION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1.12 sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; istio-1.12/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./bin/istioctl install --set &lt;span class=&#34;nv&#34;&gt;profile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;demo -y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace default istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled --overwrite
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†éƒ¨ç½² httpbin å’Œ sleep åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/httpbin/httpbin.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f samples/sleep/sleep.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨ç¨‹åºéƒ¨ç½²å¹¶è¿è¡Œåï¼Œæˆ‘ä»¬å°†æ¯ç§’ä» &lt;strong&gt;sleep&lt;/strong&gt; å®¹å™¨å‘ &lt;strong&gt;httpbin&lt;/strong&gt; å®¹å™¨å‘é€ 4 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;for i in $(seq 1 3); do curl --head -s httpbin:8000/headers; sleep 0.25; done&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:18:32 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¼šå‘ç°æ‰€æœ‰çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œå¹¶è¿”å›äº† HTTP 200ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-2-æ­¥å¼€å‘ç¼–è¯‘å’Œæ¨é€-wasm-æ¨¡å—&#34;&gt;ç¬¬ 2 æ­¥ï¼šå¼€å‘ã€ç¼–è¯‘å’Œæ¨é€ Wasm æ¨¡å—&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ Golang å’Œ Proxy Wasm Golang SDK æ¥å¼€å‘ Wasm æ¨¡å—ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ SDK èµ„æºåº“ä¸­çš„ä¸€ä¸ªç°æœ‰ä¾‹å­ï¼Œå«åš istio-rate-limitingã€‚è¦å¼€å§‹ï¼Œè¯·å…ˆå…‹éš† Github ä»“åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/tetratelabs/wasm-rate-limiting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; wasm-rate-limiting/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code&gt;main.go&lt;/code&gt; ä¸­çš„ä»£ç ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ Proxy Wasm Golang SDK å®ç°é€Ÿç‡é™åˆ¶é€»è¾‘çš„åœ°æ–¹ã€‚Wasm æ¨¡å—åšäº†ä¸¤ä»¶äº‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å“åº”ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å¤´ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ 2 ä¸ªè¯·æ±‚ / ç§’çš„é€Ÿç‡é™åˆ¶ï¼Œæ‹’ç»è¶…é¢çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ &lt;code&gt;main.go&lt;/code&gt; çš„ç‰‡æ®µï¼Œæ˜¾ç¤ºäº†åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Modify the header
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpResponseHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numHeaders&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endOfStream&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;additionalHeaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddHttpResponseHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Perform rate limiting
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OnHttpRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;UnixNano&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// We use nanoseconds() rather than time.Second() because the proxy-wasm has the known limitation.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// TODO(incfly): change to time.Second() once https://github.com/proxy-wasm/proxy-wasm-cpp-host/issues/199
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// is resolved and released.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1e9&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogCriticalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Current time %v, last refill time %v, the remain token %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;current&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastRefillNanoSec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SendHttpResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;403&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;powered-by&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;proxy-wasm-go-sdk!!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;rate limited, wait and retry.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogErrorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to send local response: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;proxywasm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ResumeHttpRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionPause&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pluginContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;remainToken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;types&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ActionContinue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;OnHttpResponseHeaders&lt;/code&gt; å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è¿­ä»£ &lt;code&gt;extraHeaders&lt;/code&gt; å˜é‡ï¼Œå¹¶å°†å¤´æ–‡ä»¶æ·»åŠ åˆ°å“åº”ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;OnHttpRequestHeaders&lt;/code&gt; å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°å½“å‰çš„æ—¶é—´æˆ³ï¼Œå°†å…¶ä¸æœ€åä¸€æ¬¡è¡¥ç»™æ—¶é—´çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼ˆå¯¹äºé€Ÿç‡é™åˆ¶å™¨ï¼‰ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå°±è¡¥ç»™ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å‰©ä½™çš„ä»¤ç‰Œï¼Œæˆ‘ä»¬å°±å‘é€ä¸€ä¸ªå¸¦æœ‰é¢å¤–å¤´çš„ 403 å“åº”ï¼ˆ&lt;strong&gt;ç”±ï¼šproxy-wasm-go-sdkï¼ï¼&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨ tinygo å°† Golang ç¨‹åºç¼–è¯‘æˆ Wasm æ¨¡å—ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tinygo build -o main.wasm -scheduler&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;none -target&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;wasi main.go
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ„å»ºä¸€ä¸ª Docker é•œåƒï¼Œå¹¶å°†å…¶æ¨é€åˆ°é•œåƒä»“åº“ï¼ˆç”¨ä½ è‡ªå·±çš„ Docker é•œåƒä»“åº“å’Œé•œåƒåç§°æ›¿æ¢ &lt;code&gt;${YOUR_DOCKER_REGISTRY_IMAGE}&lt;/code&gt;ï¼‰ã€‚åœ¨è¿™ä¹‹åï¼Œä½ çš„ Wasm æ’ä»¶å°±å¯ä»¥åœ¨ä½ çš„æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;YOUR_DOCKER_REGISTRY_IMAGE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker push -t &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;YOUR_DOCKER_REGISTRY_IMAGE&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:v1 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé¢„æ„å»ºçš„ Docker é•œåƒï¼Œå®ƒæœ‰ç›¸åŒçš„ä»£ç ï¼Œä½äº &lt;a href=&#34;http://ghcr.io/tetratelabs/wasm-rate-limiting:v1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ghcr.io/tetratelabs/wasm-rate-limiting:v1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-3-æ­¥é…ç½®-istio-wasm-æ‰©å±•-api&#34;&gt;ç¬¬ 3 æ­¥ï¼šé…ç½® Istio Wasm æ‰©å±• API&lt;/h3&gt;
&lt;p&gt;Istio Wasm Extension API å’Œæ–°çš„ WasmPlugin èµ„æºå…è®¸æˆ‘ä»¬å°†æˆ‘ä»¬æ¨é€åˆ° Docker é•œåƒä»“åº“çš„é€Ÿç‡é™åˆ¶ Wasm æ¨¡å—æ·»åŠ åˆ° httpbin å·¥ä½œè´Ÿè½½ä¸­ã€‚ä¸‹é¢æ˜¯ WasmPlugin èµ„æºçš„ YAML é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WasmPlugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin-rate-limiting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;oci://ghcr.io/tetratelabs/wasm-rate-limiting:v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªé…ç½®éƒ¨ç½²åï¼ŒIstiod å°±ä¼šæŠŠç›¸åº”çš„é…ç½®æ¨é€åˆ° Envoy sidecarï¼ˆä¸æˆ‘ä»¬åœ¨ &lt;code&gt;matchLabels&lt;/code&gt; å­—æ®µä¸­æŒ‡å®šçš„æ ‡ç­¾ç›¸åŒ¹é…çš„é‚£äº›ï¼‰ã€‚Sidecar ä¸­çš„ Istio ä»£ç†å°†æ‰§è¡Œè¿œç¨‹è·å–ï¼Œä¸‹è½½æˆ‘ä»¬åˆšåˆšæ¨é€çš„ Wasm æ¨¡å—ï¼Œç„¶åå°†å…¶åŠ è½½åˆ° Envoy è¿è¡Œæ—¶çš„ Wasm å¼•æ“ä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æŠŠä¸Šè¿° YAML ä¿å­˜ä¸º wasm.yamlï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ./wasm.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wasmplugin.extensions.istio.io/httpbin-rate-limiting created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬-4-æ­¥éªŒè¯é€Ÿç‡é™åˆ¶çš„æ•ˆæœ&#34;&gt;ç¬¬ 4 æ­¥ï¼šéªŒè¯é€Ÿç‡é™åˆ¶çš„æ•ˆæœ&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬éƒ¨ç½²äº† WasmPlugin èµ„æºå’Œ Istio ä»æ³¨å†Œè¡¨ä¸­è·å–äº† Wasm æ¨¡å—åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥éªŒè¯ Wasm æ’ä»¶ä¸­å®ç°çš„é€Ÿç‡é™åˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sleep -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;={&lt;/span&gt;.items..metadata.name&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;SLEEP_POD&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -c sleep -- sh -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;for i in $(seq 1 3); do curl --head -s httpbin:8000/headers; sleep 0.25; done&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:34 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;523&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-origin: *
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;access-control-allow-credentials: &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;powered-by: proxy-wasm-go-sdk!!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-length: &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;content-type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;who-am-i: wasm-extension
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;injected-by: istio-api!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: Tue, &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 22:16:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server: envoy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x-envoy-upstream-service-time: &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±åƒä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä» sleep å®¹å™¨å‘ httpbin å®¹å™¨å‘é€ 3 ä¸ªè¯·æ±‚ã€‚è¿™ä¸€æ¬¡ï¼ŒWasm æ’ä»¶ä»£ç è¢«æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è¾“å‡ºä¸­çš„ä¸€äº›å·®å¼‚ã€‚é¦–å…ˆï¼Œ&lt;code&gt;who-am-i&lt;/code&gt; å¤´è¢« Wasm æ’ä»¶æ³¨å…¥äº†ã€‚å‰ä¸¤ä¸ªè¯·æ±‚ä»¥ HTTP 200 çš„å“åº”ä»£ç æˆåŠŸï¼Œå‰©ä¸‹çš„è¯·æ±‚åˆ™ä»¥ HTTP 429 å¤±è´¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ä¸€ä¸ªåä¸º &lt;code&gt;powered-by&lt;/code&gt; çš„é¢å¤–å¤´ï¼Œå®ƒä¹Ÿè¢« Wasm æ’ä»¶æ³¨å…¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•™ç¨‹æ‘˜è¦&#34;&gt;æ•™ç¨‹æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œæœ¬æ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•è½»æ¾å®ç°æ’ä»¶åŠŸèƒ½ï¼Œä»¥æ‰©å±• Istio çš„åŠŸèƒ½ï¼Œæ»¡è¶³ä½ çš„ç‰¹å®šéœ€æ±‚ã€‚è¿™éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ Golang ä¸­å®ç°ä½ çš„æ’ä»¶åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘ã€æ„å»ºï¼Œå¹¶å°† Wasm æ¨¡å—æ¨é€åˆ°ç¬¦åˆ OCI æ ‡å‡†çš„ Docker é•œåƒä»“åº“ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ WasmPlugin èµ„æºé…ç½®æœåŠ¡ç½‘æ ¼å·¥ä½œè´Ÿè½½ï¼Œä»¥ä¾¿ä»è¿œç¨‹é•œåƒä»“åº“ä¸­æ‹‰å– Wasm æ¨¡å—ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯¥æ•™ç¨‹å®ç°äº†ä¸€ä¸ªå•ä¸€çš„ Wasm æ’ä»¶æ¥å¤„ç† HTTP è¯·æ±‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯ä»¥æœ‰å¤šä¸ª Wasm æ’ä»¶ï¼Œæ¯ä¸ªå•ç‹¬çš„æ’ä»¶è´Ÿè´£æŸä¸€éƒ¨åˆ†çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://github.com/istio/api/blob/master/extensions/v1alpha1/wasm.proto#L254&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AUTHN&lt;/a&gt; é˜¶æ®µçš„ä¸€ä¸ªæ’ä»¶è·å–æˆ–éªŒè¯è®¤è¯å‡­è¯ï¼›&lt;a href=&#34;https://github.com/istio/api/blob/master/extensions/v1alpha1/wasm.proto#L257&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AUTHZ&lt;/a&gt; é˜¶æ®µçš„å¦ä¸€ä¸ªæ’ä»¶å®ç°ä½ è‡ªå·±å®šåˆ¶çš„æˆæƒé€»è¾‘ï¼Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Istio Wasm æ‰©å±•è¿˜å…è®¸æˆ‘ä»¬ç”Ÿæˆæ’ä»¶æŒ‡æ ‡ï¼Œæˆ–åœ¨å¤šä¸ª Wasm æ’ä»¶ä¸­æ±‡æ€»ã€‚è¯¥æ’ä»¶æä¾›äº†ä¸€ä¸ªæ—¥å¿—åŠŸèƒ½ï¼Œå…è®¸æˆ‘ä»¬å°†æ—¥å¿—ä¿¡æ¯å†™åˆ° Envoy sidecarã€‚è¿™å¯¹ Wasm æ’ä»¶çš„è°ƒè¯•å’Œå¼€å‘ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰çš„ Istio Wasm API å¤„äº alpha é˜¶æ®µï¼Œå°†åœ¨æœªæ¥çš„ Istio ç‰ˆæœ¬ä¸­å¾—åˆ°å¢å¼ºå’Œç¨³å®šã€‚è¿™åŒ…æ‹¬é€šè¿‡éªŒè¯ç­¾åæ¥å®‰å…¨åœ°éªŒè¯ Wasm æ’ä»¶æœ¬èº«ï¼Œæ”¯æŒç”¨å­˜å‚¨ä¸º Kubernetes Secret çš„ç§˜å¯†æ¥æ‹‰å– Wasm æ’ä»¶ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ä¸€æ­¥é˜…è¯»å’Œè¡¥å……èµ„æº&#34;&gt;è¿›ä¸€æ­¥é˜…è¯»å’Œè¡¥å……èµ„æº&lt;/h2&gt;
&lt;p&gt;åœ¨ Tetrateï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ”¹å–„å¼€å‘è€…çš„ä½“éªŒï¼Œ&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tetratelabs/proxy-wasm-golang-sdk&lt;/a&gt; åŒ…å«æœ¬æ•™ç¨‹ä½¿ç”¨çš„ Golang SDK åº“ã€‚ä½ å¯ä»¥æ‰¾åˆ°æ›´å¤šçš„ä¾‹å­ï¼Œå¦‚ http &lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/blob/main/examples/http_routing/main.go#L70-L80&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤´çš„æ“ä½œ&lt;/a&gt;ã€æ ·ä¾‹&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples/http_auth_random&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒ&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/tetratelabs/proxy-wasm-go-sdk/tree/main/examples/http_routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¹å˜è·¯ç”±&lt;/a&gt;è¡Œä¸ºç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://istio.tetratelabs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Istio Distro&lt;/a&gt; æ˜¯å®‰è£…ã€æ“ä½œå’Œå‡çº§ Istio çš„æœ€ç®€å•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.tetrate.io/istio-wasm-workshop/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ¥åå‚åŠ  Tetrate çš„ Istio Wasm æ’ä»¶ç ”è®¨ä¼šï¼Œå‘ Istio ä¸­çš„ Wasm æ’ä»¶çš„åˆ›é€ è€…å­¦ä¹ &lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäº gRPC å’Œ Istio çš„æ—  sidecar ä»£ç†çš„æœåŠ¡ç½‘æ ¼</title>
      <link>https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/</link>
      <pubDate>Tue, 23 Nov 2021 10:03:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡è¯‘è‡ª Istio å®˜æ–¹åšå®¢ï¼Œåšå®¢åŸæ ‡é¢˜ &lt;a href=&#34;https://istio.io/latest/blog/2021/proxyless-grpc/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC Proxyless Service Mesh&lt;/a&gt;ï¼Œå…¶å®æ˜¯ Istio 1.11 ç‰ˆæœ¬ä¸­æ”¯æŒçš„å®éªŒç‰¹æ€§ï¼Œå¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ° Istio ä¸­ï¼Œè€Œä¸éœ€è¦å†å‘ Pod ä¸­æ³¨å…¥ Envoy ä»£ç†ã€‚æœ¬æ–‡ä¸­è¿˜ç»™å‡ºäº†ä¸€ä¸ª Demo æ€§èƒ½æµ‹è¯•æ•°æ®ï¼Œè¿™ç§åšæ³•å¯ä»¥æå¤§çš„æå‡åº”ç”¨æ€§èƒ½ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Istio ä½¿ç”¨ä¸€ç»„å‘ç° APIï¼ˆç»Ÿç§°ä¸º &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;xDS API&lt;/a&gt; æ¥åŠ¨æ€é…ç½®å…¶ Envoy sidecar ä»£ç†ã€‚è¿™äº› API çš„ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ª &lt;a href=&#34;https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a?gi=64aa2eea0283&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šç”¨çš„æ•°æ®å¹³é¢ API&lt;/a&gt;ã€‚gRPC é¡¹ç›®å¯¹ xDS API æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ç®¡ç† gRPC å·¥ä½œè´Ÿè½½ï¼Œè€Œä¸éœ€è¦åŒæ—¶éƒ¨ç½² Envoy sidecarã€‚ä½ å¯ä»¥åœ¨ &lt;a href=&#34;https://www.youtube.com/watch?v=cGJXkZ7jiDk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Megan Yahya çš„ KubeCon EU 2021 æ¼”è®²&lt;/a&gt;ä¸­äº†è§£æ›´å¤šå…³äºè¯¥é›†æˆçš„ä¿¡æ¯ã€‚å…³äº gRPC æ”¯æŒçš„æœ€æ–°æƒ…å†µï¼Œå¯ä»¥åœ¨ä»–ä»¬çš„&lt;a href=&#34;https://github.com/grpc/proposal/search?q=xds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ææ¡ˆ&lt;/a&gt;ä¸­æ‰¾åˆ°ï¼Œè¿˜æœ‰å®ç°çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;Istio 1.11 å¢åŠ äº†å®éªŒæ€§æ”¯æŒï¼Œå¯ä»¥ç›´æ¥å°† gRPC æœåŠ¡æ·»åŠ åˆ°ç½‘æ ¼ä¸­ã€‚æˆ‘ä»¬æ”¯æŒåŸºæœ¬çš„æœåŠ¡å‘ç°ï¼Œä¸€äº›åŸºäº VirtualService çš„æµé‡ç­–ç•¥ï¼Œä»¥åŠåŒå‘ TLSã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ”¯æŒçš„åŠŸèƒ½&#34;&gt;æ”¯æŒçš„åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;ä¸ Envoy ç›¸æ¯”ï¼Œç›®å‰ gRPC å†…çš„ xDS API çš„å®ç°åœ¨æŸäº›æ–¹é¢æ˜¯æœ‰é™çš„ã€‚ä»¥ä¸‹åŠŸèƒ½åº”è¯¥å¯ä»¥ä½¿ç”¨ï¼Œå°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„åˆ—è¡¨ï¼Œå…¶ä»–åŠŸèƒ½å¯èƒ½éƒ¨åˆ†å¯ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬çš„æœåŠ¡å‘ç°ã€‚ä½ çš„ gRPC æœåŠ¡å¯ä»¥æ¥è§¦åˆ°åœ¨ç½‘æ ¼ä¸­æ³¨å†Œçš„å…¶ä»– pod å’Œè™šæ‹Ÿæœºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DestinationRule&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Subset&lt;/code&gt;ï¼šä½ çš„ gRPC æœåŠ¡å¯ä»¥æ ¹æ®æ ‡ç­¾é€‰æ‹©å™¨å°†æµé‡åˆ†å‰²åˆ°ä¸åŒçš„å®ä¾‹ç»„ã€‚&lt;/li&gt;
&lt;li&gt;ç›®å‰å”¯ä¸€æ”¯æŒçš„ Istio &lt;code&gt;loadBalancer&lt;/code&gt; æ˜¯ &lt;code&gt;ROUND_ROBIN&lt;/code&gt;ï¼Œ&lt;code&gt;consistentHash&lt;/code&gt; å°†åœ¨æœªæ¥çš„ Istio ç‰ˆæœ¬ä¸­åŠ å…¥ï¼ˆæ”¯æŒ gRPCï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tls&lt;/code&gt; è®¾ç½®è¢«é™åˆ¶ä¸º &lt;code&gt;DISABLE&lt;/code&gt; æˆ– &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt;ã€‚å…¶ä»–æ¨¡å¼å°†è¢«è§†ä¸º &lt;code&gt;DISABLE&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VirtualService&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Header åŒ¹é…å’Œ URI åŒ¹é…çš„æ ¼å¼ä¸º &lt;code&gt;/ServiceName/RPCName&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¦†ç›–ç›®æ ‡ä¸»æœºå’Œå­é›†ã€‚&lt;/li&gt;
&lt;li&gt;åŠ æƒçš„æµé‡è½¬ç§»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PeerAuthentication&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;åªæ”¯æŒ &lt;code&gt;DISABLE&lt;/code&gt; å’Œ &lt;code&gt;STRICT&lt;/code&gt;ã€‚å…¶ä»–æ¨¡å¼å°†è¢«è§†ä¸º &lt;code&gt;DISABLE&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæœ‰å¯¹ auto-mTLS çš„æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–åŠŸèƒ½åŒ…æ‹¬æ•…éšœã€é‡è¯•ã€è¶…æ—¶ã€é•œåƒå’Œé‡å†™è§„åˆ™ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ”¯æŒã€‚å…¶ä¸­ä¸€äº›åŠŸèƒ½æ­£ç­‰å¾…åœ¨ gRPC ä¸­å®ç°ï¼Œè€Œå…¶ä»–åŠŸèƒ½åˆ™éœ€è¦åœ¨ Istio ä¸­æ”¯æŒã€‚gRPC ä¸­ xDS åŠŸèƒ½çš„çŠ¶æ€å¯ä»¥&lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/grpc_xds_features.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚Istio çš„æ”¯æŒçŠ¶å†µå°†å­˜åœ¨äºæœªæ¥çš„å®˜æ–¹æ–‡æ¡£ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåŠŸèƒ½æ˜¯&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®éªŒæ€§çš„&lt;/a&gt;ã€‚æ ‡å‡†çš„ Istio åŠŸèƒ½å°†éšç€æ—¶é—´çš„æ¨ç§»å’Œæ•´ä½“è®¾è®¡çš„æ”¹è¿›è€Œå¾—åˆ°æ”¯æŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶æ„æ¦‚è¿°&#34;&gt;æ¶æ„æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-grpcæœåŠ¡å¦‚ä½•ä¸istiodé€šä¿¡çš„ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;gRPCæœåŠ¡å¦‚ä½•ä¸istiodé€šä¿¡çš„ç¤ºæ„å›¾&#34; srcset=&#34;
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_huabc968057a906e61785a18796c8fab68_60668_856dcb93d4f2050c6da613426e172811.webp 400w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_huabc968057a906e61785a18796c8fab68_60668_f3ee6fba86384313fdc69ee1246fa468.webp 760w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_huabc968057a906e61785a18796c8fab68_60668_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/008i3skNly1gwp3lh9za5j311q0hm75n_huabc968057a906e61785a18796c8fab68_60668_856dcb93d4f2050c6da613426e172811.webp&#34;
               width=&#34;760&#34;
               height=&#34;355&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      gRPCæœåŠ¡å¦‚ä½•ä¸istiodé€šä¿¡çš„ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä¸ä½¿ç”¨ proxy è¿›è¡Œæ•°æ®é¢é€šä¿¡ï¼Œä½†å®ƒä»ç„¶éœ€è¦ä¸€ä¸ª agent æ¥è¿›è¡Œåˆå§‹åŒ–å’Œä¸æ§åˆ¶é¢çš„é€šä¿¡ã€‚é¦–å…ˆï¼Œagent åœ¨å¯åŠ¨æ—¶ç”Ÿæˆä¸€ä¸ª&lt;a href=&#34;https://github.com/grpc/proposal/blob/master/A27-xds-global-load-balancing.md#xdsclient-and-bootstrap-file&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼•å¯¼æ–‡ä»¶&lt;/a&gt;ï¼Œä¸ä¸º Envoy ç”Ÿæˆå¼•å¯¼æ–‡ä»¶çš„æ–¹å¼ç›¸åŒã€‚è¿™å‘Šè¯‰ gRPC åº“å¦‚ä½•è¿æ¥åˆ° istiodï¼Œåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ•°æ®é¢é€šä¿¡çš„è¯ä¹¦ï¼Œä»¥åŠå‘æ§åˆ¶é¢å‘é€ä»€ä¹ˆå…ƒæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œagent ä½œä¸ºä¸€ä¸ª xDS proxyï¼Œä»£è¡¨åº”ç”¨ç¨‹åºä¸ istiod è¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚æœ€åï¼Œagent è·å–å¹¶è½®æ¢æ•°æ®å¹³é¢é€šä¿¡ä¸­ä½¿ç”¨çš„è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¹åº”ç”¨ç¨‹åºä»£ç çš„ä¿®æ”¹&#34;&gt;å¯¹åº”ç”¨ç¨‹åºä»£ç çš„ä¿®æ”¹&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚ä»‹ç»äº† gRPC åœ¨ Go ä¸­çš„ xDS æ”¯æŒã€‚å…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„ APIã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¯ç”¨ gRPC ä¸­çš„ xDS åŠŸèƒ½ï¼Œä½ çš„åº”ç”¨ç¨‹åºå¿…é¡»åšä¸€äº›å¿…è¦çš„ä¿®æ”¹ã€‚ä½ çš„ gRPC ç‰ˆæœ¬åº”è¯¥è‡³å°‘æ˜¯ 1.39.0ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢æˆ·ç«¯&#34;&gt;å®¢æˆ·ç«¯&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢çš„å¯¼å…¥å°†åœ¨ gRPC ä¸­æ³¨å†Œ xDS è§£æå™¨å’Œå‡è¡¡å™¨ã€‚å®ƒåº”è¯¥è¢«æ·»åŠ åˆ°ä½ çš„ä¸»åŒ…æˆ–è°ƒç”¨ &lt;code&gt;grpc.Dial&lt;/code&gt; çš„åŒä¸€ä¸ªåŒ…ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“åˆ›å»ºä¸€ä¸ª gRPC è¿æ¥æ—¶ï¼ŒURL å¿…é¡»ä½¿ç”¨ &lt;code&gt;xds:///&lt;/code&gt; schemeã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DialContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;xds:///foo.ns.svc.cluster.local:7070&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤å¤–ï¼Œä¸ºäº†æ”¯æŒï¼ˆmï¼‰TLSï¼Œå¿…é¡»å‘ &lt;code&gt;DialContext&lt;/code&gt; ä¼ é€’ä¸€ä¸ªç‰¹æ®Šçš„ &lt;code&gt;TransportCredentials&lt;/code&gt; é€‰é¡¹ã€‚&lt;code&gt;FallbackCreds&lt;/code&gt; å…è®¸æˆ‘ä»¬åœ¨ istiod ä¸å‘é€å®‰å…¨é…ç½®æ—¶æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/credentials/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewClientCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;FallbackCreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// handle err
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DialContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;xds:///foo.ns.svc.cluster.local:7070&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTransportCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æœåŠ¡ç«¯&#34;&gt;æœåŠ¡ç«¯&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æ”¯æŒæœåŠ¡å™¨ç«¯çš„é…ç½®ï¼Œå¦‚ mTLSï¼Œå¿…é¡»åšä¸€äº›ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„æ„é€ å‡½æ•°æ¥åˆ›å»º &lt;code&gt;GRPCServer&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;google.golang.org/grpc/xds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewGRPCServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;RegisterFooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fooServerImpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ çš„ &lt;code&gt;protoc&lt;/code&gt; ç”Ÿæˆçš„ Go ä»£ç å·²ç»è¿‡æœŸï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°ç”Ÿæˆï¼Œä»¥ä¾¿ä¸ xDS æœåŠ¡å™¨å…¼å®¹ã€‚ä½ ç”Ÿæˆçš„ &lt;code&gt;RegisterFooServer&lt;/code&gt; å‡½æ•°åº”è¯¥åƒä¸‹é¢è¿™æ ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RegisterFooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceRegistrar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FooServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FooServer_ServiceDesc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œä¸å®¢æˆ·ç«¯çš„å˜åŒ–ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»å¯ç”¨å®‰å…¨æ”¯æŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServerCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xdscreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServerOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FallbackCreds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;insecure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// handle err
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewGRPCServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;creds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åœ¨ä½ çš„-kubernetes-éƒ¨ç½²ä¸­&#34;&gt;åœ¨ä½ çš„ Kubernetes éƒ¨ç½²ä¸­&lt;/h3&gt;
&lt;p&gt;å‡è®¾ä½ çš„åº”ç”¨ä»£ç æ˜¯å…¼å®¹çš„ï¼ŒPod åªéœ€è¦æ³¨é‡Š &lt;code&gt;inject.istio.io/templatesï¼šgrpc-agent&lt;/code&gt;ã€‚è¿™å¢åŠ äº†ä¸€ä¸ªè¿è¡Œä¸Šè¿°ä»£ç†çš„ sidecar å®¹å™¨ï¼Œä»¥åŠä¸€äº›ç¯å¢ƒå˜é‡ï¼ŒgRPC ä½¿ç”¨è¿™äº›å˜é‡æ¥å¯»æ‰¾å¼•å¯¼æ–‡ä»¶å¹¶å¯ç”¨æŸäº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº gRPC æœåŠ¡ç«¯ï¼Œä½ çš„ Pod ä¹Ÿåº”è¯¥ç”¨ &lt;code&gt;proxy.istio.io/config: &#39;{&amp;quot;holdApplicationUntilProxyStarts&amp;quot;: true}&#39;&lt;/code&gt; æ¥æ³¨é‡Šï¼Œä»¥ç¡®ä¿åœ¨ä½ çš„ gRPC æœåŠ¡ç«¯åˆå§‹åŒ–ä¹‹å‰ï¼Œä»£ç†ä¸­çš„ xDS ä»£ç†å’Œå¼•å¯¼æ–‡ä»¶å·²ç»å‡†å¤‡å°±ç»ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¾‹å­&#34;&gt;ä¾‹å­&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä½ å°†éƒ¨ç½² echoï¼Œä¸€ä¸ªå·²ç»æ”¯æŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ— ä»£ç†çš„ gRPC çš„åº”ç”¨ã€‚é€šè¿‡è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥å°è¯•ä¸€äº›æ”¯æŒçš„æµé‡ç­–ç•¥ï¼Œå¯ç”¨ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;æœ¬æŒ‡å—è¦æ±‚åœ¨è¿›è¡Œä¹‹å‰&lt;a href=&#34;https://istio.io/latest/docs/setup/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…&lt;/a&gt; Istioï¼ˆ1.11+ï¼‰æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;éƒ¨ç½²åº”ç”¨ç¨‹åº&#34;&gt;éƒ¨ç½²åº”ç”¨ç¨‹åº&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ”¯æŒæ³¨å…¥çš„å‘½åç©ºé—´ &lt;code&gt;echo-grpc&lt;/code&gt;ã€‚æ¥ä¸‹æ¥éƒ¨ç½²ä¸¤ä¸ª &lt;code&gt;echo&lt;/code&gt; åº”ç”¨ç¨‹åºçš„å®ä¾‹ä»¥åŠæœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create namespace echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl label namespace echo-grpc istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc apply -f samples/grpc-echo/grpc-echo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®ä¿ä¸¤ä¸ª Pod æ­£åœ¨è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc get pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;echo-v1-69d6d96cb7-gpcpd   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          58s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;echo-v2-5c6cbf6dc7-dfhcb   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          58s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•-grpc-è§£æå™¨&#34;&gt;æµ‹è¯• gRPC è§£æå™¨&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œå°† 17171 ç«¯å£è½¬å‘åˆ°å…¶ä¸­ä¸€ä¸ª Pod ä¸Šã€‚è¿™ä¸ªç«¯å£æ˜¯ä¸€ä¸ªé xDS æ”¯æŒçš„ gRPC æœåŠ¡ç«¯ï¼Œå…è®¸ä»ç«¯å£è½¬å‘çš„ Pod å‘å‡ºè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n echo-grpc port-forward &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n echo-grpc get pods -l &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1 -ojsonpath&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€æ‰¹ 5 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;, &amp;#34;count&amp;#34;: 5}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-qf628
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-qf628
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-bgn6t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ Kubernetes åç§°è§£æçš„çŸ­åç§°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-ltr8q
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-ltr8q
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v2-cf97bd94d-jt5mf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç”¨ç›®çš„åœ°è§„åˆ™åˆ›å»ºå­é›†&#34;&gt;ç”¨ç›®çš„åœ°è§„åˆ™åˆ›å»ºå­é›†&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œä¸ºæ¯ä¸ªç‰ˆæœ¬çš„å·¥ä½œè´Ÿè½½åˆ›å»ºä¸€ä¸ªå­é›†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1alpha3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: DestinationRule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-versions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  subsets:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      version: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      version: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµé‡è½¬ç§»&#34;&gt;æµé‡è½¬ç§»&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„å­é›†ï¼Œä½ å¯ä»¥æŠŠ 80% çš„æµé‡å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: VirtualService
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-weights
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  hosts:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  http:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - route:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - destination:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        subset: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      weight: 20
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    - destination:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        subset: v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      weight: 80
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå‘é€ä¸€ç»„ 10 ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;, &amp;#34;count&amp;#34;: 10}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep ServiceVersion
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”åº”ä¸»è¦åŒ…å« v2 å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[0 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[2 body] ServiceVersion=v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[3 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[4 body] ServiceVersion=v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[5 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[6 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[7 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[8 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[9 body] ServiceVersion=v2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¯ç”¨-mtls&#34;&gt;å¯ç”¨ mTLS&lt;/h3&gt;
&lt;p&gt;ç”±äºåœ¨ gRPC ä¸­å¯ç”¨å®‰å…¨æ‰€éœ€çš„åº”ç”¨ç¨‹åºæœ¬èº«çš„å˜åŒ–ï¼ŒIstio çš„è‡ªåŠ¨æ£€æµ‹ mTLS æ”¯æŒçš„ä¼ ç»Ÿæ–¹æ³•æ˜¯ä¸å¯é çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆå§‹ç‰ˆæœ¬éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸Šæ˜ç¡®å¯ç”¨ mTLSã€‚&lt;/p&gt;
&lt;p&gt;è¦å¯ç”¨å®¢æˆ·ç«¯çš„ mTLSï¼Œè¯·åº”ç”¨å¸¦æœ‰ &lt;code&gt;tls&lt;/code&gt; è®¾ç½®çš„ &lt;code&gt;DestinationRule&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: networking.istio.io/v1alpha3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: DestinationRule
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-mtls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  host: echo.echo-grpc.svc.cluster.local
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  trafficPolicy:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    tls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      mode: ISTIO_MUTUAL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œè¯•å›¾è°ƒç”¨å°šæœªé…ç½® mTLS çš„æœåŠ¡å™¨å°†ä¼šå¤±è´¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ERROR:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Code: Unknown
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Message: 1/1 requests had errors&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; first error: rpc error: &lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; Unavailable &lt;span class=&#34;nv&#34;&gt;desc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; all SubConns are in TransientFailure
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†å¯ç”¨æœåŠ¡å™¨ç«¯çš„ mTLSï¼Œåº”ç”¨ä¸€ä¸ª &lt;code&gt;PeerAuthentication&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç­–ç•¥å¯¹æ•´ä¸ªå‘½åç©ºé—´å¼ºåˆ¶é‡‡ç”¨ STRICT mTLSã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: security.istio.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: PeerAuthentication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: echo-mtls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: echo-grpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  mtls:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    mode: STRICT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨è¯¥æ”¿ç­–åï¼Œè¯·æ±‚å°†å¼€å§‹æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grpcurl -plaintext -d &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;url&amp;#34;: &amp;#34;xds:///echo.echo-grpc.svc.cluster.local:7070&amp;#34;}&amp;#39;&lt;/span&gt; :17171 proto.EchoTestService/ForwardEcho &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.output | join(&amp;#34;&amp;#34;)&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Handling connection &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17171&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; grpcecho.Echo&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;xds:///echo.echo-grpc.svc.cluster.local:7070 map&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  5s &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; x-request-id&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo.echo-grpc.svc.cluster.local:7070
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; content-type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;application/grpc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; user-agent&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;grpc-go/1.39.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;StatusCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ServiceVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ServicePort&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;17070&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.68.1.18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;IstioVersion&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Echo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; body&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;echo-v1-7cf5b76586-z5p8l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é™åˆ¶æ¡ä»¶&#34;&gt;é™åˆ¶æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;æœ€åˆçš„ç‰ˆæœ¬æœ‰å‡ ä¸ªé™åˆ¶ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¿®å¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æ”¯æŒè‡ªåŠ¨ mTLSï¼Œä¹Ÿä¸æ”¯æŒè®¸å¯æ¨¡å¼ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ &lt;code&gt;STRICT&lt;/code&gt;ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ &lt;code&gt;ISTIO_MUTUAL&lt;/code&gt; çš„æ˜ç¡® mTLS é…ç½®ã€‚åœ¨è¿ç§»åˆ° &lt;code&gt;STRICT&lt;/code&gt; çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Envoyã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;grpc.Serve(listener)&lt;/code&gt; æˆ– &lt;code&gt;grpc.Dial(&amp;quot;xds://...&amp;quot;)&lt;/code&gt; åœ¨ bootstrap è¢«å†™å…¥æˆ– xDS ä»£ç†å‡†å¤‡å¥½ä¹‹å‰è¢«è°ƒç”¨ä¼šå¯¼è‡´å¤±è´¥ã€‚ &lt;code&gt;holdApplicationUntilProxyStarts&lt;/code&gt; å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ–è€…åº”ç”¨ç¨‹åºå¯ä»¥å¯¹è¿™äº›å¤±è´¥æ›´åŠ ç¨³å¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ”¯æŒ xDS çš„ gRPC æœåŠ¡å™¨ä½¿ç”¨ mTLSï¼Œé‚£ä¹ˆä½ å°†éœ€è¦ç¡®ä¿ä½ çš„å¥åº·æ£€æŸ¥å¯ä»¥ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚è¦ä¹ˆä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ç«¯å£ï¼Œè¦ä¹ˆä½ çš„å¥åº·æ£€æŸ¥å®¢æˆ·ç«¯éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·å¾—é€‚å½“çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;gRPC ä¸­ xDS çš„å®ç°ä¸ Envoy ä¸ä¸€è‡´ã€‚æŸäº›è¡Œä¸ºå¯èƒ½ä¸åŒï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ç¼ºå¤±ã€‚&lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/grpc_xds_features.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC çš„åŠŸèƒ½çŠ¶æ€&lt;/a&gt;æä¾›äº†æ›´å¤šç»†èŠ‚ã€‚è¯·ç¡®ä¿æµ‹è¯•ä»»ä½• Istio é…ç½®æ˜¯å¦çœŸæ­£é€‚ç”¨äºä½ çš„æ— ä»£ç†çš„ gRPC åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€§èƒ½&#34;&gt;æ€§èƒ½&lt;/h2&gt;
&lt;h3 id=&#34;å®éªŒè®¾ç½®&#34;&gt;å®éªŒè®¾ç½®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Fortioï¼Œä¸€ä¸ªåŸºäº Go çš„è´Ÿè½½æµ‹è¯•åº”ç”¨ç¨‹åº
&lt;ul&gt;
&lt;li&gt;ç¨ä½œä¿®æ”¹ï¼Œä»¥æ”¯æŒ gRPC çš„ XDS åŠŸèƒ½ (PR)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èµ„æºï¼š
&lt;ul&gt;
&lt;li&gt;GKE 1.20 é›†ç¾¤æœ‰ 3 ä¸ª &lt;code&gt;e2-standard-16&lt;/code&gt; èŠ‚ç‚¹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ‰ 16 ä¸ª CPU+64GB å†…å­˜ï¼‰&lt;/li&gt;
&lt;li&gt;Fortio å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼š1.5 vCPUï¼Œ1000 MiB å†…å­˜&lt;/li&gt;
&lt;li&gt;Sidecarï¼ˆistio-agent å’Œå¯èƒ½çš„ Envoy ä»£ç†ï¼‰ï¼š1 vCPUï¼Œ512 MiB å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æµ‹è¯•çš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;åŸºçº¿ï¼šå¸¸è§„çš„ gRPCï¼Œæ²¡æœ‰ä½¿ç”¨ Envoy ä»£ç†æˆ– Proxyless xDS&lt;/li&gt;
&lt;li&gt;Envoyï¼šæ ‡å‡†çš„ istio-agent + Envoy proxy sidecar&lt;/li&gt;
&lt;li&gt;æ— ä»£ç†ï¼šä½¿ç”¨ xDS gRPC æœåŠ¡å™¨å®ç°çš„ gRPC å’Œå®¢æˆ·ç«¯çš„ &lt;code&gt;xds:///&lt;/code&gt; è§£æå™¨ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;PeerAuthentication&lt;/code&gt; å’Œ &lt;code&gt;DestinationRule&lt;/code&gt; å¯ç”¨ / åœç”¨ mTLS&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å»¶è¿Ÿ&#34;&gt;å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p50å»¶è¿Ÿå¯¹æ¯”å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P50å»¶è¿Ÿå¯¹æ¯”å›¾&#34; srcset=&#34;
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu1f3dca8e47dac173545ad9b4a1f5b121_93948_3a074b471e14cb11fc2317c66746cc23.webp 400w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu1f3dca8e47dac173545ad9b4a1f5b121_93948_63de6d1be42f8a6ca221d6c31a184d0b.webp 760w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu1f3dca8e47dac173545ad9b4a1f5b121_93948_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/008i3skNly1gwp512szlvj31260rgq57_hu1f3dca8e47dac173545ad9b4a1f5b121_93948_3a074b471e14cb11fc2317c66746cc23.webp&#34;
               width=&#34;760&#34;
               height=&#34;547&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P50å»¶è¿Ÿå¯¹æ¯”å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-p99-å»¶è¿Ÿå¯¹æ¯”å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;P99å»¶è¿Ÿå¯¹æ¯”å›¾&#34; srcset=&#34;
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu129e5f5b76937d444cc31a8e04e4a32d_91697_06e686b116988448b11cd59f07be69ce.webp 400w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu129e5f5b76937d444cc31a8e04e4a32d_91697_a9adb6bead390a716cbd17c76ed6ea7d.webp 760w,
               /translation/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu129e5f5b76937d444cc31a8e04e4a32d_91697_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/grpc-proxyless-service-mesh/008i3skNly1gwp51zjxqaj312q0r2jtl_hu129e5f5b76937d444cc31a8e04e4a32d_91697_06e686b116988448b11cd59f07be69ce.webp&#34;
               width=&#34;760&#34;
               height=&#34;531&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      P99 å»¶è¿Ÿå¯¹æ¯”å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨æ— ä»£ç†çš„ gRPC è§£æå™¨æ—¶ï¼Œå»¶è¿Ÿä¼šæœ‰å¾®å°çš„å¢åŠ ã€‚ä¸ Envoy ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ”¹è¿›ï¼Œä»ç„¶å¯ä»¥å®ç°å…ˆè¿›çš„æµé‡ç®¡ç†åŠŸèƒ½å’Œ mTLSã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-proxy-å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ&#34;&gt;istio-proxy å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»åˆ«&lt;/th&gt;
&lt;th&gt;å®¢æˆ·ç«¯ mCPU&lt;/th&gt;
&lt;th&gt;å®¢æˆ·ç«¯å†…å­˜ (MiB)&lt;/th&gt;
&lt;th&gt;æœåŠ¡ç«¯ mCPU&lt;/th&gt;
&lt;th&gt;æœåŠ¡ç«¯å†…å­˜ (MiB)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Envoy æ˜æ–‡&lt;/td&gt;
&lt;td&gt;320.44&lt;/td&gt;
&lt;td&gt;66.93&lt;/td&gt;
&lt;td&gt;243.78&lt;/td&gt;
&lt;td&gt;64.91&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Envoy mTLS&lt;/td&gt;
&lt;td&gt;340.87&lt;/td&gt;
&lt;td&gt;66.76&lt;/td&gt;
&lt;td&gt;309.82&lt;/td&gt;
&lt;td&gt;64.82&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— ä»£ç†æ˜æ–‡&lt;/td&gt;
&lt;td&gt;0.72&lt;/td&gt;
&lt;td&gt;23.54&lt;/td&gt;
&lt;td&gt;0.84&lt;/td&gt;
&lt;td&gt;24.31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— ä»£ç† mTLS&lt;/td&gt;
&lt;td&gt;0.73&lt;/td&gt;
&lt;td&gt;25.05&lt;/td&gt;
&lt;td&gt;0.78&lt;/td&gt;
&lt;td&gt;25.43&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å°½ç®¡æˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªä»£ç†ï¼Œä½†ä»£ç†ä½¿ç”¨çš„å†…å­˜ä¸åˆ°å®Œæ•´ vCPU çš„ 0.1%ï¼Œè€Œä¸”åªæœ‰ 25 MiBï¼Œè¿™è¿˜ä¸åˆ°è¿è¡Œ Envoy æ‰€éœ€å†…å­˜çš„ä¸€åŠã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æŒ‡æ ‡ä¸åŒ…æ‹¬åº”ç”¨å®¹å™¨ä¸­ gRPC çš„é¢å¤–èµ„æºä½¿ç”¨é‡ï¼Œä½†æœ‰åŠ©äºå±•ç¤º istio-agent åœ¨æ­¤æ¨¡å¼ä¸‹è¿è¡Œæ—¶çš„èµ„æºä½¿ç”¨å½±å“ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>eBPF å¦‚ä½•ç®€åŒ–æœåŠ¡ç½‘æ ¼</title>
      <link>https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/</link>
      <pubDate>Wed, 27 Oct 2021 13:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/</guid>
      <description>&lt;p&gt;ä»Šå¤©æœ‰å‡ ä¸ªæœåŠ¡ç½‘æ ¼çš„äº§å“å’Œé¡¹ç›®ï¼Œæ‰¿è¯ºç®€åŒ–åº”ç”¨å¾®æœåŠ¡ä¹‹é—´çš„è¿æ¥ï¼ŒåŒæ—¶æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚å®‰å…¨è¿æ¥ã€å¯è§‚æµ‹æ€§å’Œæµé‡ç®¡ç†ã€‚ä½†æ­£å¦‚æˆ‘ä»¬åœ¨è¿‡å»å‡ å¹´ä¸­åå¤çœ‹åˆ°çš„é‚£æ ·ï¼Œå¯¹æœåŠ¡ç½‘æ ¼çš„å…´å¥‹å·²ç»è¢«å¯¹&lt;a href=&#34;https://nowei.github.io/projects/svc_mesh_measurement_final_report.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¢å¤–çš„&lt;/a&gt;&lt;a href=&#34;https://engineering.hellofresh.com/everything-we-learned-running-istio-in-production-part-2-ff4c26844bfb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤æ‚æ€§&lt;/a&gt;å’Œ&lt;a href=&#34;https://pklinker.medium.com/performance-impacts-of-an-istio-service-mesh-63957a0000b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¼€é”€çš„&lt;/a&gt;å®é™…&lt;a href=&#34;https://medium.com/geekculture/watch-out-for-this-istio-proxy-sidecar-memory-pitfall-8dbd99ea7e9d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‹…å¿§æ‰€æŠ‘åˆ¶&lt;/a&gt;ã€‚è®©æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹ &lt;a href=&#34;https://ebpf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF&lt;/a&gt; æ˜¯å¦‚ä½•è®©æˆ‘ä»¬ç²¾ç®€&lt;a href=&#34;https://thenewstack.io/category/service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/a&gt;ï¼Œä½¿æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢æ›´æœ‰æ•ˆç‡ï¼Œæ›´å®¹æ˜“éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-é—®é¢˜&#34;&gt;Sidecar é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©çš„ Kubernetes æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆè¦æ±‚ä½ åœ¨æ¯ä¸€ä¸ªåº”ç”¨ pod ä¸Šæ·»åŠ ä¸€ä¸ªä»£ç† sidecar å®¹å™¨ï¼Œå¦‚ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; æˆ– &lt;a href=&#34;https://linkerd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd-proxy&lt;/a&gt;ã€‚è¿™æ˜¯æ­£ç¡®çš„ï¼šå³ä½¿åœ¨ä¸€ä¸ªéå¸¸å°çš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚è¯´æœ‰ 20 ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œäº”ä¸ª podï¼Œåˆ†å¸ƒåœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½ ä¹Ÿæœ‰ 100 ä¸ªä»£ç†å®¹å™¨ã€‚æ— è®ºä»£ç†çš„å®ç°å¤šä¹ˆå°å’Œæœ‰æ•ˆï¼Œè¿™ç§çº¯ç²¹çš„é‡å¤éƒ½ä¼šè€—è´¹èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªä»£ç†ä½¿ç”¨çš„å†…å­˜ä¸å®ƒéœ€è¦èƒ½å¤Ÿé€šä¿¡çš„æœåŠ¡æ•°é‡æœ‰å…³ã€‚Pranay Singhal å†™äº†ä»–é…ç½® Istio çš„&lt;a href=&#34;https://medium.com/geekculture/watch-out-for-this-istio-proxy-sidecar-memory-pitfall-8dbd99ea7e9d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»éªŒ&lt;/a&gt;ï¼Œå°†æ¯ä¸ªä»£ç†çš„æ¶ˆè€—ä» 1GB å·¦å³å‡å°‘åˆ°æ›´åˆç†çš„ 60-70MBã€‚ä½†æ˜¯ï¼Œå³ä½¿åœ¨æˆ‘ä»¬çš„å°ç¯å¢ƒä¸­ï¼Œåœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ 100 ä¸ªä»£ç†ï¼Œè¿™ç§ä¼˜åŒ–é…ç½®ä»ç„¶éœ€è¦æ¯ä¸ªèŠ‚ç‚¹ 2GB å·¦å³ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¥è‡ªredhatcomarchitectwhy-when-service-meshhttpsredhatcomarchitectwhy-when-service-meshæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç†sidecar&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¥è‡ª&amp;lt;a href=&amp;#34;https://redhat.com/architect/why-when-service-mesh&amp;#34; target=&amp;#34;_blank&amp;#34; rel=&amp;#34;noopener&amp;#34;&amp;gt;redhat.com/architect/why-when-service-mesh&amp;lt;/a&amp;gt;â€”â€”æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç†sidecar&#34; srcset=&#34;
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8_hu447afc0e8a4b4f136ba0a875f0862532_262774_014ccb824dfe083b8ad87d9326be59ba.webp 400w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8_hu447afc0e8a4b4f136ba0a875f0862532_262774_7f9c2edf87c67fd7aea245bd3ed05515.webp 760w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8_hu447afc0e8a4b4f136ba0a875f0862532_262774_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp69o74jj31w50u0jy8_hu447afc0e8a4b4f136ba0a875f0862532_262774_014ccb824dfe083b8ad87d9326be59ba.webp&#34;
               width=&#34;760&#34;
               height=&#34;334&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¥è‡ª&lt;a href=&#34;https://redhat.com/architect/why-when-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;redhat.com/architect/why-when-service-mesh&lt;/a&gt;â€”â€”æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä»£ç†sidecar
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ‰€æœ‰è¿™äº› sidecarï¼Ÿè¿™ç§æ¨¡å¼å…è®¸ä»£ç†å®¹å™¨ä¸ pod ä¸­çš„åº”ç”¨å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ã€‚ç½‘ç»œå‘½åç©ºé—´æ˜¯ Linux å†…æ ¸çš„ç»“æ„ï¼Œå®ƒå…è®¸å®¹å™¨å’Œ pod æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œå †æ ˆï¼Œå°†å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºç›¸äº’éš”ç¦»ã€‚è¿™ä½¿å¾—åº”ç”¨ä¹‹é—´äº’ä¸ç›¸å¹²ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥è®©å°½å¯èƒ½å¤šçš„ pod åœ¨ 80 ç«¯å£ä¸Šè¿è¡Œä¸€ä¸ª web åº”ç”¨ â€”â€” ç½‘ç»œå‘½åç©ºé—´æ„å‘³ç€å®ƒä»¬å„è‡ªæ‹¥æœ‰è‡ªå·±çš„ 80 ç«¯å£ã€‚ä»£ç†å¿…é¡»å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æ‹¦æˆªå’Œå¤„ç†è¿›å‡ºåº”ç”¨å®¹å™¨çš„æµé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•å…¥-ebpf&#34;&gt;å¼•å…¥ eBPF&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://ebpf.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;eBPF&lt;/a&gt; æ˜¯ä¸€ç§å†…æ ¸æŠ€æœ¯ï¼Œå…è®¸è‡ªå®šä¹‰ç¨‹åºåœ¨å†…æ ¸ä¸­è¿è¡Œã€‚è¿™äº›ç¨‹åºåœ¨å“åº”äº‹ä»¶æ—¶è¿è¡Œï¼Œæœ‰æˆåƒä¸Šä¸‡ä¸ªå¯èƒ½çš„äº‹ä»¶ï¼ŒeBPF ç¨‹åºå¯ä»¥è¢«é™„åŠ åˆ°è¿™äº›äº‹ä»¶ä¸Šã€‚è¿™äº›äº‹ä»¶åŒ…æ‹¬è½¨è¿¹ç‚¹ã€è¿›å…¥æˆ–é€€å‡ºä»»ä½•åŠŸèƒ½ï¼ˆåœ¨å†…æ ¸æˆ–ç”¨æˆ·ç©ºé—´ï¼‰æˆ–å¯¹æœåŠ¡ç½‘æ ¼æ¥è¯´å¾ˆé‡è¦çš„ â€”â€” æŠµè¾¾çš„ç½‘ç»œæ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;é‡è¦çš„æ˜¯ï¼Œ&lt;strong&gt;æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå†…æ ¸&lt;/strong&gt;ï¼›åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰å®¹å™¨ï¼ˆä¹Ÿå°±æ˜¯æ‰€æœ‰çš„ podï¼‰å…±äº«åŒä¸€ä¸ªå†…æ ¸ã€‚å¦‚æœä½ åœ¨å†…æ ¸ä¸­æ·»åŠ ä¸€ä¸ª eBPF ç¨‹åºåˆ°ä¸€ä¸ªäº‹ä»¶ä¸­ï¼Œå®ƒå°†è¢«è§¦å‘ï¼Œæ— è®ºå“ªä¸ªè¿›ç¨‹å¼•èµ·è¯¥äº‹ä»¶ï¼Œæ— è®ºå®ƒæ˜¯åœ¨åº”ç”¨å®¹å™¨ä¸­è¿è¡Œè¿˜æ˜¯ç›´æ¥è¿è¡Œåœ¨ä¸»æœºä¸Šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¯å°ä¸»æœºä¸€ä¸ªå†…æ ¸&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¯å°ä¸»æœºä¸€ä¸ªå†…æ ¸&#34; srcset=&#34;
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t_hu3b5b0065a6d88b2cfbf8efe57179a1d9_145091_57ed427b1c68286b2e8359f010385ff1.webp 400w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t_hu3b5b0065a6d88b2cfbf8efe57179a1d9_145091_3c946d94432720c798ed972cbcc86a96.webp 760w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t_hu3b5b0065a6d88b2cfbf8efe57179a1d9_145091_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6c8mn9j31ea0u0n0t_hu3b5b0065a6d88b2cfbf8efe57179a1d9_145091_57ed427b1c68286b2e8359f010385ff1.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¯å°ä¸»æœºä¸€ä¸ªå†…æ ¸
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ eBPF å¯¹äº Kubernetes ä¸­çš„ä»»ä½•ä¸€ç§ instrumentation æ¥è¯´éƒ½æ˜¯å¦‚æ­¤ä»¤äººå…´å¥‹çš„æŠ€æœ¯ â€”â€” ä½ åªéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€æ¬¡ instrumentation ï¼Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åº pod éƒ½ä¼šè¢«è¦†ç›–ã€‚æ— è®ºä½ æ˜¯åœ¨å¯»æ±‚å¯è§‚æµ‹æ€§ã€å®‰å…¨æ€§è¿˜æ˜¯ç½‘ç»œï¼Œç”± eBPF é©±åŠ¨çš„è§£å†³æ–¹æ¡ˆéƒ½å¯ä»¥åœ¨ä¸éœ€è¦ sidecar çš„æƒ…å†µä¸‹å¯¹åº”ç”¨è¿›è¡Œæ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº eBPF çš„ &lt;a href=&#34;http://cilium.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium&lt;/a&gt; é¡¹ç›®ï¼ˆæœ€è¿‘ &lt;a href=&#34;https://www.cncf.io/blog/2021/10/13/cilium-joins-cncf-as-an-incubating-project/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥å­µåŒ–çº§åˆ«åŠ å…¥äº‘è®¡ç®—åŸºé‡‘ä¼š&lt;/a&gt;ï¼‰å°†è¿™ç§ â€œæ—  sidecar&amp;quot; æ¨¡å¼å¸¦åˆ°äº†æœåŠ¡ç½‘æ ¼çš„ä¸–ç•Œã€‚é™¤äº†ä¼ ç»Ÿçš„ sidecar æ¨¡å‹ï¼ŒCilium è¿˜æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ª Envoy ä»£ç†å®ä¾‹è¿è¡ŒæœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ã€‚ä½¿ç”¨æˆ‘ä»¬å‰é¢çš„ä¾‹å­ï¼Œè¿™å°±æŠŠä»£ç†å®ä¾‹çš„æ•°é‡ä» 100 ä¸ªå‡å°‘åˆ°åªæœ‰ 3 ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ç”¨æ— sidecarä»£ç†æ¨¡å¼å‡å°‘ä»£ç†å®ä¾‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;ç”¨æ— sidecarä»£ç†æ¨¡å¼å‡å°‘ä»£ç†å®ä¾‹&#34; srcset=&#34;
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp_hu6485f23e60e2e8e9568294bae27898e8_169519_40c1c1aa91b3dcd3e02907745bd9eb65.webp 400w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp_hu6485f23e60e2e8e9568294bae27898e8_169519_a7883e6de360533ff756252844319881.webp 760w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp_hu6485f23e60e2e8e9568294bae27898e8_169519_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp67ocjkj31xt0u0jvp_hu6485f23e60e2e8e9568294bae27898e8_169519_40c1c1aa91b3dcd3e02907745bd9eb65.webp&#34;
               width=&#34;760&#34;
               height=&#34;327&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      ç”¨æ— sidecarä»£ç†æ¨¡å¼å‡å°‘ä»£ç†å®ä¾‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å‡å°‘-yaml&#34;&gt;å‡å°‘ YAML&lt;/h2&gt;
&lt;p&gt;åœ¨ sidecar æ¨¡å‹ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªåº”ç”¨ pod çš„ YAML éœ€è¦è¢«ä¿®æ”¹ä»¥æ·»åŠ  sidecar å®¹å™¨ã€‚è¿™é€šå¸¸æ˜¯è‡ªåŠ¨åŒ–çš„ â€”â€” ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€ä¸ª mutating webhookï¼Œåœ¨æ¯ä¸ªåº”ç”¨ pod éƒ¨ç½²çš„æ—¶å€™æ³¨å…¥ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ Istio ä¸ºä¾‹ï¼Œè¿™éœ€è¦&lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#controlling-the-injection-policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ‡è®°&lt;/a&gt; Kubernetes å‘½åç©ºé—´å’Œ / æˆ– podï¼Œä»¥å®šä¹‰æ˜¯å¦åº”è¯¥æ³¨å…¥ sidecarâ€”â€” å½“ç„¶ä¹Ÿéœ€è¦ä¸ºé›†ç¾¤å¯ç”¨ mutating webhookã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¦‚æœå‡ºäº†é—®é¢˜æ€ä¹ˆåŠï¼Ÿå¦‚æœå‘½åç©ºé—´æˆ– pod çš„æ ‡ç­¾ä¸æ­£ç¡®ï¼Œé‚£ä¹ˆ sidecar å°†ä¸ä¼šè¢«æ³¨å…¥ï¼Œpod å°†ä¸ä¼šè¢«è¿æ¥åˆ°æœåŠ¡ç½‘æ ¼ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœæ”»å‡»è€…ç ´åäº†é›†ç¾¤ï¼Œå¹¶èƒ½å¤Ÿè¿è¡Œä¸€ä¸ªæ¶æ„çš„å·¥ä½œè´Ÿè½½ â€”â€” ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ å¯†è´§å¸çŸ¿å·¥ï¼Œä»–ä»¬å°†ä¸å¤ªå¯èƒ½æ ‡è®°å®ƒï¼Œä»¥ä¾¿å®ƒåŠ å…¥æœåŠ¡ç½‘æ ¼ã€‚å®ƒä¸ä¼šé€šè¿‡æœåŠ¡ç½‘æ ¼æä¾›çš„æµé‡è§‚å¯Ÿèƒ½åŠ›è€Œè¢«å‘ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨æ”¯æŒ eBPF çš„æ—  sidecar ä»£ç†æ¨¡å‹ä¸­ï¼Œpod ä¸éœ€è¦ä»»ä½•é¢å¤–çš„ YAML å°±å¯ä»¥è¢«æ£€æµ‹ã€‚ç›¸åï¼Œä¸€ä¸ª CRD è¢«ç”¨æ¥åœ¨é›†ç¾¤èŒƒå›´å†…é…ç½®æœåŠ¡ç½‘æ ¼ã€‚å³ä½¿æ˜¯å·²ç»å­˜åœ¨çš„ pod ä¹Ÿå¯ä»¥æˆä¸ºæœåŠ¡ç½‘æ ¼çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ”»å‡»è€…è¯•å›¾é€šè¿‡ç›´æ¥åœ¨ä¸»æœºä¸Šè¿è¡Œå·¥ä½œè´Ÿè½½æ¥ç»•è¿‡ Kubernetes ç¼–æ’ï¼ŒeBPF ç¨‹åºå¯ä»¥æ£€æµ‹å¹¶æ§åˆ¶è¿™ä¸€æ´»åŠ¨ï¼Œå› ä¸ºè¿™ä¸€åˆ‡éƒ½å¯ä»¥ä»å†…æ ¸çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-æ”¯æŒçš„ç½‘ç»œæ•ˆç‡&#34;&gt;eBPF æ”¯æŒçš„ç½‘ç»œæ•ˆç‡&lt;/h2&gt;
&lt;p&gt;æ”¯æŒ eBPF çš„ç½‘ç»œå…è®¸æ•°æ®åŒ…èµ°æ·å¾„ï¼Œç»•è¿‡å†…æ ¸çš„éƒ¨åˆ†ç½‘ç»œå †æ ˆï¼Œè¿™å¯ä»¥ä½¿ Kubernetes ç½‘ç»œçš„&lt;a href=&#34;https://cilium.io/blog/2021/05/11/cni-benchmark&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ€§èƒ½å¾—åˆ°æ˜¾è‘—æ”¹å–„&lt;/a&gt;ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™åœ¨æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸­æ˜¯å¦‚ä½•åº”ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åœ¨ebpfåŠ é€Ÿæ— sidecarçš„æœåŠ¡ç½‘æ ¼æ¨¡å‹ä¸­ç½‘ç»œæ•°æ®åŒ…é€šè¿‡çš„è·¯å¾„è¦çŸ­å¾—å¤š&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åœ¨eBPFåŠ é€Ÿã€æ— sidecarçš„æœåŠ¡ç½‘æ ¼æ¨¡å‹ä¸­ï¼Œç½‘ç»œæ•°æ®åŒ…é€šè¿‡çš„è·¯å¾„è¦çŸ­å¾—å¤š&#34; srcset=&#34;
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw_hu6485f23e60e2e8e9568294bae27898e8_205265_8ec0cae22ef1103e681d1e971eaf3d97.webp 400w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw_hu6485f23e60e2e8e9568294bae27898e8_205265_747ad95ff0c2512802aaacc95f572bda.webp 760w,
               /translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw_hu6485f23e60e2e8e9568294bae27898e8_205265_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/how-ebpf-streamlines-the-service-mesh/008i3skNly1gvtp6ao3lqj31q90u0gqw_hu6485f23e60e2e8e9568294bae27898e8_205265_8ec0cae22ef1103e681d1e971eaf3d97.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åœ¨eBPFåŠ é€Ÿã€æ— sidecarçš„æœåŠ¡ç½‘æ ¼æ¨¡å‹ä¸­ï¼Œç½‘ç»œæ•°æ®åŒ…é€šè¿‡çš„è·¯å¾„è¦çŸ­å¾—å¤š
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æœåŠ¡ç½‘æ ¼çš„æƒ…å†µä¸‹ï¼Œä»£ç†åœ¨ä¼ ç»Ÿç½‘ç»œä¸­ä½œä¸º sidecar è¿è¡Œï¼Œæ•°æ®åŒ…åˆ°è¾¾åº”ç”¨ç¨‹åºçš„è·¯å¾„ç›¸å½“æ›²æŠ˜ï¼šå…¥ç«™æ•°æ®åŒ…å¿…é¡»ç©¿è¶Šä¸»æœº TCP/IP æ ˆï¼Œé€šè¿‡è™šæ‹Ÿä»¥å¤ªç½‘è¿æ¥åˆ°è¾¾ pod çš„ç½‘ç»œå‘½åç©ºé—´ã€‚ä»é‚£é‡Œï¼Œæ•°æ®åŒ…å¿…é¡»ç©¿è¿‡ pod çš„ç½‘ç»œå †æ ˆåˆ°è¾¾ä»£ç†ï¼Œä»£ç†å°†æ•°æ®åŒ…é€šè¿‡å›ç¯æ¥å£è½¬å‘åˆ°åº”ç”¨ç¨‹åºã€‚è€ƒè™‘åˆ°æµé‡å¿…é¡»åœ¨è¿æ¥çš„ä¸¤ç«¯æµç»ä»£ç†ï¼Œä¸éæœåŠ¡ç½‘æ ¼æµé‡ç›¸æ¯”ï¼Œè¿™å°†å¯¼è‡´å»¶è¿Ÿçš„&lt;a href=&#34;https://linkerd.io/2021/05/27/linkerd-vs-istio-benchmarks/#latency-at-20-rps&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜¾è‘—å¢åŠ &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº eBPF çš„ Kubernetes CNI å®ç°ï¼Œå¦‚ Ciliumï¼Œå¯ä»¥ä½¿ç”¨ eBPF ç¨‹åºï¼Œæ˜æ™ºåœ°é’©ä½å†…æ ¸ä¸­çš„ç‰¹å®šç‚¹ï¼Œæ²¿ç€æ›´ç›´æ¥çš„è·¯çº¿é‡å®šå‘æ•°æ®åŒ…ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Cilium çŸ¥é“æ‰€æœ‰çš„ Kubernetes ç«¯ç‚¹å’ŒæœåŠ¡çš„èº«ä»½ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ä¸»æœºæ—¶ï¼ŒCilium å¯ä»¥å°†å…¶ç›´æ¥åˆ†é…åˆ°å®ƒæ‰€è¦å»çš„ä»£ç†æˆ– Pod ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œä¸­çš„åŠ å¯†&#34;&gt;ç½‘ç»œä¸­çš„åŠ å¯†&lt;/h2&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªç½‘ç»œè§£å†³æ–¹æ¡ˆèƒ½å¤Ÿæ„è¯†åˆ° Kubernetes æœåŠ¡ï¼Œå¹¶åœ¨è¿™äº›æœåŠ¡çš„ç«¯ç‚¹ä¹‹é—´æä¾›ç½‘ç»œè¿æ¥ï¼Œé‚£ä¹ˆå®ƒèƒ½å¤Ÿæä¾›æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢çš„èƒ½åŠ›å°±ä¸è¶³ä¸ºå¥‡ã€‚ä½†è¿™äº›èƒ½åŠ›å¯ä»¥è¶…è¶ŠåŸºæœ¬çš„è¿æ¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯é€æ˜åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ¥ç¡®ä¿æ‰€æœ‰çš„åº”ç”¨æµé‡éƒ½æ˜¯ç»è¿‡è®¤è¯å’ŒåŠ å¯†çš„ã€‚è¿™æ˜¯é€šè¿‡åŒå‘ TLSï¼ˆmTLSï¼‰å®ç°çš„ï¼›æœåŠ¡ç½‘æ ¼ä»£ç†ç»„ä»¶ä½œä¸ºç½‘ç»œè¿æ¥çš„ç«¯ç‚¹ï¼Œå¹¶ä¸å…¶è¿œç¨‹å¯¹ç­‰ç‰©åå•†ä¸€ä¸ªå®‰å…¨çš„ TLS è¿æ¥ã€‚è¿™ç§è¿æ¥å¯¹ä»£ç†ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ï¼Œè€Œä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºåšä»»ä½•æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨åº”ç”¨å±‚ç®¡ç†çš„ TLS å¹¶ä¸æ˜¯å®ç°ç»„ä»¶é—´è®¤è¯å’ŒåŠ å¯†æµé‡çš„å”¯ä¸€æ–¹æ³•ã€‚å¦ä¸€ä¸ªé€‰æ‹©æ˜¯åœ¨ç½‘ç»œå±‚åŠ å¯†æµé‡ï¼Œä½¿ç”¨ &lt;a href=&#34;https://cilium.io/blog/2021/05/11/cni-benchmark#the-cost-of-encryption---wireguard-vs-ipsec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;IPSec æˆ– WireGuard&lt;/a&gt;ã€‚å› ä¸ºå®ƒåœ¨ç½‘ç»œå±‚æ“ä½œï¼Œè¿™ç§åŠ å¯†ä¸ä»…å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œè€Œä¸”å¯¹ä»£ç†ä¹Ÿæ˜¯é€æ˜çš„ â€”â€” å®ƒå¯ä»¥åœ¨æœ‰æˆ–æ²¡æœ‰æœåŠ¡ç½‘æ ¼æ—¶å¯ç”¨ã€‚å¦‚æœä½ ä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„å”¯ä¸€åŸå› æ˜¯æä¾›åŠ å¯†ï¼Œä½ å¯èƒ½æƒ³è€ƒè™‘ç½‘ç»œçº§åŠ å¯†ã€‚å®ƒä¸ä»…æ›´ç®€å•ï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨æ¥éªŒè¯å’ŒåŠ å¯†èŠ‚ç‚¹ä¸Šçš„ä»»ä½•æµé‡ â€”â€” å®ƒä¸åªé™äºé‚£äº›å¯ç”¨äº† sidecar çš„å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ebpf-æ˜¯æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢&#34;&gt;eBPF æ˜¯æœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼ŒeBPF åœ¨ Linux ç”Ÿäº§å‘è¡Œç‰ˆä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ä¸­å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä¼ä¸šå¯ä»¥åˆ©ç”¨å®ƒæ¥è·å¾—æ›´æœ‰æ•ˆçš„ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„æ›´æœ‰æ•ˆçš„æ•°æ®å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;å»å¹´ï¼Œæˆ‘ä»£è¡¨ &lt;a href=&#34;https://cncf.io/?utm_content=inline-mention&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF&lt;/a&gt; çš„æŠ€æœ¯ç›‘ç£å§”å‘˜ä¼šï¼Œå¯¹æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„æ•´åˆå’Œæ¸…æ™°åŒ–åšäº†ä¸€äº› &lt;a href=&#34;https://youtu.be/bESogtuHwX0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¢„æµ‹&lt;/a&gt;ã€‚åœ¨åŒä¸€ä¸»é¢˜æ¼”è®²ä¸­ï¼Œæˆ‘è°ˆåˆ° eBPF æœ‰å¯èƒ½æˆä¸ºæ›´å¤šé¡¹ç›®å’Œæ›´å¹¿æ³›éƒ¨ç½²èƒ½åŠ›çš„åŸºç¡€ã€‚è¿™ä¸¤ä¸ªæƒ³æ³•ç°åœ¨æ­£ç»“åˆåœ¨ä¸€èµ·ï¼Œå› ä¸º eBPF ä¼¼ä¹æ˜¯æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢çš„è‡ªç„¶è·¯å¾„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æœåŠ¡ç½‘æ ¼ç»ˆææŒ‡å—ç¬¬äºŒç‰ˆâ€”â€”ä¸‹ä¸€ä»£å¾®æœåŠ¡å¼€å‘</title>
      <link>https://lib.jimmysong.io/translation/service-mesh-ultimate-guide-e2/</link>
      <pubDate>Mon, 11 Oct 2021 10:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/service-mesh-ultimate-guide-e2/</guid>
      <description>&lt;h2 id=&#34;ä¸»è¦æ”¶è·&#34;&gt;ä¸»è¦æ”¶è·&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£é‡‡ç”¨æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„æ–°å…´æ¶æ„è¶‹åŠ¿ï¼Œç‰¹åˆ«æ˜¯å¤šäº‘ã€å¤šé›†ç¾¤å’Œå¤šç§Ÿæˆ·æ¨¡å¼ï¼Œå¦‚ä½•åœ¨å¼‚æ„åŸºç¡€è®¾æ–½ï¼ˆè£¸æœºã€è™šæ‹Ÿæœºå’Œ Kubernetesï¼‰ä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠä»è¾¹ç¼˜è®¡ç®—å±‚åˆ°ç½‘æ ¼çš„åº”ç”¨ / æœåŠ¡è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;äº†è§£æœåŠ¡ç½‘æ ¼ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€äº›æ–°æ¨¡å¼ï¼Œå¦‚å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ã€åª’ä½“æœåŠ¡ç½‘æ ¼ï¼ˆMedia Service Meshï¼‰å’Œæ··æ²Œç½‘æ ¼ï¼Œä»¥åŠç»å…¸çš„å¾®æœåŠ¡åæ¨¡å¼ï¼Œå¦‚ â€œæ­»æ˜Ÿï¼ˆDeath Starï¼‰ â€œæ¶æ„ã€‚&lt;/li&gt;
&lt;li&gt;è·å–æœ€æ–°çš„å…³äºåœ¨éƒ¨ç½²é¢†åŸŸä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„åˆ›æ–°æ€»ç»“ï¼Œåœ¨ Podï¼ˆK8s é›†ç¾¤ï¼‰å’Œ VMï¼ˆé K8s é›†ç¾¤ï¼‰ä¹‹é—´è¿›è¡Œå¿«é€Ÿå®éªŒã€æ··ä¹±å·¥ç¨‹å’Œé‡‘ä¸é›€éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;æ¢ç´¢æœåŠ¡ç½‘æ ¼æ‰©å±•é¢†åŸŸçš„åˆ›æ–°ï¼ŒåŒ…æ‹¬ï¼šå¢å¼ºèº«ä»½ç®¡ç†ï¼Œä»¥ç¡®ä¿å¾®æœåŠ¡è¿æ¥çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰è¯ä¹¦æˆæƒæ’ä»¶ï¼Œè‡ªé€‚åº”è·¯ç”±åŠŸèƒ½ï¼Œä»¥æé«˜æœåŠ¡çš„å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä»¥åŠå¢å¼º sidecar ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;äº†è§£æ“ä½œæ–¹é¢å³å°†å‡ºç°çš„æƒ…å†µï¼Œå¦‚é…ç½®å¤šé›†ç¾¤åŠŸèƒ½å’Œå°† Kubernetes å·¥ä½œè´Ÿè½½è¿æ¥åˆ°æ‰˜ç®¡åœ¨è™šæ‹ŸæœºåŸºç¡€è®¾æ–½ä¸Šçš„æœåŠ¡å™¨ï¼Œä»¥åŠç®¡ç†å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ä¸­æ‰€æœ‰åŠŸèƒ½å’Œ API çš„å¼€å‘è€…é—¨æˆ·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯æœ‰äº†é•¿è¶³çš„å‘å±•ã€‚æœåŠ¡ç½‘æ ¼åœ¨å„ç»„ç»‡é‡‡ç”¨äº‘åŸç”ŸæŠ€æœ¯æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚é€šè¿‡æä¾›å››ç§ä¸»è¦èƒ½åŠ› â€”â€” è¿æ¥æ€§ã€å¯é æ€§ã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨æ€§ï¼ŒæœåŠ¡ç½‘æ ¼å·²ç»æˆä¸º IT ç»„ç»‡çš„æŠ€æœ¯å’ŒåŸºç¡€è®¾æ–½ç°ä»£åŒ–å·¥ä½œçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚æœåŠ¡ç½‘æ ¼ä½¿å¼€å‘å’Œè¿ç»´å›¢é˜Ÿèƒ½å¤Ÿåœ¨åŸºç¡€è®¾æ–½å±‚é¢å®ç°è¿™äº›èƒ½åŠ›ï¼Œå› æ­¤ï¼Œå½“æ¶‰åŠåˆ°è·¨é¢†åŸŸçš„éåŠŸèƒ½éœ€æ±‚æ—¶ï¼Œåº”ç”¨å›¢é˜Ÿä¸éœ€è¦é‡æ–°å‘æ˜è½®å­ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªæœ¬æ–‡&lt;a href=&#34;https://www.infoq.com/articles/service-mesh-ultimate-guide/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€ç‰ˆ&lt;/a&gt;äº 2020 å¹´ 2 æœˆå‘è¡¨ä»¥æ¥ï¼ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯ç»å†äº†é‡å¤§åˆ›æ–°ï¼Œåœ¨ä¸æ–­å‘å±•çš„æœåŠ¡ç½‘æ ¼é¢†åŸŸå‡ºç°äº†ä¸€äº›æ–°çš„æ¶æ„è¶‹åŠ¿ã€æŠ€æœ¯èƒ½åŠ›å’ŒæœåŠ¡ç½‘æ ¼é¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼ŒæœåŠ¡ç½‘æ ¼äº§å“çš„å‘å±•è¿œè¿œè¶…è¿‡äº†åŸæœ‰çš„ Kubernetes è§£å†³æ–¹æ¡ˆï¼Œæ²¡æœ‰æ‰˜ç®¡åœ¨ Kubernetes å¹³å°ä¸Šçš„åº”ç”¨æ— æ³•åˆ©ç”¨æœåŠ¡ç½‘æ ¼ã€‚å¹¶éæ‰€æœ‰çš„ç»„ç»‡éƒ½å°†å…¶æ‰€æœ‰çš„ä¸šåŠ¡å’Œ IT åº”ç”¨ç¨‹åºè¿‡æ¸¡åˆ° Kubernetes äº‘å¹³å°ã€‚å› æ­¤ï¼Œè‡ªæœåŠ¡ç½‘æ ¼è¯ç”Ÿä»¥æ¥ï¼Œä¸€ç›´éœ€è¦è¿™é¡¹æŠ€æœ¯åœ¨ä¸åŒçš„ IT åŸºç¡€è®¾æ–½ç¯å¢ƒä¸­å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;éšç€å¾®æœåŠ¡æ¶æ„çš„ä¸æ–­é‡‡ç”¨ï¼Œåº”ç”¨ç³»ç»Ÿåœ¨äº‘ä¾›åº”å•†ã€åŸºç¡€è®¾æ–½ï¼ˆKubernetesã€è™šæ‹Ÿæœºã€è£¸æœºæœåŠ¡å™¨ï¼‰ã€åœ°åŸŸï¼Œç”šè‡³åœ¨æœåŠ¡ç½‘æ ¼é›†æˆç¯å¢ƒä¸­è¦ç®¡ç†çš„å·¥ä½œè´Ÿè½½ç±»å‹æ–¹é¢ï¼Œéƒ½å·²å®ç°è§£è€¦å’Œåˆ†å¸ƒå¼ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä»æœåŠ¡ç½‘æ ¼çš„å†å²å¼€å§‹è¯´èµ·ï¼Œäº†è§£æœåŠ¡ç½‘æ ¼æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;p&gt;2016 å¹´å‰åï¼Œâ€œæœåŠ¡ç½‘æ ¼ &amp;quot; è¿™ä¸ªè¯å‡ºç°åœ¨å¾®æœåŠ¡ã€äº‘è®¡ç®—å’Œ DevOps çš„é¢†åŸŸã€‚Buoyant å›¢é˜Ÿåœ¨ 2016 å¹´ç”¨&lt;a href=&#34;https://twitter.com/wm/status/1383061764938469377?s=20&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ª&lt;/a&gt;è¯æ¥è§£é‡Šä»–ä»¬çš„äº§å“ Linkerdã€‚å’Œäº‘è®¡ç®—é¢†åŸŸçš„è®¸å¤šæ¦‚å¿µä¸€æ ·ï¼Œç›¸å…³çš„æ¨¡å¼å’ŒæŠ€æœ¯å…¶å®æœ‰å¾ˆé•¿çš„å†å²ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼çš„åˆ°æ¥ä¸»è¦æ˜¯ç”±äº IT é¢†åŸŸå†…çš„ä¸€åœºé£æš´ã€‚å¼€å‘äººå‘˜å¼€å§‹ä½¿ç”¨å¤šè¯­è¨€ï¼ˆpolyglotï¼‰æ–¹æ³•æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶éœ€è¦åŠ¨æ€æœåŠ¡å‘ç°ã€‚è¿ç»´éƒ¨é—¨å¼€å§‹ä½¿ç”¨çŸ­æš‚çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å¸Œæœ›ä¼˜é›…åœ°å¤„ç†ä¸å¯é¿å…çš„é€šä¿¡æ•…éšœå’Œæ‰§è¡Œç½‘ç»œç­–ç•¥ã€‚å¹³å°å›¢é˜Ÿå¼€å§‹æ¥å—åƒ Kubernetes è¿™æ ·çš„å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œå¹¶å¸Œæœ›ä½¿ç”¨ç°ä»£ API é©±åŠ¨çš„ç½‘ç»œä»£ç†ï¼ˆå¦‚ Envoyï¼‰åœ¨ç³»ç»Ÿä¸­å’Œå‘¨å›´åŠ¨æ€åœ°è·¯ç”±æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ—¨åœ¨å›ç­”è½¯ä»¶æ¶æ„å¸ˆå’ŒæŠ€æœ¯è´Ÿè´£äººçš„ç›¸å…³é—®é¢˜ï¼Œå¦‚ï¼šä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿæˆ‘æ˜¯å¦éœ€è¦æœåŠ¡ç½‘æ ¼ï¼Ÿå¦‚ä½•è¯„ä¼°ä¸åŒçš„æœåŠ¡ç½‘æ ¼äº§å“ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼æ¨¡å¼&#34;&gt;æœåŠ¡ç½‘æ ¼æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ¨¡å¼ä¸“æ³¨äºç®¡ç†åˆ†å¸ƒå¼è½¯ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èƒŒæ™¯ä»‹ç»&#34;&gt;èƒŒæ™¯ä»‹ç»&lt;/h3&gt;
&lt;p&gt;è¯¥æ¨¡å¼çš„èƒŒæ™¯æœ‰ä¸¤ä¸ªæ–¹é¢ã€‚é¦–å…ˆï¼Œå·¥ç¨‹å¸ˆä»¬å·²ç»é‡‡ç”¨äº†å¾®æœåŠ¡æ¶æ„æ¨¡å¼ï¼Œå¹¶é€šè¿‡å°†å¤šä¸ªï¼ˆç†æƒ³æƒ…å†µä¸‹æ˜¯å•ä¸€ç”¨é€”ä¸”å¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼‰æœåŠ¡ç»„åˆåœ¨ä¸€èµ·æ„å»ºä»–ä»¬çš„åº”ç”¨ã€‚ç¬¬äºŒï¼Œç»„ç»‡å·²ç»æ¥å—äº†äº‘åŸç”Ÿå¹³å°æŠ€æœ¯ï¼Œå¦‚å®¹å™¨ï¼ˆå¦‚ Dockerï¼‰ã€ç¼–æ’å™¨ï¼ˆå¦‚ Kubernetesï¼‰å’Œç½‘å…³ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ„å›¾&#34;&gt;æ„å›¾&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ¨¡å¼è¯•å›¾è§£å†³çš„é—®é¢˜åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆé™¤äº†å°†ç‰¹å®šè¯­è¨€çš„é€šä¿¡åº“ç¼–è¯‘åˆ°å•ä¸ªæœåŠ¡ä¸­çš„éœ€æ±‚ï¼Œä»¥å¤„ç†æœåŠ¡å‘ç°ã€è·¯ç”±å’Œåº”ç”¨å±‚ï¼ˆç¬¬ 7 å±‚ï¼‰éåŠŸèƒ½é€šä¿¡è¦æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨åŒ–æœåŠ¡é€šä¿¡é…ç½®ï¼ŒåŒ…æ‹¬å¤–éƒ¨æœåŠ¡çš„ç½‘ç»œä½ç½®ã€å®‰å…¨å‡­è¯å’ŒæœåŠ¡è´¨é‡ç›®æ ‡ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›å¯¹å…¶ä»–æœåŠ¡çš„è¢«åŠ¨å’Œä¸»åŠ¨ç›‘æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­åˆ†å¸ƒå¼åœ°æ‰§è¡Œç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›å¯è§‚æµ‹æ€§çš„é»˜è®¤å€¼ï¼Œå¹¶ä½¿ç›¸å…³æ•°æ®çš„æ”¶é›†æ ‡å‡†åŒ–ã€‚
&lt;ul&gt;
&lt;li&gt;å¯ç”¨è¯·æ±‚è®°å½•&lt;/li&gt;
&lt;li&gt;é…ç½®åˆ†å¸ƒå¼è¿½è¸ª&lt;/li&gt;
&lt;li&gt;æ”¶é›†æŒ‡æ ‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç»“æ„&#34;&gt;ç»“æ„&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ¨¡å¼ä¸»è¦ä¾§é‡äºå¤„ç†ä¼ ç»Ÿä¸Šè¢«ç§°ä¸º â€œä¸œè¥¿å‘ â€œçš„åŸºäºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰çš„æµé‡ï¼šè¯·æ±‚ / å“åº”ç±»å‹çš„é€šä¿¡ï¼Œæºè‡ªæ•°æ®ä¸­å¿ƒå†…éƒ¨ï¼Œåœ¨æœåŠ¡ä¹‹é—´ä¼ æ’­ã€‚è¿™ä¸ API ç½‘å…³æˆ–è¾¹ç¼˜ä»£ç†ç›¸åï¼Œåè€…è¢«è®¾è®¡ä¸ºå¤„ç† â€œå—åŒ— â€œæµé‡ã€‚æ¥è‡ªå¤–éƒ¨çš„é€šä¿¡ï¼Œè¿›å…¥æ•°æ®ä¸­å¿ƒå†…çš„ä¸€ä¸ªç»ˆç«¯æˆ–æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼çš„ç‰¹ç‚¹&#34;&gt;æœåŠ¡ç½‘æ ¼çš„ç‰¹ç‚¹&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼çš„å®æ–½é€šå¸¸ä¼šæä¾›ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è§„èŒƒåŒ–å‘½åå¹¶å¢åŠ é€»è¾‘è·¯ç”±ï¼Œï¼ˆä¾‹å¦‚ï¼Œå°†ä»£ç çº§åç§° â€œç”¨æˆ·æœåŠ¡ &amp;quot; æ˜ å°„åˆ°å¹³å°ç‰¹å®šä½ç½® â€œAWS-us-east-1a/prod/users/v4â€ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›æµé‡æ•´å½¢å’Œæµé‡è½¬ç§»&lt;/li&gt;
&lt;li&gt;ä¿æŒè´Ÿè½½å‡è¡¡ï¼Œé€šå¸¸é‡‡ç”¨å¯é…ç½®çš„ç®—æ³•&lt;/li&gt;
&lt;li&gt;æä¾›æœåŠ¡å‘å¸ƒæ§åˆ¶ï¼ˆä¾‹å¦‚ï¼Œé‡‘ä¸é›€é‡Šæ”¾å’Œæµé‡åˆ†å‰²ï¼‰&lt;/li&gt;
&lt;li&gt;æä¾›æŒ‰è¯·æ±‚çš„è·¯ç”±ï¼ˆä¾‹å¦‚ï¼Œå½±å­æµé‡ã€æ•…éšœæ³¨å…¥å’Œè°ƒè¯•é‡æ–°è·¯ç”±ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ åŸºçº¿å¯é æ€§ï¼Œå¦‚å¥åº·æ£€æŸ¥ã€è¶…æ—¶ / æˆªæ­¢æ—¥æœŸã€æ–­è·¯å’Œé‡è¯•ï¼ˆé¢„ç®—ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡é€æ˜çš„åŒå‘ä¼ è¾“çº§å®‰å…¨ï¼ˆTLSï¼‰å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ç­‰ç­–ç•¥ï¼Œæé«˜å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;æä¾›é¢å¤–çš„å¯è§‚æµ‹æ€§å’Œç›‘æµ‹ï¼Œå¦‚é¡¶çº¿æŒ‡æ ‡ï¼ˆè¯·æ±‚é‡ã€æˆåŠŸç‡å’Œå»¶è¿Ÿï¼‰ï¼Œæ”¯æŒåˆ†å¸ƒå¼è¿½è¸ªï¼Œä»¥åŠ &amp;ldquo;æŒ–æ˜&amp;rdquo; å’Œæ£€æŸ¥å®æ—¶æœåŠ¡é—´é€šä¿¡çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿å¾—å¹³å°å›¢é˜Ÿèƒ½å¤Ÿé…ç½® &amp;quot; ç†æ™ºçš„é»˜è®¤å€¼â€ï¼Œä»¥ä¿æŠ¤ç³»ç»Ÿå…å—ä¸è‰¯é€šä¿¡çš„å½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼çš„èƒ½åŠ›å¯åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿æ¥æ€§&lt;/li&gt;
&lt;li&gt;å¯é æ€§&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;å¯è§‚æµ‹æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹æœåŠ¡ç½‘æ ¼æŠ€æœ¯åœ¨è¿™äº›é¢†åŸŸéƒ½èƒ½æä¾›å“ªäº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿æ¥æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡æ§åˆ¶ï¼ˆè·¯ç”±ï¼Œåˆ†æµï¼‰&lt;/li&gt;
&lt;li&gt;ç½‘å…³ï¼ˆå…¥å£ã€å‡ºå£ï¼‰&lt;/li&gt;
&lt;li&gt;æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;A/B æµ‹è¯•ã€é‡‘ä¸é›€&lt;/li&gt;
&lt;li&gt;æœåŠ¡è¶…æ—¶ã€é‡è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¯é æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–­è·¯å™¨&lt;/li&gt;
&lt;li&gt;æ•…éšœæ³¨å…¥ / æ··æ²Œæµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡é—´è®¤è¯ï¼ˆmTLSï¼‰&lt;/li&gt;
&lt;li&gt;è¯ä¹¦ç®¡ç†&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è®¤è¯ï¼ˆJWTï¼‰&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·æˆæƒï¼ˆRBACï¼‰&lt;/li&gt;
&lt;li&gt;åŠ å¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¯è§‚æµ‹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›‘æµ‹&lt;/li&gt;
&lt;li&gt;é¥æµ‹ã€ä»ªè¡¨ã€è®¡é‡&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/li&gt;
&lt;li&gt;æœåŠ¡å›¾è¡¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼æ¶æ„å†…éƒ¨åŸç†&#34;&gt;æœåŠ¡ç½‘æ ¼æ¶æ„ï¼šå†…éƒ¨åŸç†&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚Matt Kleinï¼Œ&lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy&lt;/a&gt; çš„ä½œè€…ï¼Œå†™äº†ä¸€ç¯‡å…³äº â€œ &lt;a href=&#34;https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢ä¸æ§åˆ¶å¹³é¢ &lt;/a&gt;â€œçš„æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;
&lt;p&gt;å¹¿ä¹‰ä¸Šè®²ï¼Œæ•°æ®å¹³é¢ â€œæ‰§è¡Œå·¥ä½œâ€ï¼Œè´Ÿè´£ â€œæœ‰æ¡ä»¶åœ°ç¿»è¯‘ã€è½¬å‘å’Œè§‚å¯Ÿæµå‘å’Œæ¥è‡ª [ç½‘ç»œç»ˆç«¯] çš„æ¯ä¸ªç½‘ç»œæ•°æ®åŒ…â€ã€‚åœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œæ•°æ®å¹³é¢é€šå¸¸ä»¥ä»£ç†çš„å½¢å¼å®ç°ï¼Œï¼ˆå¦‚ Envoyã€&lt;a href=&#34;http://www.haproxy.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/mosn/mosn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MOSN&lt;/a&gt;ï¼‰ï¼Œå®ƒä½œä¸º &amp;ldquo;sidecar&amp;rdquo; ä¸æ¯ä¸ªæœåŠ¡ä¸€èµ·åœ¨è¿›ç¨‹å¤–è¿è¡Œã€‚Linkerd ä½¿ç”¨äº†ä¸€ç§ &lt;a href=&#34;https://linkerd.io/2020/12/03/why-linkerd-doesnt-use-envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®å‹ä»£ç†&lt;/a&gt;æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é’ˆå¯¹æœåŠ¡ç½‘æ ¼çš„ä½¿ç”¨æƒ…å†µè¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢ â€œç›‘ç£å·¥ä½œâ€ï¼Œå¹¶å°†æ•°æ®å¹³é¢çš„æ‰€æœ‰å•ä¸ªå®ä¾‹ â€”â€” ä¸€ç»„å­¤ç«‹çš„æ— çŠ¶æ€ sidecar ä»£ç†å˜æˆä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ§åˆ¶å¹³é¢ä¸æ¥è§¦ç³»ç»Ÿä¸­çš„ä»»ä½•æ•°æ®åŒ… / è¯·æ±‚ï¼Œç›¸åï¼Œå®ƒå…è®¸äººç±»è¿ç»´äººå‘˜ä¸ºç½‘æ ¼ä¸­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æ•°æ®å¹³é¢æä¾›ç­–ç•¥å’Œé…ç½®ã€‚æ§åˆ¶å¹³é¢è¿˜èƒ½å¤Ÿæ”¶é›†å’Œé›†ä¸­æ•°æ®å¹³é¢çš„é¥æµ‹æ•°æ®ï¼Œä¾›è¿ç»´äººå‘˜ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„ç»“åˆæä¾›äº†ä¸¤æ–¹é¢çš„ä¼˜åŠ¿ï¼Œå³ç­–ç•¥å¯ä»¥é›†ä¸­å®šä¹‰å’Œç®¡ç†ï¼ŒåŒæ—¶ï¼ŒåŒæ ·çš„æ”¿ç­–å¯ä»¥ä»¥åˆ†æ•£çš„æ–¹å¼ï¼Œåœ¨ Kubernetes é›†ç¾¤çš„æ¯ä¸ª pod ä¸­æœ¬åœ°æ‰§è¡Œã€‚è¿™äº›ç­–ç•¥å¯ä»¥ä¸å®‰å…¨ã€è·¯ç”±ã€æ–­è·¯å™¨æˆ–ç›‘æ§æœ‰å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾å–è‡ª Istio æ¶æ„æ–‡æ¡£ï¼Œè™½ç„¶æ ‡æ³¨çš„æŠ€æœ¯æ˜¯ Istio ç‰¹æœ‰çš„ï¼Œä½†è¿™äº›ç»„ä»¶å¯¹æ‰€æœ‰æœåŠ¡ç½‘æ ¼çš„å®ç°éƒ½æ˜¯é€šç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-istio-æ¶æ„&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Istio æ¶æ„&#34; srcset=&#34;
               /translation/service-mesh-ultimate-guide-e2/arch_hu0adc02b1396584d7d7029a8f2091ade5_97133_0fe5ba70d2c9f629d74becfd1258c25d.webp 400w,
               /translation/service-mesh-ultimate-guide-e2/arch_hu0adc02b1396584d7d7029a8f2091ade5_97133_a6d9468ff64f0e0cb6e1ce3b732082f1.webp 760w,
               /translation/service-mesh-ultimate-guide-e2/arch_hu0adc02b1396584d7d7029a8f2091ade5_97133_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/service-mesh-ultimate-guide-e2/arch_hu0adc02b1396584d7d7029a8f2091ade5_97133_0fe5ba70d2c9f629d74becfd1258c25d.webp&#34;
               width=&#34;760&#34;
               height=&#34;538&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Istio æ¶æ„
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio æ¶æ„ï¼Œå±•ç¤ºäº†æ§åˆ¶å¹³é¢å’Œä»£ç†æ•°æ®å¹³é¢çš„äº¤äº’æ–¹å¼ï¼ˆç”± &lt;a href=&#34;https://istio.io/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio æ–‡æ¡£æä¾›&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨æ¡ˆä¾‹&#34;&gt;ä½¿ç”¨æ¡ˆä¾‹&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å¯ä»¥å®ç°æˆ–æ”¯æŒå¤šç§ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ¨æ€æœåŠ¡å‘ç°å’Œè·¯ç”±&#34;&gt;åŠ¨æ€æœåŠ¡å‘ç°å’Œè·¯ç”±&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æä¾›åŠ¨æ€æœåŠ¡å‘ç°å’Œæµé‡ç®¡ç†ï¼ŒåŒ…æ‹¬ç”¨äºæµ‹è¯•çš„æµé‡å½±å­ï¼ˆå¤åˆ¶ï¼‰ï¼Œä»¥åŠç”¨äºé‡‘ä¸é›€å‘å¸ƒå’Œ A/B å®éªŒçš„æµé‡åˆ†å‰²ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼ä¸­ä½¿ç”¨çš„ä»£ç†é€šå¸¸æ˜¯ â€œåº”ç”¨å±‚ &amp;quot; æ„ŸçŸ¥çš„ï¼ˆåœ¨ OSI ç½‘ç»œå †æ ˆçš„ç¬¬ 7 å±‚è¿è¡Œï¼‰ã€‚è¿™æ„å‘³ç€æµé‡è·¯ç”±å†³ç­–å’ŒæŒ‡æ ‡çš„æ ‡è®°å¯ä»¥åˆ©ç”¨ HTTP å¤´æˆ–å…¶ä»–åº”ç”¨å±‚åè®®å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡é—´é€šä¿¡å¯é æ€§&#34;&gt;æœåŠ¡é—´é€šä¿¡å¯é æ€§&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ”¯æŒè·¨é¢†åŸŸçš„å¯é æ€§è¦æ±‚çš„å®æ–½å’Œæ‰§è¡Œï¼Œå¦‚è¯·æ±‚é‡è¯•ã€è¶…æ—¶ã€é€Ÿç‡é™åˆ¶å’Œæ–­è·¯ã€‚æœåŠ¡ç½‘æ ¼ç»å¸¸è¢«ç”¨æ¥è¡¥å¿ï¼ˆæˆ–å°è£…ï¼‰å¤„ç†&lt;a href=&#34;https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆ†å¸ƒå¼è®¡ç®—çš„å…«ä¸ªè°¬è¯¯&lt;/a&gt;ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç½‘æ ¼åªèƒ½æä¾› wire-level çš„å¯é æ€§æ”¯æŒï¼ˆå¦‚é‡è¯• HTTP è¯·æ±‚ï¼‰ï¼Œæœ€ç»ˆæœåŠ¡åº”è¯¥å¯¹ç›¸å…³çš„ä¸šåŠ¡å½±å“è´Ÿè´£ï¼Œå¦‚é¿å…å¤šä¸ªï¼ˆéå¹‚ç­‰çš„ï¼‰HTTP POST è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµé‡çš„å¯è§‚æµ‹æ€§&#34;&gt;æµé‡çš„å¯è§‚æµ‹æ€§&lt;/h3&gt;
&lt;p&gt;ç”±äºæœåŠ¡ç½‘æ ¼å¤„äºç³»ç»Ÿå†…å¤„ç†çš„æ¯ä¸ªè¯·æ±‚çš„å…³é”®è·¯å¾„ä¸Šï¼Œå®ƒè¿˜å¯ä»¥æä¾›é¢å¤–çš„ â€œå¯è§‚æµ‹æ€§â€ï¼Œä¾‹å¦‚è¯·æ±‚çš„åˆ†å¸ƒå¼è¿½è¸ªã€HTTP é”™è¯¯ä»£ç çš„é¢‘ç‡ä»¥åŠå…¨å±€å’ŒæœåŠ¡é—´çš„å»¶è¿Ÿã€‚è™½ç„¶åœ¨ä¼ä¸šé¢†åŸŸæ˜¯ä¸€ä¸ªè¢«è¿‡åº¦ä½¿ç”¨çš„çŸ­è¯­ï¼Œä½†æœåŠ¡ç½‘æ ¼ç»å¸¸è¢«æè®®ä½œä¸ºä¸€ç§æ–¹æ³•æ¥æ•è·æ‰€æœ‰å¿…è¦çš„æ•°æ®ï¼Œä»¥å®ç°æ•´ä¸ªç³»ç»Ÿå†…æµé‡çš„ç»Ÿä¸€ç•Œé¢è§†å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€šä¿¡å®‰å…¨&#34;&gt;é€šä¿¡å®‰å…¨&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼è¿˜æ”¯æŒè·¨é¢†åŸŸå®‰å…¨è¦æ±‚çš„å®æ–½å’Œæ‰§è¡Œï¼Œå¦‚æä¾›æœåŠ¡èº«ä»½ï¼ˆé€šè¿‡ x509 è¯ä¹¦ï¼‰ï¼Œå®ç°åº”ç”¨çº§æœåŠ¡ / ç½‘ç»œåˆ†å‰²ï¼ˆä¾‹å¦‚ï¼Œâ€œæœåŠ¡ A&amp;quot; å¯ä»¥ä¸ â€œæœåŠ¡ B â€œé€šä¿¡ï¼Œä½†ä¸èƒ½ä¸ â€œæœåŠ¡ C â€œé€šä¿¡ï¼‰ï¼Œç¡®ä¿æ‰€æœ‰é€šä¿¡éƒ½ç»è¿‡åŠ å¯†ï¼ˆé€šè¿‡ TLSï¼‰ï¼Œå¹¶ç¡®ä¿å­˜åœ¨æœ‰æ•ˆçš„ç”¨æˆ·çº§èº«ä»½ä»¤ç‰Œæˆ– â€œ&lt;a href=&#34;https://qconsf.com/sf2019/presentation/user-device-identity-microservices-netflix-scale&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŠ¤ç…§&lt;/a&gt; &amp;ldquo;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åæ¨¡å¼&#34;&gt;åæ¨¡å¼&lt;/h2&gt;
&lt;p&gt;å½“åæ¨¡å¼çš„ä½¿ç”¨å‡ºç°æ—¶ï¼Œè¿™å¾€å¾€æ˜¯ä¸€ä¸ªæŠ€æœ¯æˆç†Ÿçš„æ ‡å¿—ã€‚æœåŠ¡ç½‘æ ¼ä¹Ÿä¸ä¾‹å¤–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤ªå¤šçš„æµé‡ç®¡ç†å±‚æ¬¡&#34;&gt;å¤ªå¤šçš„æµé‡ç®¡ç†å±‚æ¬¡&lt;/h3&gt;
&lt;p&gt;å½“å¼€å‘äººå‘˜ä¸ä¸å¹³å°æˆ–è¿ç»´å›¢é˜Ÿåå•†ï¼Œå¹¶åœ¨ç°åœ¨é€šè¿‡æœåŠ¡ç½‘æ ¼å®ç°çš„ä»£ç ä¸­é‡å¤ç°æœ‰çš„é€šä¿¡å¤„ç†é€»è¾‘æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§åæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œé™¤äº†æœåŠ¡ç½‘æ ¼æä¾›çš„ wire-level é‡è¯•ç­–ç•¥å¤–ï¼Œåº”ç”¨ç¨‹åºè¿˜åœ¨ä»£ç ä¸­è¿˜å®ç°äº†é‡è¯•ç­–ç•¥ã€‚è¿™ç§åæ¨¡å¼ä¼šå¯¼è‡´é‡å¤çš„äº‹åŠ¡ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼é“¶å¼¹&#34;&gt;æœåŠ¡ç½‘æ ¼é“¶å¼¹&lt;/h3&gt;
&lt;p&gt;åœ¨ IT é¢†åŸŸæ²¡æœ‰ â€œé“¶å¼¹ â€œè¿™æ ·çš„ä¸œè¥¿ï¼Œä½†ä¾›åº”å•†æœ‰æ—¶ä¼šè¢«è¯±æƒ‘ç»™æ–°æŠ€æœ¯è´´ä¸Šè¿™ä¸ªæ ‡ç­¾ã€‚æœåŠ¡ç½‘æ ¼ä¸ä¼šè§£å†³å¾®æœåŠ¡ã€Kubernetes ç­‰å®¹å™¨ç¼–æ’å™¨æˆ–äº‘ç½‘ç»œçš„æ‰€æœ‰é€šä¿¡é—®é¢˜ã€‚æœåŠ¡ç½‘æ ¼çš„ç›®çš„åªæ˜¯ä¿ƒè¿›æœåŠ¡ä»¶ï¼ˆä¸œè¥¿å‘ï¼‰çš„é€šä¿¡ï¼Œè€Œä¸”éƒ¨ç½²å’Œè¿è¡ŒæœåŠ¡ç½‘æ ¼æœ‰æ˜æ˜¾çš„è¿è¥æˆæœ¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼ä¸šæœåŠ¡æ€»çº¿esb20&#34;&gt;ä¼ä¸šæœåŠ¡æ€»çº¿ï¼ˆESBï¼‰2.0&lt;/h3&gt;
&lt;p&gt;åœ¨å‰å¾®æœåŠ¡é¢å‘æœåŠ¡æ¶æ„ï¼ˆSOAï¼‰æ—¶ä»£ï¼Œä¼ä¸šæœåŠ¡æ€»çº¿ï¼ˆESBï¼‰å®ç°äº†è½¯ä»¶ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ç³»ç»Ÿã€‚æœ‰äº›äººæ‹…å¿ƒ ESB æ—¶ä»£çš„è®¸å¤šé”™è¯¯ä¼šéšç€æœåŠ¡ç½‘æ ¼çš„ä½¿ç”¨è€Œé‡æ¼”ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ ESB æä¾›çš„é›†ä¸­çš„é€šä¿¡æ§åˆ¶æ˜¾ç„¶æœ‰ä»·å€¼ã€‚ç„¶è€Œï¼Œè¿™äº›æŠ€æœ¯çš„å‘å±•æ˜¯ç”±ä¾›åº”å•†æ¨åŠ¨çš„ï¼Œè¿™å¯¼è‡´äº†å¤šç§é—®é¢˜ï¼Œä¾‹å¦‚ï¼šESB ä¹‹é—´ç¼ºä¹äº’æ“ä½œæ€§ï¼Œè¡Œä¸šæ ‡å‡†çš„å®šåˆ¶æ‰©å±•ï¼ˆä¾‹å¦‚ï¼Œå°†ä¾›åº”å•†çš„ç‰¹å®šé…ç½®æ·»åŠ åˆ° WS-* å…¼å®¹æ¨¡å¼ä¸­ï¼‰ï¼Œä»¥åŠé«˜æˆæœ¬ã€‚ESB ä¾›åº”å•†ä¹Ÿæ²¡æœ‰åšä»»ä½•äº‹æƒ…æ¥é˜»æ­¢ä¸šåŠ¡é€»è¾‘ä¸é€šä¿¡æ€»çº¿çš„é›†æˆå’Œç´§è€¦åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤§çˆ†ç‚¸éƒ¨ç½²&#34;&gt;å¤§çˆ†ç‚¸éƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;åœ¨æ•´ä¸ª IT ç•Œæœ‰ä¸€ç§è¯±æƒ‘ï¼Œè®¤ä¸ºå¤§çˆ†ç‚¸å¼çš„éƒ¨ç½²æ–¹æ³•æ˜¯æœ€å®¹æ˜“ç®¡ç†çš„æ–¹æ³•ï¼Œä½†æ­£å¦‚ &lt;a href=&#34;https://itrevolution.com/book/accelerate/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Accelerate&lt;/a&gt; å’Œ &lt;a href=&#34;https://puppet.com/resources/report/state-of-devops-report/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DevOps æŠ¥å‘Š&lt;/a&gt;çš„ç ”ç©¶ï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚ç”±äºæœåŠ¡ç½‘æ ¼çš„å…¨é¢æ¨å¹¿æ„å‘³ç€è¿™é¡¹æŠ€æœ¯å¤„äºå¤„ç†æ‰€æœ‰ç»ˆç«¯ç”¨æˆ·è¯·æ±‚çš„å…³é”®è·¯å¾„ä¸Šï¼Œå¤§çˆ†ç‚¸å¼çš„éƒ¨ç½²æ˜¯éå¸¸å±é™©çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­»æ˜Ÿå»ºç­‘&#34;&gt;æ­»æ˜Ÿå»ºç­‘&lt;/h3&gt;
&lt;p&gt;å½“ä¼ä¸šé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå¼€å‘å›¢é˜Ÿå¼€å§‹åˆ›å»ºæ–°çš„å¾®æœåŠ¡æˆ–åœ¨åº”ç”¨ä¸­åˆ©ç”¨ç°æœ‰çš„æœåŠ¡æ—¶ï¼ŒæœåŠ¡é—´çš„é€šä¿¡æˆä¸ºæ¶æ„çš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ²»ç†æ¨¡å¼ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸åŒæœåŠ¡ä¹‹é—´çš„ç´§å¯†è€¦åˆã€‚å½“æ•´ä¸ªç³»ç»Ÿåœ¨ç”Ÿäº§ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œä¹Ÿå°†å¾ˆéš¾ç¡®å®šå“ªä¸ªæœåŠ¡å‡ºç°äº†é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç¼ºä¹æœåŠ¡æ²Ÿé€šæˆ˜ç•¥å’Œæ²»ç†æ¨¡å¼ï¼Œè¯¥æ¶æ„å°±ä¼šå˜æˆæ‰€è°“çš„ â€œæ­»æ˜Ÿæ¶æ„â€ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ç§æ¶æ„åæ¨¡å¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å…³äºäº‘åŸç”Ÿæ¶æ„é‡‡ç”¨çš„&lt;a href=&#34;https://www.infoq.com/articles/cloud-native-architecture-adoption-part1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt;ã€&lt;a href=&#34;https://www.infoq.com/articles/cloud-native-architecture-adoption-part2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/a&gt;å’Œ&lt;a href=&#34;https://www.infoq.com/articles/cloud-native-architecture-adoption-part3/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¬¬ä¸‰éƒ¨åˆ†çš„&lt;/a&gt;æ–‡ç« ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç‰¹å®šé¢†åŸŸçš„æœåŠ¡ç½‘æ ¼&#34;&gt;ç‰¹å®šé¢†åŸŸçš„æœåŠ¡ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼çš„æœ¬åœ°å®ç°å’Œè¿‡åº¦ä¼˜åŒ–æœ‰æ—¶ä¼šå¯¼è‡´æœåŠ¡ç½‘æ ¼éƒ¨ç½²èŒƒå›´è¿‡çª„ã€‚å¼€å‘äººå‘˜å¯èƒ½æ›´å–œæ¬¢é’ˆå¯¹è‡ªå·±çš„ä¸šåŠ¡é¢†åŸŸçš„æœåŠ¡ç½‘æ ¼ï¼Œä½†è¿™ç§æ–¹æ³•å¼Šå¤§äºåˆ©ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å®ç°è¿‡äºç»†åŒ–çš„æœåŠ¡ç½‘æ ¼èŒƒå›´ï¼Œæ¯”å¦‚ä¸ºç»„ç»‡ä¸­çš„æ¯ä¸ªä¸šåŠ¡æˆ–åŠŸèƒ½åŸŸï¼ˆå¦‚è´¢åŠ¡ã€äººåŠ›èµ„æºã€ä¼šè®¡ç­‰ï¼‰æä¾›ä¸“ç”¨çš„æœåŠ¡ç½‘æ ¼ã€‚è¿™å°±è¿èƒŒäº†æ‹¥æœ‰åƒæœåŠ¡ç½‘æ ¼è¿™æ ·çš„é€šç”¨æœåŠ¡åè°ƒè§£å†³æ–¹æ¡ˆçš„ç›®çš„ï¼Œå³ä¼ä¸šçº§æœåŠ¡å‘ç°æˆ–è·¨åŸŸæœåŠ¡è·¯ç”±ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼çš„å®ç°å’Œäº§å“&#34;&gt;æœåŠ¡ç½‘æ ¼çš„å®ç°å’Œäº§å“&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä»½éè¯¦å°½çš„å½“å‰æœåŠ¡ç½‘æ ¼å®æ–½æ¸…å•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkerd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd &lt;/a&gt;(CNCF æ¯•ä¸šé¡¹ç›®)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.consul.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kuma.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kuma&lt;/a&gt;ï¼ˆCNCF æ²™ç›’é¡¹ç›®ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/app-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS App Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nginx.com/products/nginx-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Service Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aspenmesh.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AspenMesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://konghq.com/kong-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kong&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.solo.io/products/gloo-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo Gloo Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://traefik.io/traefik-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik Mesh&lt;/a&gt;ï¼ˆåŸå Maeshï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://layer5.io/meshery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Meshery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openservicemesh.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Service MEsh&lt;/a&gt;ï¼ˆCNCF æ²™ç›’é¡¹ç›®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ï¼Œåƒ &lt;a href=&#34;https://www.datadoghq.com/blog/tag/service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DataDog&lt;/a&gt; è¿™æ ·çš„å…¶ä»–äº§å“ä¹Ÿå¼€å§‹æä¾›ä¸ &lt;a href=&#34;https://docs.datadoghq.com/integrations/linkerd/?tab=host&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt;ã€Istioã€Consul Connect å’Œ AWS App Mesh ç­‰æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„é›†æˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼å¯¹æ¯”&#34;&gt;æœåŠ¡ç½‘æ ¼å¯¹æ¯”&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„å‘å±•æä¸ºè¿…é€Ÿï¼Œå› æ­¤ä»»ä½•è¯•å›¾åˆ›å»ºæ¯”è¾ƒçš„åŠªåŠ›éƒ½å¯èƒ½å¾ˆå¿«å˜å¾—è¿‡æ—¶ã€‚ç„¶è€Œï¼Œç¡®å®å­˜åœ¨ä¸€äº›æ¯”è¾ƒã€‚åº”è¯¥æ³¨æ„äº†è§£æ¥æºçš„åè§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å’Œè¿›è¡Œæ¯”è¾ƒçš„æ—¥æœŸã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://layer5.io/landscape&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://layer5.io/landscape&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubedex.com/istio-vs-linkerd-vs-linkerd2-vs-consul/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubedex.com/istio-vs-linkerd-vs-linkerd2-vs-consul/&lt;/a&gt;ï¼ˆæˆªè‡³ 2021 å¹´ 8 æœˆçš„æ­£ç¡®æ•°æ®ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://platform9.com/blog/kubernetes-service-mesh-a-comparison-of-istio-linkerd-and-consul/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://platform9.com/blog/kubernetes-service-mesh-a-comparison-of-istio-linkerd-and-consul/&lt;/a&gt;ï¼ˆæˆªè‡³ 2019 å¹´ 10 æœˆçš„æœ€æ–°æƒ…å†µï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://servicemesh.es/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://servicemesh.es/ &lt;/a&gt;(æœ€åå‘è¡¨äº 2021 å¹´ 8 æœˆ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;InfoQ ä¸€ç›´å»ºè®®æœåŠ¡ç½‘æ ¼çš„é‡‡ç”¨è€…å¯¹æ¯ä¸ªäº§å“è¿›è¡Œè‡ªå·±çš„å°½èŒè°ƒæŸ¥å’Œè¯•éªŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼æ•™ç¨‹&#34;&gt;æœåŠ¡ç½‘æ ¼æ•™ç¨‹&lt;/h2&gt;
&lt;p&gt;å¯¹äºå¸Œæœ›è¯•éªŒå¤šæœåŠ¡ç½‘æ ¼çš„å·¥ç¨‹å¸ˆæˆ–å»ºç­‘å¸ˆæ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ•™ç¨‹ã€æ¸¸æˆåœºå’Œå·¥å…·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://layer5.io/meshery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Layer 5 Meshery&lt;/a&gt;â€”â€” å¤šç½‘æ ¼ç®¡ç†å¹³é¢&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/solo-io/supergloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Solo çš„ Gloo Mesh&lt;/a&gt;â€”â€” æœåŠ¡ç½‘æ ¼ç¼–æ’å¹³å°&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.katacoda.com/courses/istio/deploy-istio-on-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KataCoda Istio æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://learn.hashicorp.com/consul&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul æœåŠ¡ç½‘æ ¼æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkerd.io/2/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.nginx.com/nginx-service-mesh/tutorials/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX æœåŠ¡ç½‘æ ¼æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tetrate-academy.thinkific.com/courses/istio-fundamentals-zh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŸºç¡€æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼çš„å†å²&#34;&gt;æœåŠ¡ç½‘æ ¼çš„å†å²&lt;/h2&gt;
&lt;p&gt;è‡ª 2013 å¹´åº• Airbnb å‘å¸ƒ &lt;a href=&#34;https://medium.com/airbnb-engineering/smartstack-service-discovery-in-the-cloud-4b8a080de619&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SmartStack&lt;/a&gt;ï¼Œä¸ºæ–°å…´çš„ â€œ &lt;a href=&#34;https://www.infoq.com/microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡ &lt;/a&gt;â€œé£æ ¼æ¶æ„æä¾›è¿›ç¨‹å¤–æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆä½¿ç”¨ &lt;a href=&#34;http://www.haproxy.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAProxy&lt;/a&gt;ï¼‰ä»¥æ¥ï¼ŒInfoQ ä¸€ç›´åœ¨è·Ÿè¸ªè¿™ä¸ªæˆ‘ä»¬ç°åœ¨ç§°ä¹‹ä¸º &lt;a href=&#34;https://www.infoq.com/servicemesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/a&gt;çš„è¯é¢˜ã€‚è®¸å¤šä¹‹å‰è¢«è´´ä¸Š â€œç‹¬è§’å…½ â€œæ ‡ç­¾çš„ç»„ç»‡åœ¨æ­¤ä¹‹å‰å°±åœ¨ç ”ç©¶ç±»ä¼¼çš„æŠ€æœ¯ã€‚ä» 21 ä¸–çºªåˆå¼€å§‹ï¼Œè°·æ­Œå°±åœ¨å¼€å‘å…¶ &lt;a href=&#34;https://grpc.io/blog/principles/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stubby &lt;/a&gt;RPC æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æ¼”å˜æˆäº† &lt;a href=&#34;https://cloud.google.com/blog/products/gcp/grpc-a-true-internet-scale-rpc-framework-is-now-1-and-ready-for-production-deployments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC&lt;/a&gt;ï¼Œä»¥åŠ &lt;a href=&#34;https://landing.google.com/sre/sre-book/chapters/production-environment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°·æ­Œå‰ç«¯ï¼ˆGFEï¼‰&lt;/a&gt;å’Œå…¨å±€è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼ˆGSLBï¼‰ï¼Œåœ¨ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt; ä¸­å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„ç‰¹è´¨ã€‚åœ¨ 2010 å¹´ä»£æ—©æœŸï¼ŒTwitter å¼€å§‹äº† Scala é©±åŠ¨çš„ &lt;a href=&#34;https://twitter.github.io/finagle/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Finagle&lt;/a&gt; çš„å·¥ä½œï¼Œ&lt;a href=&#34;https://linkerd.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd&lt;/a&gt; æœåŠ¡ç½‘æ ¼ç”±æ­¤äº§ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;2014 å¹´åº•ï¼ŒNetflix å‘å¸ƒäº†&lt;a href=&#34;https://netflix.github.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ•´å¥—åŸºäº JVM çš„å®ç”¨ç¨‹åº&lt;/a&gt;ï¼ŒåŒ…æ‹¬ &lt;a href=&#34;https://www.infoq.com/news/2014/12/netflix-prana/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prana&lt;/a&gt;ï¼Œä¸€ä¸ª â€œsidecar â€œç¨‹åºï¼Œå…è®¸ç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„åº”ç”¨æœåŠ¡é€šè¿‡ HTTP ä¸åº“çš„ç‹¬ç«‹å®ä¾‹è¿›è¡Œé€šä¿¡ã€‚2016 å¹´ï¼ŒNGINX å›¢é˜Ÿå¼€å§‹è°ˆè®º â€œ&lt;a href=&#34;https://www.nginx.com/blog/microservices-reference-architecture-nginx-fabric-model/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fabric æ¨¡å‹&lt;/a&gt; &amp;ldquo;ï¼Œè¿™ä¸æœåŠ¡ç½‘æ ¼éå¸¸ç›¸ä¼¼ï¼Œä½†éœ€è¦ä½¿ç”¨ä»–ä»¬çš„å•†ä¸š NGINX Plus äº§å“æ¥å®ç°ã€‚å¦å¤–ï¼ŒLinkerd v0.2 åœ¨ 2016 å¹´ 2 æœˆ&lt;a href=&#34;https://linkerd.io/2016/02/18/linkerd-twitter-style-operability-for-microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒ&lt;/a&gt;ï¼Œå°½ç®¡è¯¥å›¢é˜Ÿç›´åˆ°åæ¥æ‰å¼€å§‹ç§°å®ƒä¸ºæœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å†å²ä¸Šçš„å…¶ä»–äº®ç‚¹åŒ…æ‹¬ 2017 å¹´ 5 æœˆçš„ &lt;a href=&#34;https://istio.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio&lt;/a&gt;ã€2018 å¹´ 7 æœˆçš„ &lt;a href=&#34;https://linkerd.io/2018/09/18/announcing-linkerd-2-0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkerd 2.0&lt;/a&gt;ã€2018 å¹´ 11 æœˆçš„ &lt;a href=&#34;https://www.hashicorp.com/products/consul/service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul Connect&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/solo-io/supergloo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gloo Mesh&lt;/a&gt;ã€2019 å¹´ 5 æœˆçš„ &lt;a href=&#34;https://smi-spec.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ¥å£ï¼ˆSMIï¼‰&lt;/a&gt;ï¼Œä»¥åŠ 2019 å¹´ 9 æœˆçš„ Maeshï¼ˆç°åœ¨å« Traefik Meshï¼‰å’Œ Kumaã€‚&lt;/p&gt;
&lt;p&gt;å³ä½¿æ˜¯åœ¨ç‹¬è§’å…½ä¼ä¸šä¹‹å¤–å‡ºç°çš„æœåŠ¡ç½‘æ ¼ï¼Œå¦‚ HashiCorp çš„ &lt;a href=&#34;https://www.consul.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Consul&lt;/a&gt;ï¼Œä¹Ÿä»ä¸Šè¿°æŠ€æœ¯ä¸­è·å¾—äº†çµæ„Ÿï¼Œé€šå¸¸æ—¨åœ¨å®ç° CoreOS æå‡ºçš„ â€œ&lt;a href=&#34;https://github.com/linearregression/GIFEE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GIFEE &lt;/a&gt;â€œæ¦‚å¿µï¼›æ‰€æœ‰äººå¯ç”¨çš„ Google åŸºç¡€è®¾æ–½ï¼ˆGoogle infrastructure for everyone elseï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ·±å…¥äº†è§£ç°ä»£æœåŠ¡ç½‘æ ¼æ¦‚å¿µçš„æ¼”å˜å†å²ï¼Œ&lt;a href=&#34;https://philcalcado.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Phil CalÃ§ado&lt;/a&gt; å†™äº†ä¸€ç¯‡å…¨é¢çš„æ–‡ç«  â€œ &lt;a href=&#34;https://philcalcado.com/2017/08/03/pattern_service_mesh.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¨¡å¼ï¼šæœåŠ¡ç½‘æ ¼&lt;/a&gt; &amp;ldquo;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼æ ‡å‡†&#34;&gt;æœåŠ¡ç½‘æ ¼æ ‡å‡†&lt;/h2&gt;
&lt;p&gt;å°½ç®¡åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯å¹´å¤ä¸€å¹´åœ°å‘ç”Ÿç€é‡å¤§è½¬å˜ï¼Œä½†æœåŠ¡ç½‘æ ¼çš„æ ‡å‡†è¿˜æ²¡æœ‰è·Ÿä¸Šåˆ›æ–°çš„æ­¥ä¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆçš„ä¸»è¦æ ‡å‡†æ˜¯&lt;a href=&#34;https://smi-spec.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ¥å£&lt;/a&gt;ï¼ˆSMIï¼‰ã€‚æœåŠ¡ç½‘æ ¼æ¥å£æ˜¯åœ¨ &lt;a href=&#34;https://kubernetes.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt; ä¸Šè¿è¡Œçš„æœåŠ¡ç½‘æ ¼çš„ä¸€ä¸ªè§„èŒƒã€‚å®ƒæœ¬èº«å¹¶æ²¡æœ‰å®ç°æœåŠ¡ç½‘æ ¼ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„æ ‡å‡†ï¼Œå¯ä»¥ç”±å„ç§æœåŠ¡ç½‘æ ¼ä¾›åº”å•†æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;SMI API çš„ç›®æ ‡æ˜¯æä¾›ä¸€å¥—é€šç”¨çš„ã€å¯ç§»æ¤çš„æœåŠ¡ç½‘æ ¼ APIï¼ŒKubernetes ç”¨æˆ·å¯ä»¥ä»¥ä¸€ç§ä¸æä¾›è€…æ— å…³çš„æ–¹å¼ä½¿ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œäººä»¬å¯ä»¥å®šä¹‰ä½¿ç”¨æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦ä¸ä»»ä½•ç‰¹å®šçš„å®ç°ç´§å¯†ç»“åˆã€‚&lt;/p&gt;
&lt;p&gt;SMI åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆ&lt;a href=&#34;https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CRD&lt;/a&gt;ï¼‰å’Œæ‰©å±• API æœåŠ¡å™¨çš„é›†åˆã€‚è¿™äº› API å¯ä»¥å®‰è£…åˆ°ä»»ä½• Kubernetes é›†ç¾¤ï¼Œå¹¶ä½¿ç”¨æ ‡å‡†å·¥å…·è¿›è¡Œæ“ä½œã€‚ä¸ºäº†æ¿€æ´»è¿™äº› APIï¼Œéœ€è¦åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ª SMI æä¾›è€…ã€‚&lt;/p&gt;
&lt;p&gt;SMI è§„èŒƒæ—¢å…è®¸ç»ˆç«¯ç”¨æˆ·çš„æ ‡å‡†åŒ–ï¼Œä¹Ÿå…è®¸æœåŠ¡ç½‘æ ¼æŠ€æœ¯æä¾›å•†çš„åˆ›æ–°ã€‚SMI å®ç°äº†çµæ´»æ€§å’Œäº’æ“ä½œæ€§ï¼Œå¹¶æ¶µç›–äº†æœ€å¸¸è§çš„æœåŠ¡ç½‘æ ¼åŠŸèƒ½ã€‚ç›®å‰çš„&lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec/tree/main/apis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§„èŒƒç»„ä»¶&lt;/a&gt;é›†ä¸­åœ¨æœåŠ¡ç½‘æ ¼èƒ½åŠ›çš„è¿æ¥æ–¹é¢ã€‚API è§„èŒƒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡è®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;æµé‡æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;æµé‡è§„æ ¼&lt;/li&gt;
&lt;li&gt;æµé‡åˆ†å‰²&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰çš„ SMI &lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”Ÿæ€ç³»ç»Ÿ&lt;/a&gt;åŒ…æ‹¬å¹¿æ³›çš„æœåŠ¡ç½‘æ ¼ï¼ŒåŒ…æ‹¬ Istioã€Linkerdã€Consul Connectã€Gloo Mesh ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;SMI è§„èŒƒæ˜¯åœ¨ &lt;a href=&#34;http://www.apache.org/licenses/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache License 2.0 ç‰ˆæœ¬ä¸‹&lt;/a&gt;&lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec/blob/main/LICENSE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¯çš„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº SMI è§„èŒƒåŠå…¶ API ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹é“¾æ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec/blob/main/SPEC_LATEST_STABLE.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¸å¿ƒè§„èŒƒ&lt;/a&gt;ï¼ˆå½“å‰ç‰ˆæœ¬ï¼š0.6.0ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§„èŒƒ Github é¡¹ç›®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/servicemeshinterface/smi-spec/blob/main/CONTRIBUTING.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦‚ä½•è´¡çŒ®&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœåŠ¡ç½‘æ ¼åŸºå‡†æµ‹è¯•&#34;&gt;æœåŠ¡ç½‘æ ¼åŸºå‡†æµ‹è¯•&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://smp-spec.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ€§èƒ½&lt;/a&gt;æ˜¯ä¸€ä¸ªæ•æ‰åŸºç¡€è®¾æ–½å®¹é‡ã€æœåŠ¡ç½‘é…ç½®å’Œå·¥ä½œè´Ÿè½½å…ƒæ•°æ®ç»†èŠ‚çš„æ ‡å‡†ã€‚SMP è§„èŒƒç”¨äºæ•æ‰ä»¥ä¸‹ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒå’ŒåŸºç¡€è®¾æ–½ç»†èŠ‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹çš„æ•°é‡å’Œè§„æ¨¡ï¼Œç¼–æ’å™¨&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç½‘æ ¼å’Œå®ƒçš„é…ç½®&lt;/li&gt;
&lt;li&gt;å·¥ä½œé‡ / åº”ç”¨ç»†èŠ‚&lt;/li&gt;
&lt;li&gt;è¿›è¡Œç»Ÿè®¡åˆ†æä»¥ç¡®å®šæ€§èƒ½ç‰¹å¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥è‡ª Linkerd å›¢é˜Ÿçš„ William Morgan &lt;a href=&#34;https://linkerd.io/2021/05/27/linkerd-vs-istio-benchmarks/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†™äº†&lt;/a&gt;å…³äº Linkerd å’Œ Istio çš„æ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚è¿˜æœ‰ä¸€ç¯‡æ¥è‡ª 2019 å¹´çš„&lt;a href=&#34;https://istio.io/latest/blog/2019/performance-best-practices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;ï¼Œä»‹ç»äº† Istio å…³äºæœåŠ¡ç½‘æ ¼æ€§èƒ½åŸºå‡†æµ‹è¯•çš„æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå°±åƒå…¶ä»–æ€§èƒ½åŸºå‡†æµ‹è¯•ä¸€æ ·ï¼Œä½ ä¸åº”è¯¥å¯¹ä»»ä½•è¿™äº›å¤–éƒ¨å‡ºç‰ˆç‰©æŠ•å…¥è¿‡å¤šçš„æ³¨æ„åŠ›ï¼Œç‰¹åˆ«æ˜¯äº§å“ä¾›åº”å•†å‘è¡¨çš„æ–‡ç« ã€‚è¯¥åœ¨ä½ çš„æœåŠ¡å™¨ç¯å¢ƒä¸­è®¾è®¡å’Œæ‰§è¡Œä½ è‡ªå·±çš„æ€§èƒ½æµ‹è¯•ï¼Œä»¥éªŒè¯å“ªä¸ªå…·ä½“äº§å“é€‚åˆä½ çš„åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡å’ŒéåŠŸèƒ½è¦æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¢ç´¢æœåŠ¡ç½‘æ ¼çš„æœªæ¥&#34;&gt;æ¢ç´¢æœåŠ¡ç½‘æ ¼çš„æœªæ¥&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.infoq.com/profile/Kasun-Indrasiri/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kasun Indrasiri&lt;/a&gt; æ¢è®¨äº† â€œ &lt;a href=&#34;https://www.infoq.com/articles/service-mesh-event-driven-messaging/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºäº‹ä»¶é©±åŠ¨çš„æ¶ˆæ¯ä¼ é€’ä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„æ½œåŠ›&lt;/a&gt; &amp;ldquo;ï¼Œä»–åœ¨å…¶ä¸­è®¨è®ºäº†åœ¨æœåŠ¡ç½‘æ ¼ä¸­å®ç°æ¶ˆæ¯ä¼ é€’æ”¯æŒçš„ä¸¤ç§ä¸»è¦çš„æ–°å…´æ¶æ„æ¨¡å¼ï¼šåè®®ä»£ç† sidecar å’Œ HTTP æ¡¥æ¥ sidecarã€‚è¿™æ˜¯æœåŠ¡ç½‘æ ¼ç¤¾åŒºä¸­ä¸€ä¸ªæ´»è·ƒçš„å‘å±•é¢†åŸŸï¼Œåœ¨ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/2852&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy ä¸­&lt;/a&gt;æ”¯æŒ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/2852&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache Kafka çš„&lt;/a&gt;å·¥ä½œå¼•èµ·äº†ç›¸å½“å¤šçš„å…³æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;Christian Posta ä¹‹å‰åœ¨ â€œ&lt;a href=&#34;https://www.infoq.com/articles/service-mesh-api-federating/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Towards a Unified, Standard API for Consolidating Service Meshes &lt;/a&gt;ä¸­å†™è¿‡å…³äºæœåŠ¡ç½‘æ ¼ä½¿ç”¨æ ‡å‡†åŒ–çš„å°è¯•ã€‚è¿™ç¯‡æ–‡ç« è¿˜è®¨è®ºäº† 2019 å¹´å¾®è½¯å’Œåˆä½œä¼™ä¼´åœ¨ KubeCon EU ä¸Šå®£å¸ƒçš„&lt;a href=&#34;https://cloudblogs.microsoft.com/opensource/2019/05/21/service-mesh-interface-smi-release/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼æ¥å£ï¼ˆSMIï¼‰&lt;/a&gt;ã€‚SMI å®šä¹‰äº†ä¸€å¥—é€šç”¨å’Œå¯ç§»æ¤çš„ APIï¼Œæ—¨åœ¨ä¸ºå¼€å‘äººå‘˜æä¾›ä¸åŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„äº’æ“ä½œæ€§ï¼ŒåŒ…æ‹¬ Istioã€Linkerd å’Œ Consul Connectã€‚&lt;/p&gt;
&lt;p&gt;å°†æœåŠ¡ç½‘æ ¼ä¸å¹³å°ç»“æ„æ•´åˆçš„ä¸»é¢˜å¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºä¸¤ä¸ªå­ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ­£åœ¨è¿›è¡Œçš„å·¥ä½œæ˜¯å‡å°‘ç”±æœåŠ¡ç½‘æ ¼æ•°æ®å¹³é¢å¼•å…¥çš„ç½‘ç»œå¼€é”€ã€‚è¿™åŒ…æ‹¬&lt;a href=&#34;https://www.dpdk.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•°æ®å¹³é¢å¼€å‘å·¥å…·åŒ…ï¼ˆDPDKï¼‰&lt;/a&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ª&lt;a href=&#34;https://www.linuxjournal.com/content/userspace-networking-dpdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åº&lt;/a&gt;ï¼Œâ€œç»•è¿‡äº† Linux å†…æ ¸ç½‘ç»œå †æ ˆï¼Œç›´æ¥ä¸ç½‘ç»œç¡¬ä»¶å¯¹è¯â€ã€‚è¿˜æœ‰ &lt;a href=&#34;https://www.infoq.com/news/2018/03/cilium-linux-bpf/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium å›¢é˜Ÿçš„&lt;/a&gt;åŸºäº Linux çš„ BPF è§£å†³æ–¹æ¡ˆï¼Œå®ƒåˆ©ç”¨ Linux å†…æ ¸ä¸­çš„æ‰©å±•&lt;a href=&#34;https://cilium.io/blog/istio/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼¯å…‹åˆ©åŒ…è¿‡æ»¤å™¨ï¼ˆeBPFï¼‰åŠŸèƒ½&lt;/a&gt;æ¥å®ç° â€œéå¸¸æœ‰æ•ˆçš„ç½‘ç»œã€ç­–ç•¥æ‰§è¡Œå’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½â€ã€‚å¦ä¸€ä¸ªå›¢é˜Ÿæ­£åœ¨ç”¨&lt;a href=&#34;https://github.com/networkservicemesh/networkservicemesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œæœåŠ¡ç½‘æ ¼ï¼ˆNetwork Service Meshï¼‰&lt;/a&gt;å°†æœåŠ¡ç½‘æ ¼çš„æ¦‚å¿µæ˜ å°„åˆ° L2/L3 æœ‰æ•ˆè½½è·ï¼Œè¯•å›¾ â€œä»¥äº‘åŸç”Ÿçš„æ–¹å¼é‡æ–°æƒ³è±¡ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼ˆNFVï¼‰&amp;quot;ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œæœ‰å¤šé¡¹ä¸¾æªå°†æœåŠ¡ç½‘æ ¼ä¸å…¬å…±äº‘å¹³å°æ›´ç´§å¯†åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œä» &lt;a href=&#34;https://www.infoq.com/news/2019/01/aws-app-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS App Mesh&lt;/a&gt;ã€&lt;a href=&#34;https://www.infoq.com/news/2019/04/google-traffic-director/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GCP Traffic Director&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.infoq.com/articles/azure-service-fabric-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure Service Fabric Mesh çš„&lt;/a&gt;å‘å¸ƒå¯è§ç«¯å€ªã€‚&lt;/p&gt;
&lt;p&gt;Buoyant å›¢é˜Ÿè‡´åŠ›äºä¸ºæœåŠ¡ç½‘æ ¼æŠ€æœ¯å¼€å‘æœ‰æ•ˆçš„ä»¥äººä¸ºæœ¬çš„æ§åˆ¶å¹³é¢ã€‚ä»–ä»¬æœ€è¿‘å‘å¸ƒäº† &lt;a href=&#34;https://buoyant.io/cloud/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Buoyant Cloud&lt;/a&gt;ï¼Œä¸€ä¸ªåŸºäº SaaS çš„ â€œå›¢é˜Ÿæ§åˆ¶å¹³é¢â€ï¼Œç”¨äºå¹³å°å›¢é˜Ÿæ“ä½œ Kubernetesã€‚è¿™ä¸ªäº§å“å°†åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå»å¹´ä»¥æ¥ï¼Œåœ¨æœåŠ¡ç½‘æ ¼é¢†åŸŸä¹Ÿæœ‰ä¸€äº›åˆ›æ–°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤šäº‘å¤šé›†ç¾¤å¤šç§Ÿæˆ·æœåŠ¡ç½‘æ ¼&#34;&gt;å¤šäº‘ã€å¤šé›†ç¾¤ã€å¤šç§Ÿæˆ·æœåŠ¡ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;è¿‘å¹´æ¥ï¼Œä¸åŒç»„ç»‡å¯¹äº‘çš„é‡‡ç”¨å·²ç»ä»å•ä¸€çš„äº‘è§£å†³æ–¹æ¡ˆï¼ˆç§æœ‰äº‘æˆ–å…¬å…±äº‘ï¼‰è½¬å˜ä¸ºç”±å¤šä¸ªä¸åŒä¾›åº”å•†ï¼ˆAWSã€è°·æ­Œã€å¾®è½¯ Azure ç­‰ï¼‰æ”¯æŒçš„åŸºäºå¤šäº‘ï¼ˆç§æœ‰ã€å…¬å…±å’Œæ··åˆï¼‰çš„æ–°åŸºç¡€è®¾æ–½ã€‚åŒæ—¶ï¼Œéœ€è¦æ”¯æŒä¸åŒçš„å·¥ä½œè´Ÿè½½ï¼ˆäº¤æ˜“ã€æ‰¹å¤„ç†å’Œæµåª’ä½“ï¼‰ï¼Œè¿™å¯¹å®ç°ç»Ÿä¸€çš„äº‘æ¶æ„è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›ä¸šåŠ¡å’ŒéåŠŸèƒ½éœ€æ±‚åè¿‡æ¥åˆå¯¼è‡´éœ€è¦åœ¨å¼‚æ„åŸºç¡€è®¾æ–½ï¼ˆè£¸æœºã€è™šæ‹Ÿæœºå’Œ Kubernetesï¼‰ä¸­éƒ¨ç½²æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚æœåŠ¡ç½‘æ ¼éœ€è¦ç›¸åº”è½¬å˜ï¼Œä»¥æ”¯æŒè¿™äº›ä¸åŒçš„å·¥ä½œè´Ÿè½½å’ŒåŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;åƒ &lt;a href=&#34;https://konghq.com/blog/multi-cluster-multi-cloud-service-meshes-with-cncfs-kuma-and-envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kuma&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.tetrate.io/tetrate-service-bridge/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Bridge&lt;/a&gt; è¿™æ ·çš„æŠ€æœ¯æ”¯æŒå¤šç½‘æ ¼æ§åˆ¶å¹³é¢ï¼Œä»¥ä½¿ä¸šåŠ¡åº”ç”¨åœ¨å¤šé›†ç¾¤å’Œå¤šäº‘æœåŠ¡ç½‘æ ¼ç¯å¢ƒä¸­å·¥ä½œã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæŠ½è±¡å‡ºè·¨å¤šä¸ªåŒºåŸŸçš„æœåŠ¡ç½‘æ ¼ç­–ç•¥çš„åŒæ­¥ä»¥åŠè·¨è¿™äº›åŒºåŸŸçš„æœåŠ¡è¿æ¥ï¼ˆå’ŒæœåŠ¡å‘ç°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„å¦ä¸€ä¸ªæ–°è¶‹åŠ¿æ˜¯éœ€è¦ä»è¾¹ç¼˜è®¡ç®—å±‚ï¼ˆç‰©è”ç½‘è®¾å¤‡ï¼‰åˆ°ç½‘æ ¼å±‚çš„åº”ç”¨ / æœåŠ¡è¿æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åª’ä½“æœåŠ¡ç½‘æ ¼&#34;&gt;åª’ä½“æœåŠ¡ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;æ€ç§‘ç³»ç»Ÿå…¬å¸å¼€å‘çš„&lt;a href=&#34;https://www.ciscotechblog.com/blog/introducing-media-streaming-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åª’ä½“æµç½‘æ ¼ï¼ˆMedia Streaming Meshï¼‰&lt;/a&gt;æˆ–åª’ä½“æœåŠ¡ç½‘æ ¼ï¼Œç”¨äºåè°ƒå®æ—¶åº”ç”¨ç¨‹åºï¼Œå¦‚å¤šäººæ¸¸æˆã€å¤šæ–¹è§†é¢‘ä¼šè®®æˆ–åœ¨ Kubernetes äº‘å¹³å°ä¸Šä½¿ç”¨æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„ CCTV æµã€‚è¿™äº›åº”ç”¨æ­£è¶Šæ¥è¶Šå¤šåœ°ä»å•ä½“åº”ç”¨è½¬å‘å¾®æœåŠ¡æ¶æ„ã€‚æœåŠ¡ç½‘æ ¼å¯ä»¥é€šè¿‡æä¾›è´Ÿè½½å‡è¡¡ã€åŠ å¯†å’Œå¯è§‚æµ‹æ€§ç­‰åŠŸèƒ½æ¥å¸®åŠ©åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ··æ²Œç½‘æ ¼&#34;&gt;æ··æ²Œç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://chaos-mesh.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Chaos Mesh&lt;/a&gt; æ˜¯ &lt;a href=&#34;https://community.cncf.io/chaos-mesh-community/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNCF æ‰˜ç®¡çš„é¡¹ç›®&lt;/a&gt;ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ã€äº‘åŸç”Ÿçš„æ··æ²Œå·¥ç¨‹å¹³å°ï¼Œç”¨äºæ‰˜ç®¡åœ¨ Kubernetes ä¸Šçš„åº”ç”¨ç¨‹åºã€‚è™½ç„¶ä¸æ˜¯ç›´æ¥çš„æœåŠ¡ç½‘æ ¼å®ç°ï¼Œä½† Chaos Mesh é€šè¿‡åè°ƒåº”ç”¨ç¨‹åºä¸­çš„æ•…éšœæ³¨å…¥è¡Œä¸ºæ¥å®ç°æ··æ²Œå·¥ç¨‹å®éªŒã€‚æ•…éšœæ³¨å…¥æ˜¯æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„ä¸€ä¸ªå…³é”®èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Chaos Mesh éšè—äº†åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œå› æ­¤åº”ç”¨å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå®é™…çš„æ··æ²Œå®éªŒã€‚Chaos Mesh &lt;a href=&#34;https://chaos-mesh.org/blog/chaos-mesh-q&amp;amp;a/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯ä»¥å’ŒæœåŠ¡ç½‘æ ¼ä¸€èµ·ä½¿ç”¨&lt;/a&gt;ã€‚è¯·çœ‹è¿™ä¸ª&lt;a href=&#34;https://github.com/sergioarmgpl/operating-systems-usac-course/blob/master/lang/en/projects/project1v3/project1.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨ä¾‹&lt;/a&gt;ï¼Œè¯¥å›¢é˜Ÿå¦‚ä½•ä½¿ç”¨ Linkerd å’Œ Chaos Mesh æ¥ä¸ºä»–ä»¬çš„é¡¹ç›®è¿›è¡Œæ··æ²Œå®éªŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼ä½œä¸ºä¸€ç§æœåŠ¡&#34;&gt;æœåŠ¡ç½‘æ ¼ä½œä¸ºä¸€ç§æœåŠ¡&lt;/h3&gt;
&lt;p&gt;ä¸€äº›æœåŠ¡ç½‘æ ¼ä¾›åº”å•†ï¼Œå¦‚ Buoyantï¼Œæ­£åœ¨æä¾›ç®¡ç†æœåŠ¡ç½‘æ ¼æˆ– â€œæœåŠ¡ç½‘æ ¼ä½œä¸ºä¸€ç§æœåŠ¡ â€œçš„è§£å†³æ–¹æ¡ˆã€‚ä»Šå¹´æ—©äº›æ—¶å€™ï¼ŒBuoyant &lt;a href=&#34;https://buoyant.io/newsroom/buoyant-cloud-offers-managed-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒ&lt;/a&gt;å…¬å¼€æµ‹è¯•å‘å¸ƒä¸€ä¸ªåä¸º &lt;a href=&#34;http://buoyant.io/cloud&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Buoyant Cloud çš„&lt;/a&gt; SaaS åº”ç”¨ç¨‹åºï¼Œå…è®¸å®¢æˆ·ç»„ç»‡åˆ©ç”¨ Linkerd æœåŠ¡ç½‘æ ¼çš„æŒ‰éœ€æ”¯æŒåŠŸèƒ½æ¥ç®¡ç†æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;Buoyant Cloud è§£å†³æ–¹æ¡ˆæä¾›çš„ä¸€äº›åŠŸèƒ½åŒ…æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨è·Ÿè¸ª Linkerd æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„å¥åº·çŠ¶å†µ&lt;/li&gt;
&lt;li&gt;åœ¨ Kubernetes å¹³å°ä¸Šç®¡ç†è·¨ podã€ä»£ç†å’Œé›†ç¾¤çš„æœåŠ¡ç½‘æ ¼ç”Ÿå‘½å‘¨æœŸå’Œç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;ä»¥ SRE ä¸ºé‡ç‚¹çš„å·¥å…·ï¼ŒåŒ…æ‹¬æœåŠ¡æ°´å¹³ç›®æ ‡ï¼ˆSLOï¼‰ã€å·¥ä½œè´Ÿè·é»„é‡‘æŒ‡æ ‡è·Ÿè¸ªå’Œå˜æ›´è·Ÿè¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç½‘ç»œæœåŠ¡ç½‘æ ¼nsm&#34;&gt;ç½‘ç»œæœåŠ¡ç½‘æ ¼ï¼ˆNSMï¼‰&lt;/h3&gt;
&lt;p&gt;ç½‘ç»œæœåŠ¡ç½‘æ ¼ï¼ˆ&lt;a href=&#34;https://networkservicemesh.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NSM&lt;/a&gt;ï¼‰æ˜¯äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šçš„å¦ä¸€ä¸ªæ²™ç›’é¡¹ç›®ï¼Œæä¾›äº†ä¸€ä¸ªæ··åˆçš„ã€å¤šäº‘çš„ IP æœåŠ¡ç½‘æ ¼ã€‚NSM å®ç°äº†ç½‘ç»œæœåŠ¡è¿æ¥ã€å®‰å…¨å’Œå¯è§‚æµ‹æ€§ç­‰åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯æœåŠ¡ç½‘æ ¼çš„æ ¸å¿ƒç‰¹å¾ã€‚NSM ä¸ç°æœ‰çš„å®¹å™¨ç½‘ç»œæ¥å£ï¼ˆ&lt;a href=&#34;https://github.com/containernetworking/cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNI&lt;/a&gt;ï¼‰å®ç°ååŒå·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼æ‰©å±•&#34;&gt;æœåŠ¡ç½‘æ ¼æ‰©å±•&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ‰©å±•æ˜¯å¦ä¸€ä¸ªå·²ç»çœ‹åˆ°å¾ˆå¤šåˆ›æ–°çš„é¢†åŸŸã€‚æœåŠ¡ç½‘æ ¼æ‰©å±•çš„ä¸€äº›å‘å±•åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢å¼ºçš„èº«ä»½ç®¡ç†ï¼Œä»¥ç¡®ä¿å¾®æœåŠ¡è¿æ¥çš„å®‰å…¨ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰è¯ä¹¦æˆæƒæ’ä»¶&lt;/li&gt;
&lt;li&gt;è‡ªé€‚åº”è·¯ç”±åŠŸèƒ½ï¼Œä»¥æé«˜æœåŠ¡çš„å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§&lt;/li&gt;
&lt;li&gt;åŠ å¼º sidecar ä»£ç†æƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼ä¸šåŠ¡&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸šåŠ¡&lt;/h3&gt;
&lt;p&gt;é‡‡ç”¨æœåŠ¡ç½‘æ ¼çš„å¦ä¸€ä¸ªé‡è¦é¢†åŸŸæ˜¯æœåŠ¡ç½‘æ ¼ç”Ÿå‘½å‘¨æœŸçš„è¿ç»´æ–¹é¢ã€‚æ“ä½œæ–¹é¢ â€”â€” å¦‚é…ç½®å¤šé›†ç¾¤åŠŸèƒ½å’Œå°† Kubernetes å·¥ä½œè´Ÿè½½è¿æ¥åˆ°è™šæ‹ŸæœºåŸºç¡€è®¾æ–½ä¸Šæ‰˜ç®¡çš„æœåŠ¡å™¨ï¼Œä»¥åŠç®¡ç†å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼ä¸­æ‰€æœ‰åŠŸèƒ½å’Œ API çš„å¼€å‘è€…é—¨æˆ· â€”â€” å°†åœ¨ç”Ÿäº§ä¸­æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆçš„æ•´ä½“éƒ¨ç½²å’Œæ”¯æŒæ–¹é¢å‘æŒ¥é‡è¦ä½œç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¸¸è§é—®é¢˜&#34;&gt;å¸¸è§é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&#34;&gt;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ï¼ˆå¯èƒ½æ˜¯åŸºäºå¾®æœåŠ¡çš„ï¼‰è½¯ä»¶ç³»ç»Ÿå†…ç®¡ç†æ‰€æœ‰æœåŠ¡å¯¹æœåŠ¡ï¼ˆä¸œè¥¿å‘ï¼‰æµé‡çš„æŠ€æœ¯ã€‚å®ƒæ—¢æä¾›ä»¥ä¸šåŠ¡ä¸ºé‡ç‚¹çš„åŠŸèƒ½æ“ä½œï¼Œå¦‚è·¯ç”±ï¼Œä¹Ÿæä¾›éåŠŸèƒ½æ”¯æŒï¼Œå¦‚æ‰§è¡Œå®‰å…¨ç­–ç•¥ã€æœåŠ¡è´¨é‡å’Œé€Ÿç‡é™åˆ¶ã€‚å®ƒé€šå¸¸ï¼ˆå°½ç®¡ä¸æ˜¯å”¯ä¸€çš„ï¼‰ä½¿ç”¨ sidecar ä»£ç†æ¥å®ç°ï¼Œæ‰€æœ‰æœåŠ¡éƒ½é€šè¿‡ sidecar ä»£ç†è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼ä¸-api-ç½‘å…³æœ‰ä»€ä¹ˆä¸åŒ&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸ API ç½‘å…³æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å…³äºæœåŠ¡ç½‘æ ¼çš„å®šä¹‰ï¼Œè§ä¸Šæ–‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼ŒAPI ç½‘å…³ç®¡ç†è¿›å…¥é›†ç¾¤çš„æ‰€æœ‰å…¥å£ï¼ˆå—åŒ—ï¼‰æµé‡ï¼Œå¹¶ä¸ºè·¨åŠŸèƒ½çš„é€šä¿¡è¦æ±‚æä¾›é¢å¤–æ”¯æŒã€‚å®ƒä½œä¸ºè¿›å…¥ç³»ç»Ÿçš„å•ä¸€å…¥å£ç‚¹ï¼Œä½¿å¤šä¸ª API æˆ–æœåŠ¡å‡èšåœ¨ä¸€èµ·ï¼Œä¸ºç”¨æˆ·æä¾›ç»Ÿä¸€çš„ä½“éªŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚æœæˆ‘æ­£åœ¨éƒ¨ç½²å¾®æœåŠ¡æˆ‘æ˜¯å¦éœ€è¦æœåŠ¡ç½‘æ ¼&#34;&gt;å¦‚æœæˆ‘æ­£åœ¨éƒ¨ç½²å¾®æœåŠ¡ï¼Œæˆ‘æ˜¯å¦éœ€è¦æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ä¸€å®šã€‚æœåŠ¡ç½‘æ ¼å¢åŠ äº†æŠ€æœ¯æ ˆçš„æ“ä½œå¤æ‚æ€§ï¼Œå› æ­¤é€šå¸¸åªæœ‰åœ¨ç»„ç»‡åœ¨æ‰©å±•æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é€šä¿¡æ–¹é¢é‡åˆ°å›°éš¾ï¼Œæˆ–è€…æœ‰ç‰¹å®šçš„ç”¨ä¾‹éœ€è¦è§£å†³æ—¶æ‰ä¼šéƒ¨ç½²ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘æ˜¯å¦éœ€è¦æœåŠ¡ç½‘æ ¼æ¥å®ç°å¾®æœåŠ¡çš„æœåŠ¡å‘ç°&#34;&gt;æˆ‘æ˜¯å¦éœ€è¦æœåŠ¡ç½‘æ ¼æ¥å®ç°å¾®æœåŠ¡çš„æœåŠ¡å‘ç°ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ï¼ŒæœåŠ¡ç½‘æ ¼æä¾›äº†å®ç°æœåŠ¡å‘ç°çš„ä¸€ç§æ–¹å¼ã€‚å…¶ä»–è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ç‰¹å®šè¯­è¨€çš„åº“ï¼ˆå¦‚ Ribbon å’Œ &lt;a href=&#34;https://www.infoq.com/news/2012/09/Eureka/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Eureka&lt;/a&gt; æˆ– &lt;a href=&#34;https://www.infoq.com/finagle/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Finagle&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼æ˜¯å¦ä¼šç»™æˆ‘çš„æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¢åŠ å¼€é”€--å»¶è¿Ÿ&#34;&gt;æœåŠ¡ç½‘æ ¼æ˜¯å¦ä¼šç»™æˆ‘çš„æœåŠ¡ä¹‹é—´çš„é€šä¿¡å¢åŠ å¼€é”€ / å»¶è¿Ÿï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ˜¯çš„ï¼Œå½“ä¸€ä¸ªæœåŠ¡ä¸å¦ä¸€ä¸ªæœåŠ¡è¿›è¡Œé€šä¿¡æ—¶ï¼ŒæœåŠ¡ç½‘æ ¼è‡³å°‘ä¼šå¢åŠ ä¸¤ä¸ªé¢å¤–çš„ç½‘ç»œè·³æ•°ï¼ˆç¬¬ä¸€ä¸ªæ˜¯æ¥è‡ªå¤„ç†æºçš„å‡ºç«™è¿æ¥çš„ä»£ç†ï¼Œç¬¬äºŒä¸ªæ˜¯æ¥è‡ªå¤„ç†ç›®çš„åœ°çš„å…¥ç«™è¿æ¥çš„ä»£ç†ï¼‰ã€‚ç„¶è€Œï¼Œè¿™ä¸ªé¢å¤–çš„ç½‘ç»œè·³è½¬é€šå¸¸å‘ç”Ÿåœ¨ &lt;a href=&#34;https://en.wikipedia.org/wiki/Localhost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;localhost æˆ– loopback ç½‘ç»œæ¥å£&lt;/a&gt;ä¸Šï¼Œå¹¶ä¸”åªå¢åŠ äº†å°‘é‡çš„å»¶è¿Ÿï¼ˆåœ¨æ¯«ç§’çº§ï¼‰ã€‚å®éªŒå’Œäº†è§£è¿™å¯¹ç›®æ ‡ç”¨ä¾‹æ˜¯å¦æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œåº”è¯¥æ˜¯æœåŠ¡ç½‘æ ¼åˆ†æå’Œè¯„ä¼°çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡ç½‘æ ¼ä¸åº”è¯¥æ˜¯-kubernetes-æˆ–åº”ç”¨ç¨‹åºè¢«éƒ¨ç½²åˆ°çš„-äº‘åŸç”Ÿå¹³å°-çš„ä¸€éƒ¨åˆ†å—&#34;&gt;æœåŠ¡ç½‘æ ¼ä¸åº”è¯¥æ˜¯ Kubernetes æˆ–åº”ç”¨ç¨‹åºè¢«éƒ¨ç½²åˆ°çš„ &amp;ldquo;äº‘åŸç”Ÿå¹³å°&amp;rdquo; çš„ä¸€éƒ¨åˆ†å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ½œåœ¨çš„ã€‚æœ‰ä¸€ç§è¯´æ³•æ˜¯åœ¨äº‘åŸç”Ÿå¹³å°ç»„ä»¶å†…ä¿æŒå…³æ³¨ç‚¹çš„åˆ†ç¦»ï¼ˆä¾‹å¦‚ï¼ŒKubernetes è´Ÿè´£æä¾›å®¹å™¨ç¼–æ’ï¼Œè€ŒæœåŠ¡ç½‘æ ¼è´Ÿè´£æœåŠ¡é—´çš„é€šä¿¡ï¼‰ã€‚ç„¶è€Œï¼Œæ­£åœ¨è¿›è¡Œçš„å·¥ä½œæ˜¯å°†ç±»ä¼¼æœåŠ¡ç½‘æ ¼çš„åŠŸèƒ½æ¨å‘ç°ä»£å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰äº§å“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘å¦‚ä½•å®æ–½éƒ¨ç½²æˆ–æ¨å¹¿æœåŠ¡ç½‘æ ¼&#34;&gt;æˆ‘å¦‚ä½•å®æ–½ã€éƒ¨ç½²æˆ–æ¨å¹¿æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æœ€å¥½çš„æ–¹æ³•æ˜¯åˆ†æå„ç§æœåŠ¡ç½‘æ ¼äº§å“ï¼ˆè§ä¸Šæ–‡ï¼‰ï¼Œå¹¶éµå¾ªæ‰€é€‰ç½‘æ ¼ç‰¹æœ‰çš„å®æ–½å‡†åˆ™ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¥½æ˜¯ä¸æ‰€æœ‰åˆ©ç›Šç›¸å…³è€…åˆä½œï¼Œé€æ­¥å°†ä»»ä½•æ–°æŠ€æœ¯éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘å¯ä»¥å»ºç«‹è‡ªå·±çš„æœåŠ¡ç½‘æ ¼å—&#34;&gt;æˆ‘å¯ä»¥å»ºç«‹è‡ªå·±çš„æœåŠ¡ç½‘æ ¼å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä½†æ›´ç›¸å…³çš„é—®é¢˜æ˜¯ï¼Œä½ åº”è¯¥å—ï¼Ÿå»ºç«‹ä¸€ä¸ªæœåŠ¡ç½‘æ ¼æ˜¯ä½ ç»„ç»‡çš„æ ¸å¿ƒç«äº‰åŠ›å—ï¼Ÿä½ èƒ½å¦ä»¥æ›´æœ‰æ•ˆçš„æ–¹å¼ä¸ºä½ çš„å®¢æˆ·æä¾›ä»·å€¼ï¼Ÿä½ æ˜¯å¦ä¹Ÿè‡´åŠ›äºç»´æŠ¤ä½ è‡ªå·±çš„ç½‘ç»œï¼Œä¸ºå®‰å…¨é—®é¢˜æ‰“è¡¥ä¸ï¼Œå¹¶ä¸æ–­æ›´æ–°å®ƒä»¥åˆ©ç”¨æ–°æŠ€æœ¯ï¼Ÿç”±äºç°åœ¨æœ‰ä¸€ç³»åˆ—çš„å¼€æºå’Œå•†ä¸šæœåŠ¡ç½‘æ ¼äº§å“ï¼Œä½¿ç”¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆå¾ˆå¯èƒ½æ›´æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨ä¸€ä¸ªè½¯ä»¶äº¤ä»˜ç»„ç»‡å†…å“ªä¸ªå›¢é˜Ÿæ‹¥æœ‰æœåŠ¡ç½‘æ ¼&#34;&gt;åœ¨ä¸€ä¸ªè½¯ä»¶äº¤ä»˜ç»„ç»‡å†…ï¼Œå“ªä¸ªå›¢é˜Ÿæ‹¥æœ‰æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é€šå¸¸ï¼Œå¹³å°æˆ–è¿ç»´å›¢é˜Ÿæ‹¥æœ‰æœåŠ¡ç½‘æ ¼ï¼Œä»¥åŠ Kubernetes å’ŒæŒç»­äº¤ä»˜ç®¡é“åŸºç¡€è®¾æ–½ã€‚ç„¶è€Œï¼Œå¼€å‘äººå‘˜å°†é…ç½®æœåŠ¡ç½‘æ ¼çš„å±æ€§ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå›¢é˜Ÿåº”è¯¥ç´§å¯†åˆä½œã€‚è®¸å¤šä¼ä¸šæ­£åœ¨è¿½éšäº‘è®¡ç®—å…ˆé”‹çš„è„šæ­¥ï¼Œå¦‚ Netflixã€Spotify å’Œè°·æ­Œï¼Œå¹¶æ­£åœ¨åˆ›å»ºå†…éƒ¨å¹³å°å›¢é˜Ÿï¼Œä¸º&lt;a href=&#34;https://www.infoq.com/news/2018/06/netflix-full-cycle-developers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä»¥äº§å“ä¸ºé‡ç‚¹çš„å…¨å‘¨æœŸå¼€å‘å›¢é˜Ÿ&lt;/a&gt;æä¾›å·¥å…·å’ŒæœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼å—&#34;&gt;Envoy æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Envoy æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿä»£ç†ï¼Œæœ€åˆæ˜¯ç”± Lyft å›¢é˜Ÿè®¾è®¡å’Œæ„å»ºçš„ã€‚Envoy ç»å¸¸è¢«ç”¨ä½œæœåŠ¡ç½‘æ ¼çš„æ•°æ®å¹³é¢ã€‚ç„¶è€Œï¼Œä¸ºäº†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼ï¼ŒEnvoy å¿…é¡»ä¸æ§åˆ¶å¹³é¢ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·æ‰èƒ½ä½¿è¿™äº›æŠ€æœ¯é›†åˆæˆä¸ºä¸€ä¸ªæœåŠ¡ç½‘æ ¼ã€‚æ§åˆ¶å¹³é¢å¯ä»¥æ˜¯ç®€å•çš„é›†ä¸­å¼é…ç½®æ–‡ä»¶åº“å’ŒæŒ‡æ ‡æ”¶é›†å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¨é¢ / å¤æ‚çš„ Istioã€‚&lt;/p&gt;
&lt;h3 id=&#34;istio-å’Œ-æœåŠ¡ç½‘æ ¼--è¿™ä¸¤ä¸ªè¯å¯ä»¥äº’æ¢ä½¿ç”¨å—&#34;&gt;Istio å’Œ â€œæœåŠ¡ç½‘æ ¼ &amp;quot; è¿™ä¸¤ä¸ªè¯å¯ä»¥äº’æ¢ä½¿ç”¨å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ï¼ŒIstio æ˜¯æœåŠ¡ç½‘æ ¼çš„ä¸€ç§ã€‚ç”±äº Istio åœ¨æœåŠ¡ç½‘æ ¼ç±»åˆ«å‡ºç°æ—¶å¾ˆå—æ¬¢è¿ï¼Œä¸€äº›äººå°† Istio å’ŒæœåŠ¡ç½‘æ ¼æ··ä¸ºä¸€è°ˆã€‚è¿™ä¸ªæ··æ·†çš„é—®é¢˜å¹¶ä¸æ˜¯æœåŠ¡ç½‘æ ¼æ‰€ç‹¬æœ‰çš„ï¼ŒåŒæ ·çš„æŒ‘æˆ˜å‘ç”Ÿåœ¨ Docker å’Œå®¹å™¨æŠ€æœ¯ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ªæœåŠ¡ç½‘æ ¼&#34;&gt;æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ªæœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜æ²¡æœ‰å”¯ä¸€çš„ç­”æ¡ˆã€‚å·¥ç¨‹å¸ˆå¿…é¡»äº†è§£ä»–ä»¬å½“å‰çš„éœ€æ±‚ï¼Œä»¥åŠä»–ä»¬çš„å®æ–½å›¢é˜Ÿçš„æŠ€èƒ½ã€èµ„æºå’Œæ—¶é—´ã€‚ä¸Šé¢çš„æœåŠ¡ç½‘æ ¼æ¯”è¾ƒé“¾æ¥å°†æä¾›ä¸€ä¸ªè‰¯å¥½çš„æ¢ç´¢èµ·ç‚¹ï¼Œä½†æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¼ä¸šè‡³å°‘å°è¯•ä¸¤ä¸ªç½‘æ ¼ï¼Œä»¥äº†è§£å“ªäº›äº§å“ã€æŠ€æœ¯å’Œå·¥ä½œæµç¨‹æœ€é€‚åˆä»–ä»¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘å¯ä»¥åœ¨-kubernetes-ä¹‹å¤–ä½¿ç”¨æœåŠ¡ç½‘å—&#34;&gt;æˆ‘å¯ä»¥åœ¨ Kubernetes ä¹‹å¤–ä½¿ç”¨æœåŠ¡ç½‘å—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ˜¯çš„ã€‚è®¸å¤šæœåŠ¡ç½‘æ ¼å…è®¸åœ¨å„ç§åŸºç¡€è®¾æ–½ä¸Šå®‰è£…å’Œç®¡ç†æ•°æ®å¹³é¢ä»£ç†å’Œç›¸å…³æ§åˆ¶å¹³é¢ã€‚&lt;a href=&#34;https://www.hashicorp.com/resources/consul-service-mesh-kubernetes-and-beyond&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HashiCorp çš„ Consul&lt;/a&gt; æ˜¯æœ€çŸ¥åçš„ä¾‹å­ï¼ŒIstio ä¹Ÿè¢«å®éªŒæ€§åœ°ç”¨äº Cloud Foundryã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–èµ„æº&#34;&gt;å…¶ä»–èµ„æº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.com/servicemesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfoQ æœåŠ¡ç½‘æ ¼ä¸»é¡µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.com/minibooks/service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfoQ eMagï¼šæœåŠ¡ç½‘æ ¼çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://servicemesh.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼ï¼šæ¯ä½è½¯ä»¶å·¥ç¨‹å¸ˆéƒ½éœ€è¦äº†è§£çš„ä¸–ç•Œä¸Šæœ€å®¹æ˜“è¢«æ»¥ç”¨çš„æŠ€æœ¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://servicemesh.es/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼çš„æ¯”è¾ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://softwareengineeringdaily.com/2020/01/07/service-meshes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.com/articles/cloud-native-architecture-adoption-part3/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é‡‡ç”¨äº‘åŸç”Ÿæ¶æ„ï¼Œç¬¬ä¸‰éƒ¨åˆ†ï¼šæœåŠ¡åè°ƒå’ŒæœåŠ¡ç½‘æ ¼&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ç½‘ç»œä»£ç† Envoy å¼€æºäº”å‘¨å¹´ï¼Œåˆ›å§‹äºº Matt Klein äº²è¿°å¼€æºå¿ƒè·¯å†ç¨‹åŠç»éªŒæ•™è®­</title>
      <link>https://lib.jimmysong.io/translation/envoy-oss-5-year/</link>
      <pubDate>Wed, 15 Sep 2021 10:41:54 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/envoy-oss-5-year/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡è¯‘è‡ª Envoy ä»£ç†çš„åˆ›å§‹äºº Matt Klein äºæ˜¨æ™šåœ¨ä¸ªäººåšå®¢ä¸Šå‘å¸ƒçš„æ–‡ç«  &lt;a href=&#34;https://mattklein123.dev/2021/09/14/5-years-envoy-oss/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;5 year of Envoy OSS&lt;/a&gt;ã€‚ä»–åœ¨ Twitter å› ä¸ºè‡ªå·±çš„ç¨‹åº bug é€ æˆé‡å¤§äº‹æ•…è€Œç¦»èŒï¼ŒååŠ å…¥ Lyftï¼Œåœ¨å¼€æº Envoy ä¹‹å‰å‡ ä¹æ²¡æœ‰è´¡çŒ®å’Œç®¡ç†å¼€æºé¡¹ç›®çš„ç»éªŒï¼Œè¿™ç¯‡æ–‡ç« åˆ†äº«äº†ä»–ä¸ªäººåŠ Envoy å¼€æºçš„å¿ƒè·¯å†ç¨‹ï¼Œåœ¨æŠ•èº«å¼€æº Envoy è¿˜æ˜¯ä¸ºé›‡ä¸» Lyft æ•ˆå‘½ï¼Œè¯¥å¦‚ä½•æŠ‰æ‹©ï¼Ÿçœ‹å®Œæœ¬æ–‡ï¼Œç›¸ä¿¡å¯¹äºå¼€æºé¡¹ç›®çš„ç»´æŠ¤è€…ã€åˆ›ä¸šè€…åŠæŠ•èµ„äººéƒ½ä¼šå¤§æœ‰æ”¶è·ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy Proxy å¼€æº&lt;/a&gt;çš„ &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;5 å‘¨å¹´&lt;/a&gt;ã€‚æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œåœ¨ä¸“ä¸šæ–¹é¢ï¼Œè¿‡å»çš„ 5 å¹´æ˜¯ä¸€ä¸ªå²è¯—èˆ¬çš„è¿‡å±±è½¦ï¼Œæˆ‘çš„æƒ…ç»ªä»‹äºå…´å¥‹ã€è‡ªè±ªã€ç„¦è™‘ã€å°´å°¬ã€æ— èŠã€å€¦æ€ ä¹‹é—´ã€‚æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„å‰ä¼ å’Œå†å²ï¼Œä»¥åŠæˆ‘åœ¨å‘å±•å¤§å‹å¼€æºè½¯ä»¶é¡¹ç›®çš„è¿‡ç¨‹ä¸­æ‰€å­¦åˆ°çš„ä¸€äº›ç»éªŒæ•™è®­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰ä¼ å’Œå†å²&#34;&gt;å‰ä¼ å’Œå†å²&lt;/h2&gt;
&lt;h3 id=&#34;å‰ä¼ &#34;&gt;å‰ä¼ &lt;/h3&gt;
&lt;p&gt;é™¤äº†ä¸€äº›å°çš„å¼¯è·¯ï¼Œæˆ‘åœ¨æŠ€æœ¯è¡Œä¸šäºŒåå¹´çš„èŒä¸šç”Ÿæ¶¯ä¸€ç›´ä¸“æ³¨äºåº•å±‚ç³»ç»Ÿï¼šåµŒå…¥å¼ç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿï¼Œè™šæ‹ŸåŒ–ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠæœ€è¿‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿç½‘ç»œã€‚æˆ‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿç½‘ç»œä¹‹æ—…å§‹äº 2010 å¹´åˆåœ¨äºšé©¬é€Šï¼Œæˆ‘æœ‰å¹¸å¸®åŠ©å¼€å‘äº†ç¬¬ä¸€æ‰¹é«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰EC2 å®ä¾‹ç±»å‹ã€‚æˆ‘å­¦åˆ°äº†å¤§é‡çš„åº•å±‚é«˜æ€§èƒ½è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ï¼Œå°½ç®¡æˆ‘å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µæ¥è§¦æœ‰é™ã€‚&lt;/p&gt;
&lt;p&gt;2012 å¹´ï¼Œæˆ‘åŠ å…¥äº† Twitterï¼Œåœ¨ç»å†äº†å‡ æ¬¡é”™è¯¯çš„å¼€å§‹åï¼Œæˆ‘æœ€ç»ˆåŠ å…¥äº†è¾¹ç¼˜ç½‘ç»œå›¢é˜Ÿã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœŸæ­£æ¥è§¦åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨ç½‘ç»œæ¦‚å¿µã€‚æˆ‘é¢†å¯¼äº†ä¸€ä¸ªæ–°çš„ HTTP è¾¹ç¼˜ä»£ç†çš„å¼€å‘ï¼Œç§°ä¸º Twitter æµå¼èšåˆå™¨ï¼ˆTSAï¼‰ï¼Œå®ƒåœ¨ 2013 å¹´é¦–æ¬¡æ¨å‡ºï¼Œä»¥æ‰©å¤§ Twitter çš„ â€œfirehoseâ€ APIï¼ˆæµå¼æ‰€æœ‰æ¨æ–‡ï¼‰çš„äº¤ä»˜ã€‚åœ¨ 2014 å¹´ä¸–ç•Œæ¯å‰å¤•ï¼Œæˆ‘ä»¬å†³å®šå°† TSA ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ HTTP/HTTP2/TLS è¾¹ç¼˜ä»£ç†ï¼Œåœ¨é è¿‘å·´è¥¿èµ›äº‹çš„å­˜åœ¨ç‚¹ï¼ˆPOPsï¼‰æ¨å‡ºã€‚è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ä¸å¯èƒ½åœ¨ POP çš„å°‘é‡ä¸»æœºæ‰˜ç®¡æœºæ¶ä¸Šéƒ¨ç½²ç°æœ‰çš„åŸºäº JVM çš„èµ„æºåŒ®ä¹çš„è¾¹ç¼˜ä»£ç†ã€‚é¡¹ç›®å‘¨æœŸç‰¹åˆ«ç´§å¼ ï¼Œæˆ‘çš„å›¢é˜ŸæˆåŠŸåœ°å®Œæˆäº†ä¸€å±Šæ²¡æœ‰äº‹æ•…çš„ä¸–ç•Œæ¯ã€‚ï¼ˆæˆ‘è¿˜æ¸…æ¥šåœ°è®°å¾—æœ‰ä¸€æ®µæ—¶é—´ï¼Œå½“è½¯ä»¶å´©æºƒæ—¶ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œæˆ‘éƒ½ä¼šç»™è‡ªå·±æ‰“ä¸Šä¸€é¡µï¼Œä¿®å¤é”™è¯¯ï¼Œç„¶åé‡æ–°è¿›è¡Œé‡‘ä¸é›€éƒ¨ç½²ï¼Œç»§ç»­æµ‹è¯•ï¼‰ã€‚åœ¨ Twitter å·¥ä½œæœŸé—´ï¼Œæˆ‘è¿˜æ¥è§¦åˆ°äº†è¯¥å…¬å¸é€šè¿‡ Finagle åº“è¿›è¡ŒæœåŠ¡é—´ç½‘ç»œé€šä¿¡çš„æ–¹å¼ï¼Œå¹¶å–å¾—äº†å·¨å¤§æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´å…ƒæ—¦å‰åï¼Œæˆ‘åœ¨ Twitter çš„æ—¥å­é‡Œï¼Œå› ä¸ºæˆ‘å†™çš„ä¸€ä¸ª bugï¼ŒTSA ç³»ç»Ÿæ•…éšœå¯¼è‡´æ•°ç™¾ä¸‡ Twitter çš„å®‰å“ç”¨æˆ·è¢«ä¸‹çº¿ï¼Œè¿™å°†æ˜¯æˆ‘åœ¨ Twitter å·¥ä½œçš„å°¾å£°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-matt-klein-å‘è¡¨çš„æ¨ç‰¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Matt Klein å‘è¡¨çš„æ¨ç‰¹&#34; srcset=&#34;
               /translation/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_huf325008400e2ee78cef76533687242a3_50295_facd95aed2f3cf1809d59308700882a4.webp 400w,
               /translation/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_huf325008400e2ee78cef76533687242a3_50295_dd5d122ba5b17fe4300fe1c2aaefa022.webp 760w,
               /translation/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_huf325008400e2ee78cef76533687242a3_50295_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/envoy-oss-5-year/008i3skNly1guh3vblu9xj60tu0eu76p02_huf325008400e2ee78cef76533687242a3_50295_facd95aed2f3cf1809d59308700882a4.webp&#34;
               width=&#34;760&#34;
               height=&#34;378&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Matt Klein å‘è¡¨çš„æ¨ç‰¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;åŠ å…¥-lyft-å’Œåˆ›å»º-lyft-ä»£ç†&#34;&gt;åŠ å…¥ Lyft å’Œåˆ›å»º â€œLyft ä»£ç†â€&lt;/h3&gt;
&lt;p&gt;æˆ‘åœ¨ 2015 å¹´æ˜¥å¤©ç¦»å¼€äº† Twitterï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸‹çº¿äº‹ä»¶çš„å½±å“ï¼Œéƒ¨åˆ†åŸå› æ˜¯å¯¹æ²¡æœ‰å¾—åˆ°æ™‹å‡çš„æŒ«è´¥æ„Ÿï¼Œéƒ¨åˆ†åŸå› æ˜¯æƒ³å°è¯•æ–°çš„ä¸œè¥¿ã€‚æˆ‘è·Ÿç€æˆ‘çš„è€æ¿ä» Twitter åˆ°äº† Lyftï¼Œè¿˜æœ‰æˆ‘åœ¨ Twitter çš„å…¶ä»–åŒäº‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘åŠ å…¥ Lyft æ—¶ï¼Œå…¬å¸è§„æ¨¡ç›¸å¯¹è¾ƒå°ï¼ˆå°‘äº 100 åå·¥ç¨‹å¸ˆï¼‰ï¼Œå¹¶ä¸”æ­£åœ¨åŠªåŠ›ä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„ã€‚æˆ‘å·²ç»&lt;a href=&#34;https://mattklein123.dev/appearances/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šæ¬¡&lt;/a&gt;è°ˆåˆ°äº† Envoy çš„è¿™éƒ¨åˆ†å†ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šå†é‡è¿°ï¼Œåœ¨æ­¤ç®€çŸ­çš„æ€»ç»“ä¸‹ï¼ŒLyft é‡åˆ°äº†æ‰€æœ‰å…¸å‹çš„å¾®æœåŠ¡è¿ç§»é—®é¢˜ï¼Œä¸»è¦æ˜¯æºäºç½‘ç»œå’Œå¯è§‚æµ‹æ€§ã€‚æ­¤å¤–ï¼ŒLyft å·²ç»æ˜¯ â€œå¤šé¢æ‰‹â€ï¼ˆä½¿ç”¨å¤šç§è¯­è¨€å’Œæ¡†æ¶ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åŸºäºåº“çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³è¿™äº›é—®é¢˜ä¼¼ä¹ä¸åˆ‡å®é™…ã€‚å› æ­¤ï¼Œæ ¹æ®æˆ‘ä»¥å‰å»ºç«‹ TSA çš„ç»éªŒå’Œè§‚å¯ŸæœåŠ¡é—´é€šä¿¡åœ¨ Twitter çš„å·¥ä½œæ–¹å¼ï¼Œç”±äºå¾—åˆ°åœ¨ Lyft çš„å‰ Twitter åŒäº‹ä»¬çš„ä¿¡ä»»ï¼Œæˆ‘æè®®å»ºç«‹ä¸€ä¸ªæ–°çš„åº”ç”¨ç½‘ç»œç³»ç»Ÿï¼Œç§°ä¸º â€œLyft ä»£ç†â€ã€‚&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸€äº›æ¿€çƒˆçš„è®¨è®ºï¼ŒåŒ…æ‹¬æ–°çš„ä»£ç†æ˜¯å¦åº”è¯¥ç”¨ Python æ„å»ºï¼ˆæ˜¯çš„ï¼ŒçœŸçš„ï¼‰ï¼Œæˆ‘ä»¬å°±é¡¹ç›®çš„å¤§è‡´è½®å»“è¾¾æˆä¸€è‡´ï¼Œå¹¶å†³å®šä½¿ç”¨ C++ ä½œä¸ºå®ç°è¯­è¨€ã€‚åœ¨å½“æ—¶ï¼ŒC++ ä¼¼ä¹æ˜¯å”¯ä¸€åˆç†çš„é€‰æ‹©ã€‚ä»Šå¤©æˆ‘è¿˜ä¼šé€‰æ‹© C++ å—ï¼Ÿç„¶è€Œï¼Œå¦‚ä»Šå·²ç»ä¸æ˜¯ 2015 å¹´åˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸è¯´ â€œEnvoy&amp;quot; è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œè¿™éƒ¨åˆ†çš„å†å²å°±ä¸å®Œæ•´äº†ã€‚æˆ‘ä»¬æ­£åœ¨ä¸ºè¿™ä¸ªé¡¹ç›®å»ºç«‹æœ€åˆçš„å¼€å‘è„šæ‰‹æ¶çš„æ—¶å€™ï¼Œä¸€ä¸ªæœ‰è¿œè§çš„åŒäº‹ï¼ˆRyan Laneï¼‰è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠè¿™ä¸ªæ–°é¡¹ç›®å«åš â€œLyft ä»£ç†â€ï¼Œæˆ‘ä»¬å¿…é¡»é€‰æ‹©ä¸€ä¸ªæ›´å¥½çš„åå­—ã€‚æˆ‘æ€»æ˜¯å¾ˆå®é™…ï¼Œå°±å»æ‰¾è¾å…¸ï¼ŒæŸ¥äº†ä¸€ä¸‹ â€œä»£ç†â€ï¼Œç„¶åå†³å®šç”¨ Envoy ä½œä¸ºæ–°åå­—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-lyft-ä¸Šçº¿&#34;&gt;åœ¨ Lyft ä¸Šçº¿&lt;/h3&gt;
&lt;p&gt;ç›´åˆ° 2015 å¹´å¤å¤©ï¼Œæˆ‘æ‰å¼€å§‹è®¤çœŸåœ°ç ”ç©¶ Envoy çš„æºä»£ç ã€‚é‚£å‡ ä¸ªæœˆæ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰è¶£çš„å‡ ä¸ªæœˆã€‚æˆ‘ä»¬åº”è¯¥çæƒœè¿™æ®µåˆåˆ›æ—¶æœŸï¼Œå› ä¸ºå®ƒä¸ä¼šæŒç»­å¾ˆä¹…ã€‚æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œäº‰å–åœ¨åˆç†çš„æ—¶é—´å†…ï¼ˆæ ¹æ®æˆ‘çš„å®šä¹‰ï¼Œè¿™ç§ç±»å‹çš„é¡¹ç›®éœ€è¦ 3-4 ä¸ªæœˆçš„æ—¶é—´ï¼‰åšå‡ºèƒ½ç»™ Lyft å¸¦æ¥ä»·å€¼çš„ä¸œè¥¿ã€‚ä¿—è¯è¯´ï¼ŒLyft ç»™äº†æˆ‘å¤§é‡çš„ç»³å­æ¥åŠæ­»è‡ªå·±ï¼Œè€Œæˆ‘è‡´åŠ›äºç¡®ä¿è¿™ç§åŠæ­»ä¸ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæˆ‘çš„æ•ˆç‡ä¸»è¦å½’åŠŸäºåˆšä»å‹ç¼©çš„å¼€å‘æ—¶é—´è¡¨å’Œè®¸å¤šé”™è¯¯ï¼ˆä¸»è¦æ˜¯æˆ‘è‡ªå·±çš„ï¼‰ä¸­èµ°å‡ºæ¥ï¼Œåœ¨ Twitter çš„ TSAã€‚æˆ‘çŸ¥é“å“ªäº›é”™è¯¯æ˜¯ä¸èƒ½çŠ¯çš„ï¼Œå“ªäº›æŠ½è±¡æ˜¯éœ€è¦çš„ï¼Œå“ªäº›æµ‹è¯•æœ‰æ•ˆï¼Œå“ªäº›æ— æ•ˆï¼Œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´ç§‹å¤©å‡†å¤‡æŠ•å…¥ç”Ÿäº§çš„ Envoy çš„æœ€åˆç‰ˆæœ¬åªåŒ…å«äº†è¯¥é¡¹ç›®ä»Šå¤©æ‰€åŒ…å«çš„åŠŸèƒ½å’Œå¤æ‚æ€§çš„ä¸€å°éƒ¨åˆ†ã€‚å®ƒä¸æ”¯æŒ TLSï¼Œåªæ”¯æŒ HTTP/1ï¼Œå¹¶ä¸”æœ‰æå…¶ç®€å•çš„è·¯ç”±å’Œå¼¹æ€§åŠŸèƒ½ã€‚å®ƒæ‰€æ‹¥æœ‰çš„æ˜¯ä½ ä»Šå¤©æ‰€çœ‹åˆ°çš„ä¸œè¥¿çš„éª¨æ¶ã€‚åœ¨è¿™ä¸ªé¡¹ç›®çš„å†å²ä¸Šï¼Œå¾ˆå°‘æœ‰é‡å¤§çš„é‡æ„ï¼Œä¸»è¦æ˜¯å› ä¸ºï¼Œæ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œæˆ‘çŸ¥é“å°†è¦å‘ç”Ÿä»€ä¹ˆï¼Œä»¥åŠä¸ºäº†æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œéœ€è¦æœ‰å“ªäº›æŠ½è±¡ã€‚Envoy ä»ä¸€å¼€å§‹å°±æ‹¥æœ‰ä¸€æµçš„å¯è§‚æµ‹æ€§è¾“å‡ºï¼Œä»¥æŒ‡æ ‡å’Œæ—¥å¿—çš„å½¢å¼ã€‚åœ¨ 2021 å¹´ï¼Œè¿™ç§ç±»å‹çš„ç½‘ç»œå¯è§‚æµ‹æ€§æ˜¯æ¡Œé¢ä¸Šçš„èµŒæ³¨ï¼ˆè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¦å½’åŠŸäº Envoy çš„æˆåŠŸï¼‰ï¼Œä½†åœ¨å½“æ—¶å´ä¸æ˜¯è¿™æ ·ã€‚&lt;/p&gt;
&lt;p&gt;Envoy æœ€åˆæ˜¯ä½œä¸ºè¾¹ç¼˜ä»£ç†åœ¨ Lyft ä¸Šçº¿çš„ï¼Œä½äºæä¾› TLS ç»ˆæ­¢çš„ AWS ELB åé¢ã€‚åˆ° 2015 å¹´ç§‹æœ«ï¼ŒEnvoy ä¸º Lyft çš„ 100% æµé‡æä¾›æœåŠ¡ï¼Œè¯¥ç³»ç»Ÿäº§ç”Ÿçš„è¾¹ç¼˜ä»ªè¡¨ç›˜ç«‹å³å¾—åˆ°äº†å›æŠ¥ï¼ˆä¾‹å¦‚ï¼Œæä¾› API è°ƒç”¨ç™¾åˆ†ç‚¹å»¶è¿Ÿç›´æ–¹å›¾ï¼Œæ¯ä¸ªç»ˆç«¯çš„æˆåŠŸç‡å’Œè¯·æ±‚ç‡ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€åˆæ¨å‡ºåä¸ä¹…ï¼Œå¦ä¸€ä½ Twitter åŒäº‹ï¼ˆBill Gallagherï¼‰åŠ å…¥äº†æˆ‘çš„é¡¹ç›®ï¼Œæˆ‘ä»¬è¿…é€Ÿå¢åŠ äº†ä¸€äº›åŠŸèƒ½ï¼Œå¦‚ TLS ç»ˆæ­¢ã€HTTP/2 æ”¯æŒã€æ›´å¤šè·¯ç”±å’Œè´Ÿè½½å¹³è¡¡åŠŸèƒ½ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ï¼ŒLyft åŸºäº Envoy çš„ â€œæœåŠ¡ç½‘æ ¼ &amp;quot; ä¹Ÿå¼€å§‹æˆå½¢äº†ã€‚é¦–å…ˆï¼ŒEnvoy è¢«éƒ¨ç½²åœ¨ PHP å•ç‰‡æœºæ—è¾¹ï¼Œä»¥å–ä»£ HAProxy åŠå…¶ä¸€äº›å›ºæœ‰çš„è¿ç»´é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œå½“æ—¶ HAProxy ä»ç„¶æ˜¯å•çº¿ç¨‹çš„ï¼‰ï¼Œä»¥å¸®åŠ© MongoDB çš„ä»£ç†ã€‚å¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒEnvoy çš„æ—©æœŸå¼€å‘æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯é’ˆå¯¹ MongoDB çš„ç¨³å®šæ€§ï¼ˆè´Ÿè½½å‡è¡¡ã€é€Ÿç‡é™åˆ¶ã€å¯è§‚æµ‹æ€§ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Envoy çš„è¾¹ç¼˜æœºç¾¤å’Œå•ä½“ä¹‹é—´çš„ç›´æ¥è§‚å¯Ÿèƒ½åŠ›çš„å¥½å¤„æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ä¸ä¹…ä¹‹åï¼Œæˆ‘ä»¬åœ¨ä¸€äº›é«˜ RPS åˆ†è§£çš„å¾®æœåŠ¡æ—è¾¹éƒ¨ç½²äº† Envoyï¼Œä»¥å¸®åŠ©æ’é™¤ç½‘ç»œé—®é¢˜ã€‚è¿™æ–¹é¢çš„ä»·å€¼ä¹Ÿå¾—åˆ°äº†è¯æ˜ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬è¶…è¶Šäº†å¯¹å¯è§‚æµ‹æ€§çš„å…³æ³¨ï¼Œå¢åŠ äº†å¸®åŠ©ç³»ç»Ÿå¯é æ€§çš„åŠŸèƒ½ï¼Œå¦‚ç›´æ¥è¿æ¥å’ŒæœåŠ¡å‘ç°ï¼ˆè·³è¿‡å†…éƒ¨ ELBï¼‰ã€å¼‚å¸¸å€¼æ£€æµ‹ã€å¥åº·æ£€æŸ¥ã€é‡è¯•ã€æ–­è·¯ç­‰ã€‚Lyft çš„åŸºäºè´Ÿè½½çš„é‡å¤§äº‹ä»¶çš„æ•°é‡ä»æ¯ 1-2 å‘¨ä¸€æ¬¡æ…¢æ…¢å‡å°‘ã€‚å½“ç„¶ï¼ŒEnvoy ä¸èƒ½å°†æ‰€æœ‰æ­¤ç±»äº‹ä»¶çš„å‡å°‘å½’åŠŸäºæ­¤ï¼Œä½†å®ƒæä¾›çš„ç½‘ç»œæŠ½è±¡ç¡®å®æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;2016 å¹´åˆï¼Œæˆ‘ä»¬å†³å®šæ¨åŠ¨ä¸€ä¸ª 100% è¦†ç›–çš„æœåŠ¡ç½‘æ ¼ã€‚æœ€åˆï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™å°†æ˜¯ä¸€ä¸ªè‰°éš¾çš„è¿‡ç¨‹ï¼Œéœ€è¦è‡ªä¸Šè€Œä¸‹çš„æˆæƒã€‚åœ¨å®è·µä¸­ï¼Œ&lt;strong&gt;å›¢é˜ŸæŠ¥åå‚åŠ äº†è¿ç§»ï¼Œå› ä¸ºä»–ä»¬å°†å¾—åˆ°çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„&lt;/strong&gt;ã€‚â€œèƒ¡èåœ &amp;ldquo;å¼çš„è¿ç§»å‡ ä¹æ€»æ˜¯æˆåŠŸçš„ã€‚è€Œ â€œå¤§æ£’&amp;rdquo; å¼çš„è¿ç§»åˆ™å¾ˆå°‘æˆåŠŸï¼Œæˆ–è€…å³ä½¿æˆåŠŸäº†ï¼Œä¹Ÿä¼šåœ¨ç»„ç»‡å†…ç•™ä¸‹çœ¼æ³ªå’Œæ„¤æ€’ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2016 å¹´ä¸­æœŸï¼ŒEnvoy è¢«ç”¨äº Lyft çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ï¼ŒåŒ…æ‹¬è¾¹ç¼˜æœåŠ¡ã€æœåŠ¡é—´é€šä¿¡ã€æ•°æ®åº“ã€å¤–éƒ¨åˆä½œä¼™ä¼´ç­‰ã€‚æ— è®ºä»å“ªä¸ªè§’åº¦æ¥çœ‹ï¼Œè¯¥é¡¹ç›®éƒ½å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œå¸®åŠ© Lyft å®Œæˆäº†å¾®æœåŠ¡çš„è¿ç§»ï¼Œæé«˜äº†æ•´ä½“çš„å¯é æ€§ï¼Œå¹¶å¯¹ç½‘ç»œè¿›è¡Œäº†æŠ½è±¡ï¼Œä½¿å¤§å¤šæ•°å·¥ç¨‹å¸ˆä¸éœ€è¦äº†è§£çœŸå®çš„ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ã€‚æ­¤åï¼ŒBill ç¦»å¼€äº†è¿™ä¸ªé¡¹ç›®ï¼Œåœ¨ Lyft ä»äº‹å…¶ä»–å·¥ä½œï¼Œæ¥æ›¿ä»–çš„æ˜¯ Roman Dzhabarov å’Œ Constance Caramanolis åŠ å…¥æˆ‘çš„å›¢é˜Ÿã€‚æˆ‘ä»¬çš„å°å›¢é˜Ÿä¸ºæ•´ä¸ª Lyft å¼€å‘å’Œè¿ç»´ Envoyã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€æ”¾æºç &#34;&gt;å¼€æ”¾æºç &lt;/h3&gt;
&lt;p&gt;åˆ° 2016 å¹´å¤å¤©ï¼Œæˆ‘ä»¬å¼€å§‹è®¤çœŸè®¨è®ºå¼€æº Envoy çš„é—®é¢˜ã€‚æ—©æœŸçš„ Lyft å‘˜å·¥å¯¹å¼€æºå’Œå®ƒä¸ºå…¬å¸æ‰€åšçš„äº‹æƒ…å¾ˆæ¬£èµã€‚å¾ˆæ˜æ˜¾ï¼ŒEnvoy å¹¶ä¸æ˜¯ Lyft çš„ä¸»è¦ä¸šåŠ¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠå®ƒæ”¾åœ¨é‚£é‡Œå¹¶ç»™äºˆå›æŠ¥å‘¢ï¼Ÿæˆ‘å¯ä»¥å¦ç‡åœ°è¯´ï¼Œæˆ‘ä»¬éƒ½å¸¦ç€ä¸åŒçš„ç›®æ ‡å’ŒæœŸæœ›æ¥å¯¹å¾…å¼€æ”¾æºä»£ç çš„è¿‡ç¨‹ï¼Œä»¥åŠå¯¹é¡¹ç›®è·å¾—å·¨å¤§æˆåŠŸåä¼šå‘ç”Ÿä»€ä¹ˆæ„Ÿåˆ°éå¸¸å¤©çœŸã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŠ å…¥ Envoy ä¹‹å‰ï¼Œæˆ‘å·²ç»ä½¿ç”¨äº†ç›¸å½“å¤šçš„å¼€æºè½¯ä»¶ï¼Œä½†æˆ‘å‡ ä¹æ²¡æœ‰å¼€æºè´¡çŒ®çš„ç»éªŒï¼Œä¹Ÿæ²¡æœ‰ç»´æŠ¤è€…çš„ç»éªŒã€‚ï¼ˆè™½ç„¶æˆ‘åœ¨ Linux å†…æ ¸ä¸­æœ‰è¿‡&lt;a href=&#34;https://github.com/torvalds/linux/commit/00370b8f8dd6e3171b8202f9c5187a5f73e99497&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€æ¬¡æäº¤&lt;/a&gt;ï¼ï¼‰å¼€æº Envoy ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šï¼Œå¯ä»¥æ‰©å±•æˆ‘çš„æŠ€èƒ½ç»„åˆï¼Œå­¦ä¹ æ–°çš„ä¸œè¥¿ï¼Œå¯èƒ½ä¼šä¿ƒè¿›æˆ‘çš„èŒä¸šç”Ÿæ¶¯ï¼Œå¦ç‡åœ°è¯´ï¼Œæˆ‘ä¸å¸Œæœ›æœ‰ä¸€ä¸ª TSA v3 åœ¨ç¬¬ä¸‰å®¶å…¬å¸å‡ºç°ã€‚å¯¹äº Lyft æ¥è¯´ï¼ŒEnvoy æ˜¯ä¸€ä¸ªé‡è¦çš„å·¥ç¨‹é¡¹ç›®ï¼Œé¢†å¯¼å±‚è®¤ä¸ºï¼Œå¼€æ”¾æºä»£ç å°†ä½¿ Lyft ä½œä¸ºä¸€ä¸ªå·¥ç¨‹ç»„ç»‡å…·æœ‰å¯ä¿¡åº¦ï¼Œå¹¶æœ‰åŠ©äºæ‹›è˜å·¥ä½œã€‚æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰äººéƒ½å¯¹åˆ›å»ºæˆåŠŸçš„å¼€æºï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè·å¾—æˆåŠŸçš„æƒ…å†µä¸‹åŸ¹è‚²å®ƒæ‰€éœ€è¦çš„ä¸œè¥¿æ„Ÿåˆ°å¤©çœŸã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæˆ‘ä»¬å†³å®šç»™å®ƒä¸€ä¸ªæœºä¼šã€‚æˆ‘ä»¬åœ¨ 2016 å¹´å¤å¤©èŠ±äº†å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´æ¥ç¼–å†™æ–‡æ¡£ï¼ˆJose Nino åœ¨è¿™ä¸ªæ—¶å€™åŠ å…¥äº†å›¢é˜Ÿï¼Œä»–çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å°±æ˜¯é˜…è¯»å¹¶å¸®åŠ©æ”¹è¿›æ‰€æœ‰çš„æ–‡æ¡£ï¼‰ï¼Œæ¸…ç†å­˜å‚¨åº“ï¼Œä½¿å…¶ &amp;quot; ä¸é‚£ä¹ˆå°´å°¬â€ï¼Œåˆ¶ä½œç½‘ç«™ï¼Œå‘å¸ƒåšæ–‡ç­‰ç­‰ã€‚æˆ‘çœŸçš„å¾ˆæ„Ÿè°¢è¿™æ®µæ—¶é—´é‡Œæˆ‘åœ¨ Lyft çš„åŒäº‹ï¼Œä»–ä»¬ä¸ä»…æ”¯æŒæˆ‘ä»¬ï¼Œè¿˜å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†æ— æ•°çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç½‘ç«™è®¾è®¡ã€logo ç­‰ç­‰ã€‚å³ä½¿åœ¨è¿™ä¸ªæ—©æœŸé˜¶æ®µï¼Œæˆ‘ä»¬ä¹Ÿè§‰å¾—ç¬¬ä¸€å°è±¡å¾ˆé‡è¦ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨å¼€æºé¢†åŸŸæœ‰æ‰€ä½œä¸ºï¼Œå°±å¿…é¡»é€šè¿‡é«˜è´¨é‡çš„æ–‡æ¡£ã€ç½‘ç«™ç­‰ç»™äººç•™ä¸‹è‰¯å¥½çš„ç¬¬ä¸€å°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬è¿˜åˆ©ç”¨æˆ‘ä»¬çš„è¡Œä¸šå…³ç³»ï¼Œä¸ Lyft çš„ä¸€äº› â€œåŒè¡Œå…¬å¸â€ï¼ˆæ¹¾åŒºçš„ â€œç‹¬è§’å…½ &amp;quot; äº’è”ç½‘åˆ›ä¸šå…¬å¸ï¼‰ä¼šé¢ï¼Œå‘ä»–ä»¬å±•ç¤ºæˆ‘ä»¬åœ¨ Envoy æ–¹é¢æ‰€åšçš„å·¥ä½œï¼Œå¹¶è·å¾—ä»–ä»¬çš„åé¦ˆï¼Œæˆ‘ä»¬è®¤ä¸ºå¦‚æœæˆ‘ä»¬åœ¨æ­£å¼å¼€æºå‰æˆåŠŸè·å¾—ä¸€ä¸ªå¯åŠ¨åˆä½œä¼™ä¼´ï¼Œè¿™å°†æ˜¯å¯¹é¡¹ç›®çš„ä¸€ä¸ªé‡å¤§å¸®åŠ©ã€‚æ‰€æœ‰è¿™äº›ä¼šè®®éƒ½éå¸¸å‹å¥½ï¼Œæ€»çš„æ¥è¯´ï¼Œæ‰€æœ‰ä¸æˆ‘ä»¬ä¼šé¢çš„å…¬å¸éƒ½å¯¹æˆ‘ä»¬æ‰€å–å¾—çš„æˆå°±å°è±¡æ·±åˆ»ã€‚ä½†æ˜¯ï¼Œäº‹åçœ‹æ¥ï¼Œä»–ä»¬éƒ½è¡¨ç¤ºï¼Œä»¥ä»–ä»¬çš„å°å‹åŸºç¡€è®¾æ–½å›¢é˜Ÿï¼Œä¸å¯èƒ½é©¬ä¸Šé‡‡ç”¨ Envoyã€‚ä»–ä»¬ç¥æ„¿æˆ‘ä»¬åœ¨å¼€æ”¾æºä»£ç æ–¹é¢å–å¾—æœ€å¥½çš„æˆç»©ï¼Œå¹¶è¯´ä»–ä»¬ä»¥åä¼šå›æ¥çœ‹çœ‹ã€‚æˆ‘ä»¬ä¸ç¦å¯¹è¿™äº›ä¼šè®®çš„ç»“æœæ„Ÿåˆ°æ²®ä¸§ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å‘å‰æ¨è¿›äº†ã€‚&lt;/p&gt;
&lt;p&gt;2015 å¹´ 8 æœˆï¼Œæˆ‘ä¸è°·æ­Œè¿›è¡Œäº†ç¬¬ä¸€æ¬¡å‹å¥½çš„ä¼šé¢ã€‚ä¸€ä¸ª Lyft çš„åŒäº‹ï¼ˆChris Burnettï¼‰åœ¨ä¸€ä¸ª gRPC èšä¼šä¸Šå‘è¨€ï¼Œæåˆ°äº† Envoyï¼Œå› ä¸ºå®ƒä¸ Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/grpc#grpc-bridging&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gRPC æ¡¥æ¥&lt;/a&gt;æ”¯æŒæœ‰å…³ã€‚æˆ‘ä¸çŸ¥é“çš„æ˜¯ï¼Œè°·æ­Œåœ¨å‘ç° Envoy çš„æ—¶å€™ï¼Œæ­£å‡†å¤‡åœ¨ NGINX çš„åŸºç¡€ä¸Šæ¨å‡º Istioã€‚ä¸€æ¬¡ä¼šè®®å¼•å‡ºäº†å¦ä¸€æ¬¡ä¼šè®®ï¼Œç„¶åæ˜¯æ›´å¤šçš„ä¼šè®®ï¼Œåœ¨ Envoy å¼€æºä¹‹å‰ï¼Œå¤§é‡çš„è°·æ­Œå‘˜å·¥å·²ç»çœ‹åˆ°äº†æºä»£ç å’Œæ–‡æ¡£ã€‚(ç¨åä¼šæœ‰æ›´å¤šå…³äºè¿™æ–¹é¢çš„å†…å®¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 9 æœˆåˆï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¹¶å°†å¼€æºæ—¥å®šä¸º 9 æœˆ 14 æ—¥ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘æ˜¯ä¸€ä¸ªï¼ˆè¿‡åº¦ï¼Ÿï¼‰è‡ªä¿¡çš„äººï¼Œä½†åœ¨æˆ‘çš„ç”Ÿæ´»ä¸­ï¼Œæœ‰å‡ æ¬¡æˆ‘å¯¹è‡ªå·±æˆåŠŸçš„èƒ½åŠ›æœ‰å¾ˆå¤§çš„ç„¦è™‘ã€‚æˆ‘ç«‹å³æƒ³åˆ°çš„æ˜¯ï¼šå¼€å§‹ä¸Šé«˜ä¸­ï¼Œå¼€å§‹ä¸Šå¤§å­¦ï¼Œä»¥åŠå¤§å­¦æ¯•ä¸šååœ¨å¾®è½¯å·¥ä½œã€‚è€Œå¼€æºçš„ Envoy å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æˆ‘è®°å¾—æˆ‘è¢«å…¬ä¼—çš„ååº”å“åäº†ã€‚äººä»¬ä¼šæ€ä¹ˆè¯´ï¼Ÿåé¦ˆä¼šæ˜¯ç§¯æçš„è¿˜æ˜¯æ¶æ¯’çš„ï¼Ÿè™½ç„¶æˆ‘ä»¬åœ¨å¼€æºæ—¶æ˜¯ä¸€ä¸ªå°å›¢é˜Ÿï¼Œä½†æˆ‘ä»ç„¶å†™äº† 90% æˆ–æ›´å¤šçš„ä»£ç ï¼Œå¹¶ä¸”è§‰å¾—æŠŠå®ƒæ”¾åˆ°å…¬å…±é¢†åŸŸæ˜¯å¯¹æˆ‘è‡ªå·±å’Œæˆ‘çš„èƒ½åŠ›çš„ä¸€ç§åæ˜ ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœŸè€Œè‡³ï¼Œ&lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt; åœ¨ 2016 å¹´ 9 æœˆ 14 æ—¥ &lt;a href=&#34;https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆä¸ºå¼€æºäº§å“&lt;/a&gt;ã€‚æˆ‘è®°å¾—æˆ‘å’Œå¦»å­ä¸€èµ·åº†ç¥ï¼Œå¹¶è¯´äº†ä¸€äº›è¯ã€‚â€œå¦‚æœæˆ‘ä»¬èƒ½è®©å…¶ä»–å…¬å¸åƒ Lyft ä¸€æ ·ä½¿ç”¨ Envoyï¼Œæˆ‘å°±ä¼šå¾ˆé«˜å…´ã€‚â€&lt;/p&gt;
&lt;p&gt;å¯¹å¼€æ”¾æºç å‘å¸ƒçš„ååº”å‡ ä¹æ˜¯æ™®éçš„ç§¯æã€‚ä»¤æˆ‘ä»¬æƒŠè®¶çš„æ˜¯ï¼Œå‡ ä¹æ˜¯ç«‹åˆ»ï¼Œæˆ‘ä»¬å¼€å§‹å¬åˆ°å¤§å…¬å¸çš„å£°éŸ³ï¼Œè€Œä¸æ˜¯å°å…¬å¸ã€‚åœ¨å‡ å‘¨å†…ï¼Œæˆ‘ä»¬ä¸è‹¹æœã€å¾®è½¯è¿›è¡Œäº†äº¤è°ˆï¼Œä¸è°·æ­Œçš„å¯¹è¯ä¹Ÿä¸æ–­åŠ å¿«ã€‚å¤§å…¬å¸åœ¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆä¸­å­˜åœ¨é—®é¢˜ï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„å›¢é˜Ÿå‡†å¤‡æŠ•å…¥åˆ°è§£å†³è¿™äº›é—®é¢˜çš„å·¥ä½œä¸­ã€‚å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼ˆè‡³å°‘åœ¨ Twitter çš„è§‚ç‚¹ä¸­ï¼‰ï¼ŒC++ åœ¨è¿™é‡Œæ˜¯ä¸€ç§å¸®åŠ©ï¼Œè€Œä¸æ˜¯ä¸€ç§é˜»ç¢ã€‚è¿™äº›å¤§å…¬å¸éƒ½å·²ç»æ‹¥æœ‰å……è¶³çš„ C/C++ å¼€å‘èµ„æºï¼Œä»¥åŠä»–ä»¬æƒ³è¦æ•´åˆçš„ç°æœ‰åº“ï¼Œç­‰ç­‰ã€‚å¯¹ä»–ä»¬æ¥è¯´ï¼ŒC++ æ˜¯ä¸€ä¸ªå–ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæ¯«ä¸å¥‡æ€ªï¼Œæˆ‘ä»¬ä¸è°·æ­Œçš„äººæœ‰æœ€å¤šçš„äº’åŠ¨ã€‚æœ€åˆä¸»è¦æ˜¯æ„å»º Istio çš„å›¢é˜Ÿï¼Œä½†æ¸æ¸åœ°ï¼Œæˆ‘ä»¬ä¸ Anna Berenberg èŠ±äº†æ›´å¤šæ—¶é—´ï¼Œå¥¹ç°åœ¨æ˜¯è°·æ­Œçš„æ°å‡ºå·¥ç¨‹å¸ˆï¼Œé¢†å¯¼å„ç§ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡å·¥ä½œã€‚è¿™ç§å…³ç³»å°†äº§ç”Ÿ &amp;quot; å–·æ°”ç‡ƒæ–™â€ï¼Œåœ¨ 2017 å¹´åˆçœŸæ­£å¯åŠ¨è¯¥é¡¹ç›®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€å§‹èµ·é£&#34;&gt;å¼€å§‹èµ·é£&lt;/h3&gt;
&lt;p&gt;åˆ°äº† 2017 å¹´åˆï¼Œå¾ˆæ˜æ˜¾ï¼ŒEnvoy çš„å¼€å‘æ­£åœ¨åŠ é€Ÿã€‚è°·æ­Œæ‰¿è¯ºç”¨ Envoy å–ä»£ NGINXï¼Œç”¨äº Istioï¼ˆæœ€ç»ˆåœ¨ 2017 å¹´æ˜¥å­£æ¨å‡ºï¼‰ï¼Œå¯¹é¡¹ç›®çš„æœªæ¥æ¥è¯´æ›´é‡è¦çš„æ˜¯ï¼ŒAnna çš„å¤§å‹å›¢é˜Ÿè‡´åŠ›äº GCP äº‘è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œä»–ä»¬å¼€å§‹å‘ä½¿ç”¨ Envoy çš„å„ç§äº‘è´Ÿè½½å‡è¡¡äº§å“ä»¥åŠå†…éƒ¨ç”¨ä¾‹ï¼ˆè¿™åœ¨è¿™ä¸ªæ—¶æœŸéƒ½æ˜¯éå¸¸ç§˜å¯†çš„ï¼Œä½†ç°åœ¨å·²ç»ä¼—æ‰€å‘¨çŸ¥ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†æ°¸è¿œè®°å¾—ä¸è°·æ­Œäº’åŠ¨çš„é‚£æ®µæ—¶é—´æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­æœ€ç´§å¼ çš„æ—¶æœŸä¹‹ä¸€ã€‚è¯´å®è¯ï¼Œé‚£æ„Ÿè§‰å°±åƒä¸€ä¸ªæ”¶è´­ï¼ˆå®¡è®¯ï¼‰è¿‡ç¨‹ã€‚æˆ‘è®°å¾—é•¿é•¿çš„ä¼šè®®å’Œç”µå­é‚®ä»¶çº¿ç¨‹ï¼Œä»¥è¯æ˜æˆ‘ä»¬çš„æŠ€æœ¯å†³å®šï¼Œâ€œé¢è¯• &amp;ldquo;ä¸­ï¼Œè°·æ­Œè¯•å›¾ç¡®å®šæˆ‘ä»¬æ˜¯å¦ä¼šæˆä¸ºä¸€ä¸ªå¥½çš„å¼€æºé¡¹ç›®åˆä½œä¼™ä¼´ï¼Œç­‰ç­‰ã€‚å½“æ—¶æˆ‘ä»¬å¾ˆç—›è‹¦åœ°å‘ç°ï¼Œè¿™æ¬¡&amp;rdquo; æ”¶è´­ &amp;quot; å°†ä½¿ Envoy è¿›å…¥ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±æ°¸è¿œæ— æ³•å®ç°çš„è½¨é“ï¼Œæ‰€ä»¥æˆ‘ä»¬å°½ä¸€åˆ‡åŠªåŠ›ä½¿å®ƒè·å¾—æˆåŠŸï¼Œæœ€ç»ˆä¹Ÿè·å¾—äº†æˆåŠŸã€‚è€Œä¸”ï¼Œåœ¨è¿‡å» 4 å¹´å¤šçš„æ—¶é—´é‡Œï¼Œæˆ‘ä»¬ä¸è°·æ­Œçš„åˆä½œç¡®å®æ˜¯ä¸€ç§æ°å‡ºçš„ä¼™ä¼´å…³ç³»ã€‚æ—©æœŸçš„è°·æ­Œäº‘å·¥ç¨‹å¸ˆæœ€ç»ˆæˆä¸ºç»´æŠ¤è€…ï¼ŒHarvey Tuch å’Œ Alyssa Wilkï¼Œä¸ºé¡¹ç›®å¸¦æ¥äº†å¤§é‡çš„äººæ‰ï¼ŒåŒ…æ‹¬æŠ€æœ¯ä¸Šçš„ï¼Œä»¥åŠå¯¹å¼€æºå’Œç¤¾åŒºçš„æ”¯æŒã€‚æˆ‘å¯¹ä»–ä»¬çš„æ„Ÿæ¿€ä¹‹æƒ…æº¢äºè¨€è¡¨ï¼Œæ²¡æœ‰ä»–ä»¬ï¼Œé¡¹ç›®å°±ä¸ä¼šæœ‰ä»Šå¤©çš„æˆå°±ã€‚å¤šå¹´æ¥ä¸ºè¯¥é¡¹ç›®åšå‡ºè´¡çŒ®çš„å…¶ä»–è°·æ­Œå·¥ç¨‹å¸ˆï¼ˆç°åœ¨æœ‰å¾ˆå¤šï¼‰ï¼Œé™¤äº†æ™®éæ˜¯ä¼˜ç§€çš„ç¤¾åŒºç®¡ç†è€…ä¹‹å¤–ï¼Œè¿˜ä¸ºè¯¥é¡¹ç›®å¢åŠ äº†å¤§é‡çš„å·¥ç¨‹åŠ›é‡ï¼Œå¦åˆ™è¯¥é¡¹ç›®å°±ä¸ä¼šæœ‰ã€‚æˆ‘å½“ç„¶å¯¹æœ€åˆçš„è°·æ­Œåˆä½œå…³ç³»æœ‰é¡¾è™‘ï¼ˆæŠ€æœ¯å’Œç†å¿µä¸Šçš„åˆ†æ­§ï¼Œç­‰ç­‰ï¼‰ï¼Œä½†æˆ‘å¯ä»¥è¯šå®åœ°è¯´ï¼Œè¿™äº›é¡¾è™‘éƒ½æ²¡æœ‰æˆä¸ºç°å®ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†ç¡®ä¿ Istio å’Œ GCP å›¢é˜Ÿä¸è°·æ­Œåˆä½œçš„æˆåŠŸä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜èŠ±äº†å¤§é‡æ—¶é—´ä¸å…¶ä»–å…¬å¸å’Œç»´æŠ¤è€…åˆä½œå¹¶åŠ å…¥ä»–ä»¬ï¼Œå…¶ä¸­è®¸å¤šäººå¯¹é¡¹ç›®äº§ç”Ÿäº†å·¨å¤§çš„å½±å“ï¼Œè‡³ä»Šä»ä½œä¸ºç»´æŠ¤è€…ã€è´¡çŒ®è€…æˆ–ç”¨æˆ·å¤§é‡å‚ä¸ã€‚å¦‚æœæ²¡æœ‰è¿™äº›æ—©æœŸçš„ç¤¾åŒºæˆå‘˜ï¼Œè¿™ä¸ªé¡¹ç›®å°±ä¸ä¼šæœ‰ä»Šå¤©ï¼Œæˆ‘ä¹Ÿéå¸¸æ„Ÿè°¢ä»–ä»¬å¯¹é¡¹ç›®çš„ä¿¡ä»»ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œéšç€é¡¹ç›®çš„ä¸æ–­æ·±å…¥ï¼Œæˆ‘å¼€å§‹æ”¶åˆ°å¤§é‡æŠ•èµ„è€…å¯¹ Enovy çš„å…´è¶£ã€‚æœ‰å¼ºçƒˆçš„æ„¿æœ›è®©æˆ‘ç¦»å¼€ Lyftï¼Œå›´ç»•è¿™ä¸ªé¡¹ç›®å¼€ä¸€å®¶å…¬å¸ã€‚æˆ‘&lt;a href=&#34;https://medium.com/@mattklein123/optimizing-impact-why-i-will-not-start-an-envoy-platform-company-8904286658cb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†™è¿‡è¿™éƒ¨åˆ†çš„æ—…ç¨‹&lt;/a&gt;ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™é‡Œé‡è¿°ï¼Œç•™åœ¨ Lyft æˆ‘ä¼šæœ‰å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›æ¥å¤„ç†æ‰€æœ‰è¿™äº›äº’åŠ¨ã€‚æ­£å¦‚é“¾æ¥çš„æ–‡ç« æ‰€æè¿°çš„ï¼Œæˆ‘æœ€ç»ˆå†³å®šç•™åœ¨ Lyftï¼Œä¸å¼€å…¬å¸ï¼Œä»¥æ”¯æŒ Envoy çš„æŒç»­æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»ç„¶åœ¨ Lyft å·¥ä½œï¼Œæ­£å¦‚æˆ‘å°†åœ¨åé¢è¿›ä¸€æ­¥è®¨è®ºçš„é‚£æ ·ï¼Œæˆ‘è¶Šæ¥è¶Šå¤šåœ°ä»äº‹ä¸¤ä»½å·¥ä½œã€‚æˆ‘çš„ç¬¬ä¸€ä»½å·¥ä½œæ˜¯åœ¨å†…éƒ¨é¢†å¯¼ç½‘ç»œå›¢é˜Ÿï¼Œå¹¶åœ¨è¿è¥ä¸Šæ”¯æŒ Lyft çš„ Envoyã€‚æˆ‘çš„ç¬¬äºŒä»½å·¥ä½œæ˜¯ä½œä¸º Envoy çš„å…¬ä¼—å½¢è±¡ï¼ŒåŒ…æ‹¬ OSS é¢†å¯¼ï¼Œä»£ç å®¡æŸ¥ï¼Œä¿®å¤é”™è¯¯ï¼Œç¼–å†™å¯ä»¥ä¿ƒè¿›é¡¹ç›®çš„åŠŸèƒ½ï¼Œåœ¨ä¼šè®®ä¸Šå‘è¨€ï¼Œå¸®åŠ©å…¶ä»–å…¬å¸é‡‡ç”¨å’Œéƒ¨ç½² Envoyï¼Œç­‰ç­‰ã€‚æˆ‘å¼€å§‹å˜å¾—è¿‡äºåˆ†æ•£ï¼Œå¹¶å‡ºç°äº†å€¦æ€ çš„è¿¹è±¡ã€‚ç„¶è€Œï¼Œåˆ°äº† 2017 å¹´å¹´ä¸­ï¼Œä¸å¯å¦è®¤çš„äº‹å®æ˜¯ï¼ŒEnvoy çš„å‘å±•è½¨è¿¹æ˜¯å¤§å¤§çš„ â€œå‘ä¸Šå’Œå‘å³â€ã€‚å„å¤§å…¬å¸ã€â€œåŒè¡Œå…¬å¸â€ã€å‚ç›´äº§å“å’ŒæœåŠ¡ç­‰çš„é‡‡ç”¨ç‡ç»§ç»­æ”€å‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æèµ ç»™-cncf-ä¸”æ„Ÿåˆ°å€¦æ€ &#34;&gt;æèµ ç»™ CNCF ä¸”æ„Ÿåˆ°å€¦æ€ &lt;/h3&gt;
&lt;p&gt;åˆ° 2017 å¹´ç§‹å¤©ï¼Œæœ‰ä¸¤ä»¶äº‹æ˜¯æ¸…æ¥šçš„ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Envoy å·²ç»è¶…å‡ºäº† Lyft OSS è®¾å¤‡æ‰€èƒ½æä¾›çš„èŒƒå›´ã€‚è¯¥é¡¹ç›®éœ€è¦æ³•å¾‹ã€å…¬å…±å…³ç³»ã€è¥é”€ã€æ´»åŠ¨ç»„ç»‡ç­‰æ–¹é¢çš„å¸®åŠ©ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘å¾ˆå¿«å°±å®Œå…¨å€¦æ€ äº†ï¼Œéœ€è¦æ‰¾å‡ºä¸€æ¡å¯æŒç»­å‘å±•çš„é“è·¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬æœ€ç»ˆåŒæ„è€ƒè™‘å°† Envoy è½¬äº¤åˆ° CNCFã€‚æ•°æœˆæ¥ï¼ŒCNCF ä¸€ç›´åœ¨è¿½æ±‚è¯¥é¡¹ç›®ï¼Œä½†ä¼¼ä¹ä»æ¥æ²¡æœ‰ä»»ä½•ä»¤äººä¿¡æœçš„ç†ç”±æ¥åŠ å…¥ã€‚åˆ° 2017 å¹´åº•ï¼Œå¾ˆæ˜æ˜¾ï¼ŒCNCF çš„èµ„æºå³ä½¿ä¸æ˜¯å‡€æ”¶ç›Šï¼Œä¹Ÿè‡³å°‘å¯¹é¡¹ç›®æ˜¯ä¸­æ€§çš„ã€‚æˆ‘ä»¬å¼€å§‹äº†æäº¤ç¨‹åºï¼Œå¹¶æœ€ç»ˆåœ¨æˆ‘ä»¬æœ€åˆå¼€æ”¾é¡¹ç›®èµ„æºçš„å‡ ä¹æ•´æ•´ä¸€å¹´å&lt;a href=&#34;https://eng.lyft.com/envoy-joins-the-cncf-dc18baefbc22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠ å…¥äº†è¯¥åŸºé‡‘ä¼š&lt;/a&gt;ã€‚æˆ‘å¾ˆæ„Ÿè°¢ Alexis Richardson å’Œ Chris Aniszczyk åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹é¡¹ç›®çš„æŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹åˆ™è¦å¤æ‚å¾—å¤šã€‚ä»æ ¹æœ¬ä¸Šè¯´ï¼Œæˆ‘çš„å·¥ä½œæ—¶é—´è¶…è¿‡äº†æˆ‘çš„å·¥ä½œèƒ½åŠ›ï¼Œæœ‰æ•ˆåœ°è·¨è¶Šäº†ä¸¤ä¸ªä¸åŒçš„å·¥ä½œã€‚æ­¤å¤–ï¼Œæˆ‘æ­£åœ¨æœŸå¾…æˆ‘çš„ç¬¬ä¸€ä¸ªå­©å­ï¼Œé¢„äº§æœŸåœ¨ 2018 å¹´åˆï¼Œéšç€åˆ°æ¥çš„æ—¥æœŸè¶Šæ¥è¶Šè¿‘ï¼Œè¿™è®©æˆ‘è¶Šæ¥è¶Šç„¦è™‘ã€‚åˆ°è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å·²ç»å¾ˆæ¸…æ¥šï¼Œæˆ‘åœ¨è®¾å®šæœŸæœ›å’Œç•Œé™æ–¹é¢åšå¾—ä¸å¤Ÿå¥½ï¼Œä¸çŸ¥é“è‡ªå·±èƒ½å¤Ÿä¸º Lyft æä¾›ä»€ä¹ˆï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ä»è¡Œä¸šçš„è§’åº¦å…³æ³¨ Envoy çš„æŒç»­å¢é•¿ã€‚åœ¨ Lyftï¼Œæˆ‘è¶Šæ¥è¶Šæ”¾ä»»è‡ªæµï¼Œé™·å…¥äººé™…å…³ç³»çš„äº‰åµï¼Œåœ¨ä¸ºæ›´å¤šçš„åˆçº§å›¢é˜Ÿæˆå‘˜æä¾›æŒ‡å¯¼å’Œé¢†å¯¼æ–¹é¢ï¼Œæ²¡æœ‰è¾¾åˆ°æˆ‘è¿™ä¸ªçº§åˆ«çš„æœŸæœ›ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘å½“æ—¶æ­£å¤„äºå´©æºƒçš„è¾¹ç¼˜ï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº† Envoy è€Œä¸æ˜¯ Lyftï¼Œè¿™å¯¹æˆ‘çš„ Lyft åŒäº‹é€ æˆäº†ä¼¤å®³ã€‚æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘åœ¨ 2017 å¹´åˆè‡³å¹´ä¸­å¯¹æˆ‘çš„å·¥ä½œé‡ä¸ Lyft çš„é¢†å¯¼å±‚æ›´åŠ é€æ˜ï¼Œæˆ‘å¯èƒ½ä¼šé¿å…ä¸€äº›æœ€ç³Ÿç³•çš„ç»“æœï¼Œä½†ä¸å¹¸çš„ç°å®æ˜¯ï¼Œ&lt;strong&gt;ä¸ºå¼€æºè½¯ä»¶è¡Œä¸šçš„å·¥ä½œæä¾›èµ„æºï¼Œè€Œè¿™äº›å·¥ä½œå¯¹é›‡ä¸»æ²¡æœ‰ç«‹å³æ˜æ˜¾çš„ä½œç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„åŠªåŠ›&lt;/strong&gt;ã€‚å®ƒå¯èƒ½ä¼šæ›´é¡ºåˆ©ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè™½ç„¶æˆ‘å¯¹ä¸€äº›æˆ‘æœ¬å¯ä»¥å¤„ç†å¾—æ›´å¥½çš„äººé™…å…³ç³»é—®é¢˜æ„Ÿåˆ°é—æ†¾ï¼Œä½†æ— è®ºå¥½åï¼Œ&lt;strong&gt;æˆ‘éƒ½ä¸åæ‚”æŠŠç²¾åŠ›æ”¾åœ¨ Envoy ä¸Šã€‚æˆ‘ä¼˜å…ˆè€ƒè™‘çš„æ˜¯ Envoyï¼Œè€Œä¸æ˜¯ Lyftï¼Œæˆ‘åšäº†æˆ‘è®¤ä¸ºå½“æ—¶å¿…é¡»åšçš„äº‹æƒ…ï¼Œä»¥ä½¿å®ƒæˆåŠŸ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æŒç»­å‘å±•é“è·¯&#34;&gt;å¯æŒç»­å‘å±•é“è·¯&lt;/h3&gt;
&lt;p&gt;æˆ‘çš„ç¬¬ä¸€ä¸ªå­©å­åœ¨ 2018 å¹´ 2 æœˆå‡ºç”Ÿï¼ŒLyft æå…¶æ…·æ…¨çš„é™ªäº§å‡æ”¿ç­–ä¸ºæˆ‘æä¾›äº†ä¼‘æ¯å’Œæ”¾ç©ºè‡ªå·±çš„æ—¶é—´ã€‚æˆ‘ä» Lyft è·å¾—äº†ä¸€äº›ç©ºé—´ï¼Œå¹¶å¼€å§‹æ›´æ·±å…¥åœ°æ€è€ƒæˆ‘æƒ³è¦ä»€ä¹ˆä»¥åŠä»€ä¹ˆå¯¹æˆ‘æ¥è¯´æ˜¯å¯æŒç»­çš„ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä¼‘å®Œé™ªäº§å‡å›æ¥åï¼Œæˆ‘ä¸ Lyft é¢†å¯¼å±‚æ˜ç¡®è¡¨ç¤ºï¼Œæˆ‘ä¸èƒ½å†å‚ä¸ Lyft çš„ Envoy çš„ &amp;ldquo;æ—¥å¸¸&amp;rdquo; è¿ç»´ã€‚ç›¸åï¼Œç”±äº 2017 å¹´åº•çš„ä¸€äº›åæœï¼ŒåŸºç¡€è®¾æ–½å›¢é˜Ÿä¹Ÿå¸Œæœ›ä¸æˆ‘åˆ†å¼€ä¸€äº›ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œ&lt;strong&gt;æˆ‘å¤§å¹…åé€€ï¼Œå®é™…ä¸Šå®Œå…¨åœæ­¢äº†åœ¨ Lyft çš„åŸºç¡€è®¾æ–½å·¥ä½œ&lt;/strong&gt;ï¼Œåœ¨ 2018 å¹´å¹´ä¸­è‡³å¹´æœ«çš„ Lyft Bikes å’Œ Scooters åˆå§‹ç‰ˆæœ¬ä¸­ç¼–å†™å›ºä»¶ç½‘ç»œä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„å›¢é˜ŸåŠªåŠ›ï¼Œåœ¨å‹ç¼©çš„æ—¶é—´èŒƒå›´å†…å¾—åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œæˆ‘çœŸçš„å¾ˆå–œæ¬¢åœ¨å‡ ä¸ªæœˆå†…åšä¸€äº›å®Œå…¨ä¸åŒçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;2018 å¹´ä¹Ÿæ˜¯æˆ‘ç§¯æå¼€å§‹ç¢ç£¨åœ¨ Envoy OSS ç¤¾åŒºä¸­ &amp;ldquo;å–ä»£è‡ªå·±&amp;rdquo; çš„é‚£ä¸€å¹´ã€‚æˆ‘èŠ±äº†å¤§é‡çš„æ—¶é—´ï¼ˆå¹¶å°†ç»§ç»­èŠ±å¤§é‡çš„æ—¶é—´ï¼‰æ¥åŸ¹å…»ç»´æŠ¤è€…ã€æ–°çš„è´¡çŒ®è€…ï¼Œç»„ç»‡ç¬¬ä¸€æ¬¡ä¸“é—¨çš„ EnvoyConï¼Œç­‰ç­‰ã€‚ä»»ä½•é¢†å¯¼è€…éƒ½åº”è¯¥æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œé‚£å°±æ˜¯ç¡®ä¿è¯¥ç»„ç»‡åœ¨æœ‰ä¸€å¤©è¯¥é¢†å¯¼è€…é€€ä½æ—¶èƒ½å¤Ÿç»§ç»­è‰¯å¥½åœ°è¿ä½œã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2018 å¹´åº•ï¼Œæˆ‘çš„ä¸»è¦èŒä¸šå€¦æ€ é£é™©å·²ç»å¾—åˆ°è§£å†³ï¼Œæˆ‘åˆå¼€å§‹äº†åˆç†çš„å·¥ä½œæ—¶é—´ï¼Œå¹¶èŠ±äº†å¾ˆå¤šæ—¶é—´ä¸æˆ‘çš„å¦»å­å’Œå„¿å­åœ¨ä¸€èµ·ï¼Œæˆ‘çš„æ—¶é—´å¤§è‡´åœ¨ Envoy OSS å·¥ä½œå’Œ Lyft çš„ä¸€èˆ¬åŸºç¡€è®¾æ–½é¢†å¯¼ä¹‹é—´å„å ä¸€åŠã€‚æ˜ç¡®åœ°è¯´ï¼ŒEnvoy çš„æˆåŠŸå¸¦æ¥çš„ç‰¹æƒä½¿æˆ‘èƒ½å¤Ÿåœ¨ Lyft çš„å·¥ä½œç”Ÿæ´»ä¸­å–å¾—è¿™ç§å¹³è¡¡ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œéšç€æˆ‘çš„è¡Œä¸šåœ°ä½çš„æé«˜ï¼Œæˆ‘çš„å½±å“åŠ›ä¹Ÿåœ¨åŒæ­¥å¢åŠ ï¼Œè¿™ä½¿å¾—æˆ‘æ›´å®¹æ˜“æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾å®šå°±ä¸šæ¡æ¬¾ã€‚æ²¡æœ‰å¤šå°‘äººæœ‰è¿™æ ·çš„è¿æ°”ï¼Œæˆ‘æ˜ç™½æˆ‘æ˜¯å¤šä¹ˆå¹¸è¿ï¼Œèƒ½å¤Ÿ â€œçªç ´ â€œå€¦æ€ å¢™çš„å¦ä¸€è¾¹è€Œä¸å¿…ç¦»å¼€æˆ‘çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;envoy-é•¿å¤§äº†&#34;&gt;Envoy é•¿å¤§äº†&lt;/h3&gt;
&lt;p&gt;è‡ª 2019 å¹´ä»¥æ¥ï¼Œå› ä¸ºæ–°å† ç–«æƒ…ï¼Œæˆ‘åœ¨ Lyft çš„åŸºç¡€è®¾æ–½é¢†å¯¼å’Œ OSS é¢†å¯¼ä¹‹é—´ç»§ç»­ä¿æŒç€æˆ‘ä¸Šé¢æè¿°çš„äº”äº”å¼€çš„æ¯”ä¾‹ã€‚å½“ç„¶ä¹Ÿæœ‰å•è°ƒå’Œæ¸´æœ›ä¸åŒçš„æ—¶å€™ï¼ˆä»å†å²ä¸Šçœ‹ï¼Œæˆ‘æ˜¯ä¸€ä¸ªä¹ æƒ¯æ€§æ¢å·¥ä½œçš„äººï¼Œ6.5 å¹´æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘åœ¨ä¸€ä»¶äº‹æƒ…ä¸Šå·¥ä½œçš„æœ€é•¿æ—¶é—´ï¼‰ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘å¾ˆé«˜å…´çœ‹åˆ° Envoy ä»ä¸€ä¸ª â€œæ–°ç§€ &amp;quot; å˜æˆæ›´å¤šçš„ â€œå°‘å¹´â€ã€‚æˆ‘ä¸å†ä¸“æ³¨äºåšæˆ‘æ‰€èƒ½æƒ³åˆ°çš„ä¸€åˆ‡ï¼Œä½¿ Envoy è·å¾—å·¨å¤§çš„æˆåŠŸï¼Œå› ä¸ºå¦ç‡åœ°è¯´ï¼ŒEnvoy æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆåŠŸï¼Œå·²ç»å¸­å·äº†å¸‚åœºï¼Œå¹¶æ”¹å˜äº†ç”¨æˆ·å¯¹åº”ç”¨è´Ÿè½½å‡è¡¡å·¥å…·çš„æœŸæœ›ã€‚ç›¸åï¼Œæˆ‘æ›´å…³æ³¨é¡¹ç›®çš„å¯æŒç»­æ€§ã€‚æˆ‘ä»¬æ˜¯åœ¨åšé•¿æœŸçš„å·¥ä½œï¼Œè¿™äº›å¤©æˆ‘è§‰å¾—è‡ªå·±æ›´åƒä¸€ä¸ª CEOï¼Œçœ‹å‡å‘˜äººæ•°ã€ä¼˜å…ˆçº§ã€é¢„ç®—ç¼–åˆ¶ã€å®‰å…¨é—®é¢˜ç­‰ç­‰ã€‚è¿™å¹¶ä¸æ˜¯è¯´è¿™ä¸æ˜¯æœ‰ç”¨çš„å·¥ä½œï¼›å®ƒæ˜¾ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œå®ƒåªæ˜¯ä¸æ—©æœŸçš„å·¥ä½œä¸åŒï¼Œæ—©æœŸçš„å·¥ä½œæŠ€æœ¯æ€§æ›´å¼ºï¼ŒèŠ‚å¥æ›´å¿«ã€‚&lt;/p&gt;
&lt;p&gt;æˆªæ­¢åˆ° 2021 å¹´æœ«ï¼Œæˆ‘å¯¹ Envoy æœ€å¼•ä»¥ä¸ºè±ªçš„äº‹æƒ…æ˜¯ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªç¤¾åŒºå·²ç»å¯ä»¥è‡ªæˆ‘ç»´æŒäº†ã€‚æˆ‘ä»¬æœ‰ä¸€ç¾¤ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ï¼Œä»–ä»¬å¯¹é¡¹ç›®çš„æˆåŠŸå……æ»¡çƒ­æƒ…ï¼Œå¹¶åœ¨ä½¿ Envoy æˆä¸ºä»Šå¤©çš„æ ·å­ä¸­å‘æŒ¥äº†ä½œç”¨ã€‚è¿™ç¡®å®æ˜¯ä¸€ä¸ªå›¢é˜Ÿçš„åŠªåŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»éªŒæ•™è®­&#34;&gt;ç»éªŒæ•™è®­&lt;/h2&gt;
&lt;p&gt;è¿‡å»çš„ 5 å¹´æ˜¯ä¸€ä¸ªå²è¯—èˆ¬çš„æ—…ç¨‹ã€‚è™½ç„¶æˆ‘è§‰å¾—æˆ‘åœ¨æŠ€æœ¯ä¸Šå­¦åˆ°çš„ä¸œè¥¿ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æˆ‘åœ¨é¢†å¯¼åŠ›ã€ç¤¾åŒºå»ºè®¾å’Œæ‰€æœ‰å…¶ä»–éæŠ€æœ¯æ€§çš„ä¸œè¥¿æ–¹é¢éƒ½å¾—åˆ°äº†æˆé•¿å’Œå­¦ä¹ ï¼Œè¿™äº›éƒ½æ˜¯å»ºç«‹ä¸€ä¸ªæˆåŠŸçš„ä¼ä¸šï¼Œæ— è®ºæ˜¯ä¼ä¸šè¿˜æ˜¯ä¸€ä¸ªä¸»è¦çš„å¼€æºæˆåŠŸæ•…äº‹ã€‚ä»¥ä¸‹æ˜¯æˆ‘å¯¹ä¸€äº›ä¸»è¦å­¦ä¹ å†…å®¹çš„ç®€çŸ­æ€»ç»“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›åŠä¸€ä¸ªä¼ä¸š&#34;&gt;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›åŠä¸€ä¸ªä¼ä¸š&lt;/h3&gt;
&lt;p&gt;ä¹Ÿè®¸æœ‰äº‰è®®çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘è®¤ä¸ºå¦‚æœä¸€ä¸ªäººæœ‰ç›®æ ‡è¦åˆ›å»ºä¸€ä¸ªéå¸¸æˆåŠŸçš„å¼€æºè½¯ä»¶é¡¹ç›®ï¼Œä»–ä»¬éœ€è¦æŠŠå®ƒæƒ³æˆä¸€ä¸ªä¼ä¸š&lt;/strong&gt;ã€‚é™¤äº†æ ¸å¿ƒæŠ€æœ¯ä¹‹å¤–ï¼Œåˆ›ä¸šè¿˜æ¶‰åŠå¾ˆå¤šå› ç´ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹›è˜ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™æ„å‘³ç€æ‹›è˜è´¡çŒ®è€…å’Œç»´æŠ¤è€…ï¼‰&lt;/li&gt;
&lt;li&gt;è·å–å®¢æˆ·ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™è¢«è½¬åŒ–ä¸ºç”¨æˆ·ï¼‰&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£å’ŒæŠ€æœ¯å†™ä½œ&lt;/li&gt;
&lt;li&gt;å…¬å…±å…³ç³»&lt;/li&gt;
&lt;li&gt;å¸‚åœºè¥é”€&lt;/li&gt;
&lt;li&gt;æ³•å¾‹ï¼ˆå•†æ ‡ã€è®¸å¯ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;äººåŠ›èµ„æºï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™å°†è½¬åŒ–ä¸ºè§£å†³ç¤¾åŒºçº çº·å’Œåˆ¶å®šæ–‡åŒ–ï¼‰&lt;/li&gt;
&lt;li&gt;èµ„é‡‘ï¼ˆåœ¨å¼€æºè½¯ä»¶ä¸­ï¼Œè¿™è½¬åŒ–ä¸ºè¾…åŠ©è´¹ç”¨ï¼Œå¦‚ CIã€ä¸ºç»´æŠ¤è€…æ‰¾åˆ°å…è®¸ä»–ä»¬åœ¨é¡¹ç›®ä¸­éƒ¨åˆ†æˆ–å…¨éƒ¨æ—¶é—´å·¥ä½œçš„å·¥ä½œï¼Œç­‰ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;æ€»çš„è¯´æ¥ï¼Œå°±æ˜¯é¢†å¯¼å’Œæ–¹å‘çš„ç¡®å®šã€‚èµ„æºæœ‰é™ï¼Œæœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšã€‚ä¼ä¸š / é¡¹ç›®éœ€è¦ä¸“æ³¨äºæœ€é‡è¦çš„äº‹æƒ…ï¼Œä»¥å®ç°äº§å“çš„å¸‚åœºé€‚åº”æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›´è§‚åœ°è¯´ï¼Œæˆ‘çŸ¥é“è¿™ä¸€ç‚¹ï¼Œåœ¨æœ€åˆä¸º Envoy è¿›è¡Œå¼€æºåŠªåŠ›æ—¶ï¼Œæˆ‘ç§¯æåœ°è¿½æ±‚ä¸Šè¿°æ‰€æœ‰çš„é¢†åŸŸï¼ŒåŠªåŠ›ä½¿é¡¹ç›®ä»å¼€å§‹å‘å±•åˆ°ä»Šå¤©çš„è§„æ¨¡ã€‚ä¸Šè¿°åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½å¾ˆå…³é”®ï¼Œå¦‚æœæ²¡æœ‰æ‰€æœ‰è¿™äº›ï¼Œä¸€ä¸ªé¡¹ç›®æ˜¯ä¸å¯èƒ½æˆåŠŸçš„ï¼Œå°¤å…¶æ˜¯åœ¨æŠ€æœ¯é¢†åŸŸæœ‰å¾ˆå¤šèµ„é‡‘é›„åšçš„å…¬å¸ç«äº‰å¯¹æ‰‹çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¼ºçƒˆé¼“åŠ±é‚£äº›è€ƒè™‘è¿›è¡Œå¤§è§„æ¨¡å¼€æºå·¥ä½œçš„äººæå‰åœ¨ä¸Šè¿°é¢†åŸŸè¿›è¡ŒæŠ•èµ„ï¼Œä»¥ä¾¿åœ¨ç¬¬ä¸€å¤©å°±ç»™äººç•™ä¸‹æœ€ä½³å°è±¡ã€‚æ­¤å¤–ï¼Œæ–°çš„å¼€æºé¡¹ç›®åº”è¯¥å‡†å¤‡åœ¨é¡¹ç›®æˆé•¿å¹¶å¼€å§‹çœ‹åˆ°é‡‡ç”¨æ—¶ï¼Œåœ¨ä¸Šè¿°é¢†åŸŸè¿›è¡Œæ›´å¤šçš„æŠ•èµ„ã€‚&lt;/p&gt;
&lt;p&gt;æ¯«ä¸å¥‡æ€ªï¼Œè¿™äº›å¤©æˆ‘åœ¨ Envoy ä¸Šåšçš„ç¼–ç å·¥ä½œç›¸å¯¹è¾ƒå°‘ã€‚æˆ‘åœ¨é¡¹ç›®ä¸Šçš„æ—¶é—´ä¸»è¦æ˜¯ç®¡ç†é¡¹ç›®çš„æ‰€æœ‰éæŠ€æœ¯æ–¹é¢ï¼ˆä¸Šè¿°åˆ—è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œç”šè‡³æ›´å¤šï¼ï¼‰ï¼Œå¹¶ç¡®ä¿äº‹æƒ…æŒ‰è®¡åˆ’è¿›è¡Œã€‚æˆ‘æ‰€åšçš„å¤§å¤šæ•°ç¼–ç é¡¹ç›®éƒ½æ˜¯ â€œæ¸…æ´ &amp;quot; çš„å¹•åé¡¹ç›®ï¼Œå¯¹é¡¹ç›®æœ‰å¥½å¤„ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆä¹è¶£ï¼Œä¹Ÿä¸å¯èƒ½æ¿€åŠ±å…¶ä»–è´¡çŒ®è€…ï¼ˆå½“ç„¶ï¼Œæˆ‘å¯¹ä»–ä»¬æ¯å¤©çš„å·¥ä½œæ²¡æœ‰å‘è¨€æƒï¼Œæˆ‘æœ‰åŠ¨åŠ›è®©ä»–ä»¬å°½å¯èƒ½çš„å¼€å¿ƒï¼Œè¿™æ ·ä»–ä»¬å°±ä¸ä¼šç¦»å¼€ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»ˆç«¯ç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&#34;&gt;ç»ˆç«¯ç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;è¿™äº›å¤©æ¥ï¼Œå¾ˆå¤š â€œå¤§çš„å¼€æºè½¯ä»¶â€ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºç¡€è®¾æ–½é¢†åŸŸï¼Œæ˜¯ç”±å¤§å…¬å¸å’Œé£é™©æŠ•èµ„æ”¯æŒçš„åˆåˆ›å…¬å¸èµ„åŠ©çš„ã€‚æˆ‘ä¸ä¼šç»•åˆ°å…³äºå¼€æºè½¯ä»¶çš„å›°éš¾ç»æµçš„è®¨è®ºï¼Œå› ä¸ºæˆ‘&lt;a href=&#34;https://medium.com/@mattklein123/the-broken-economics-of-oss-5a1b31fc0182&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·²ç»å†™è¿‡äº†&lt;/a&gt;ã€‚æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘åšä¿¡ç»ˆç«¯ç”¨æˆ·çš„å¼€æºè½¯ä»¶æ¯”ä¼ä¸šå’Œé£é™©æŠ•èµ„æ”¯æŒçš„å¼€æºè½¯ä»¶æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿&lt;/strong&gt;ï¼šæœ€åˆçš„å®¢æˆ·å‡ ä¹è‚¯å®šä¼šä»è½¯ä»¶ä¸­è·å¾—ä»·å€¼ï¼Œå¦åˆ™è½¯ä»¶å°±ä¸ä¼šå¾—åˆ°èµ„åŠ©ã€‚è¿™ç§ä¸å®¢æˆ·ä¸€èµ·å»ºç«‹ä¸œè¥¿çš„è‰¯æ€§å¾ªç¯æ˜¯éå¸¸å¼ºå¤§çš„ã€‚å®ƒå‡ ä¹æ™®éå¯¼è‡´äº†æ›´å¥½çš„ç»“æœï¼šè½¯ä»¶æ›´å¯é ã€æ›´ä¸“æ³¨ã€åŠŸèƒ½æ›´å°‘ã€‚æœ‰å¾ˆå¤šç”±æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶çš„ä¾‹å­ï¼Œç„¶åå–å¾—äº†å·¨å¤§çš„å•†ä¸šæˆåŠŸã€‚é‰´äºåšå®çš„åŸºç¡€å’Œå†…åœ¨çš„äº§å“å¸‚åœºé€‚åº”æ€§ï¼Œè¿™å¯¹æˆ‘æ¥è¯´å¹¶ä¸å¥‡æ€ªã€‚æˆ‘å¸Œæœ›çœ‹åˆ°æ¯”ä»Šå¤©æ›´å¤šçš„æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶ï¼Œå°½ç®¡æˆ‘è®¤è¯†åˆ°ç»æµä¸Šæ˜¯å›°éš¾çš„ã€‚å¯¹äºé‚£äº›æœ‰æœºä¼šçš„äººæ¥è¯´ï¼Œè¯·å‘è¿™ç§ç±»å‹çš„è½¯ä»¶æ‰€å…·æœ‰çš„ç»“æ„æ€§ä¼˜åŠ¿é æ‹¢ï¼&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦è·Ÿé£è¦è·Ÿéšå®¢æˆ·&#34;&gt;ä¸è¦è·Ÿé£ï¼Œè¦è·Ÿéšå®¢æˆ·&lt;/h3&gt;
&lt;p&gt;è¿™ä¹Ÿè®¸æ˜¯ &amp;ldquo;æˆåŠŸçš„å¼€æºè½¯ä»¶å°±åƒåˆ›ä¸š&amp;rdquo; å’Œ &amp;ldquo;æœ€ç»ˆç”¨æˆ·é©±åŠ¨çš„å¼€æºè½¯ä»¶æ˜¯ä¸€ç§ç»“æ„æ€§ä¼˜åŠ¿&amp;rdquo; çš„å¿…ç„¶ç»“æœï¼Œä½†æˆ‘æ— æ³•å¼ºè°ƒåšæŒä¸æ‡ˆåœ°å…³æ³¨å®¢æˆ·çš„å®é™…éœ€æ±‚è€Œä¸æ˜¯ç‚’ä½œå‘¨æœŸæ‰€è®¤ä¸ºçš„å®¢æˆ·éœ€æ±‚æ˜¯å¤šä¹ˆå…³é”®ã€‚ä¾‹å¦‚ï¼Œ&lt;strong&gt;å¤šå¹´æ¥ï¼Œäººä»¬ä¸€ç›´åœ¨å˜²ç¬‘ Envoy æ˜¯ç”¨ C++ ç¼–å†™çš„ï¼Œè¿™å¼•èµ·äº†æ— æ•°çš„ç¬‘è¯&lt;/strong&gt;ã€‚æˆ‘å–œæ¬¢ C++ å—ï¼Ÿä¸ï¼Œä¸æ˜¯å¾ˆå–œæ¬¢ã€‚å®ƒæ˜¯å¦åœ¨ 2015 å¹´å®Œæˆäº†å·¥ä½œï¼Œå¹¶å¸å¼•äº†æœ€åˆçš„ä¸€æ‰¹ä¸»è¦ç”¨æˆ·ï¼Ÿè‚¯å®šæ˜¯çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå…³æ³¨å®¢æˆ·å’Œå¸‚åœºçš„ä¾‹å­ï¼Œè€Œä¸æ˜¯å±ˆæœäºæ²¡æœ‰å®é™… â€œå•†ä¸š &amp;quot; å½±å“çš„ç‚’ä½œã€‚å¦‚æœä¸€ä¸ªäººæŠŠå¼€æºè½¯ä»¶å½“åšä¸€ä¸ªä¼ä¸šï¼Œå°±ä¼šç«‹åˆ»æ˜ç™½ï¼Œ&lt;strong&gt;ä»¥å®¢æˆ·å’Œå¸‚åœºä¸ºä¸­å¿ƒæ˜¯å–å¾—å·¨å¤§æˆåŠŸçš„å”¯ä¸€é€”å¾„&lt;/strong&gt;ã€‚åœ¨ Envoyï¼Œæˆ‘èŠ±äº†å¤§é‡çš„æ—¶é—´ä¸ºç»ˆç«¯ç”¨æˆ·äº‰è®ºï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å»ºç«‹çš„ä¸œè¥¿èƒ½è®©æ‰€æœ‰äººå—ç›Šï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€å°éƒ¨åˆ†å°ä¼—ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æ‰©å±•æ€§æ˜¯è‡³å…³é‡è¦çš„&#34;&gt;å¯æ‰©å±•æ€§æ˜¯è‡³å…³é‡è¦çš„&lt;/h3&gt;
&lt;p&gt;è·Ÿç€å®¢æˆ·èµ°å¾€å¾€ä¼šå¯¼è‡´å®¢æˆ·çš„è¦æ±‚ä¸èƒ½å¾ˆå¥½åœ°èå…¥é¡¹ç›®çš„æ¶æ„ä¸­ã€‚ä»å¼€æºè½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œå¤±å»å¯¹é¡¹ç›®ä¸»è¦ç›®æ ‡çš„å…³æ³¨ä¼šå¯¼è‡´åŠŸèƒ½è”“å»¶ã€è½¯ä»¶æ— æ³•ç»´æŠ¤å’Œç»´æŠ¤äººå‘˜è´Ÿæ‹…è¿‡é‡ã€‚åŒæ—¶ï¼Œè¯´ â€œä¸ &amp;quot; ä¹Ÿæ˜¯å¤±å»æ½œåœ¨ç”¨æˆ·çš„ä¸€ä¸ªä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Envoyï¼Œæˆ‘æƒ³ç¡®ä¿æˆ‘ä»¬è‡³å°‘å¯ä»¥è¯´ â€œæ˜¯çš„ï¼Œä½†æ˜¯â€¦â€¦&amp;quot;ï¼Œå³æä¾›ä¸€ä¸ªå¼ºå¤§çš„å¯æ‰©å±•æ€§æ¨¡å‹ï¼Œè®©ç”¨æˆ·å¯ä»¥æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸éœ€è¦å°†æ¯ä¸€ä¸ªæ”¹åŠ¨å’ŒåŠŸèƒ½éƒ½æ¨åˆ°ä¸Šæ¸¸ã€‚è¿™ç§ç­–ç•¥å·²ç»å¤šæ¬¡å¾—åˆ°å›æŠ¥ï¼Œå®ƒå‡è½»äº†ç»´æŠ¤è€…çš„è´Ÿæ‹…ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè§£å†³ä»–ä»¬è‡ªå·±çš„é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå°† Envoy æ¨å‘äº†æˆ‘åœ¨æœ€åˆè®¾è®¡è¯¥è½¯ä»¶æ—¶ä»æœªæƒ³è±¡è¿‡çš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ‰©å±•æ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¼€æºè½¯ä»¶çš„æ„å»ºæ¨¡å—ï¼Œæ˜¯è‡³å…³é‡è¦çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è´¨é‡é—®é¢˜&#34;&gt;è´¨é‡é—®é¢˜&lt;/h3&gt;
&lt;p&gt;è·Ÿéšå®¢æˆ·çš„å¦ä¸€ä¸ªæ¨è®ºæ˜¯ï¼Œè´¨é‡ç¡®å®å¾ˆé‡è¦ã€‚ç”¨æˆ·å¸Œæœ›è½¯ä»¶æ˜“äºæ“ä½œï¼Œç›¸å¯¹æ¥è¯´æ²¡æœ‰é”™è¯¯ï¼Œå…³å¿ƒå®‰å…¨ï¼Œç­‰ç­‰ã€‚æ›¾å‡ ä½•æ—¶å¾ˆå¤šäººä¼šè§‰å¾—å› ä¸ºå¼€æºè½¯ä»¶æ˜¯ &amp;quot; å…è´¹çš„â€ï¼Œæ‰€ä»¥è´¨é‡å°±å¾—ä¸åˆ°ä¿è¯ã€‚è¿™åœ¨ç†è®ºä¸Šä¹Ÿè®¸æ˜¯æ­£ç¡®çš„ï¼Œä½†å®é™…ä¸Šï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®å¯¹è½¯ä»¶è´¨é‡è®¤çœŸå¯¹å¾…ä¹‹å‰ï¼Œç”¨æˆ·ä¸ä¼šå¤§é‡åœ°èšé›†åœ¨ä¸€ä¸ªè½¯ä»¶ä¸Šã€‚å› ä¸ºè·å¾—ç”¨æˆ·æ˜¯ä¸€ä¸ªé£è½®ï¼Œå¯ä»¥è·å¾—æ›´å¤šçš„ç”¨æˆ·ï¼ˆç‰¹åˆ«æ˜¯å½“ä»æ—©æœŸé‡‡ç”¨è€…è½¬å‘æ™šæœŸé‡‡ç”¨è€…æ—¶ï¼‰ï¼Œæ‰€ä»¥ç¡®ä¿ä¸ºæ•´ä¸ªè½¯ä»¶è´¨é‡ç¼–åˆ—æ—¶é—´é¢„ç®—å°±æ›´åŠ å…³é”®äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº Envoyï¼Œæˆ‘ä¸€ç›´æœ‰ä¸€ä¸ª &amp;ldquo;é›¶ç¢°æ’&amp;rdquo; çš„ç†å¿µã€‚ä»»ä½•å´©æºƒéƒ½ä¼šè¢«è°ƒæŸ¥å’Œä¿®å¤ï¼Œæ— è®ºå¤šä¹ˆä¸é¢‘ç¹çš„é”™è¯¯ã€‚è¿™ç§å¯¹ç¨³å®šæ€§å’Œè´¨é‡çš„å…³æ³¨ä¸ä¼šè¢«å¿½è§†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤¾åŒºæ˜¯æ‰©å¤§è§„æ¨¡çš„å”¯ä¸€é€”å¾„&#34;&gt;ç¤¾åŒºæ˜¯æ‰©å¤§è§„æ¨¡çš„å”¯ä¸€é€”å¾„&lt;/h3&gt;
&lt;p&gt;è¿™å¾ˆæ˜æ˜¾ï¼Œä½†æˆ‘è¿˜æ˜¯è¦è¯´ï¼šç¤¾åŒºæ˜¯æ‰©å±•å¼€æºè½¯ä»¶çš„å”¯ä¸€é€”å¾„ã€‚è¿™æ˜¯ä¸€ä¸ªç”±ç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ç»„æˆçš„ç¤¾åŒºã€‚æ­¤å¤–ï¼Œç¤¾åŒºçš„&lt;strong&gt;åŸºè°ƒ&lt;/strong&gt;åœ¨é¡¹ç›®å¼€å§‹æ—¶å°±å·²ç»ç¡®å®šï¼Œè€Œä¸”æéš¾æ”¹å˜ã€‚äººç±»å€¾å‘äºéµå¾ªè§„èŒƒã€‚ä¸€æ—¦è§„èŒƒè¢«ç¡®å®šä¸‹æ¥ï¼Œæ— è®ºè§„èŒƒæ˜¯ä»€ä¹ˆï¼Œä¸è¿™äº›è§„èŒƒä¸ä¸€è‡´çš„äººéƒ½ä¼šè¢«é¿å¼€ã€‚å› æ­¤ï¼Œ&lt;strong&gt;é¡¹ç›®æœ€åˆçš„å…¬å…±åŸºè°ƒå¯¹äºè®¾å®šå…¶é•¿æœŸçš„ç¤¾åŒºè½¨è¿¹æä¸ºå…³é”®&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æŠŠ Envoy åšæˆå¼€æºè½¯ä»¶æ—¶ï¼Œæˆ‘åœ¨ GitHub ä¸ŠæŠ•å…¥äº†å¤§é‡çš„ç²¾åŠ›ä¸äººä»¬ä¸€èµ·å·¥ä½œï¼Œä½¿ç”¨å»ºè®¾æ€§å’Œæ¬¢è¿æ€§çš„è¯­è¨€ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘å°½æˆ‘æ‰€èƒ½è®© Envoy æˆä¸ºä¸€ä¸ªå—æ¬¢è¿çš„åœ°æ–¹ï¼Œè®©äººä»¬æ„¿æ„æ¥è´¡çŒ®è‡ªå·±çš„åŠ›é‡ï¼Œæ— è®ºæ˜¯ç»´æŠ¤ã€å¶å°”çš„è´¡çŒ®ï¼Œè¿˜æ˜¯ç”¨æˆ·å¸®åŠ©å…¶ä»–ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Envoy æ‰€å–å¾—çš„æ‰€æœ‰ä¸åŒç±»å‹çš„æˆåŠŸä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œç»™æˆ‘å¸¦æ¥æœ€å¤šä¸ªäººæ»¡è¶³æ„Ÿçš„éƒ¨åˆ†æ˜¯ï¼Œæœ‰ç›¸å½“å¤šçš„äººå‘Šè¯‰æˆ‘ï¼Œä»–ä»¬å·²ç»å‘èª“ä¸å†ä½¿ç”¨å¼€æºè½¯ä»¶ï¼Œå°¤å…¶æ˜¯åŸºç¡€è®¾æ–½å¼€æºè½¯ä»¶ï¼Œå› ä¸ºä»–ä»¬è§‰å¾—å¤§å¤šæ•°é¡¹ç›®ä¸­çš„äººå¯¹å½¼æ­¤æ„Ÿè§‰éƒ½å¾ˆç³Ÿç³•ã€‚ç›¸åçš„ï¼Œä»–ä»¬å–œæ¬¢ä¸º Envoy åšè´¡çŒ®ï¼Œå› ä¸ºè¿™ä¸ªç¤¾åŒºæ˜¯å¦‚æ­¤çš„å°Šé‡å’Œæ¬¢è¿å½¼æ­¤ã€‚è¿™éœ€è¦å¤§é‡çš„åŠªåŠ›å’Œçºªå¾‹ï¼Œå°¤å…¶æ˜¯åœ¨é¡¹ç›®çš„æ—©æœŸï¼Œæ‰èƒ½è¾¾åˆ°è¿™æ ·çš„ç»“æœï¼Œè€Œè¿™å·²ç»å¾—åˆ°äº†ä¼—å¤šçš„å›æŠ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¦ä½ä¼°ä»ä¸€å¼€å§‹å°±ç¡®å®šé¡¹ç›®çš„æ–‡åŒ–å’ŒåŸºè°ƒçš„å¤åˆæ•ˆåº”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ··åˆå•†ä¸šå’Œå¼€æºè½¯ä»¶çš„åˆ©ç›Šæ˜¯éå¸¸å›°éš¾çš„&#34;&gt;æ··åˆå•†ä¸šå’Œå¼€æºè½¯ä»¶çš„åˆ©ç›Šæ˜¯éå¸¸å›°éš¾çš„&lt;/h3&gt;
&lt;p&gt;å·²ç»æœ‰å¾ˆå¤šå…³äºå¼€æºè½¯ä»¶çš„å›°éš¾ç»æµå­¦çš„æ–‡ç« ï¼ˆ&lt;a href=&#34;https://medium.com/@mattklein123/the-broken-economics-of-oss-5a1b31fc0182&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŒ…æ‹¬æˆ‘è‡ªå·±çš„æ–‡ç« &lt;/a&gt;ï¼Œæˆ‘åœ¨ä¸Šé¢æåˆ°çš„ï¼‰ã€‚æˆ‘åªæƒ³è¯´ï¼Œ&lt;strong&gt;è¯•å›¾å°†å•†ä¸šä¸Šçš„æˆåŠŸå’Œå¼€æ”¾æºç çš„æˆåŠŸç»“åˆèµ·æ¥æ˜¯éå¸¸å›°éš¾çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™äº›æˆåŠŸå¾€å¾€æ˜¯ç›¸äº’çŸ›ç›¾çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç›¸ä¿¡ï¼ŒEnvoy é€šè¿‡å…¶å¼ºå¤§çš„ API å’Œå¯æ‰©å±•æ€§ç³»ç»Ÿç©¿é€äº†è¿™ä¸ªçŸ›ç›¾ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼ŒEnvoy å·²ç»æˆä¸ºä¸€ä¸ªå·¥å…·ï¼Œç°åœ¨è¢«å¤§é‡çš„å‚ç›´äº§å“å’ŒæœåŠ¡æ‰€ä½¿ç”¨ã€‚è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªç¤¾åŒºï¼Œè¯¥ç¤¾åŒºå……æ»¡äº†é€‰æ‹©åœ¨ä¸€ä¸ªå…±åŒçš„åŸºåº•ä¸Šåˆä½œçš„å…¬å¸ï¼Œå³ä½¿æ˜¯é€šè¿‡åœ¨æ‰©å±• / API / æ§åˆ¶å¹³é¢ / UI/UX å±‚ä¸Šçš„åˆ›æ–°ï¼Œæ¨å‡ºç›¸äº’ç«äº‰çš„ä¸Šå±‚äº§å“ã€‚&lt;/p&gt;
&lt;p&gt;ä»»ä½•æˆåŠŸçš„å¼€æºé¡¹ç›®éƒ½ä¼šçœ‹åˆ°å¤§é‡çš„å•†ä¸š / æŠ•èµ„äººçš„å…´è¶£ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¿æŒä¸€ä¸ªå……æ»¡æ´»åŠ›çš„ç¤¾åŒºï¼ŒåŒæ—¶åˆèƒ½å–å¾—å•†ä¸šä¸Šçš„æˆåŠŸï¼ˆæˆ‘è®¤ä¸ºè¿™å¯¹æ•´ä¸ªé¡¹ç›®çš„æˆåŠŸæ˜¯å¿…è¦çš„ï¼Œå› ä¸ºé’±å¿…é¡»æ¥è‡ªæŸå¤„ï¼‰ï¼Œ&lt;strong&gt;é‚£ä¹ˆé¢„å…ˆè€ƒè™‘å¦‚ä½•å°†æ ¸å¿ƒå±‚å’Œå•†ä¸šå±‚åˆ†å¼€æ˜¯æå…¶é‡è¦çš„&lt;/strong&gt;ã€‚è¿™æ ·åšçš„å®ç”¨æ€§å’Œç­–ç•¥ä¼šå› é¡¹ç›®å’ŒæŠ€æœ¯çš„ä¸åŒè€Œä¸åŒï¼Œä½†æˆ‘ç›¸ä¿¡ä¸“æ³¨äºå¼ºå¤§çš„ API / æ‰©å±•æ€§çš„åˆ†å‰²æ˜¯ä¸€ä¸ªå¯Œæœ‰æˆæ•ˆçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºé‡‘ä¼šæ˜¯å¾ˆæ£˜æ‰‹çš„&#34;&gt;åŸºé‡‘ä¼šæ˜¯å¾ˆæ£˜æ‰‹çš„&lt;/h3&gt;
&lt;p&gt;åœ¨ç°ä»£çš„å¼€æºè®¨è®ºä¸­ï¼Œæœ‰å¾ˆå¤šå…³äºåŸºé‡‘ä¼šçš„ä½œç”¨çš„è®¨è®ºã€‚æˆ‘ä¸æ‰“ç®—å¯¹è¿™ä¸€è¯é¢˜åšå¤§é‡çš„è¯„è®ºï¼Œ&lt;strong&gt;ä½†æˆ‘çš„ä¸»è¦å»ºè®®æ˜¯ä¸è¦è¢«åŸºé‡‘ä¼šå’Œå®ƒä»¬å¯èƒ½æä¾›çš„ç†è®ºåˆ©ç›Šæ‰€å¹²æ‰°&lt;/strong&gt;ã€‚ç›¸åï¼Œè¦ç§¯æåœ°å…³æ³¨äº§å“çš„å¸‚åœºé€‚åº”æ€§ï¼Œç”Ÿäº§é«˜è´¨é‡çš„è½¯ä»¶ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›ä»·å€¼ã€‚å¦‚æœè¿™äº›äº‹æƒ…å¾—ä»¥å®ç°ï¼Œå…¶ä½™çš„äº‹æƒ…å°±ä¼šè‡ªç„¶è€Œç„¶åœ°å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéå¸¸æˆåŠŸçš„é¡¹ç›®æ¥è¯´ï¼ŒåŸºé‡‘ä¼šï¼Œæ›´ç¡®åˆ‡åœ°è¯´ï¼Œä¸­ç«‹çš„å•†æ ‡æŒæœ‰åœ°ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘è‚¯å®šä¼šåœ¨é‚£ä¸ªæ—¶å€™è€ƒè™‘åŠ å…¥ä¸€ä¸ªã€‚éšç€é¡¹ç›®çš„æˆç†Ÿï¼ŒEnvoy ä»æˆä¸º CNCF çš„ä¸€éƒ¨åˆ†æ‰€è·å¾—çš„ä»·å€¼ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚CNCF é›‡ä½£äº†å¼€æºè½¯ä»¶å¾‹å¸ˆã€è¥é”€äººå‘˜ã€å…¬å…±å…³ç³»äººå‘˜ã€ä¸€æµçš„æ´»åŠ¨äººå‘˜ç­‰ç­‰ã€‚è¿™äº›é¢å¤–çš„èµ„æºåœ¨ â€œç»è¥ä¸šåŠ¡ &amp;quot; æ–¹é¢æ˜¯éå¸¸å®è´µçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æå‰è€ƒè™‘æ²»ç†é—®é¢˜&#34;&gt;æå‰è€ƒè™‘æ²»ç†é—®é¢˜&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-matt-klein-å‘è¡¨çš„æ¨ç‰¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Matt Klein å‘è¡¨çš„æ¨ç‰¹&#34; srcset=&#34;
               /translation/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu4d88e40b73c416c2f95bedcdcee50bad_54509_b15353fb9aab64b88fb9cdd25b030a34.webp 400w,
               /translation/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu4d88e40b73c416c2f95bedcdcee50bad_54509_61a404a79d75a2f19958db49222ebc41.webp 760w,
               /translation/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu4d88e40b73c416c2f95bedcdcee50bad_54509_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;
               src=&#34;https://lib.jimmysong.io/translation/envoy-oss-5-year/008i3skNly1guh3vqvywcj60tw0h8go702_hu4d88e40b73c416c2f95bedcdcee50bad_54509_b15353fb9aab64b88fb9cdd25b030a34.webp&#34;
               width=&#34;760&#34;
               height=&#34;438&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Matt Klein å‘è¡¨çš„æ¨ç‰¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¼€æºæ²»ç†æ˜¯&lt;strong&gt;éå¸¸&lt;/strong&gt;å›°éš¾çš„ã€‚å°±å…¶æœ¬è´¨è€Œè¨€ï¼Œå¼€æ”¾æºä»£ç æ˜¯æ— æ”¿åºœçš„ï¼Œæ²¡æœ‰æ˜ç¡®çš„é¢†å¯¼ç»“æ„ã€‚æ²¡æœ‰ä¸€ä¸ªé€‚åˆæ‰€æœ‰é¡¹ç›®çš„æ²»ç†æ–¹æ³•ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¿…é¡»æ‰¾åˆ°è‡ªå·±çš„å‰è¿›æ–¹å‘ï¼Œå¯ä»¥é€šè¿‡ â€œBDFLâ€/CEO ç±»å‹çš„æ¨¡å¼ã€æŒ‡å¯¼å§”å‘˜ä¼šã€ç±»ä¼¼ Apache PMC çš„ç¨‹åºç­‰ã€‚æ‰€æœ‰çš„æ²»ç†æ¨¡å¼éƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”æœ‰ä¸åŒçš„å¤±è´¥æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨é¡¹ç›®å˜å¾—åºå¤§å’ŒæˆåŠŸä¹‹å‰ï¼Œå…ˆè®¤çœŸæ€è€ƒæ²»ç†é—®é¢˜ã€‚å†™ä¸‹ä¸€å¥—è§„åˆ™å’Œè§„èŒƒï¼Œç‰¹åˆ«æ˜¯èŠ±æ—¶é—´è®°å½•é¡¹ç›®çš„å†²çªè§£å†³è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ä¹Ÿè¦æ„è¯†åˆ°ï¼Œæ ¹æ®æˆ‘åœ¨ä¸Šé¢å…³äºç¤¾åŒºè§„èŒƒå¦‚ä½•åœ¨æ—©æœŸè®¾å®šçš„è¯„è®ºï¼Œæ—©æœŸçš„é¡¹ç›®ç»´æŠ¤è€…å°†å¯¹æ•´ä¸ªå¯¹è¯å’Œå†²çªè§£å†³çš„é£æ ¼äº§ç”Ÿå·¨å¤§çš„å½±å“ï¼Œå°±åƒå…¬å¸çš„æ—©æœŸå‘˜å·¥å¯¹å…¬å¸çš„æ–‡åŒ–äº§ç”Ÿå·¨å¤§çš„å½±å“ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çš„å°è±¡ä¸­ï¼Œæˆ‘ä»¬åœ¨ Envoy å†…éƒ¨éå¸¸å¹¸è¿ï¼Œæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•é‡å¤§åˆ†æ­§ï¼Œå‡ºç°çš„é—®é¢˜ä¹Ÿå¯ä»¥è¿…é€Ÿå‹å¥½åœ°è§£å†³ã€‚åœ¨é¡¹ç›®çš„å†å²ä¸Šï¼Œæˆ‘ä»¬ä»æ¥æ²¡æœ‰éœ€è¦æ´å¼•&lt;a href=&#34;https://github.com/envoyproxy/envoy/blob/main/GOVERNANCE.md#conflict-resolution-and-voting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç»´æŠ¤è€…æŠ•ç¥¨ç¨‹åºæ¥è§£å†³å†²çª&lt;/a&gt;ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆå°±ï¼Œä¹Ÿæ˜¯å¯¹æ‰€æœ‰ç»´æŠ¤è€…çš„ç´ è´¨å’Œä¸“ä¸šæ€§çš„è¯æ˜ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°è¯¥é¡¹ç›®å·²ç»å˜å¾—å¦‚æ­¤å—æ¬¢è¿ï¼Œä»¥åŠå›´ç»•å®ƒçš„æ‰€æœ‰å•†ä¸šåˆ©ç›Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯¹å¼€æºè´¡çŒ®çš„æœŸæœ›æ˜¯è‡³å…³é‡è¦çš„&#34;&gt;å¯¹å¼€æºè´¡çŒ®çš„æœŸæœ›æ˜¯è‡³å…³é‡è¦çš„&lt;/h3&gt;
&lt;p&gt;æˆ‘åœ¨ä¸Šé¢æåˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘è‡ªå·±çš„èŒä¸šå€¦æ€ å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºæˆ‘æ²¡æœ‰å¾ˆå¥½åœ°ä¸æˆ‘çš„é›‡ä¸»å°±æˆ‘éœ€è¦èŠ±å¤šå°‘æ—¶é—´æ¥ç®¡ç† Envoy çš„å¼€æºå¢é•¿è®¾å®šåˆç†çš„æœŸæœ›ã€‚æˆ‘ä¸ä¼šæ’’è°è¯´ï¼Œè¿›è¡Œè¿™æ ·çš„å¯¹è¯å°±èƒ½ç¥å¥‡åœ°ä½¿é›‡ä¸»ä¸ºæŸäººè…¾å‡ºå¤§é‡æ—¶é—´æ¥ä»äº‹å¼€æºå·¥ä½œï¼Œç‰¹åˆ«æ˜¯é‚£äº›å¯èƒ½ä¸ç›´æ¥é€‚ç”¨äºå…¶æ—¥å¸¸å·¥ä½œçš„é¡¹ç›®ã€‚è¯è™½å¦‚æ­¤ï¼Œæˆ‘ç¡®ä¿¡å¯¹æ‰€æœ‰å‚ä¸çš„äººæ¥è¯´ï¼Œå¯¹å¼€æºè¿‡ç¨‹æœ‰å…¬å¼€å’Œè¯šå®çš„æœŸæœ›æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯åœ¨å¼€æºé¡¹ç›®ä¹‹å‰æˆ–å¼€å§‹ä»¥å¼€æºèº«ä»½å·¥ä½œä¹‹å‰è¦é—®çš„åˆç†é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›‡å‘˜åº”è¯¥é—®ä»–ä»¬çš„é›‡ä¸»ï¼Œä¸ºä»€ä¹ˆä»–ä»¬è¦å¼€æ”¾æºä»£ç ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é›‡ä¸»åº”è¯¥é—®ä»–ä»¬çš„å‘˜å·¥ï¼Œä¸ºä»€ä¹ˆä»–ä»¬è¦å¼€æ”¾æºä»£ç ï¼Ÿ(è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå’Œå‰ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¸åŒæ˜¯å®Œå…¨åˆç†çš„ï¼Œä½†åº”è¯¥åœ¨å…¬å¼€åœºåˆè®¨è®º)ã€‚&lt;/li&gt;
&lt;li&gt;é›‡å‘˜åº”è¯¥é—®ä»–ä»¬çš„é›‡ä¸»ï¼Œå¦‚æœé¡¹ç›®æˆåŠŸäº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¯¥é¡¹ç›®å°†æœ‰å“ªäº›èµ„æºå¯ç”¨ï¼Ÿå‘˜å·¥å°†æœ‰å¤šå°‘æ—¶é—´å¯ä»¥åœ¨é€šç”¨çš„å¼€æºè½¯ä»¶é—®é¢˜ä¸Šå·¥ä½œï¼Œç›®çš„æ˜¯ç›´æ¥æ¨åŠ¨é¡¹ç›®çš„å‘å±•ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é›‡ä¸»å’Œé›‡å‘˜ä¹‹é—´ä¸åŒ¹é…çš„æœŸæœ›æ˜¯æœªæ¥æ€¨æ¨å’Œå€¦æ€ çš„æ ¹æœ¬åŸå› ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç†å®¹æ˜“api-éš¾&#34;&gt;ä»£ç†å®¹æ˜“ï¼ŒAPI éš¾&lt;/h3&gt;
&lt;p&gt;å¯¹ä¸€äº›äººæ¥è¯´ï¼ŒEnvoy æä¾›çš„åº•å±‚ç½‘ç»œä»£ç†æœºåˆ¶ä¼¼ä¹æ˜¯è¿™ä¸ªé¡¹ç›®çš„å¤æ‚éƒ¨åˆ†ã€‚äº‹å®è¯æ˜ï¼Œä¸ä¸º Envoy å‘å±•ä¸€ä¸ªç¨³å®šçš„ API ç”Ÿæ€ç³»ç»Ÿæ‰€åšçš„å·¥ä½œç›¸æ¯”ï¼Œä»£ç†éƒ¨åˆ†ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰ç›¸å¯¹ç®€å•ã€‚å¹³è¡¡äººç±»å’Œè®¡ç®—æœºæ¶ˆè´¹çš„ API äººä½“å·¥ç¨‹å­¦ï¼Œä¿æŒä¸åŒç‰ˆæœ¬çš„ç¨³å®šæ€§ï¼Œå‘å±• API ä»¥æ”¯æŒå…¶ä»–å®¢æˆ·ç«¯ï¼Œå¦‚ gRPCï¼ŒæŒ‡å®šåè®®è¯­ä¹‰ä»¥ä½¿ Envoy èƒ½å¤Ÿä¸æ•°ç™¾ï¼ˆå¯èƒ½æ˜¯æ•°åƒï¼‰ä¸ªä¸åŒçš„ç®¡ç†æœåŠ¡å™¨å¯¹è¯ï¼Œç­‰ç­‰ï¼Œéƒ½æ˜¯éå¸¸å¤æ‚çš„ã€‚æˆ‘ä¸ºå›¢é˜Ÿåœ¨è¿™ä¸€é¢†åŸŸå–å¾—çš„æˆå°±æ„Ÿåˆ°éª„å‚²ï¼ˆç‰¹åˆ«è¦æ„Ÿè°¢æ¨åŠ¨è¿™ä¸€å·¥ä½œçš„ Harveyï¼‰ï¼Œå³ä½¿åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›é”™è¯¯ï¼ˆæ¯”å¦‚ä» API çš„ V2 ç‰ˆæœ¬å¼ºåˆ¶è¿ç§»åˆ° V3 ç‰ˆæœ¬ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè½¯ä»¶æä¾›äº†ä¸€ä¸ª APIï¼Œè€Œä¸”æ›´é‡è¦çš„æ˜¯å¸Œæœ›è¿™ä¸ª API æˆä¸ºå…¶ä»–ç³»ç»Ÿçš„å…³é”®ç»„ä»¶ï¼Œé‚£ä¹ˆä¸è¦ä½ä¼°æä¾›ä¸€ä¸ªç¨³å®šå’Œç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ API çš„æˆæœ¬å’Œå¤æ‚æ€§ã€‚åè¿‡æ¥è¯´ï¼Œ&lt;strong&gt;å¼ºå¤§çš„ API æ˜¯ä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿé£è½®çš„é‡è¦ç»„æˆéƒ¨åˆ†&lt;/strong&gt;ï¼Œä¼šä»¥æ­¤äº§ç”Ÿæ›´å¤šçš„äº§å“å’Œç”¨æˆ·ï¼Œæ‰€ä»¥åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™äº›åŠªåŠ›æ˜¯éå¸¸å€¼å¾—çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸è¦å¿½è§†èŒä¸šå€¦æ€ &#34;&gt;ä¸è¦å¿½è§†èŒä¸šå€¦æ€ &lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœä¸€ä¸ªäººæƒ³æˆå°±å¤§äº‹ä¸šï¼Œæˆ‘ä¸ç›¸ä¿¡ä»–å¯ä»¥ 100% å®ç°è‰¯å¥½çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡&lt;/strong&gt;ã€‚ç°å®æƒ…å†µæ˜¯ï¼Œä»»ä½•æˆåŠŸéƒ½æ˜¯ç”±ç°æœ‰çš„ç‰¹æƒ / æœºä¼šã€ä¸€ä¸ªå¥½çš„æƒ³æ³•ã€è‰¯å¥½çš„æ‰§è¡ŒåŠ›å’Œå¤§é‡çš„è¿æ°”ï¼ˆåŒ…æ‹¬åœ¨æ­£ç¡®çš„æ—¶é—´å‡ºç°åœ¨æ­£ç¡®çš„åœ°ç‚¹ï¼‰ç»„æˆçš„ã€‚æ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½åœ¨ Envoy ä¸­å‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä¸ä¼šå‡è£…æˆ‘æ²¡æœ‰æŠŠè‡ªå·±æå¾—å¾ˆç´¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ 2017 å¹´ã€‚æˆ‘ä¹Ÿä¼šé‡æ–°åšä¸€é 2017 å¹´çš„å·¥ä½œï¼Œå› ä¸ºä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘åšäº†æˆ‘å¿…é¡»åšçš„äº‹æƒ…ï¼Œä½¿é¡¹ç›®è·å¾—æˆåŠŸã€‚(æœ‰æ—¶æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘å·²ç»æœ‰äº†å­©å­ï¼ŒEnovy æ˜¯å¦è¿˜ä¼šè¯ç”Ÿã€‚æˆ‘ä¸ç¡®å®šå®ƒæ˜¯å¦ä¼šå‘ç”Ÿï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæ›´é•¿çš„è°ˆè¯ä¸»é¢˜ï¼)&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘åœ¨ 2017 å¹´æè¿°çš„é‚£ç§å²è¯—èˆ¬çš„æ¨åŠ¨åŠ›åªèƒ½æŒç»­è¿™ä¹ˆä¹…ï¼Œç›´åˆ°ä¸€ä¸ªäººå´©æºƒã€‚æˆ‘é¼“åŠ±å¤§å®¶ä¸æ–­åæ€è‡ªå·±çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œå¹¶ä¸ºè‡ªå·±æ‰¾å‡ºä¸€æ¡å¯æŒç»­å‘å±•çš„é“è·¯ã€‚æ¯ä¸ªäººçš„æƒ…å†µéƒ½ä¸åŒï¼Œæˆ‘ä¸èƒ½æä¾›ä»»ä½•ä¸€ä¸ªé¿å…èŒä¸šå€¦æ€ çš„å»ºè®®ï¼Œä½†æˆ‘è®¤ä¸ºåæ€æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªå·±ä¸å¾—ä¸åŠªåŠ›çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ„Ÿè°¢&#34;&gt;æ„Ÿè°¢&lt;/h2&gt;
&lt;p&gt;åœ¨è¿‡å» 6 å¹´åŠçš„æ—¶é—´é‡Œï¼Œåœ¨ Envoy ä¸Šå·¥ä½œï¼Œå…¶ä¸­ 5 å¹´æ˜¯ä½œä¸ºå¼€æºè½¯ä»¶ï¼Œè¿™æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­çš„äº®ç‚¹ã€‚è¿™ä¸ªé¡¹ç›®çš„æˆåŠŸç¡®å®æ˜¯ä¸€ä¸ªå›¢é˜Ÿçš„åŠªåŠ›ï¼Œæˆ‘ä¸€ä¸ªäººæ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œæˆ‘ä¸ºæˆ‘ä»¬æ‰€æœ‰äººï¼ˆç»´æŠ¤è€…ã€è´¡çŒ®è€…å’Œç”¨æˆ·ï¼‰å…±åŒå®Œæˆçš„äº‹æƒ…æ„Ÿåˆ°éå¸¸è‡ªè±ªã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸Šå·¥ä½œçš„ç»´æŠ¤è€…å’Œè´¡çŒ®è€…æ˜¯æˆ‘æ‰€å…±äº‹è¿‡çš„æœ€å¥½çš„å·¥ç¨‹å¸ˆç¾¤ä½“ï¼Œä»–ä»¬æ‰åæ¨ªæº¢ï¼Œä»–ä»¬å°±èŒåœ¨ä¸åŒå…¬å¸ï¼Œä½äºä¸åŒçš„åœ°ç†ä½ç½®ï¼Œè¿™çœŸæ˜¯å¼€æºçš„ç†è®ºæ½œåŠ›åœ¨å®è·µä¸­çš„ä½“ç°ã€‚ä½œä¸ºä¸€ä¸ªå›¢é˜Ÿï¼Œæˆ‘ä»¬å·²ç»äº§ç”Ÿäº†ä¸–ç•Œæ€§çš„å½±å“ï¼Œæ”¹å˜äº†ç”¨æˆ·å¯¹è½¯ä»¶è´Ÿè½½å‡è¡¡ç³»ç»Ÿçš„æœŸæœ›ï¼ŒåŒæ—¶ä¹Ÿå»ºç«‹äº†ä¸€ä¸ªå……æ»¡æ´»åŠ›å’Œçƒ­æƒ…çš„ç¤¾åŒºã€‚åœ¨æˆ‘æœ€ç–¯ç‹‚çš„æ¢¦æƒ³ä¸­ï¼Œæˆ‘ä»æœªæƒ³è¿‡è¿™ä¸ªé¡¹ç›®ä¼šæˆä¸ºä»Šå¤©çš„æ ·å­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æˆ‘æ¥è¯´ï¼Œæœªæ¥ä¼šå‘ç”Ÿä»€ä¹ˆå°±ä¸é‚£ä¹ˆæ¸…æ¥šäº†ã€‚æ­£å¦‚æˆ‘ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘çš„é‡ç‚¹å·²ç»è½¬ç§»åˆ°äº†å¯æŒç»­æ€§ä¸Šã€‚æˆ‘æƒ³ç¡®ä¿ï¼Œå¦‚æœæœ‰ä¸€å¤©æˆ‘ç¦»å¼€äº†ï¼Œè¿™ä¸ªé¡¹ç›®å°†ä¿æŒå¥åº·ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸€å¤©è¿˜æ²¡æœ‰åˆ°æ¥ï¼Œæˆ‘æœŸå¾…ç€åœ¨å¯é¢„è§çš„æœªæ¥å¸®åŠ©é¢†å¯¼é¡¹ç›®å‰è¿›ï¼Œå¸Œæœ›èƒ½å–å¾—æ›´å¤§çš„æˆåŠŸå’Œé‡‡ç”¨ã€‚å‘å‰è¿ˆè¿›ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Istio å®‰å…¨æœ€ä½³å®è·µ</title>
      <link>https://lib.jimmysong.io/translation/istio-security-best-practices/</link>
      <pubDate>Mon, 02 Aug 2021 13:05:42 +0800</pubDate>
      <guid>https://lib.jimmysong.io/translation/istio-security-best-practices/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª Istio å®˜æ–¹åšå®¢ &lt;a href=&#34;https://istio.io/latest/docs/ops/best-practices/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Security Best Practices&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Istio çš„å®‰å…¨åŠŸèƒ½æä¾›äº†å¼ºå¤§çš„èº«ä»½ã€ç­–ç•¥ã€é€æ˜çš„ TLS åŠ å¯†ä»¥åŠè®¤è¯ã€æˆæƒå’Œå®¡è®¡ï¼ˆAAAï¼‰å·¥å…·æ¥ä¿æŠ¤ä½ çš„æœåŠ¡å’Œæ•°æ®ã€‚ç„¶è€Œï¼Œä¸ºäº†å……åˆ†å®‰å…¨åœ°åˆ©ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¿…é¡»æ³¨æ„éµå¾ªæœ€ä½³å®è·µã€‚å»ºè®®åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æ¦‚è¿°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŒå‘-tls&#34;&gt;åŒå‘ TLS&lt;/h2&gt;
&lt;p&gt;Istio å°†å°½å¯èƒ½ä½¿ç”¨&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#mutual-tls-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŒå‘ TLS&lt;/a&gt; å¯¹æµé‡è¿›è¡Œ&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/tls-configuration/#auto-mtls&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨&lt;/a&gt;åŠ å¯†ã€‚ç„¶è€Œï¼Œä»£ç†åœ¨é»˜è®¤æƒ…å†µä¸‹è¢«é…ç½®ä¸º&lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#permissive-mode&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¯æ¨¡å¼ï¼ˆPermissive Modeï¼‰&lt;/a&gt;ï¼Œè¿™æ„å‘³ç€ä»–ä»¬å°†æ¥å—åŒå‘ TLS å’Œæ˜æ–‡æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™æ˜¯ä¸ºäº†å¢é‡é‡‡ç”¨æˆ–å…è®¸æ¥è‡ªæ²¡æœ‰ Istio sidecar çš„å®¢æˆ·ç«¯çš„æµé‡çš„éœ€è¦ï¼Œä½†å®ƒä¹Ÿå‰Šå¼±äº†å®‰å…¨ç«‹åœºã€‚å»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹&lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authentication/mtls-migration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿ç§»åˆ°ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict Modeï¼‰&lt;/a&gt;ï¼Œä»¥å¼ºåˆ¶ä½¿ç”¨åŒå‘ TLSã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œä»…é åŒå‘ TLS å¹¶ä¸è¶³ä»¥ä¿è¯æµé‡çš„å®‰å…¨ï¼Œå› ä¸ºå®ƒåªæä¾›è®¤è¯ï¼Œè€Œä¸æ˜¯æˆæƒã€‚è¿™æ„å‘³ç€ï¼Œä»»ä½•æ‹¥æœ‰æœ‰æ•ˆè¯ä¹¦çš„äººä»ç„¶å¯ä»¥è®¿é—®ä¸€ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œå…¨é”å®šæµé‡ï¼Œå»ºè®®é…ç½®&lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authorization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒç­–ç•¥&lt;/a&gt;ã€‚è¿™å…è®¸åˆ›å»ºç»†ç²’åº¦çš„ç­–ç•¥æ¥å…è®¸æˆ–æ‹’ç»æµé‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åªå…è®¸æ¥è‡ª &lt;code&gt;app&lt;/code&gt; å‘½åç©ºé—´çš„è¯·æ±‚è®¿é—® &lt;code&gt;hello-world&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆæƒç­–ç•¥&#34;&gt;æˆæƒç­–ç•¥&lt;/h2&gt;
&lt;p&gt;Istio &lt;a href=&#34;https://istio.io/latest/docs/concepts/security/#authorization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæƒ&lt;/a&gt;åœ¨ Istio å®‰å…¨ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚å®ƒéœ€è¦åŠªåŠ›é…ç½®æ­£ç¡®çš„æˆæƒç­–ç•¥ï¼Œä»¥æœ€å¥½åœ°ä¿æŠ¤ä½ çš„é›†ç¾¤ã€‚äº†è§£è¿™äº›é…ç½®çš„å½±å“æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸º Istio æ— æ³•ç¡®å®šæ‰€æœ‰ç”¨æˆ·çš„æ­£ç¡®æˆæƒã€‚è¯·å…¨ç¨‹å…³æ³¨æœ¬èŠ‚å†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨é»˜è®¤æ‹’ç»çš„æˆæƒç­–ç•¥&#34;&gt;åº”ç”¨é»˜è®¤æ‹’ç»çš„æˆæƒç­–ç•¥&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®ä½ æŒ‰ç…§ default-deny æ¨¡å¼å®šä¹‰ä½ çš„ Istio æˆæƒç­–ç•¥ï¼Œä»¥å¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€åŠ¿ã€‚é»˜è®¤æ‹’ç»æˆæƒæ¨¡å¼æ„å‘³ç€ä½ çš„ç³»ç»Ÿé»˜è®¤æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œè€Œä½ å®šä¹‰äº†å…è®¸è¯·æ±‚çš„æ¡ä»¶ã€‚å¦‚æœä½ é”™è¿‡äº†ä¸€äº›æ¡ä»¶ï¼Œæµé‡å°†è¢«æ„å¤–åœ°æ‹’ç»ï¼Œè€Œä¸æ˜¯æµé‡è¢«æ„å¤–åœ°å…è®¸ã€‚åè€…é€šå¸¸æ˜¯ä¸€ä¸ªå®‰å…¨äº‹ä»¶ï¼Œè€Œå‰è€…å¯èƒ½ä¼šå¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€æœåŠ¡ä¸­æ–­æˆ–ä¸ç¬¦åˆä½ çš„ SLO/SLAã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨ &lt;a href=&#34;https://istio.io/latest/docs/tasks/security/authorization/authz-http/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP æµé‡çš„æˆæƒä»»&lt;/a&gt;åŠ¡ä¸­ï¼Œåä¸º &lt;code&gt;allow-nothing&lt;/code&gt; çš„æˆæƒç­–ç•¥ç¡®ä¿æ‰€æœ‰æµé‡åœ¨é»˜è®¤æƒ…å†µä¸‹è¢«æ‹’ç»ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œå…¶ä»–æˆæƒç­–ç•¥æ ¹æ®ç‰¹å®šæ¡ä»¶å…è®¸æµé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨è·¯å¾„è§„èŒƒåŒ–ä¸Šå®šåˆ¶ä½ çš„ç³»ç»Ÿ&#34;&gt;åœ¨è·¯å¾„è§„èŒƒåŒ–ä¸Šå®šåˆ¶ä½ çš„ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;Istio æˆæƒç­–ç•¥å¯ä»¥åŸºäº HTTP è¯·æ±‚ä¸­çš„ URL è·¯å¾„ã€‚&lt;a href=&#34;https://en.wikipedia.org/wiki/URI_normalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯å¾„è§„èŒƒåŒ–ï¼ˆåˆç§° URI è§„èŒƒåŒ–ï¼‰&lt;/a&gt;å¯¹ä¼ å…¥è¯·æ±‚çš„è·¯å¾„è¿›è¡Œä¿®æ”¹å’Œæ ‡å‡†åŒ–ï¼Œä»è€Œä½¿è§„èŒƒåŒ–åçš„è·¯å¾„èƒ½å¤Ÿä»¥æ ‡å‡†æ–¹å¼è¿›è¡Œå¤„ç†ã€‚è¯­æ³•ä¸Šä¸åŒçš„è·¯å¾„åœ¨è·¯å¾„è§„èŒƒåŒ–åå¯èƒ½æ˜¯ç­‰åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;Istio æ”¯æŒä»¥ä¸‹è¯·æ±‚è·¯å¾„çš„è§„èŒƒåŒ–æ–¹æ¡ˆï¼Œç„¶åå†æ ¹æ®æˆæƒç­–ç•¥è¿›è¡Œè¯„ä¼°å’Œè·¯ç”±è¯·æ±‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é€‰é¡¹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NONE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸åšä»»ä½•è§„èŒƒåŒ–å¤„ç†ã€‚Envoy æ”¶åˆ°çš„ä»»ä½•ä¿¡æ¯éƒ½ä¼šè¢«åŸå°ä¸åŠ¨åœ°è½¬å‘ç»™ä»»ä½•åç«¯æœåŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;../%2Fa../b&lt;/code&gt; ç”±æˆæƒæ”¿ç­–è¯„ä¼°å¹¶å‘é€ç»™ä½ çš„æœåŠ¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯ç›®å‰ Istio é»˜è®¤å®‰è£…ä¸­ä½¿ç”¨çš„é€‰é¡¹ã€‚è¿™åœ¨ Envoy ä»£ç†ä¸Šåº”ç”¨äº† &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;normalize_path&lt;/code&gt;&lt;/a&gt;é€‰é¡¹ï¼Œè¯¥é€‰é¡¹éµå¾ª &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt;ï¼Œæœ‰é¢å¤–çš„è§„èŒƒåŒ–å¤„ç†ï¼Œå°†åæ–œçº¿è½¬æ¢æˆæ­£æ–œçº¿ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/a/../b&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/b&lt;/code&gt;ã€‚&lt;code&gt;\da&lt;/code&gt; è¢«è§„èŒƒåŒ–å¾® &lt;code&gt;/da&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ–œçº¿åœ¨ &lt;em&gt;BASE&lt;/em&gt; è§„èŒƒåŒ–ä¹‹åè¢«åˆå¹¶ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/a//b&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/a/b&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æœ€ä¸¥æ ¼çš„è®¾ç½®ï¼Œå½“ä½ é»˜è®¤å…è®¸æ‰€æœ‰æµé‡ã€‚è¿™ä¸ªè®¾ç½®æ˜¯æ¨èçš„ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä½ éœ€è¦å½»åº•æµ‹è¯•ä½ çš„æˆæƒç­–ç•¥è·¯å¾„ã€‚ç™¾åˆ†æ¯”ç¼–ç çš„æ–œçº¿å’Œåæ–œçº¿å­—ç¬¦ï¼ˆ&lt;code&gt;%2F&lt;/code&gt;ã€&lt;code&gt;%2f&lt;/code&gt;ã€&lt;code&gt;%5C&lt;/code&gt; å’Œ &lt;code&gt;%5c&lt;/code&gt;ï¼‰åœ¨ MERGE_SLASHES è¢«è§„èŒƒåŒ–ä¹‹å‰è¢«è§£ç ä¸º &lt;code&gt;/&lt;/code&gt; æˆ– &lt;code&gt;\&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/a%2fb&lt;/code&gt; è¢«è§„èŒƒåŒ–ä¸º &lt;code&gt;/a/b&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¯¥é…ç½®æ˜¯é€šè¿‡ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ä¸­çš„ &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ProxyPathNormalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;pathNormalization&lt;/code&gt;&lt;/a&gt;å­—æ®µæŒ‡å®šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¼ºè°ƒè¿™ä¸€ç‚¹ï¼Œè§„èŒƒåŒ–ç®—æ³•æ˜¯æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œçš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç™¾åˆ†æ¯”è§£ç  &lt;code&gt;%2F&lt;/code&gt;ã€&lt;code&gt;%2f&lt;/code&gt;ã€&lt;code&gt;%5C&lt;/code&gt; å’Œ &lt;code&gt;%5c&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; å’Œå…¶ä»–ç”± Envoy çš„ &lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;normalize_path&lt;/code&gt;&lt;/a&gt;é€‰é¡¹å®ç°çš„è§„èŒƒåŒ–ã€‚&lt;/li&gt;
&lt;li&gt;åˆå¹¶æ–œçº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶è¿™äº›è§„èŒƒåŒ–é€‰é¡¹ä»£è¡¨äº†æ¥è‡ª HTTP æ ‡å‡†å’Œå¸¸è§è¡Œä¸šæƒ¯ä¾‹çš„å»ºè®®ï¼Œä½†åº”ç”¨ç¨‹åºå¯ä»¥ä»¥å®ƒé€‰æ‹©çš„ä»»ä½•æ–¹å¼è§£é‡Šä¸€ä¸ª URLã€‚å½“ä½¿ç”¨æ‹’ç»ç­–ç•¥æ—¶ï¼Œè¯·ç¡®ä¿ä½ äº†è§£ä½ çš„åº”ç”¨ç¨‹åºçš„è¡Œä¸ºæ–¹å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;é…ç½®çš„ä¾‹å­&#34;&gt;é…ç½®çš„ä¾‹å­&lt;/h3&gt;
&lt;p&gt;ç¡®ä¿ Envoy è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ä»¥ç¬¦åˆä½ çš„åç«¯æœåŠ¡çš„æœŸæœ›ï¼Œå¯¹ä½ çš„ç³»ç»Ÿå®‰å…¨è‡³å…³é‡è¦ã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥ä½œä¸ºä½ é…ç½®ç³»ç»Ÿçš„å‚è€ƒã€‚è§„èŒƒåŒ–çš„ URL è·¯å¾„ï¼Œå¦‚æœé€‰æ‹©äº† &lt;code&gt;NONE&lt;/code&gt;ï¼Œåˆ™æ˜¯åŸå§‹çš„ URL è·¯å¾„å°†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æ¥å¯¹ç…§æˆæƒç­–ç•¥è¿›è¡Œæ£€æŸ¥&lt;/li&gt;
&lt;li&gt;è½¬å‘åˆ°åç«¯åº”ç”¨ç¨‹åº&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä½ çš„åº”ç”¨ç¨‹åº&lt;/th&gt;
&lt;th&gt;é€‰æ‹©&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¾é ä»£ç†è¿›è¡Œè§„èŒƒåŒ–å¤„ç†&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;, &lt;code&gt;MERGE_SLASHES&lt;/code&gt; or &lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œä¸åˆå¹¶æ–œçº¿&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BASE&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œåˆå¹¶æ–œçº¿ï¼Œä½†ä¸å¯¹&lt;a href=&#34;https://tools.ietf.org/html/rfc3986#section-2.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç™¾åˆ†æ¯”ç¼–ç &lt;/a&gt;çš„æ–œçº¿è¿›è¡Œè§£ç &lt;/td&gt;
&lt;td&gt;&lt;code&gt;MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ¹æ® &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; è§„èŒƒåŒ–è¯·æ±‚è·¯å¾„ï¼Œåˆå¹¶æ–œçº¿ï¼Œå¹¶å¯¹&lt;a href=&#34;https://tools.ietf.org/html/rfc3986#section-2.1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç™¾åˆ†æ¯”ç¼–ç &lt;/a&gt;çš„æ–œçº¿è¿›è¡Œè§£ç &lt;/td&gt;
&lt;td&gt;&lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤„ç†è¯·æ±‚è·¯å¾„çš„æ–¹å¼ä¸ &lt;a href=&#34;https://tools.ietf.org/html/rfc3986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 3986&lt;/a&gt; ä¸å…¼å®¹&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NONE&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;å¦‚ä½•é…ç½®&#34;&gt;å¦‚ä½•é…ç½®&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; æ¥æ›´æ–° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ istioctl upgrade --set meshConfig.pathNormalization.normalization=DECODE_AND_MERGE_SLASHES
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–é€šè¿‡æ”¹å˜ä½ çš„ Operator é‡å†™æ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ cat &amp;lt;&amp;lt;EOF &amp;gt; iop.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;install.istio.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IstioOperator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meshConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pathNormalization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;normalization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DECODE_AND_MERGE_SLASHES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;$ istioctl install -f iop.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä½ æƒ³ç›´æ¥ç¼–è¾‘ Mesh é…ç½®ï¼Œä½ å¯ä»¥å°† &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ProxyPathNormalization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;pathNormalization&lt;/code&gt;&lt;/a&gt;æ·»åŠ åˆ° &lt;a href=&#34;https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mesh é…ç½®&lt;/a&gt;ä¸­ï¼Œè¯¥é…ç½®æ˜¯ &lt;code&gt;istio-&amp;lt;REVISION_ID&amp;gt;&lt;/code&gt; çš„ CongfigMapï¼Œåœ¨ &lt;code&gt;istio-system&lt;/code&gt; å‘½åç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€‰æ‹© &lt;code&gt;DECODE_AND_MERGE_SLASHES&lt;/code&gt; é€‰é¡¹ï¼Œä½ ä¿®æ”¹ mesh é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mesh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      pathNormalization:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        normalization: DECODE_AND_MERGE_SLASHES
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ...      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¸å¤ªå¸¸è§çš„è§„èŒƒåŒ–é…ç½®&#34;&gt;ä¸å¤ªå¸¸è§çš„è§„èŒƒåŒ–é…ç½®&lt;/h3&gt;
&lt;h4 id=&#34;å¤§å°å†™è§„èŒƒåŒ–&#34;&gt;å¤§å°å†™è§„èŒƒåŒ–&lt;/h4&gt;
&lt;p&gt;åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä»¥ä¸åŒºåˆ†å¤§å°å†™çš„æ–¹å¼æ¯”è¾ƒæˆæƒç­–ç•¥ä¸­çš„è·¯å¾„å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå°† &lt;code&gt;https://myurl/get&lt;/code&gt; å’Œ &lt;code&gt;https://myurl/GeT&lt;/code&gt; ç­‰åŒå¯¹å¾…ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ &lt;code&gt;EnvoyFilter&lt;/code&gt;ã€‚è¿™ä¸ªè¿‡æ»¤å™¨å°†æ”¹å˜ç”¨äºæ¯”è¾ƒçš„è·¯å¾„å’Œå‘ˆç°ç»™åº”ç”¨ç¨‹åºçš„è·¯å¾„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EnvoyFilter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-case-insensitive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;configPatches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;applyTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP_FILTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GATEWAY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filterChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.network.http_connection_manager&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;envoy.filters.http.router&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;INSERT_BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy.lua&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;typed_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;@type&amp;#34;: &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inlineCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              function envoy_on_request(request_handle)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                local path = request_handle:headers():get(&amp;#34;:path&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;                request_handle:headers():replace(&amp;#34;:path&amp;#34;, string.lower(path))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              end              &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;äº†è§£æµé‡é‡‡é›†çš„é™åˆ¶&#34;&gt;äº†è§£æµé‡é‡‡é›†çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;Istio sidecar çš„å·¥ä½œåŸç†æ˜¯æ•è·å…¥ç«™æµé‡å’Œå‡ºç«™æµé‡ï¼Œå¹¶é€šè¿‡ sidecar ä»£ç†å¼•å¯¼å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµé‡éƒ½è¢«æ•è·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å®šå‘åªå¤„ç†åŸºäº TCP çš„æµé‡ã€‚ä»»ä½• UDP æˆ– ICMP æ•°æ®åŒ…éƒ½ä¸ä¼šè¢«æ•è·æˆ–ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar ä½¿ç”¨çš„è®¸å¤šç«¯å£&lt;/a&gt;ä»¥åŠ 22 å·ç«¯å£çš„å…¥ç«™æ•è·è¢«ç¦ç”¨ã€‚è¿™ä¸ªåˆ—è¡¨å¯ä»¥é€šè¿‡ &lt;code&gt;traffic.sidecar.istio.io/excludeInboundPorts&lt;/code&gt; ç­‰é€‰é¡¹æ¥æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;å‡ºç«™æ•è·åŒæ ·å¯ä»¥é€šè¿‡ &lt;code&gt;traffic.sidecar.istio.io/excludeOutboundPorts&lt;/code&gt; ç­‰è®¾ç½®æˆ–å…¶ä»–æ–¹å¼å‡å°‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºå’Œå…¶ sidecar ä»£ç†ä¹‹é—´çš„å®‰å…¨è¾¹ç•Œæœ€å°ã€‚å¯¹ sidecar çš„é…ç½®æ˜¯ä»¥æ¯ä¸ªæ¨¡å—ä¸ºåŸºç¡€çš„ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œ / è¿›ç¨‹å‘½åç©ºé—´ä¸­è¿è¡Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½æœ‰èƒ½åŠ›åˆ é™¤é‡å®šå‘è§„åˆ™ï¼Œå¹¶åˆ é™¤ã€æ”¹å˜ã€ç»ˆæ­¢æˆ–æ›¿æ¢ sidecar ä»£ç†ã€‚è¿™å…è®¸ä¸€ä¸ª pod æ•…æ„ç»•è¿‡å®ƒçš„ sidecar çš„å‡ºç«™æµé‡æˆ–æ•…æ„è®©å…¥ç«™æµé‡ç»•è¿‡å®ƒçš„ sidecarã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œä¾é  Istio æ— æ¡ä»¶åœ°æ•è·æ‰€æœ‰æµé‡æ˜¯ä¸å®‰å…¨çš„ã€‚ç›¸åï¼Œå®‰å…¨è¾¹ç•Œæ˜¯å®¢æˆ·ç«¯ä¸èƒ½ç»•è¿‡å¦ä¸€ä¸ª pod çš„ sidecarã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åœ¨ 9080 ç«¯å£è¿è¡Œ &lt;code&gt;review&lt;/code&gt; åº”ç”¨ç¨‹åºï¼Œæˆ‘å¯ä»¥å‡è®¾æ¥è‡ª &lt;code&gt;productpage&lt;/code&gt; åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æµé‡å°†è¢« sidecar ä»£ç†æ•è·ï¼Œå…¶ä¸­ Istio è®¤è¯å’Œæˆæƒç­–ç•¥å¯èƒ½é€‚ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ©ç”¨-networkpolicy-è¿›è¡Œæ·±åº¦é˜²å¾¡&#34;&gt;åˆ©ç”¨ &lt;code&gt;NetworkPolicy&lt;/code&gt; è¿›è¡Œæ·±åº¦é˜²å¾¡&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥ç¡®ä¿æµé‡å®‰å…¨ï¼ŒIstio ç­–ç•¥å¯ä»¥ä¸ Kubernetes &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/network-policies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œç­–ç•¥&lt;/a&gt;åˆ†å±‚ã€‚è¿™å®ç°äº†ä¸€ä¸ªå¼ºå¤§çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Defense_in_depth_%28computing%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±åº¦é˜²å¾¡&lt;/a&gt;ç­–ç•¥ï¼Œå¯ä»¥ç”¨æ¥è¿›ä¸€æ­¥åŠ å¼ºä½ çš„ç½‘æ ¼çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€‰æ‹©åªå…è®¸æµé‡åˆ°æˆ‘ä»¬ &lt;code&gt;review&lt;/code&gt; åº”ç”¨ç¨‹åºçš„ &lt;code&gt;9080&lt;/code&gt; ç«¯å£ã€‚å¦‚æœé›†ç¾¤ä¸­çš„ Pod è¢«ç ´åæˆ–å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œè¿™å¯èƒ½ä¼šé™åˆ¶æˆ–é˜»æ­¢æ”»å‡»è€…çš„è¿›å±•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¡®ä¿å‡ºå£æµé‡çš„å®‰å…¨&#34;&gt;ç¡®ä¿å‡ºå£æµé‡çš„å®‰å…¨&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œåƒ &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-control/#envoy-passthrough-to-external-services&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;outboundTrafficPolicy: REGISTRY_ONLY&lt;/code&gt;&lt;/a&gt; ä½œä¸ºä¸€ä¸ªå®‰å…¨ç­–ç•¥ï¼Œé˜²æ­¢æ‰€æœ‰å¯¹æœªç”³æŠ¥æœåŠ¡çš„è®¿é—®ã€‚ç„¶è€Œï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨è¾¹ç•Œï¼Œåº”è¯¥è¢«è®¤ä¸ºæ˜¯å°½åŠ›è€Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™å¯¹é˜²æ­¢æ„å¤–çš„ä¾èµ–æ€§å¾ˆæœ‰ç”¨ï¼Œä½†å¦‚æœä½ æƒ³ä¿è¯å‡ºå£æµé‡çš„å®‰å…¨ï¼Œå¹¶å¼ºåˆ¶è¦æ±‚æ‰€æœ‰å‡ºç«™æµé‡é€šè¿‡ä»£ç†ï¼Œä½ åº”è¯¥ä¾é  &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Egress Gateway&lt;/a&gt;ã€‚å½“ä¸&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/#apply-kubernetes-network-policies&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œç­–ç•¥&lt;/a&gt;ç›¸ç»“åˆæ—¶ï¼Œä½ å¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„æµé‡ï¼Œæˆ–ä¸€äº›å­é›†ï¼Œé€šè¿‡å‡ºå£ç½‘å…³ã€‚è¿™ç¡®ä¿äº†å³ä½¿å®¢æˆ·æ„å¤–åœ°æˆ–æ¶æ„åœ°ç»•è¿‡ä»–ä»¬çš„ sidecarï¼Œè¯¥è¯·æ±‚ä¹Ÿä¼šè¢«é˜»æ­¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å½“ä½¿ç”¨-tls-å‘èµ·æ—¶åœ¨ç›®çš„åœ°è§„åˆ™ä¸­é…ç½®-tls-éªŒè¯&#34;&gt;å½“ä½¿ç”¨ TLS å‘èµ·æ—¶ï¼Œåœ¨ç›®çš„åœ°è§„åˆ™ä¸­é…ç½® TLS éªŒè¯&lt;/h2&gt;
&lt;p&gt;Istio æä¾›äº†ä»ä¸€ä¸ª sidecar ä»£ç†æˆ–ç½‘å…³&lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/egress/egress-tls-origination/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘èµ· TLS&lt;/a&gt; çš„èƒ½åŠ›ã€‚è¿™ä½¿å¾—å‘é€çº¯æ–‡æœ¬ HTTP æµé‡çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€æ˜åœ° â€œå‡çº§ â€œåˆ° HTTPSã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é…ç½® &lt;code&gt;DestinationRule&lt;/code&gt; çš„ &lt;code&gt;tls&lt;/code&gt; è®¾ç½®æ—¶ï¼Œå¿…é¡»æ³¨æ„æŒ‡å®š &lt;code&gt;caCertificates&lt;/code&gt; å­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼ŒæœåŠ¡å™¨çš„è¯ä¹¦å°†ä¸ä¼šè¢«éªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;google-tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;google.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;caCertificates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/etc/ssl/certs/ca-certificates.crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç½‘å…³&#34;&gt;ç½‘å…³&lt;/h2&gt;
&lt;p&gt;åœ¨è¿è¡Œ Istio &lt;a href=&#34;https://istio.io/latest/docs/tasks/traffic-management/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³&lt;/a&gt;æ—¶ï¼Œæ¶‰åŠä¸€äº›èµ„æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Gateways&lt;/code&gt;ï¼Œå®ƒæ§åˆ¶ç½‘å…³çš„ç«¯å£å’Œ TLS è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VirtualServices&lt;/code&gt;ï¼Œæ§åˆ¶è·¯ç”±é€»è¾‘ã€‚è¿™äº›éƒ½æ˜¯é€šè¿‡åœ¨ç½‘å…³å­—æ®µä¸­çš„ç›´æ¥å¼•ç”¨å’Œåœ¨ç½‘å…³å’Œ &lt;code&gt;VirtualService&lt;/code&gt; çš„ &lt;code&gt;hosts&lt;/code&gt; å­—æ®µä¸­çš„ç›¸äº’çº¦å®šä¸ &lt;code&gt;Gateway&lt;/code&gt; ç›¸å…³è”çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é™åˆ¶-gateway-åˆ›å»ºæƒé™&#34;&gt;é™åˆ¶ &lt;code&gt;Gateway&lt;/code&gt; åˆ›å»ºæƒé™&lt;/h3&gt;
&lt;p&gt;å»ºè®®å°† Gateway èµ„æºçš„åˆ›å»ºé™åˆ¶åœ¨å—ä¿¡ä»»çš„é›†ç¾¤ç®¡ç†å‘˜ã€‚è¿™å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/rbac/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes RBAC ç­–ç•¥&lt;/a&gt;æˆ– &lt;a href=&#34;https://www.openpolicyagent.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Policy Agent&lt;/a&gt; ç­‰å·¥å…·å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¿å…è¿‡äºå®½æ³›çš„-hosts-é…ç½®&#34;&gt;é¿å…è¿‡äºå®½æ³›çš„ &lt;code&gt;hosts&lt;/code&gt; é…ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œé¿å…åœ¨ &lt;code&gt;Gateway&lt;/code&gt; ä¸­è¿›è¡Œè¿‡äºå¹¿æ³›çš„ &lt;code&gt;hosts&lt;/code&gt; è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè¿™ç§é…ç½®å°†å…è®¸ä»»ä½• VirtualService ç»‘å®šåˆ° &lt;code&gt;Gateway&lt;/code&gt;ï¼Œå¯èƒ½ä¼šæš´éœ²å‡ºæ„å¤–çš„åŸŸï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™åº”è¯¥è¢«é”å®šï¼Œåªå…è®¸ç‰¹å®šåŸŸæˆ–ç‰¹å®šå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;foo.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ foo.example.com çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;default/bar.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ default å‘½åç©ºé—´ bar.example.com çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;route-namespace/*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸ route-namespace å‘½åç©ºé—´çš„ VirtualServices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éš”ç¦»æ•æ„ŸæœåŠ¡&#34;&gt;éš”ç¦»æ•æ„ŸæœåŠ¡&lt;/h3&gt;
&lt;p&gt;å¯èƒ½éœ€è¦å¯¹æ•æ„ŸæœåŠ¡å®æ–½æ›´ä¸¥æ ¼çš„ç‰©ç†éš”ç¦»ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³ä¸ºæ•æ„Ÿçš„ &lt;code&gt;payment.example.com&lt;/code&gt; è¿è¡Œä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/setup/install/istioctl/#configure-gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸“ç”¨çš„ç½‘å…³å®ä¾‹&lt;/a&gt;ï¼Œè€Œä¸ºä¸å¤ªæ•æ„Ÿçš„åŸŸåå¦‚ &lt;code&gt;blog.example.com&lt;/code&gt; å’Œ &lt;code&gt;store.example.com&lt;/code&gt; ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„å…±äº«ç½‘å…³å®ä¾‹ã€‚è¿™å¯ä»¥æä¾›ä¸€ä¸ªæ›´å¼ºå¤§çš„æ·±åº¦é˜²å¾¡ï¼Œå¹¶æœ‰åŠ©äºæ»¡è¶³æŸäº›ç›‘ç®¡åˆè§„å‡†åˆ™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨æ”¾å®½çš„-sni-ä¸»æœºåŒ¹é…ä¸‹æ˜ç¡®åœ°ç¦ç”¨æ‰€æœ‰æ•æ„Ÿçš„-http-ä¸»æœº&#34;&gt;åœ¨æ”¾å®½çš„ SNI ä¸»æœºåŒ¹é…ä¸‹ï¼Œæ˜ç¡®åœ°ç¦ç”¨æ‰€æœ‰æ•æ„Ÿçš„ http ä¸»æœº&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸åŒçš„ä¸»æœºä¸Šä½¿ç”¨å¤šä¸ª &lt;code&gt;Gateways&lt;/code&gt; æ¥å®šä¹‰åŒå‘ TLS å’Œç®€å• TLS æ˜¯åˆç†çš„ã€‚ä¾‹å¦‚ï¼Œå¯¹ SNI ä¸»æœº &lt;code&gt;admin.example.com&lt;/code&gt; ä½¿ç”¨åŒå‘ TLSï¼Œå¯¹ SNI ä¸»æœº &lt;code&gt;*.example.com&lt;/code&gt; ä½¿ç”¨ç®€å• TLSã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;guestgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admingateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;admin.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MUTUAL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ‰å¿…è¦è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œå¼ºçƒˆå»ºè®®åœ¨é™„åŠ åˆ° &lt;code&gt;*.example.com&lt;/code&gt; çš„ &lt;code&gt;VirtualService&lt;/code&gt; ä¸­æ˜ç¡®ç¦ç”¨ http ä¸»æœº &lt;code&gt;admin.example.com&lt;/code&gt;ã€‚åŸå› æ˜¯ç›®å‰åº•å±‚çš„ &lt;a href=&#34;https://github.com/envoyproxy/envoy/issues/6767&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;envoy ä»£ç†ä¸éœ€è¦&lt;/a&gt; http 1 å¤´ &lt;code&gt;Host&lt;/code&gt; æˆ– http 2 ä¼ªå¤´&lt;code&gt;:authority&lt;/code&gt; çš„ SNI çº¦æŸåï¼Œæ”»å‡»è€…å¯ä»¥é‡æ–°ä½¿ç”¨ guest-SNI TLS è¿æ¥æ¥è®¿é—® admin &lt;code&gt;VirtualService&lt;/code&gt;ã€‚http å“åº”ä»£ç  421 æ˜¯ä¸ºè¿™ç§ &lt;code&gt;Host&lt;/code&gt; SNI ä¸åŒ¹é…è€Œè®¾è®¡çš„ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç¦ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;disable-sensitive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;admin.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;guestgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;abort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;percentage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dest.default.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åè®®æ£€æµ‹&#34;&gt;åè®®æ£€æµ‹&lt;/h2&gt;
&lt;p&gt;Istio ä¼š&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#automatic-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨ç¡®å®š&lt;/a&gt;å®ƒæ‰€çœ‹åˆ°çš„æµé‡çš„&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#automatic-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åè®®&lt;/a&gt;ã€‚ä¸ºäº†é¿å…æ„å¤–æˆ–æ•…æ„çš„æ¼æ£€ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æµé‡è¡Œä¸ºï¼Œå»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/traffic-management/protocol-selection/#explicit-protocol-selection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ˜ç¡®å£°æ˜åè®®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cni&#34;&gt;CNI&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†é€æ˜åœ°æ•è·æ‰€æœ‰æµé‡ï¼ŒIstio ä¾èµ–äº &lt;code&gt;istio-init&lt;/code&gt; &lt;code&gt;initContainer&lt;/code&gt; æ‰€é…ç½®çš„ &lt;code&gt;iptables&lt;/code&gt; è§„åˆ™ã€‚è¿™å¢åŠ äº†ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¦æ±‚&lt;/a&gt;ï¼Œå³ &lt;code&gt;NET_ADMIN&lt;/code&gt; å’Œ &lt;code&gt;NET_RAW&lt;/code&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çš„èƒ½åŠ›&lt;/a&gt;å¿…é¡»å¯¹ pod å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘æˆäºˆ pod çš„æƒé™ï¼ŒIstio æä¾›äº†ä¸€ä¸ª &lt;a href=&#34;https://istio.io/latest/docs/setup/additional-setup/cni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CNI æ’ä»¶&lt;/a&gt;ï¼Œå®ƒæ¶ˆé™¤äº†è¿™ä¸ªè¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Istio CNI æ’ä»¶ç›®å‰æ˜¯ä¸€ä¸ª alpha åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åŠ å›ºçš„-docker-é•œåƒ&#34;&gt;ä½¿ç”¨åŠ å›ºçš„ docker é•œåƒ&lt;/h2&gt;
&lt;p&gt;Istio çš„é»˜è®¤ docker é•œåƒï¼ŒåŒ…æ‹¬é‚£äº›ç”±æ§åˆ¶å¹³é¢ã€ç½‘å…³å’Œ sidecar ä»£ç†è¿è¡Œçš„é•œåƒï¼Œéƒ½æ˜¯åŸºäº ubuntu çš„ã€‚è¿™æä¾›äº†å„ç§å·¥å…·ï¼Œå¦‚ bash å’Œ curlï¼Œè¿™ä»¥æ–¹ä¾¿ä¸ºä»£ä»·ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚&lt;/p&gt;
&lt;p&gt;Istio è¿˜æä¾›äº†ä¸€ä¸ªåŸºäº&lt;a href=&#34;https://istio.io/latest/docs/ops/configuration/security/harden-docker-images/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ— å‘è¡Œç‰ˆé•œåƒçš„&lt;/a&gt;å°å‹é•œåƒï¼Œå‡å°‘äº†é•œåƒä¸­çš„ä¾èµ–æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ— å‘è¡Œç‰ˆçš„é•œåƒç›®å‰æ˜¯ä¸€ä¸ª alpha åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘å¸ƒå’Œå®‰å…¨ç­–ç•¥&#34;&gt;å‘å¸ƒå’Œå®‰å…¨ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿ä½ çš„é›†ç¾¤æœ‰æœ€æ–°çš„å·²çŸ¥æ¼æ´çš„å®‰å…¨è¡¥ä¸ï¼Œé‡è¦çš„æ˜¯ä¿æŒåœ¨ Istio çš„æœ€æ–°è¡¥ä¸ç‰ˆæœ¬ä¸Šï¼Œå¹¶ç¡®ä¿ä½ åœ¨ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/releases/supported-releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒçš„ç‰ˆæœ¬&lt;/a&gt;ä¸Šï¼Œä»åœ¨æ¥æ”¶å®‰å…¨è¡¥ä¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ£€æµ‹æ— æ•ˆé…ç½®&#34;&gt;æ£€æµ‹æ— æ•ˆé…ç½®&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Istio åœ¨åˆ›å»ºèµ„æºæ—¶æä¾›äº†éªŒè¯ï¼Œä½†è¿™äº›æ£€æŸ¥ä¸èƒ½æŠ“ä½æ‰€æœ‰é˜»æ­¢é…ç½®åœ¨ç½‘æ ¼ä¸­åˆ†å¸ƒçš„é—®é¢˜ã€‚è¿™å¯èƒ½å¯¼è‡´åº”ç”¨çš„ç­–ç•¥è¢«æ„å¤–åœ°å¿½ç•¥ï¼Œä»è€Œå¯¼è‡´æ„å¤–çš„ç»“æœã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åº”ç”¨é…ç½®ä¹‹å‰æˆ–ä¹‹åè¿è¡Œ &lt;code&gt;istioctl analyze&lt;/code&gt;ï¼Œä»¥ç¡®ä¿é…ç½®æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§æ§åˆ¶å¹³é¢çš„æ‹’ç»é…ç½®ã€‚é™¤äº†æ—¥å¿—ä¹‹å¤–ï¼Œè¿™äº›éƒ½æ˜¯é€šè¿‡ &lt;code&gt;pilot_total_xds_rejects&lt;/code&gt; æŒ‡æ ‡æ¥æ˜¾ç¤ºçš„ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•ä½ çš„é…ç½®ï¼Œä»¥ç¡®ä¿å®ƒç»™å‡ºé¢„æœŸçš„ç»“æœã€‚å¯¹äºå®‰å…¨ç­–ç•¥æ¥è¯´ï¼Œè¿è¡Œæ­£é¢å’Œè´Ÿé¢çš„æµ‹è¯•æ˜¯æœ‰ç”¨çš„ï¼Œä»¥ç¡®ä¿ä½ ä¸ä¼šæ„å¤–åœ°é™åˆ¶è¿‡å¤šæˆ–è¿‡å°‘çš„æµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¿å…-alpha-å’Œå®éªŒæ€§åŠŸèƒ½&#34;&gt;é¿å… alpha å’Œå®éªŒæ€§åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ Istio åŠŸèƒ½å’Œ API éƒ½è¢«åˆ†é…äº†ä¸€ä¸ª&lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŠŸèƒ½çŠ¶æ€&lt;/a&gt;ï¼Œå®šä¹‰äº†å®ƒçš„ç¨³å®šæ€§ã€åºŸæ­¢æ”¿ç­–å’Œå®‰å…¨æ”¿ç­–ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº alpha å’Œå®éªŒæ€§åŠŸèƒ½æ²¡æœ‰é‚£ä¹ˆå¼ºçš„å®‰å…¨ä¿è¯ï¼Œå»ºè®®å°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒä»¬ã€‚åœ¨è¿™äº›åŠŸèƒ½ä¸­å‘ç°çš„å®‰å…¨é—®é¢˜å¯èƒ½ä¸ä¼šè¢«ç«‹å³ä¿®å¤ï¼Œæˆ–è€…ä¸éµå¾ªæˆ‘ä»¬çš„æ ‡å‡†&lt;a href=&#34;https://istio.io/latest/docs/releases/security-vulnerabilities/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨æ¼æ´&lt;/a&gt;ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;è¦ç¡®å®šåœ¨ä½ çš„é›†ç¾¤ä¸­ä½¿ç”¨çš„åŠŸèƒ½çŠ¶æ€ï¼Œè¯·æŸ¥é˜… &lt;a href=&#34;https://istio.io/latest/docs/releases/feature-stages/#istio-features&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Istio åŠŸèƒ½&lt;/a&gt;åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é”å®šç«¯å£&#34;&gt;é”å®šç«¯å£&lt;/h2&gt;
&lt;p&gt;Istio é…ç½®äº†&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å„ç§&lt;/a&gt;å¯èƒ½è¢«é”å®šçš„&lt;a href=&#34;https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç«¯å£&lt;/a&gt;ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å¹³é¢&#34;&gt;æ§åˆ¶å¹³é¢&lt;/h3&gt;
&lt;p&gt;Istiod ä¸ºæ–¹ä¾¿èµ·è§ï¼Œé»˜è®¤æš´éœ²äº†å‡ ä¸ªæœªç»è®¤è¯çš„æ˜æ–‡ç«¯å£ã€‚å¦‚æœéœ€è¦ï¼Œè¿™äº›ç«¯å£å¯ä»¥è¢«å…³é—­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;8080&lt;/code&gt; ç«¯å£æš´éœ²äº†è°ƒè¯•æ¥å£ï¼Œå®ƒæä¾›äº†å¯¹é›†ç¾¤çŠ¶æ€çš„å„ç§ç»†èŠ‚çš„è¯»å–æƒé™ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ Istiod ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡ &lt;code&gt;ENABLE_DEBUG_ON_HTTP=false&lt;/code&gt; æ¥ç¦ç”¨ã€‚è­¦å‘Šï¼šè®¸å¤š &lt;code&gt;istioctl&lt;/code&gt; å‘½ä»¤éƒ½ä¾èµ–äºè¿™ä¸ªæ¥å£ï¼Œå¦‚æœå®ƒè¢«ç¦ç”¨ï¼Œå°†æ— æ³•è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;15010&lt;/code&gt; ç«¯å£é€šè¿‡æ˜æ–‡æš´éœ² XDS æœåŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ Istiod éƒ¨ç½²ä¸­æ·»åŠ  &lt;code&gt;--grpcAddr=&amp;quot;&amp;quot;&lt;/code&gt; æ ‡å¿—æ¥ç¦ç”¨ã€‚æ³¨æ„ï¼šé«˜åº¦æ•æ„Ÿçš„æœåŠ¡ï¼Œå¦‚è¯ä¹¦ç­¾ç½²å’Œåˆ†å‘æœåŠ¡ï¼Œç»ä¸é€šè¿‡æ˜æ–‡æä¾›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ•°æ®å¹³é¢&#34;&gt;æ•°æ®å¹³é¢&lt;/h3&gt;
&lt;p&gt;è¯¥ä»£ç†æš´éœ²äº†å„ç§ç«¯å£ã€‚å¯¹å¤–æš´éœ²çš„æ˜¯ &lt;code&gt;15090&lt;/code&gt; ç«¯å£ï¼ˆé¥æµ‹ï¼‰å’Œ &lt;code&gt;15021&lt;/code&gt; ç«¯å£ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚ç«¯å£ &lt;code&gt;15020&lt;/code&gt; å’Œ &lt;code&gt;15000&lt;/code&gt; æä¾›è°ƒè¯•ç«¯ç‚¹ã€‚è¿™äº›ç«¯å£åªåœ¨æœ¬åœ°ä¸»æœºä¸Šæš´éœ²ã€‚å› æ­¤ï¼Œè¿è¡Œåœ¨ä¸ä»£ç†ç›¸åŒçš„ pod ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®ï¼›åœ¨ sidecar å’Œåº”ç”¨ç¨‹åºä¹‹é—´æ²¡æœ‰ä¿¡ä»»è¾¹ç•Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®ç¬¬ä¸‰æ–¹æœåŠ¡è´¦æˆ·ä»¤ç‰Œ&#34;&gt;é…ç½®ç¬¬ä¸‰æ–¹æœåŠ¡è´¦æˆ·ä»¤ç‰Œ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ä¸ Istio æ§åˆ¶å¹³é¢è¿›è¡Œè®¤è¯ï¼ŒIstio ä»£ç†å°†ä½¿ç”¨æœåŠ¡è´¦æˆ·ä»¤ç‰Œã€‚Kubernetes æ”¯æŒè¿™ç§ä»¤ç‰Œçš„ä¸¤ç§å½¢å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹ä»¤ç‰Œï¼Œæœ‰ä¸€ä¸ªèŒƒå›´å†…çš„å—ä¼—å’Œåˆ°æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€æ–¹ä»¤ç‰Œï¼Œæ²¡æœ‰è¿‡æœŸï¼Œå¹¶è¢«å®‰è£…åˆ°æ‰€æœ‰çš„ Pod ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºç¬¬ä¸€æ–¹ä»¤ç‰Œçš„å±æ€§ä¸å¤ªå®‰å…¨ï¼ŒIstio å°†é»˜è®¤ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»¤ç‰Œã€‚ç„¶è€Œï¼Œè¿™ä¸ªåŠŸèƒ½å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„ Kubernetes å¹³å°ä¸Šéƒ½å¯ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨ &lt;code&gt;istioctl&lt;/code&gt; æ¥å®‰è£…ï¼Œå°†ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ”¯æŒã€‚è¿™ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œé€šè¿‡ä¼ é€’ &lt;code&gt;--set values.global.jwtPolicy=third-party-jwt&lt;/code&gt; æˆ– -&lt;code&gt;-set values.global.jwtPolicy=first-party-jwt&lt;/code&gt; è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è¦ç¡®å®šä½ çš„é›†ç¾¤æ˜¯å¦æ”¯æŒç¬¬ä¸‰æ–¹ä»¤ç‰Œï¼Œå¯»æ‰¾ &lt;code&gt;TokenRequest&lt;/code&gt; APIã€‚å¦‚æœè¿™æ²¡æœ‰è¿”å›å“åº”ï¼Œé‚£ä¹ˆè¯¥åŠŸèƒ½å°±ä¸è¢«æ”¯æŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get --raw /api/v1 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;.resources[] | select(.name | index(&amp;#34;serviceaccounts/token&amp;#34;))&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;serviceaccounts/token&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: true,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;group&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;authentication.k8s.io&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;TokenRequest&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™½ç„¶ç°åœ¨å¤§å¤šæ•°äº‘æä¾›å•†éƒ½æ”¯æŒè¿™ä¸€åŠŸèƒ½ï¼Œä½†åœ¨ Kubernetes 1.20 ä¹‹å‰ï¼Œè®¸å¤šæœ¬åœ°å¼€å‘å·¥å…·å’Œè‡ªå®šä¹‰å®‰è£…å¯èƒ½ä¸æ”¯æŒã€‚è¦å¯ç”¨è¯¥åŠŸèƒ½ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®ä¸‹æ¸¸è¿æ¥çš„é™åˆ¶&#34;&gt;é…ç½®ä¸‹æ¸¸è¿æ¥çš„é™åˆ¶&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioï¼ˆå’Œ Envoyï¼‰å¯¹ä¸‹æ¸¸è¿æ¥çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚è¿™å¯èƒ½è¢«æ¶æ„è¡Œä¸ºè€…åˆ©ç”¨ï¼ˆè§&lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰å…¨å…¬å‘Š 2020-007&lt;/a&gt;ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¿…é¡»ä¸ºä½ çš„ç¯å¢ƒé…ç½®ä¸€ä¸ªé€‚å½“çš„è¿æ¥é™åˆ¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ä¸‹è½½ &lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/custom-bootstrap-runtime.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;custom-bootstrap-runtime.yaml &lt;/a&gt;åˆ›å»ºä¸€ä¸ª ConfigMapã€‚æ ¹æ®ä½ çš„éƒ¨ç½²ä¸­å„ä¸ªç½‘å…³å®ä¾‹æ‰€éœ€çš„å¹¶å‘è¿æ¥æ•°ï¼Œæ›´æ–° ConfigMap ä¸­çš„ &lt;code&gt;global_downstream_max_connections&lt;/code&gt;ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶ï¼ŒEnvoy å°†å¼€å§‹æ‹’ç» tcp è¿æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n istio-system apply -f custom-bootstrap-runtime.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¥å£ç½‘å…³éƒ¨ç½²æ‰“è¡¥ä¸ï¼Œä»¥ä½¿ç”¨ä¸Šè¿°é…ç½®ã€‚ä¸‹è½½ &lt;a href=&#34;https://istio.io/latest/news/security/istio-security-2020-007/gateway-patch.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gateway-patch.yaml&lt;/a&gt; å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨å®ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl --namespace istio-system patch deployment istio-ingressgateway --patch &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;cat gateway-patch.yaml&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡®è®¤æ–°çš„é™åˆ¶å·²ç»åˆ°ä½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nv&#34;&gt;ISTIO_INGRESS_PODNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pods -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;istio-ingressgateway -n istio-system  -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.items[0].metadata.name}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl --namespace istio-system &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -i -t  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ISTIO_INGRESS_PODNAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -c istio-proxy -- curl -sS http://localhost:15000/runtime
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;entries&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;overload.global_downstream_max_connections&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;layer_values&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;250000&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;final_value&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;250000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;layers&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;static_layer_0&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
  </channel>
</rss>
