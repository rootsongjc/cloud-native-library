<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>应用载入最佳实践 | 云原生资料库</title>
    <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/</link>
      <atom:link href="https://lib.jimmysong.io/tsb/design-guides/app-onboarding/index.xml" rel="self" type="application/rss+xml" />
    <description>应用载入最佳实践</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Wed, 09 Aug 2023 12:00:00 +0800</lastBuildDate>
    <image>
      <url>https://lib.jimmysong.io/media/sharing.png</url>
      <title>应用载入最佳实践</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/</link>
    </image>
    
    <item>
      <title>集群准备</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/prepare/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/prepare/</guid>
      <description>&lt;p&gt;平台所有者（&amp;ldquo;平台&amp;rdquo;）将通过以下步骤准备一个集群：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;部署 TSE/TSB&lt;/p&gt;
&lt;p&gt;首先部署 TSE 或 TSB，并启动预期的工作负载集群。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启用严格（零信任）安全&lt;/p&gt;
&lt;p&gt;配置平台以遵循 &amp;lsquo;require-mTLS&amp;rsquo; 和 &amp;lsquo;deny-all&amp;rsquo; 的零信任安全策略。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建 Kubernetes 命名空间&lt;/p&gt;
&lt;p&gt;在每个将由应用所有者用于托管服务和应用程序的集群中创建并标记命名空间。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建 Tetrate 工作区&lt;/p&gt;
&lt;p&gt;创建将用于管理命名空间内服务行为的 Tetrate 工作区和相关配置。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;部署入口网关&lt;/p&gt;
&lt;p&gt;如有需要，在将托管应该提供给外部访问的服务的工作区中部署入口网关。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启用 GitOps 集成&lt;/p&gt;
&lt;p&gt;启用 GitOps 集成，以便应用所有者用户可以在不需要 Tetrate 特权访问的情况下与平台交互。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启用其他集成&lt;/p&gt;
&lt;p&gt;启用其他集成，以便应用所有者用户可以在不需要 Tetrate 特权访问的情况下与平台交互。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;平台部署-tsetsb&#34;&gt;平台：部署 TSE/TSB&lt;/h2&gt;
&lt;p&gt;按照产品说明部署 TSE 或 TSB 管理平面，然后启动预期的工作负载集群。&lt;/p&gt;
&lt;p&gt;请确保安装所需的附加组件并满足必要的先决条件。&lt;/p&gt;
&lt;h2 id=&#34;平台启用严格安全&#34;&gt;平台：启用严格安全&lt;/h2&gt;
&lt;p&gt;你应该使用 TSE/TSB 配置平台以零信任方式运行。具体来说：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;组件与应用所有者服务之间的所有通信都使用 mTLS 进行安全保护。这意味着外部的第三方，例如集群中的其他服务或具有数据路径访问权限的服务，不能读取事务、修改事务或冒充客户或服务。&lt;/li&gt;
&lt;li&gt;默认情况下拒绝所有通信。平台所有者必须明确打开所需的通信路径。这意味着只允许明确允许的通信。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;严格安全&#34;&gt;严格安全&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;TSE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;导航到 &lt;strong&gt;设置&lt;/strong&gt; &amp;gt; &lt;strong&gt;基本设置&lt;/strong&gt;。确保 &lt;strong&gt;Enforce mTLS&lt;/strong&gt; 和 &lt;strong&gt;Deny-All&lt;/strong&gt; 都已启用：&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tse-安全设置&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../images/tse-security.png&#34; alt=&#34;TSE 安全设置&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      TSE 安全设置
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;你也可以使用 Tetrate API 配置严格安全，方法是遵循 Tetrate Service Bridge 的说明。&lt;/p&gt;
&lt;p&gt;在 Tetrate 产品中，默认设置与顶级组织关联，顶级组织在 TSB 中是可定义的，而在 TSE 中设置为值 &lt;code&gt;tse&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;你将在名为 &lt;strong&gt;default&lt;/strong&gt; 的 &lt;strong&gt;OrganizationSetting&lt;/strong&gt; 中的 &lt;strong&gt;OrganizationSetting.spec.defaultSecuritySetting&lt;/strong&gt; 部分中找到安全设置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl get os -o yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可以在租户或工作区的基础上进一步覆盖这些设置（请注意，TSE 有一个名为 &lt;strong&gt;tse&lt;/strong&gt; 的单一租户，而 TSB 支持多个用户定义的租户）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;要默认要求使用 mTLS，请将 &lt;strong&gt;authenticationSettings.trafficMode&lt;/strong&gt; 设置为 &lt;strong&gt;REQUIRED&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;要默认声明拒绝所有通信，请将 &lt;strong&gt;authorization.rules.denyAll&lt;/strong&gt; 设置为 &lt;strong&gt;true&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;要防止子资源覆盖这些设置，请将 &lt;strong&gt;propagationStrategy&lt;/strong&gt; 设置为 &lt;strong&gt;STRICTER&lt;/strong&gt;（此步骤是非必需的）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以在 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/latest/refs/tsb/v2/organization_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB API 参考&lt;/a&gt; 中找到这些设置的描述。&lt;/p&gt;
&lt;p&gt;稍后，你将有选择地覆盖这些设置以允许允许的流量。&lt;/p&gt;
&lt;h2 id=&#34;平台创建-kubernetes-命名空间&#34;&gt;平台：创建 Kubernetes 命名空间&lt;/h2&gt;
&lt;p&gt;Kubernetes 的核心隔离单元是&lt;a href=&#34;https://kubernetes.io/docs/concepts/security/multi-tenancy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;命名空间&lt;/a&gt;。许多部署使用非常细粒度的命名空间以强制执行高级别的控制并为每个服务提供重复配置的自由。&lt;/p&gt;
&lt;p&gt;一旦将工作负载集群接入到 TSE/TSB 中，然后可以创建每个应用所有者团队将需要的命名空间，并为 Istio 注入进行标记。这就是命名空间中的资源将由 TSE/TSB 管理所需的全部内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl label namespace bookinfo istio-injection&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;enabled
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;平台创建-tetrate-工作区&#34;&gt;平台：创建 Tetrate 工作区&lt;/h2&gt;
&lt;p&gt;在实践中，细粒度的命名空间并不准确地模拟许多企业遵循的应用程序和团队结构。应用程序由多个命名空间组成，通常跨越多个不同的集群、区域、地区甚至云。&lt;/p&gt;
&lt;p&gt;出于这个原因，Tetrate 引入了一个称为 &lt;strong&gt;工作区&lt;/strong&gt; 的更高级别的结构。工作区是 Tetrate 产品中的主要隔离单元，它只是一个或多个集群中的一组命名空间。&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-命名空间和工作区&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../images/namespace-workspace.png&#34; alt=&#34;命名空间和工作区&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      命名空间和工作区
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;工作区提供了一个便捷的更高级别抽象，与组织的应用程序保持一致，这些应用程序通常跨越多个命名空间和/或集群。&lt;/p&gt;
&lt;details&gt;
&lt;summary&gt;&lt;b&gt;TSB 租户&lt;/b&gt;&lt;/summary&gt;
&lt;p&gt;Tetrate Service Express（TSE）提供一个单一的组织（用于全局设置）和多个工作区（用于个别设置）。TSE 旨在由单个团队使用。&lt;/p&gt;
&lt;p&gt;Tetrate Service Bridge 添加了一个中间层的 &lt;strong&gt;租户&lt;/strong&gt; 概念，允许在顶级组织内拥有多个独立的团队。&lt;strong&gt;租户&lt;/strong&gt; 可以在团队层面上应用额外的隔离，并可以覆盖全局设置。&lt;/p&gt;
&lt;p&gt;在本文档中，我们假设组织内只有一个团队，因此所有设置将应用于工作区级别。示例将使用名为 &lt;code&gt;tse&lt;/code&gt; 的组织和名为 &lt;code&gt;tse&lt;/code&gt; 的租户；当使用 TSB 时，你应该将这些更改为反映你选择的层次结构。&lt;/p&gt;
&lt;/details&gt;
&lt;p&gt;为每个应用程序创建 Tetrate 工作区，覆盖分配给该应用程序的命名空间：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过工作区的 &lt;strong&gt;namespaceSelector&lt;/strong&gt; 定义命名空间列表。条目可以限制在单个集群中 &lt;code&gt;cluster-1/bookinfo&lt;/code&gt;，也可以跨足所有集群 &lt;code&gt;*/bookinfo&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;注意我们如何使用 &lt;strong&gt;WorkspaceSetting&lt;/strong&gt; 覆盖了每个工作区的 &lt;strong&gt;defaultSecuritySetting&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; bookinfo-ws.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiversion: api.tsb.tetrate.io/v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Workspace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  organization: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  tenant: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo-ws
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespaceSelector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    names:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      - &amp;#34;*/bookinfo&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: api.tsb.tetrate.io/v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: WorkspaceSetting
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  organization: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  tenant: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  workspace: bookinfo-ws
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo-ws-settings
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  defaultSecuritySetting:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    authenticationSettings:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      trafficMode: REQUIRED
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    authorization:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      mode: WORKSPACE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl apply -f bookinfo-ws.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在打开一个工作区（&lt;strong&gt;authorization.mode: WORKSPACE&lt;/strong&gt;）时，你在零信任环境中创建了一个“泡泡”。该工作区内的所有服务可以相互通信，但必须使用 mTLS。&lt;/p&gt;
&lt;h2 id=&#34;平台部署入口网关&#34;&gt;平台：部署入口网关&lt;/h2&gt;
&lt;p&gt;通常，你会希望安排外部流量到达工作区内的特定服务。为此，你首先应在每个集群中的每个工作区部署一个&lt;strong&gt;入口网关&lt;/strong&gt;。应用程序所有者随后可以定义通过此入口网关公开其服务的网关规则。&lt;/p&gt;
&lt;h3 id=&#34;创建-tetrate-网关组&#34;&gt;创建 Tetrate 网关组&lt;/h3&gt;
&lt;p&gt;首先，创建一个 Tetrate 网关组，其范围限定在将托管入口网关的每个工作区和集群内。例如，如果 &lt;strong&gt;Bookinfo&lt;/strong&gt; 工作区跨足了 &lt;strong&gt;cluster-1&lt;/strong&gt; 和 &lt;strong&gt;cluster-2&lt;/strong&gt;，你可以为此工作区创建两个网关组，每个集群一个：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; bookinfo-gwgroup-cluster-1.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: gateway.tsb.tetrate.io/v2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Group
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo-gwgroup-cluster-1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  organization: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  tenant: tse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  workspace: bookinfo-ws
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespaceSelector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    names:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      - &amp;#34;cluster-1/bookinfo&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tctl apply -f bookinfo-gw-group-1.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;部署入口网关&#34;&gt;部署入口网关&lt;/h3&gt;
&lt;p&gt;接下来，在要接收外部流量的每个工作区和集群中部署一个入口网关：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; bookinfo-ingress-gw.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: install.tetrate.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: IngressGateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: bookinfo-ingress-gw
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  kubeSpec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    service:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      type: LoadBalancer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f bookinfo-ingress-gw.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这一步将在相应的命名空间中创建一个 &lt;strong&gt;envoy 代理&lt;/strong&gt; pod，它将作为入口网关运行（&lt;code&gt;kubectl get pod -n bookinfo -l app=bookinfo-ingress-gw&lt;/code&gt;）。请注意，你使用 IngressGateway 在特定集群中创建资源，因此使用 &lt;code&gt;kubectl&lt;/code&gt; 部署资源。&lt;/p&gt;
&lt;p&gt;稍后，应用程序所有者将想要创建 &lt;strong&gt;Gateway&lt;/strong&gt; 资源以公开其选择的服务。他们需要知道：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tetrate 工作区的名称，例如 &lt;strong&gt;bookinfo-ws&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;每个集群上 Tetrate 网关组的名称，例如 &lt;strong&gt;bookinfo-gwgroup-cluster-1&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;每个集群上入口网关的名称，例如 &lt;strong&gt;bookinfo-ingress-gw&lt;/strong&gt;。可以在所有集群上使用相同的名称&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;入口网关非常轻量级，并且为了安全和容错目的，为每个工作区运行一个单独的入口网关提供了隔离。对于非常大型的部署，你可能希望在多个工作区之间&lt;a href=&#34;../../howto/gateway/shared-ingress&#34;&gt;共享入口网关&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;平台启用-gitops-集成&#34;&gt;平台：启用 GitOps 集成&lt;/h2&gt;
&lt;p&gt;提供 Tetrate 管理的平台配置有两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;tctl&lt;/code&gt; 提供平台范围的配置，调用用户需要对 Tetrate API 服务器进行身份验证&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;kubectl&lt;/code&gt; 提供每个集群的配置，调用用户需要对 Kubernetes API 服务器进行身份验证&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于某些用例，用户（平台所有者或应用程序所有者）需要提供平台范围和每个集群的配置。&lt;/p&gt;
&lt;p&gt;Tetrate 的 GitOps 集成允许用户使用 Kubernetes API 提供平台范围的配置。GitOps 应该在一个或多个集群上启用；该过程会安装 Tetrate 平台范围配置的 CRD，任何资源都会自动从集群推送到 Tetrate API 服务器：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Tetrate Service Express：&lt;/strong&gt; 在 Tetrate Service Express 上默认启用 GitOps 集成。有关集成的概述，请参阅 &lt;a href=&#34;https://docs.tetrate.io/service-express/gitops/gitops-tse&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSE 中的 GitOps&lt;/a&gt; 指南。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tetrate Service Bridge：&lt;/strong&gt; 你需要在 Tetrate Service Bridge 上明确启用 GitOps。有关详细信息，请参阅 TSB 文档中的 &lt;a href=&#34;../../../operations/features/configure-gitops&#34;&gt;配置 GitOps&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;总的来说，GitOps 不仅适用于 GitOps 的用例。即使在组织采用 GitOps 姿态来管理配置之前，它也是有用的；GitOps 也可以用于允许选定的 K8s 用户管理 Tetrate 配置。这意味着用户不必拥有 Tetrate 用户/角色，他们可以使用他们已经习惯的 K8s 工具。&lt;/p&gt;
&lt;h2 id=&#34;平台启用额外的集成&#34;&gt;平台：启用额外的集成&lt;/h2&gt;
&lt;p&gt;你可能希望为你的平台启用其他集成。例如，在使用 AWS 时：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装 &lt;a href=&#34;http://docs.tetrate.io/service-express/installation/eks-cluster#install-aws-load-balancer-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS 负载均衡控制器&lt;/a&gt; 以实现更好的负载均衡器集成&lt;/li&gt;
&lt;li&gt;启用 &lt;a href=&#34;https://docs.tetrate.io/service-express/integrations/route53#enabling-the-integration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS Route 53 控制器&lt;/a&gt; 以管理由应用程序所有者公开的服务的 DNS 记录条目&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>部署服务和配置网关规则</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/deploy-service/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/deploy-service/</guid>
      <description>&lt;p&gt;应用程序所有者的用户体验在他们直接使用原生 Kubernetes API 与 Kubernetes 平台交互，或者依赖于间接方法（如 CD 流水线）来部署和配置平台时几乎没有变化。&lt;/p&gt;
&lt;p&gt;应用程序所有者 (&amp;ldquo;Apps&amp;rdquo;) 将按以下步骤部署和公开服务：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;部署服务&lt;/p&gt;
&lt;p&gt;在由平台所有者提供的 Kubernetes 命名空间中部署目标服务。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;公开服务&lt;/p&gt;
&lt;p&gt;配置一个 Gateway 资源，通过本地 Ingress 网关公开服务。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;apps-开始之前&#34;&gt;Apps: 开始之前&lt;/h2&gt;
&lt;p&gt;在开始之前，你需要从你的管理员（平台所有者）那里获得以下信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes 集群和命名空间：在所选择的命名空间中部署和管理服务所需的 API 访问权限&lt;/li&gt;
&lt;li&gt;Tetrate 拓扑：Kubernetes 命名空间被分组为 Tetrate 工作空间，一个工作空间可以包含来自多个集群的命名空间。你需要了解拓扑，包括：
&lt;ul&gt;
&lt;li&gt;Tetrate 工作空间的名称&lt;/li&gt;
&lt;li&gt;该工作空间中的命名空间和集群&lt;/li&gt;
&lt;li&gt;Tetrate Gateway Groups 的名称 - 通常每个工作空间每个集群有一个 Gateway Group&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请注意，Tetrate 部署的最常见安全姿态是允许 Workspace 内的流量，在工作空间之间以及不在工作空间中的 mesh 服务之间拒绝所有流量。如果需要，你的管理员可以在工作空间之间开放额外的流量。&lt;/p&gt;
&lt;h2 id=&#34;apps-部署服务&#34;&gt;Apps: 部署服务&lt;/h2&gt;
&lt;p&gt;将你的服务部署到由平台所有者提供的 Kubernetes 命名空间中，例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -n bookinfo -f https://raw.githubusercontent.com/istio/istio/master/samples/bookinfo/platform/kube/bookinfo.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;alert-note-title&#34;&gt;
    &lt;p&gt;识别 Tetrate 管理的命名空间&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
    由 Tetrate 管理的命名空间将启用 Istio 注入。你可以使用 &lt;code&gt;kubectl describe ns &amp;lt;namespace&amp;gt;&lt;/code&gt; 来验证此信息，并查找标签 &lt;strong&gt;istio-injection=enabled&lt;/strong&gt;。你部署的 Pod 将在运行时具有一个额外的 &lt;strong&gt;istio-proxy&lt;/strong&gt; 容器，以及几个瞬态的 init 容器。
&lt;/div&gt;

&lt;h2 id=&#34;apps-公开服务&#34;&gt;Apps: 公开服务&lt;/h2&gt;
&lt;p&gt;使用 Gateway 资源公开一个服务。这将配置 Ingress 网关以将流量负载均衡到你的服务：&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-通过-ingress-网关公开服务&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../images/topology.png&#34; alt=&#34;通过 Ingress 网关公开服务&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      通过 Ingress 网关公开服务
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Gateway&lt;/strong&gt; 资源引用了以下资源，这些资源应由你的管理员（平台所有者）提供：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tetrate 组织 &lt;strong&gt;tse&lt;/strong&gt;，租户 &lt;strong&gt;tse&lt;/strong&gt;，工作空间 &lt;strong&gt;bookinfo-ws&lt;/strong&gt; 和 Gateway 组 &lt;strong&gt;bookinfo-gwgroup-1&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;位于 &lt;strong&gt;bookinfo/bookinfo-ingress-gw&lt;/strong&gt; 中的 Ingress Gateway&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;突出显示的行包含了这些资源的名称：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; bookinfo-gateway.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb.tetrate.io/organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb.tetrate.io/tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb.tetrate.io/workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-ws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tsb.tetrate.io/gatewayGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-gwgroup-1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-ingress-gw&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# highlight-end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo.tse.tetratelabs.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceDestination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo/productpage.bookinfo.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl apply -f bookinfo-gateway.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此配置在所选的 Ingress 网关上实例化。Ingress 网关是一个基于 Envoy 的代理，用于侦听传入流量（在本例中是端口 &lt;strong&gt;80&lt;/strong&gt; 上的 &lt;strong&gt;http&lt;/strong&gt; 流量）。然后，将具有主机头 &lt;strong&gt;bookinfo.tse.tetratelabs.io&lt;/strong&gt; 的流量路由到你的服务 &lt;strong&gt;bookinfo/productpage.bookinfo.svc.cluster.local&lt;/strong&gt;，端口为 &lt;strong&gt;9080&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;了解-tetrate-gateway&#34;&gt;了解 Tetrate Gateway&lt;/h3&gt;
&lt;p&gt;在幕后，你应用的 Tetrate &lt;strong&gt;Gateway&lt;/strong&gt; 对象将由 Tetrate 管理平面在 Tetrate 的配置层次结构中处理，然后用于创建一个或多个 Istio &lt;strong&gt;gateway&lt;/strong&gt; 对象：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gateway -n bookinfo bookinfo-gateway -o yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;gateway&lt;/strong&gt; 对象包含一个选择器，该选择器标识了应该实例化此配置的 Ingress 网关（一个 Envoy 代理 Pod）。&lt;/p&gt;
&lt;h4 id=&#34;tetrate-参数&#34;&gt;Tetrate 参数&lt;/h4&gt;
&lt;p&gt;如果你的 Tetrate 参数有任何错误，&lt;strong&gt;apply&lt;/strong&gt; 操作将被拒绝。你将收到类似于以下错误消息：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Error from server: error when creating &amp;#34;bookinfo-gateway.yaml&amp;#34;: admission webhook &amp;#34;gitops.tsb.tetrate.io&amp;#34; denied the request: computing an access decision: checking permissions [organizations/tse/serviceaccounts/auto-cluster-cluster-1#exHFFwuGQSCPQP941C4ilMZFWwmO4lJoTyQXKjAPHXk ([CreateGateway]) organizations/tse/tenants/tse/workspaces/bookinfo-ws/gatewaygroups/bookinfo-gwgroup]: target &amp;#34;organizations/tse/tenants/tse/workspaces/bookinfo-ws/gatewaygroups/bookinfo-gwgroup&amp;#34; does not exist: node not found
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这四个参数（&lt;strong&gt;organization&lt;/strong&gt;、&lt;strong&gt;tenant&lt;/strong&gt;、&lt;strong&gt;workspace&lt;/strong&gt; 和 &lt;strong&gt;gatewayGroup&lt;/strong&gt;）对应于由管理员（平台所有者）创建的 Tetrate 配置，它们定义了你的 &lt;strong&gt;Ingress&lt;/strong&gt; 资源应位于 Tetrate 配置层次结构中的位置。&lt;/p&gt;
&lt;h4 id=&#34;工作负载选择器&#34;&gt;工作负载选择器&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;workloadSelector&lt;/strong&gt; 段标识了应将此配置应用于哪个 Ingress 网关（代理）。如果这些参数中的任何一个不正确（它们与 Ingress 控制器不匹配），则不会应用配置。&lt;/p&gt;
&lt;p&gt;在上述示例中，你可以按以下方式找到 Ingress 网关：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods -n bookinfo -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bookinfo-ingress-gw
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;检查-ingress-网关&#34;&gt;检查 Ingress 网关&lt;/h4&gt;
&lt;p&gt;Ingress Gateway pod 部署在由你分配的 Tetrate 工作空间管理的一个命名空间中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get ingressgateway -A
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;检查 Ingress Gateway 配置，并查看托管 Envoy 代理的 Pod：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe ingressgateway -n bookinfo bookinfo-ingress-gw
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl describe pod -n bookinfo -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bookinfo-ingress-gw
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;跟踪日志，包括实时访问日志：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -n bookinfo -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;bookinfo-ingress-gw
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;route-53-同步&#34;&gt;Route 53 同步&lt;/h4&gt;
&lt;p&gt;如果管理员配置了 AWS Route 53 同步，那么 Tetrate 集成还将根据你的 &lt;strong&gt;Gateway&lt;/strong&gt; 资源中的 &lt;strong&gt;hostname&lt;/strong&gt; 自动为你配置一个基于 Route 53 DNS 的名称。&lt;/p&gt;
&lt;p&gt;如果你具有访问 &lt;strong&gt;istio-system&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;命名空间的权限，你可以从 Tetrate 的 Route 53 控制器中查看日志：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl logs -n istio-system -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;route53-controller
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;通过-ingress-网关访问服务&#34;&gt;通过 Ingress 网关访问服务&lt;/h4&gt;
&lt;p&gt;如果为你配置了 DNS，你应该能够直接访问服务：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl http://bookinfo.tse.tetratelabs.io
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;你还可以确定 Ingress Gateway 的公共地址（IP 或 FQDN）并直接发送流量：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GATEWAY_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl -n bookinfo get service bookinfo-ingress-gw -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{.status.loadBalancer.ingress[0][&amp;#39;hostname&amp;#39;,&amp;#39;ip&amp;#39;]}&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -s --connect-to bookinfo.tse.tetratelabs.io:80:&lt;span class=&#34;nv&#34;&gt;$GATEWAY_IP&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://bookinfo.tse.tetratelabs.io/productpage&amp;#34;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;进一步阅读&#34;&gt;进一步阅读&lt;/h2&gt;
&lt;p&gt;有关配置 Ingress Gateway 资源以控制如何公开服务的更多信息，请参阅以下文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../..//quickstart/ingress-gateway&#34;&gt;附加的 Gateway 示例 (TSB 文档)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Gateway 参考文档：&lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/gateway/v2/ingress_gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB&lt;/a&gt; / &lt;a href=&#34;https://docs.tetrate.io/service-express/reference/k8s-api/tsb-crds-gen#gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>监控指标</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/monitor/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/monitor/</guid>
      <description>&lt;p&gt;Tetrate 管理平面从每个接入的工作负载平台以及启用了适当 Skywalking 客户端的其他工作负载中收集指标和跟踪信息。这些指标存储在 ElasticSearch 数据库中，并通过 Tetrate UI 中的仪表板提供：&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-仪表板-ui服务实例指标&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../images/metrics-1.png&#34; alt=&#34;仪表板 UI：服务实例指标&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      仪表板 UI：服务实例指标
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;查看 &lt;a href=&#34;../../../quickstart/observability&#34;&gt;TSB&lt;/a&gt; 或 &lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/observability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSE&lt;/a&gt; 示例以获取更多详细信息。&lt;/p&gt;
&lt;p&gt;用户需要访问 Tetrate UI 才能查看这些指标。在简单的单团队部署中可能是可行的，并且在 TSB 中，可以通过为应用程序所有者提供基于角色的访问权限，在非常大规模的情况下也可能是可行的，但在许多情况下，为你的应用程序所有者团队提供访问权限可能不是可行的或不适当的做法。&lt;/p&gt;
&lt;p&gt;另一种方法是将 Tetrate 收集的指标导出到第三方仪表板，如 Grafana。这通常是提供大量用户访问 Tetrate 指标的最合适方式，特别是如果你已经有一个成熟的企业仪表板解决方案。&lt;/p&gt;
&lt;h2 id=&#34;在第三方仪表板中公开-tetrate-指标&#34;&gt;在第三方仪表板中公开 Tetrate 指标&lt;/h2&gt;
&lt;p&gt;你需要公开你的 TSE 指标并安排一个仪表板收集器来抓取并标记它们。以下资源可能会对你有所帮助：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;了解 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/operations/telemetry&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate 指标架构&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;TSE &lt;a href=&#34;https://docs.tetrate.io/service-express/integrations/grafana&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS 托管 Grafana 集成指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;TSB &lt;a href=&#34;https://docs.tetrate.io/service-bridge/howto/promql-using-skywalking&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus PromQL 指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;TSB &lt;a href=&#34;https://docs.tetrate.io/service-bridge/operations/telemetry/new_relic&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;New Relic 集成&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;获取-tetrate-跟踪信息&#34;&gt;获取 Tetrate 跟踪信息&lt;/h2&gt;
&lt;p&gt;Tetrate 管理平台从工作负载集群的交易中对跟踪信息进行采样，并将其存储在管理集群上。Tetrate 提供了 &lt;code&gt;tctl&lt;/code&gt; 命令行工具中的功能来（a）离线复制集群和跟踪数据，并（b）检查此数据。&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tctl-工具用于检查性能数据&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;../images/tctl-service.png&#34; alt=&#34;tctl 工具用于检查性能数据&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      tctl 工具用于检查性能数据
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;可以使用此功能，以便平台所有者可以对活动数据进行特权转储，并将其提供给应用程序所有者团队进行分析。&lt;/p&gt;
&lt;p&gt;有关更多详细信息，请参阅有关 &lt;a href=&#34;../../../troubleshooting/identify-underperforming-services&#34;&gt;如何识别和排查性能不佳的服务&lt;/a&gt; 的文档。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>集群之间的连接与故障切换</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/cross-cluster/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/cross-cluster/</guid>
      <description>&lt;p&gt;Tetrate 使应用所有者能够轻松地在多个集群中部署应用程序。可以在选择的工作区中部署东西向网关，并将一些或所有服务暴露给其他集群。Tetrate 的中央服务注册表用于在其他集群中为这些暴露的服务创建虚拟端点（&lt;strong&gt;ServiceEntries&lt;/strong&gt;），以便客户端可以发现和使用这些服务，就像它们在本地运行一样。&lt;/p&gt;
&lt;p&gt;这项功能可用于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在不同的集群中分发应用程序的组件&lt;/li&gt;
&lt;li&gt;从远程集群访问集中式共享服务，如数据库微服务&lt;/li&gt;
&lt;li&gt;在不同集群之间为服务实例提供故障切换&lt;/li&gt;
&lt;li&gt;通过确保相同的应用程序和寻址方案在一个集群中或分布在多个集群中，简化测试&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;平台所有者（&amp;ldquo;Platform&amp;rdquo;）为故障转移案例准备了平台，应用程序所有者（&amp;ldquo;Apps&amp;rdquo;）可以在对其工作流程进行最少修改的情况下利用这些功能。&lt;/p&gt;
&lt;p&gt;平台所有者将按以下方式准备平台：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;部署东西向网关
在包含要共享的服务的命名空间中部署东西向网关。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;更新工作区以暴露所需的服务
更新工作区以暴露所需的服务，以便它们可以在其他集群中被发现和使用。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为内部故障切换部署东西向网关
在其他集群中部署额外的东西向网关以进行服务故障切换。
然后，应用程序所有者可以：&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;访问已暴露的服务
从其他集群中访问已暴露的服务。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在集群之间进行故障切换
验证服务能否从一个集群故障转移到另一个集群中的备份实例。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;平台开始之前&#34;&gt;平台：开始之前&lt;/h2&gt;
&lt;p&gt;在开始之前，你需要知道：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;共享服务所在的工作区&lt;/li&gt;
&lt;li&gt;应暴露哪些服务；默认情况下，工作区中的所有服务都会被暴露&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你还可以查看 TSE 入门用例：&lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/ha-eastwest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高可用性&lt;/a&gt; 和 &lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/cross-cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;跨集群通信&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;平台部署东西向网关&#34;&gt;平台：部署东西向网关&lt;/h2&gt;
&lt;p&gt;在包含要共享服务的命名空间中部署一个东西向网关：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; eastwest-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: install.tetrate.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: IngressGateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: eastwest-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  eastWestOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f eastwest-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;列出在本地集群中运行的东西向网关：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods -A -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eastwest-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;平台更新工作区以暴露所需的服务&#34;&gt;平台：更新工作区以暴露所需的服务&lt;/h2&gt;
&lt;p&gt;更新与工作区相关联的 &lt;strong&gt;WorkspaceSettings&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;settings.tetrate.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;WorkspaceSetting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-workspace-setting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-workspace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultEastWestGatewaySettings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;eastwest-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exposedServices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;details.bookinfo.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;reviews.bookinfo.svc.cluster.local&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请注意，&lt;strong&gt;defaultEastWestGatewaySettings&lt;/strong&gt; 使用 &lt;strong&gt;workloadSelector&lt;/strong&gt; 识别东西向网关，并具有一个可选的 &lt;strong&gt;exposedServices&lt;/strong&gt; 部分。&lt;/p&gt;
&lt;p&gt;应用程序所有者可以从远程集群中发现和使用这些共享服务。它们作为 &lt;strong&gt;xcp-multicluster&lt;/strong&gt; 命名空间中的 &lt;strong&gt;ServiceEntries&lt;/strong&gt; 暴露，并且使用与第一个集群中相同的 FQDN：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get serviceentry -n xcp-multicluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;请注意，如果应用程序所有者在远程集群中部署了相同的服务，那么 Tetrate 控制平台将删除 &lt;strong&gt;ServiceEntries&lt;/strong&gt;，以便该集群中的客户端更喜欢在同一集群中的服务实例。&lt;/p&gt;
&lt;h2 id=&#34;应用程序访问已暴露的服务&#34;&gt;应用程序：访问已暴露的服务&lt;/h2&gt;
&lt;p&gt;一旦在源集群中部署了东西向网关，并使用 &lt;strong&gt;WorkspaceSettings:defaultEastWestGatewaySettings&lt;/strong&gt; 选择了要暴露的服务，就可以在源集群中部署服务。匹配的服务将在远程集群中暴露出来。&lt;/p&gt;
&lt;p&gt;你可以通过以下方式在远程集群中查看暴露服务的列表如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get serviceentry -n xcp-multicluster
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些服务的完全限定域名（FQDN）在远程集群中是可寻址的，这意味着远程集群中的任何客户端服务都可以访问原始服务，无需进行任何修改。Tetrate 平台会保持&lt;strong&gt;ServiceEntries&lt;/strong&gt;与原始服务的存在和状态同步。&lt;/p&gt;
&lt;h2 id=&#34;平台为内部故障切换部署东西向网关&#34;&gt;平台：为内部故障切换部署东西向网关&lt;/h2&gt;
&lt;p&gt;在这种情况下，我们将准备平台以便在一个集群与另一个集群之间进行内部服务的故障转移。例如，一个应用所有者可以将一个多组件的应用程序（如 &lt;strong&gt;bookinfo&lt;/strong&gt;）部署到两个集群中。每个应用程序将使用本地版本的依赖服务，除非本地实例失败，在这种情况下，Tetrate 平台将自动将流量切换到另一个集群。应用所有者不需要进行任何应用程序修改。&lt;/p&gt;
&lt;h4 id=&#34;先决条件&#34;&gt;先决条件&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;必须在每个工作负载集群中创建应用程序的命名空间。&lt;/li&gt;
&lt;li&gt;Tetrate 工作区必须包括这些命名空间，并且必须跨足每个工作负载集群。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;例如，如果要在命名空间 &lt;strong&gt;bookinfo&lt;/strong&gt; 中部署应用程序，那么这个命名空间必须在每个集群中存在，并且 &lt;strong&gt;Workspace&lt;/strong&gt; 配置应引用所有实例，例如，使用以下 &lt;strong&gt;namespaceSelector&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*/bookinfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;部署一个东西向网关&#34;&gt;部署一个东西向网关&lt;/h4&gt;
&lt;p&gt;在其他集群中部署额外的东西向网关，与之前完全相同：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF &amp;gt; eastwest-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: install.tetrate.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: IngressGateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: eastwest-gateway
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  eastWestOnly: true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f eastwest-gateway.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;应用程序在集群之间测试故障转移&#34;&gt;应用程序：在集群之间测试故障转移&lt;/h2&gt;
&lt;p&gt;通过上述配置，你可以将应用程序部署到多个集群中。如果一个集群中的服务实例因任何原因失败，Tetrate 平台将检测到并将流量透明地切换到远程工作正常的服务实例。&lt;/p&gt;
&lt;p&gt;Tetrate 平台为集群中的每个远程服务实例创建了影子 &lt;strong&gt;WorkloadEntries&lt;/strong&gt;，这些实例存在于本地实例所在的集群和命名空间中。例如，如果你将 &lt;strong&gt;bookinfo&lt;/strong&gt; 应用程序部署到两个配置有高可用性的集群中，然后你可以检查每个集群以查看影子 &lt;strong&gt;WorkloadEntries&lt;/strong&gt; 是否存在。&lt;/p&gt;
&lt;p&gt;在下面的案例中，我们只暴露了 &lt;strong&gt;details&lt;/strong&gt; 和 &lt;strong&gt;reviews&lt;/strong&gt; 服务，并且云平台在三个 IP 地址上暴露了 &lt;strong&gt;eastwest-gateway&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get workloadentries -n bookinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# NAME                                           AGE   ADDRESS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-details-fc556d47e94d1cb435e513fa016c2243     17m   18.135.167.198&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-details-fc556d47e94d1cb435e513fa016c2243-2   17m   18.168.99.230&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-details-fc556d47e94d1cb435e513fa016c2243-3   17m   35.179.51.164&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-reviews-3ab8d1334c8f22513cd591f84c978f88     17m   18.135.167.198&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-reviews-3ab8d1334c8f22513cd591f84c978f88-2   17m   18.168.99.230&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# k-reviews-3ab8d1334c8f22513cd591f84c978f88-3   17m   35.179.51.164&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get svc -n bookinfo eastwest-gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# NAME               TYPE           CLUSTER-IP      EXTERNAL-IP                                                                     PORT(S)           AGE&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# eastwest-gateway   LoadBalancer   10.100.17.100   k8s-bookinfo-eastwest-00a17af379-bdda7f4eb8c5da5c.elb.eu-west-2.amazonaws.com   15443:30082/TCP   82m&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;要了解更多信息，请查看 TSE 入门练习 &lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/ha-eastwest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;在集群之间进行故障切换&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>扩展安全策略</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/security/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/security/</guid>
      <description>&lt;p&gt;Tetrate 允许你创建一个明确定义、准确可持续发展的安全策略，可以与你的 Tetrate 管理的系统平滑地同步发展。&lt;/p&gt;
&lt;p&gt;平台所有者（&amp;ldquo;Platform&amp;rdquo;）和应用程序所有者（&amp;ldquo;Apps&amp;rdquo;）共同合作创建你的安全策略的元素：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;识别安全阻塞
应用程序所有者识别当前 Tetrate 安全策略阻止的必需流量。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;应用安全规则
平台所有者验证所需的安全例外，并使用 Tetrate API 实施它。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;审计安全规则
定期，平台所有者可能希望审计当前的安全策略，以确保它们足以满足安全和合规性需求。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;平台开始之前&#34;&gt;平台：开始之前&lt;/h2&gt;
&lt;p&gt;本指南将涵盖在零信任环境中的工作负载之间配置访问控制。工作负载通过 Istio 提供的 Tetrate 平台发放和更新 SPIFFE 标识进行身份验证。本指南不涵盖 JWT、OAuth 或 OIDC 用户身份验证等更高级别的功能。&lt;/p&gt;
&lt;p&gt;指南从推荐的起始姿态开始：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有工作负载都使用 SPIFFE 标识，并且对于所有流量，都需要 mTLS。这意味着外部第三方（如集群中的其他服务或具有对数据路径的访问权限的服务）无法读取事务、修改事务或冒充客户端或服务。&lt;/li&gt;
&lt;li&gt;默认情况下，所有通信都被拒绝，只有解锁了工作区，并且内部流量是允许的。&lt;/li&gt;
&lt;li&gt;默认的安全传播策略是 REPLACE&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;你需要了解的内容&#34;&gt;你需要了解的内容&lt;/h3&gt;
&lt;p&gt;使用 &lt;strong&gt;SecuritySetting&lt;/strong&gt; 部分配置 Tetrate 安全姿态。这些部分以资源的层次结构呈现：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;组织级别的 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/v2/organization_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;OrganizationSetting/defaultSecuritySetting&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;租户级别的 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/v2/tenant_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;TenantSetting/defaultSecuritySetting&lt;/strong&gt;&lt;/a&gt;。一个组织可以包含多个租户。&lt;/li&gt;
&lt;li&gt;每个工作区级别的 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/v2/organization_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;WorkspaceSetting/defaultSecuritySetting&lt;/strong&gt;&lt;/a&gt;。一个租户包含多个工作区。&lt;/li&gt;
&lt;li&gt;每个安全组级别的 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/security/v2/security_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;SecuritySetting&lt;/strong&gt;&lt;/a&gt;。安全组允许将工作区细分为更小的命名空间集合。&lt;/li&gt;
&lt;li&gt;每个服务级别的 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/security/v2/service_security_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;ServiceSecuritySetting&lt;/strong&gt;&lt;/a&gt;。在安全组内，可以为单个服务应用规则。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在每个资源中，你可以配置一个 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/security/v2/security_setting#tetrateio-api-tsb-security-v2-securitysetting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;SecuritySetting&lt;/strong&gt;&lt;/a&gt; 部分。&lt;/p&gt;
&lt;h3 id=&#34;传播策略&#34;&gt;传播策略&lt;/h3&gt;
&lt;p&gt;有关更多信息，请参阅&lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/types/v2/types#tetrateio-api-tsb-types-v2-propagationstrategy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;传播策略&lt;/a&gt;文档。&lt;/p&gt;
&lt;h3 id=&#34;常见做法&#34;&gt;常见做法&lt;/h3&gt;
&lt;p&gt;在配置安全策略时，有两种常见做法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;自上而下，开放工作区&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;首先定义高级别的默认值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 &lt;strong&gt;OrganizationSetting/defaultSecuritySetting&lt;/strong&gt; 中设置 &lt;strong&gt;denyAll&lt;/strong&gt;，并将 &lt;strong&gt;propagationStrategy&lt;/strong&gt; 设置为 &lt;strong&gt;REPLACE&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;在 &lt;strong&gt;WorkspaceSetting/defaultSecuritySetting&lt;/strong&gt; 中设置 &lt;strong&gt;mode: WORKSPACE&lt;/strong&gt; 以允许工作区之间的通信，&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;自下而上，细粒度规则&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;定义初始姿态：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不要在组织级别启用 &amp;lsquo;Deny-All&amp;rsquo;，但是将 &lt;strong&gt;propagationStrategy&lt;/strong&gt; 设置为 &lt;strong&gt;STRICTER&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一旦在较低级别定义了 &lt;strong&gt;Allow&lt;/strong&gt; 规则，那些不匹配该规则的请求将被拒绝，然后将这个拒绝传播到默认情况下拒绝所有其他请求的层次结构中。然后，你可以维护一个显式的 Allow 规则列表，知道其他所有东西都将被拒绝。&lt;/p&gt;
&lt;p&gt;这种方法更难以管理，因为你需要声明每个 &lt;strong&gt;Allow&lt;/strong&gt; 规则，但它提供了更严格的安全性。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;应用程序识别安全阻塞&#34;&gt;应用程序：识别安全阻塞&lt;/h2&gt;
&lt;p&gt;当你希望访问目标服务时，你需要知道该服务的 FQDN（全限定域名）。通常情况下，这会在 Tetrate 服务注册表中列出，但也可能以其他形式存在，例如 &lt;strong&gt;ServiceEntry&lt;/strong&gt;。服务所有者应该能够提供 FQDN。&lt;/p&gt;
&lt;p&gt;在调试访问控制问题时，你可以从客户端容器向目标服务发出简单的 HTTP 请求开始：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CLIENT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;kubectl get pod -n bookinfo -l &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ratings -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.items[0].metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CLIENT&lt;/span&gt; -n bookinfo -c ratings -- &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  curl -s productpage.bookinfo.svc.cluster.local:9080/productpage
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 如果 Tetrate 策略拒绝访问，则期望响应为 &amp;#39;RBAC: access denied&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果客户端的 &lt;strong&gt;curl&lt;/strong&gt; 命令得到文本响应 &lt;code&gt;RBAC: access denied&lt;/code&gt;，则表示 Tetrate 平台配置正在阻止访问。其他错误是由其他（非访问控制）原因引起的。&lt;/p&gt;
&lt;h3 id=&#34;定义安全策略&#34;&gt;定义安全策略&lt;/h3&gt;
&lt;p&gt;安全策略是从目标服务的角度定义的；它们定义了哪些客户端被允许访问目标。目标服务的所有者应该要求平台所有者向阻止访问的 &amp;ldquo;拒绝访问&amp;rdquo; 安全策略中添加一个适当的例外，以便客户端可以访问目标服务。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;对于客户端和目标服务都是如此，平台所有者需要知道：&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;服务 &lt;strong&gt;名称&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;服务 &lt;strong&gt;serviceAccount&lt;/strong&gt;（&lt;code&gt;kubectl get pod -n bookinfo podname -o jsonpath=&amp;quot;{.spec.serviceAccount}&amp;quot;)&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;服务所在的 &lt;strong&gt;命名空间&lt;/strong&gt; 和 &lt;strong&gt;集群&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Tetrate &lt;strong&gt;工作区&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;平台所有者将根据其安全实践确定适当的安全规则来打开所请求的流量。安全规则可以基于服务到服务、命名空间到命名空间、工作区到工作区或各种组合。&lt;/p&gt;
&lt;h2 id=&#34;平台应用安全规则&#34;&gt;平台：应用安全规则&lt;/h2&gt;
&lt;p&gt;安全规则是从目标服务的角度进行配置的。它们可以基于工作区中的安全组，也可以是单独的 Kubernetes 服务账户。Tetrate 平台会积累这些规则，遵循每个级别的 &lt;strong&gt;propagationStrategy&lt;/strong&gt;，并生成完整的安全策略。该策略使用集群内和集群之间的 Istio 配置来实施。&lt;/p&gt;
&lt;p&gt;在构建规则时，请考虑以下两个问题：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;目标是什么？&lt;/th&gt;
&lt;th&gt;如何定义规则的位置&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;工作区中的所有命名空间&lt;/td&gt;
&lt;td&gt;更新 &lt;strong&gt;WorkspaceSetting/defaultSecuritySetting&lt;/strong&gt; 中的 &lt;strong&gt;authorization&lt;/strong&gt; 部分。&lt;br/&gt;或者，你可能希望将 &lt;strong&gt;WorkspaceSetting/defaultSecuritySetting&lt;/strong&gt; 视为不可变的，并在整个工作区范围内的 &lt;strong&gt;安全组&lt;/strong&gt; 中进行更改&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;工作区中的某些命名空间&lt;/td&gt;
&lt;td&gt;为目标创建一个适当的 &lt;strong&gt;安全组&lt;/strong&gt;，并在附加到该 **安全&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;组** 的 &lt;strong&gt;SecuritySetting&lt;/strong&gt; 中更新 &lt;strong&gt;authorization&lt;/strong&gt; 部分 |
| 单个命名的服务                    | 为该服务创建一个 &lt;strong&gt;ServiceSecuritySetting&lt;/strong&gt;，附加到工作区中的适当 &lt;strong&gt;安全组&lt;/strong&gt;。在 &lt;strong&gt;ServiceSecuritySetting&lt;/strong&gt; 中更新 &lt;strong&gt;authorization&lt;/strong&gt; 部分 |&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;来源是什么？&lt;/th&gt;
&lt;th&gt;如何定义规则&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;同一命名空间&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;NAMESPACE&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;同一安全组&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;GROUP&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;同一工作区&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;WORKSPACE&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;同一集群&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;CLUSTER&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;具名的 Kubernetes 服务账户&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;CUSTOM&lt;/strong&gt;，并列出服务账户&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;更加细粒度的控制&lt;/td&gt;
&lt;td&gt;将 &lt;strong&gt;AuthorizationSettings.mode&lt;/strong&gt; 设置为 &lt;strong&gt;RULES&lt;/strong&gt;，并提供 &lt;strong&gt;allow&lt;/strong&gt; 和 &lt;strong&gt;deny&lt;/strong&gt; 的工作区和安全组列表&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;首先查看 &lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/security/v2/security_setting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;SecuritySetting&lt;/strong&gt; 文档&lt;/a&gt; 获取一组实际示例和更详细的文档。&lt;/p&gt;
&lt;h4 id=&#34;在-direct-模式中使用-istio-原语&#34;&gt;在 DIRECT 模式中使用 Istio 原语&lt;/h4&gt;
&lt;p&gt;对于高级情况，也可以直接使用 Istio 原语定义安全策略。要执行此操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;配置 &lt;strong&gt;Security Group&lt;/strong&gt; 使用 &lt;strong&gt;configMode: DIRECT&lt;/strong&gt;。这意味着 Tetrate &lt;strong&gt;SecuritySettings&lt;/strong&gt; API 无法应用于此组&lt;/li&gt;
&lt;li&gt;创建 &lt;strong&gt;PeerAuthentication&lt;/strong&gt; 和 &lt;strong&gt;AuthorizationPolicy&lt;/strong&gt; Istio Security v1beta1 资源，并使用注释将其附加到 &lt;strong&gt;Security Group&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tetrate 管理平台将会将这些 &lt;strong&gt;DIRECT&lt;/strong&gt; 模式配置与其他 &lt;strong&gt;BRIDGED&lt;/strong&gt; 模式配置协调一致，并生成适当的数据平面配置。&lt;/p&gt;
&lt;h2 id=&#34;平台审计安全规则&#34;&gt;平台：审计安全规则&lt;/h2&gt;
&lt;p&gt;定期地，你可能希望审计 Tetrate 实施的安全规则。你可以使用几种行业标准工具来可视化规则：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kiali.io/docs/features/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kiali&lt;/a&gt; 可以检查和可视化生成的 Istio 配置&lt;/li&gt;
&lt;li&gt;Tetrate 平台可以生成源自平台所有者配置的分层访问控制策略的 L3/4 网络策略。然后，可以使用各种第三方 Kubernetes 网络策略可视化工具来检查和可视化这些 L3/4 Kubernetes 网络策略。&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>跨集群实现高可用性</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/high-availability/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/high-availability/</guid>
      <description>&lt;p&gt;通过 TSB 和 TSE，你有多种选项可以配置你的平台，使应用程序在集群间以高可用性的方式运行。在每种情况下，一旦平台所有者（&amp;ldquo;平台&amp;rdquo;）合适地准备了平台，应用程序所有者（&amp;ldquo;应用&amp;rdquo;）只需要从两个或多个集群中部署和发布其服务，即可利用 HA 的优势。&lt;/p&gt;
&lt;h2 id=&#34;高可用性的选项&#34;&gt;高可用性的选项&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;选项 1：使用 Tetrate 的 Edge Gateway 解决方案
使用 Tetrate 的 Edge Gateway 来为多个集群提供前端，并在它们之间分发流量。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选项 2：使用 Tetrate 的 Route 53 控制器与 AWS Route 53
使用 AWS Route 53 控制器为从 TSE 或 TSB 发布的服务自动配置 Route 53。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选项 3：手动配置 GSLB 解决方案
手动配置 GSLB 解决方案，以在集群入口点之间分发流量并执行健康检查。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;开始之前&#34;&gt;开始之前&lt;/h2&gt;
&lt;p&gt;在跨集群负载均衡时，你可能需要依赖 DNS GSLB 解决方案将流量分发到每个服务的入口点（边缘网关等）。在这种情况下，你需要考虑健康检查的功能。&lt;/p&gt;
&lt;p&gt;一旦在集群上部署了应用程序，可能需要详细的每应用程序健康检查，但首先，基础设施健康检查是一个很好的起点。健康检查的目的有两个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;验证工作负载集群的功能和可达性&lt;/strong&gt;：为此，通常只需运行一个简单的 &amp;lsquo;canary&amp;rsquo; 服务，如 &lt;strong&gt;&lt;a href=&#34;http://httpbin.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;httpbin&lt;/a&gt;&lt;/strong&gt;，并验证它是否可以通过每个入口点访问。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;确定到达每个工作负载集群的最佳方式&lt;/strong&gt;：边缘和内部负载均衡器通常配置为在本地和远程代理或集群之间进行负载平衡。这确保了它们始终可以满足请求，即使这意味着使用远程目标。对于 GSLB 健康检查请求，请配置每一跃点只使用下一个本地跃点，如果不可用，则失败，以便对使用快速本地路径的入口点进行健康检查成功。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;选项-1配置-tetrate-的-edge-gateway&#34;&gt;选项 1：配置 Tetrate 的 Edge Gateway&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;../../../howto/gateway/multi-cluster-traffic-shifting&#34;&gt;Edge Gateway 解决方案&lt;/a&gt; 在 &lt;a href=&#34;../../ha-multicluster/&#34;&gt;HA 设计指南&lt;/a&gt; 中有详细说明。通过 Edge Gateway，你可以在工作负载或专用集群中部署边缘负载均衡器。这些网关的目的是接收流量并将其（负载平衡）转发到目标服务的工作中的 Ingress Gateway。&lt;/p&gt;
&lt;h3 id=&#34;背景信息&#34;&gt;背景信息&lt;/h3&gt;
&lt;p&gt;Edge Gateways 由 Tetrate 平台管理，考虑到稳定性和可靠性。它们很少更新，并以尽可能简单的配置运行。它们通常部署在专用的 K8s 集群中，以最小化来自相邻工作负载的干扰或中断的可能性。如果你希望部署多个 Edge Gateway 以实现最大的高可用性，可以使用基本的 GSLB 解决方案来分发流量。&lt;/p&gt;
&lt;p&gt;请查看以下背景资源：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../../ha-multicluster/&#34;&gt;Tetrate HA 设计指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;你的 GSLB 供应商的最佳实践指南&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;启动一个新应用程序&#34;&gt;启动一个新应用程序&lt;/h3&gt;
&lt;p&gt;当你使用 Tetrate 的 Edge Gateway 启动一个新应用程序时，需要在多个接触点配置流量流向：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为工作负载集群上的 Ingress Gateways 的 Gateway 资源配置应用程序以从集群中发布应用程序。有关详细信息，请参阅 &lt;a href=&#34;../deploy-service&#34;&gt;部署服务&lt;/a&gt; 内容。通常情况下，不需要为应用程序的工作负载集群实例配置 DNS&lt;/li&gt;
&lt;li&gt;为边缘集群上的 Edge Gateways 的 Gateway 资源配置应用程序，以从 Edge Gateway 中发布应用程序并将流量分发到正常工作的工作负载集群实例。有关如何执行此操作以及可能适用的高可用性考虑事项的详细信息，请参阅 &lt;a href=&#34;../../ha-multicluster/&#34;&gt;Tetrate HA 设计指南&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;为应用程序的 FQDN 配置 DNS，以将流量定向到 Edge Gateway 的正常实例。通常情况下，可以使用第三方的基于 DNS 的 GSLB 服务（例如，由你的云提供商提供的 AWS Route 53）或诸如 NS1、CloudFlare 或 Akamai 等云中立解决方案执行此操作。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;具体的步骤由你选择的 Edge Gateway 配置和正在使用的 DNS GSLB 解决方案的性质密切定义。&lt;/p&gt;
&lt;h2 id=&#34;选项-2使用-tetrate-的-aws-route-53-控制器与-aws-route-53&#34;&gt;选项 2：使用 Tetrate 的 AWS Route 53 控制器与 AWS Route 53&lt;/h2&gt;
&lt;p&gt;在 Amazon EKS 上部署工作负载或 Edge Gateways 时，Tetrate 平台可以自动维护反映应用程序所有者或平台所有者对公开的应用程序和服务的意图的 Route 53 DNS 条目。Tetrate 的 Route 53 控制器监视 Gateway 资源并识别其中的 &lt;strong&gt;hostname&lt;/strong&gt; DNS 值。只要匹配的 Route 53 托管区存在并且平台所有者已经允许访问，Route 53 控制器将配置并维护必要的 DNS 条目，以便客户可以通过网关访问工作负载。&lt;/p&gt;
&lt;h3 id=&#34;背景信息-1&#34;&gt;背景信息&lt;/h3&gt;
&lt;p&gt;请查看以下背景资源：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-express/integrations/route53&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Express - AWS Route 53 集成&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/publish-service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Express - 入门 - 发布服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/ha-route53&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tetrate Service Express - 入门 - 多集群和 Route 53&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;平台准备集群&#34;&gt;平台：准备集群&lt;/h3&gt;
&lt;p&gt;要使此功能可用于你的应用程序所有者，你需要执行三件事：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建 Route 53 托管区
为你计划使用的 dns 条目（域）创建必要的 Route 53 托管区，例如 &lt;code&gt;.tetratelabs.io&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在每个集群上部署 Route 53 控制器
在每个集群上启用适当的 IAM 服务帐户，并部署 &lt;strong&gt;Tetrate Route 53 控制器&lt;/strong&gt;。你可以使用 &lt;strong&gt;spec.providerSettings.route53.domainFilter&lt;/strong&gt; 设置来限制可以从集群中管理哪些 Route 53 托管区。
我们强烈建议在每个集群上 &lt;a href=&#34;https://docs.tetrate.io/service-express/installation/eks-cluster#install-aws-load-balancer-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装 AWS 负载均衡器控制器&lt;/a&gt;，以实现 Tetrate 平台、Ingress Gateways 和 Route 53 配置及健康检查的最佳集成。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;解释应用程序所有者需要知道的内容
分享应用程序所有者需要知道以使用 Route 53 自动化的详细信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对于简单的 Ingress 情况，在 Ingress &lt;strong&gt;Gateway&lt;/strong&gt; 资源中使用正确的主机名就足够了，Route 53 控制器将提供 Route 53 简单的 DNS 资源&lt;/li&gt;
&lt;li&gt;对于多集群、GSLB 情况，应用程序所有者将需要 &lt;a href=&#34;https://docs.tetrate.io/service-express/getting-started/ha-route53&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;使用 AWS 特定的注释来扩展其 Ingress &lt;strong&gt;Gateway&lt;/strong&gt; 资源&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;选项-3手动配置-gslb-解决方案&#34;&gt;选项 3：手动配置 GSLB 解决方案&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;选项 3：&lt;/strong&gt; 你还可以选择使用第三方的 GSLB 解决方案来在 Tetrate 管理的端点（Edge Gateways 或 Ingress Gateways）之间分发流量。另外，CDN 可以为一组 Edge Gateways 和 Ingress Gateways 提供前端。&lt;/p&gt;
&lt;h2 id=&#34;应用程序部署应用程序&#34;&gt;应用程序：部署应用程序&lt;/h2&gt;
&lt;p&gt;你的管理员（平台所有者）将解释你需要了解的内容，以在集群间部署应用程序，配置健康检查并测试高可用性。评估标准取决于他们为准备平台采取的方法。&lt;/p&gt;
&lt;p&gt;通过适当的配置，你应该可以很好地控制你的服务是如何发布的，并在集群间共享流量。这将使你能够创建一个高可用性部署，以管理健康检查并操作常见任务，如为应用程序升级做准备之前排放集群。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>针对服务配置额外的安全措施</title>
      <link>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/gateway-security/</link>
      <pubDate>Wed, 09 Aug 2023 12:00:00 +0800</pubDate>
      <guid>https://lib.jimmysong.io/tsb/design-guides/app-onboarding/gateway-security/</guid>
      <description>&lt;p&gt;当一个服务使用 &lt;strong&gt;Gateway&lt;/strong&gt; 资源公开时，应用所有者可以配置一系列措施来保护他们的服务。&lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/gateway/v2/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway 资源&lt;/a&gt;（&lt;a href=&#34;https://docs.tetrate.io/service-bridge/refs/tsb/gateway/v2/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSB&lt;/a&gt; / &lt;a href=&#34;https://docs.tetrate.io/service-express/refs/tsb/gateway/v2/gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TSE&lt;/a&gt;）支持以下功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在集群或服务实例之间提供跨集群的 HTTP 支持，支持 TLS、路由、负载平衡和重定向&lt;/li&gt;
&lt;li&gt;在集群或服务实例之间提供跨集群的 TCP 支持，支持 TLS、路由和负载平衡&lt;/li&gt;
&lt;li&gt;使用 JWT 令牌进行身份验证&lt;/li&gt;
&lt;li&gt;针对外部授权服务进行授权&lt;/li&gt;
&lt;li&gt;基于客户端地址、HTTP 标头、路径和方法的每秒、每分钟或每小时的速率限制&lt;/li&gt;
&lt;li&gt;使用 WASM 插件实现自定义流量管理功能&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;安全功能&#34;&gt;安全功能&lt;/h2&gt;
&lt;p&gt;从安全角度来看，两个有用的功能是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;身份验证和授权
与其将身份验证方法构建到目标服务中，不如让 Ingress Gateway 根据 JWT 令牌的内容检查和授权流量。这简化了服务配置，集中了身份验证，确保与其他服务的一致性，并允许在没有任何应用程序更改的情况下采用不同的安全姿态（例如，开发、测试和生产）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;速率限制
通过在 Ingress Gateway 中限制每秒/每分钟/每小时的请求，可以保护上游服务免受流量激增的影响。可以对资源的个体 &amp;lsquo;贪婪&amp;rsquo; 使用者（例如爬取机器人和蜘蛛）进行限制，并且可以使试图接管账户的暴力尝试变得不可能。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;应用程序配置身份验证和授权&#34;&gt;应用程序：配置身份验证和授权&lt;/h2&gt;
&lt;p&gt;Tetrate 平台提供了授权功能，以授权由 Ingress Gateway 接收的每个 HTTP 请求。它支持使用 JWT 声明进行本地授权，并支持外部授权（&lt;a href=&#34;https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_authz_filter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ext-authz&lt;/a&gt;）来确定是否允许或拒绝请求。&lt;/p&gt;
&lt;p&gt;如果你有一个单独的内部系统，或者希望使用与 JWT 不同的其他身份验证架构，或者希望与第三方授权解决方案（如 Open Policy Agent (OPA) 或 PlainID）集成，你可能会决定使用外部授权系统：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;g1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;w1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ns1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;authentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://accounts.google.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwksUri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://www.googleapis.com/oauth2/v3/certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;issuer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;auth.mycompany.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jwksUri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://auth.mycompany.com/oauth2/jwks&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;external&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://company.com/authz&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;includeRequestHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 将标头转发到授权服务。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceDestination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ns1/productpage.ns1.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有关详细信息，请查看&lt;a href=&#34;../../../howto/authorization/&#34;&gt;外部授权&lt;/a&gt;，这也适用于 TSE。&lt;/p&gt;
&lt;h2 id=&#34;应用程序配置速率限制&#34;&gt;应用程序：配置速率限制&lt;/h2&gt;
&lt;p&gt;速率限制允许你将流量通过你的 Ingress Gateway 限制到预定的限制。你可以对流量属性进行分类，如源 IP 地址和 HTTP 标头，分别对每个类别进行速率限制。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway.tsb.tetrate.io/v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;g1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workspace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;w1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tenant&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;organization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workloadSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ns1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SIMPLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bookinfo-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceDestination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ns1/productpage.ns1.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rateLimiting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 对远程地址为 1.2.3.4 的客户端进行每小时 10 次的速率限制&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;dimensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;remoteAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.2.3.4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestsPerUnit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HOUR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 对 user-agent 标头中的每个唯一值进行每分钟 50 次的速率限制&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;dimensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;user-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestsPerUnit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MINUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 对每个唯一的客户端远程地址进行每秒 100 次的速率限制&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# 对 HTTP 请求的 GET 方法和路径前缀为 /productpage 的进行限制&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;dimensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;remoteAddress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;:path&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/productpage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;:method&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestsPerUnit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;SECOND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果你关心以下任何方面，你可能需要考虑速率限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;防止恶意的基于容量的活动，如 DDoS 攻击或暴力攻击&lt;/li&gt;
&lt;li&gt;限制不良行为的蜘蛛、机器人或爬取器的影响&lt;/li&gt;
&lt;li&gt;防止你的应用程序及其资源（如数据库）过载&lt;/li&gt;
&lt;li&gt;实施公平的业务逻辑，如为不同的用户组应用不同的 API 限制。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有关详细信息，请查看 &lt;a href=&#34;../../../howto/rate-limiting/&#34;&gt;TSB 速率限制文档&lt;/a&gt;，这也适用于 TSE。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
