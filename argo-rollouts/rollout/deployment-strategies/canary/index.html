<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="å®‹å‡€è¶…" />

  
  
  
    
  
  <meta name="description" content="é‡‘ä¸é›€å‘å¸ƒæ˜¯ä¸€ç§éƒ¨ç½²ç­–ç•¥ï¼Œæ“ä½œå‘˜å°†æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºé‡Šæ”¾åˆ°ç”Ÿäº§æµé‡çš„ä¸€å°éƒ¨åˆ†ä¸­ã€‚ æ¦‚è¿° ç”±äºæ²¡æœ‰å…³äºé‡‘ä¸é›€éƒ¨ç½²çš„å…±è¯†æ ‡å‡†ï¼Œå› æ­¤ Rollouts Controller å…è®¸ç”¨æˆ·æ¦‚è¿°ä»–ä»¬æƒ³è¦è¿è¡Œå…¶é‡‘ä¸é›€éƒ¨ç½²çš„æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ä½¿ç”¨çš„æ­¥éª¤" />

  
  <link rel="alternate" hreflang="zh" href="https://lib.jimmysong.io/argo-rollouts/rollout/deployment-strategies/canary/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.2c25b2854625561177dfe556e1065970.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-MP490FS739"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-MP490FS739");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a4b7f65b1839466beaa48d633aa60c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hud79519197c2c386463324871b321d647_6772_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://lib.jimmysong.io/argo-rollouts/rollout/deployment-strategies/canary/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@jimmysongio" />
    <meta property="twitter:creator" content="@jimmysongio" />
  
  <meta property="og:site_name" content="äº‘åŸç”Ÿèµ„æ–™åº“" />
  <meta property="og:url" content="https://lib.jimmysong.io/argo-rollouts/rollout/deployment-strategies/canary/" />
  <meta property="og:title" content="é‡‘ä¸é›€éƒ¨ç½² | äº‘åŸç”Ÿèµ„æ–™åº“" />
  <meta property="og:description" content="é‡‘ä¸é›€å‘å¸ƒæ˜¯ä¸€ç§éƒ¨ç½²ç­–ç•¥ï¼Œæ“ä½œå‘˜å°†æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºé‡Šæ”¾åˆ°ç”Ÿäº§æµé‡çš„ä¸€å°éƒ¨åˆ†ä¸­ã€‚ æ¦‚è¿° ç”±äºæ²¡æœ‰å…³äºé‡‘ä¸é›€éƒ¨ç½²çš„å…±è¯†æ ‡å‡†ï¼Œå› æ­¤ Rollouts Controller å…è®¸ç”¨æˆ·æ¦‚è¿°ä»–ä»¬æƒ³è¦è¿è¡Œå…¶é‡‘ä¸é›€éƒ¨ç½²çš„æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ä½¿ç”¨çš„æ­¥éª¤" /><meta property="og:image" content="https://lib.jimmysong.io/media/sharing.png" />
    <meta property="twitter:image" content="https://lib.jimmysong.io/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
      <meta
        property="article:published_time"
        content="2023-06-21T16:00:00&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2024-03-06T15:17:26&#43;08:00">
  

  



  

  

  





  <title>é‡‘ä¸é›€éƒ¨ç½² | äº‘åŸç”Ÿèµ„æ–™åº“</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.62d6f8dfe8493f1c68557dde65bec362.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>æœç´¢</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="å…³é—­"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="æœç´¢..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="æœç´¢...">
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="äº‘åŸç”Ÿèµ„æ–™åº“"
            
            ></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="åˆ‡æ¢å¯¼èˆª">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"><img src="/media/logo.svg" alt="äº‘åŸç”Ÿèµ„æ–™åº“"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#books"><span>å›¾ä¹¦</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>æ•™ç¨‹</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/kubernetes-handbook"><span>Kubernetes åŸºç¡€æ•™ç¨‹</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/istio-fundamentals-zh"><span>Istio åŸºç¡€æ•™ç¨‹</span></a>
              
                <a class="dropdown-item" href="https://academy.tetrate.io/courses/envoy-fundamentals-zh"><span>Envoy åŸºç¡€æ•™ç¨‹</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://jimmysong.io/blog/" target="_blank" rel="noopener"><span>åšå®¢</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://cloudnative.to/" target="_blank" rel="noopener"><span>ç¤¾åŒº</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#tags"><span>æ ‡ç­¾</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>å…³äº</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://jimmysong.io/contact/" data-toggle="tooltip" data-placement="bottom" title="è”ç³»" target="_blank" rel="noopener" aria-label="è”ç³»">
                <i class="fab fa-weixin" aria-hidden="true"></i>
              </a>
            </li>
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/jimmysongio" data-toggle="tooltip" data-placement="bottom" title="å…³æ³¨" target="_blank" rel="noopener" aria-label="å…³æ³¨">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        <li class="nav-item">
            <a class="nav-link" href="https://jimmysong.io" target="_blank" rel="noopener" data-toggle="tooltip" data-placement="bottom" title="é¦–é¡µ" aria-label="é¦–é¡µ"><i class="fas fa-home" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link js-search" href="#" data-toggle="tooltip" data-placement="bottom" title="æœç´¢" aria-label="æœç´¢"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        

        
        
        
        <li class="nav-item">
          <a href="#" class="nav-link set-theme">
            <i class="fa fa-sun" aria-hidden="true" id="theme-icon"></i>
          </a>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          éƒ¨ç½²ç­–ç•¥
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">æœç´¢...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">ç›®å½•</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#æ¦‚è¿°">æ¦‚è¿°</a></li>
    <li><a href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li>
    <li><a href="#æš‚åœæŒç»­æ—¶é—´">æš‚åœæŒç»­æ—¶é—´</a></li>
    <li><a href="#åŠ¨æ€é‡‘ä¸é›€è§„æ¨¡å¸¦æµé‡è·¯ç”±">åŠ¨æ€é‡‘ä¸é›€è§„æ¨¡ï¼ˆå¸¦æµé‡è·¯ç”±ï¼‰</a></li>
    <li><a href="#åŠ¨æ€ç¨³å®šè§„æ¨¡å¸¦æµé‡è·¯ç”±">åŠ¨æ€ç¨³å®šè§„æ¨¡ï¼ˆå¸¦æµé‡è·¯ç”±ï¼‰</a></li>
    <li><a href="#æ¨¡ä»¿æ»šåŠ¨æ›´æ–°">æ¨¡ä»¿æ»šåŠ¨æ›´æ–°</a></li>
    <li><a href="#å…¶ä»–å¯é…ç½®ç‰¹æ€§">å…¶ä»–å¯é…ç½®ç‰¹æ€§</a>
      <ul>
        <li><a href="#analysis">analysis</a></li>
        <li><a href="#antiaffinity">antiAffinity</a></li>
        <li><a href="#canaryservice">canaryService</a></li>
        <li><a href="#stableservice">stableService</a></li>
        <li><a href="#maxsurge">maxSurge</a></li>
        <li><a href="#maxunavailable">maxUnavailable</a></li>
        <li><a href="#trafficrouting">trafficRouting</a></li>
      </ul>
    </li>
  </ul>
</nav>

      

    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="/">
        
          é¦–é¡µ
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/argo-rollouts/">
        
          Argo Rollouts ä¸­æ–‡æ–‡æ¡£
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/argo-rollouts/rollout/">
        
          Rollout
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="/argo-rollouts/rollout/deployment-strategies/">
        
          éƒ¨ç½²ç­–ç•¥
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        é‡‘ä¸é›€éƒ¨ç½²
      </li>
    </ol>
  </nav>




          

          <h1>é‡‘ä¸é›€éƒ¨ç½²</h1>

          <div class="article-style">
            <p>é‡‘ä¸é›€å‘å¸ƒæ˜¯ä¸€ç§éƒ¨ç½²ç­–ç•¥ï¼Œæ“ä½œå‘˜å°†æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºé‡Šæ”¾åˆ°ç”Ÿäº§æµé‡çš„ä¸€å°éƒ¨åˆ†ä¸­ã€‚</p>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>ç”±äºæ²¡æœ‰å…³äºé‡‘ä¸é›€éƒ¨ç½²çš„å…±è¯†æ ‡å‡†ï¼Œå› æ­¤ Rollouts Controller å…è®¸ç”¨æˆ·æ¦‚è¿°ä»–ä»¬æƒ³è¦è¿è¡Œå…¶é‡‘ä¸é›€éƒ¨ç½²çš„æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ä½¿ç”¨çš„æ­¥éª¤åˆ—è¡¨ï¼Œä»¥åœ¨<code>.spec.template</code>å‘ç”Ÿæ›´æ”¹æ—¶æ“ä½œ ReplicaSetsã€‚åœ¨æ–°çš„ ReplicaSet è¢«æå‡ä¸ºç¨³å®šç‰ˆæœ¬å¹¶ä¸”æ—§ç‰ˆæœ¬è¢«å®Œå…¨ç¼©å‡ä¹‹å‰ï¼Œæ¯ä¸ªæ­¥éª¤å°†è¢«è¯„ä¼°ã€‚</p>
<p>æ¯ä¸ªæ­¥éª¤å¯ä»¥æœ‰ä¸¤ä¸ªå­—æ®µã€‚<code>setWeight</code>å­—æ®µæŒ‡å®šåº”å‘é€åˆ°é‡‘ä¸é›€çš„æµé‡ç™¾åˆ†æ¯”ï¼Œ<code>pause</code>ç»“æ„æŒ‡ç¤º Rollout æš‚åœã€‚å½“æ§åˆ¶å™¨åˆ°è¾¾ Rollout çš„<code>pause</code>æ­¥éª¤æ—¶ï¼Œå®ƒå°†å‘<code>.status.PauseConditions</code>å­—æ®µæ·»åŠ ä¸€ä¸ª<code>PauseCondition</code>ç»“æ„ã€‚å¦‚æœ<code>pause</code>ç»“æ„ä¸­çš„<code>duration</code>å­—æ®µè®¾ç½®ï¼ŒRollout å°†åœ¨ç­‰å¾…<code>duration</code>å­—æ®µçš„å€¼ä¹‹å‰ä¸ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚å¦åˆ™ï¼ŒRollout å°†æ— é™æœŸç­‰å¾…è¯¥ Pause æ¡ä»¶è¢«åˆ é™¤ã€‚é€šè¿‡ä½¿ç”¨<code>setWeight</code>å’Œ<code>pause</code>å­—æ®µï¼Œç”¨æˆ·å¯ä»¥æè¿°ä»–ä»¬æƒ³è¦å¦‚ä½•è¿›å…¥æ–°ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯é‡‘ä¸é›€ç­–ç•¥çš„ç¤ºä¾‹ã€‚</p>
<p>ğŸ”” é‡è¦ï¼šå¦‚æœé‡‘ä¸é›€ Rollout æœªä½¿ç”¨<a href="../traffic-management/">æµé‡ç®¡ç†</a>ï¼Œåˆ™ Rollout å°†å°½æœ€å¤§åŠªåŠ›åœ¨æ–°ç‰ˆæœ¬å’Œæ—§ç‰ˆæœ¬ä¹‹é—´å®ç°æœ€åä¸€ä¸ª<code>setWeight</code>æ­¥éª¤ä¸­åˆ—å‡ºçš„ç™¾åˆ†æ¯”ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ Rollout æœ‰ 10 ä¸ªå‰¯æœ¬å’Œ 10ï¼… çš„ç¬¬ä¸€ä¸ª<code>setWeight</code>æ­¥éª¤ï¼Œåˆ™æ§åˆ¶å™¨å°†å°†æ–°çš„æœŸæœ› ReplicaSet ç¼©æ”¾ä¸º 1 ä¸ªå‰¯æœ¬ï¼Œå°†æ—§çš„ç¨³å®š ReplicaSet ç¼©æ”¾ä¸º 9 ä¸ªã€‚åœ¨ setWeight ä¸º 15ï¼…çš„æƒ…å†µä¸‹ï¼ŒRollout å°è¯•é€šè¿‡å‘ä¸Šèˆå…¥è®¡ç®—ï¼ˆå³ï¼Œæ–°çš„ ReplicaSet å…·æœ‰ 2 ä¸ª Podï¼Œå› ä¸º 10 çš„ 15ï¼…å‘ä¸Šèˆå…¥ä¸º 2ï¼Œæ—§çš„ ReplicaSet å…·æœ‰ 9 ä¸ª Podï¼Œå› ä¸º 10 çš„ 85ï¼…å‘ä¸Šèˆå…¥ä¸º 9ï¼‰è·å¾—æ›´ç²¾ç»†çš„æ§åˆ¶ç™¾åˆ†æ¯”è€Œä¸ä½¿ç”¨å¤§é‡å‰¯æœ¬ã€‚é‚£ä¸ªç”¨æˆ·åº”è¯¥ä½¿ç”¨æµé‡ç®¡ç†åŠŸèƒ½ã€‚</p>
<h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">argoproj.io/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Rollout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-rollout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.15.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">minReadySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w"> </span><span class="c">#è¡¨æ˜ Rollout åº”ä½¿ç”¨é‡‘ä¸é›€ç­–ç•¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;25%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setWeight</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">pause</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l">1h</span><span class="w"> </span><span class="c"># 1 å°æ—¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setWeight</span><span class="p">:</span><span class="w"> </span><span class="m">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{}<span class="w"> </span><span class="c"># ç„¡é™æœŸæš‚åœ</span><span class="w">
</span></span></span></code></pre></div><h2 id="æš‚åœæŒç»­æ—¶é—´">æš‚åœæŒç»­æ—¶é—´</h2>
<p>æš‚åœæŒç»­æ—¶é—´å¯ä»¥ç”¨å¯é€‰çš„æ—¶é—´å•ä½åç¼€æŒ‡å®šã€‚æœ‰æ•ˆçš„æ—¶é—´å•ä½ä¸ºâ€œsâ€ã€â€œmâ€ã€â€œhâ€ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºâ€œsâ€ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{<span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span>}<span class="w">  </span><span class="c"># 10 ç§’</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{<span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l">10s }</span><span class="w"> </span><span class="c"># 10 ç§’</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{<span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l">10m }</span><span class="w"> </span><span class="c"># 10 åˆ†é’Ÿ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{<span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l">10h }</span><span class="w"> </span><span class="c"># 10 å°æ—¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{}<span class="w">                </span><span class="c"># æ— é™æœŸæš‚åœ</span><span class="w">
</span></span></span></code></pre></div><p>å¦‚æœæš‚åœæ­¥éª¤æ²¡æœ‰æŒ‡å®š<code>duration</code>ï¼Œåˆ™ Rollout å°†æ— é™æœŸæš‚åœã€‚è¦å–æ¶ˆæš‚åœï¼Œè¯·ä½¿ç”¨ argo kubectl æ’ä»¶<code>promote</code>å‘½ä»¤ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> <span class="c1"># æå‡åˆ°ä¸‹ä¸€æ­¥</span>
</span></span><span class="line"><span class="cl"> kubectl argo rollouts promote &lt;rollout&gt;
</span></span></code></pre></div><h2 id="åŠ¨æ€é‡‘ä¸é›€è§„æ¨¡å¸¦æµé‡è·¯ç”±">åŠ¨æ€é‡‘ä¸é›€è§„æ¨¡ï¼ˆå¸¦æµé‡è·¯ç”±ï¼‰</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRollout æ§åˆ¶å™¨å°†æ ¹æ®å½“å‰æ­¥éª¤çš„<code>trafficWeight</code>æ¥æ‰©å±•é‡‘ä¸é›€ï¼Œä»¥åŒ¹é…æµé‡æƒé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰æƒé‡ä¸º 25ï¼…ï¼Œå¹¶ä¸”æœ‰å››ä¸ªå‰¯æœ¬ï¼Œåˆ™ä¸ºäº†åŒ¹é…æµé‡æƒé‡ï¼Œé‡‘ä¸é›€å°†è¢«ç¼©æ”¾ä¸º 1ã€‚</p>
<p>å¯ä»¥æ§åˆ¶é‡‘ä¸é›€å‰¯æœ¬åœ¨æ­¥éª¤æœŸé—´çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œä»¥ä¾¿å®ƒä¸å¿…å¿…é¡»åŒ¹é…æµé‡æƒé‡ã€‚ä»¥ä¸‹æ˜¯æ­¤ç±»ç”¨ä¾‹ï¼š</p>
<ol>
<li>æ–°ç‰ˆæœ¬ä¸åº”å…¬å¼€ï¼ˆ<code>setWeight: 0</code>ï¼‰ï¼Œä½†ä½ å¸Œæœ›å°†é‡‘ä¸é›€æ‰©å±•åˆ°è¿›è¡Œæµ‹è¯•ã€‚</li>
<li>ä½ å¸Œæœ›æœ€å°åŒ–é‡‘ä¸é›€å †æ ˆçš„è§„æ¨¡ï¼Œå¹¶ä½¿ç”¨ä¸€äº›åŸºäºæ ‡å¤´çš„æµé‡æ•´å½¢åˆ°é‡‘ä¸é›€ï¼Œè€Œ<code>setWeight</code>ä»ç„¶è®¾ç½®ä¸º 0ã€‚</li>
<li>ä½ å¸Œæœ›å°†é‡‘ä¸é›€æ‰©å±•åˆ° 100ï¼…ï¼Œä»¥ä¾¿è¿›è¡Œæµé‡é˜´å½±å¤„ç†ã€‚</li>
</ol>
<p>ğŸ”” é‡è¦ï¼šä»…å½“ä½¿ç”¨å¸¦æœ‰æµé‡è·¯ç”±çš„é‡‘ä¸é›€ç­–ç•¥æ—¶ï¼Œæ‰å¯ä»¥è®¾ç½®é‡‘ä¸é›€æ¯”ä¾‹ã€‚</p>
<p>è¦åœ¨æ­¥éª¤æœŸé—´æ§åˆ¶é‡‘ä¸é›€æ¯”ä¾‹å’Œæƒé‡ï¼Œè¯·ä½¿ç”¨<code>setCanaryScale</code>æ­¥éª¤ï¼Œå¹¶æŒ‡ç¤ºé‡‘ä¸é›€åº”ä½¿ç”¨å“ªä¸ªæ¯”ä¾‹ï¼š</p>
<ul>
<li>æ˜¾å¼å‰¯æœ¬è®¡æ•°è€Œä¸æ›´æ”¹æµé‡æƒé‡ï¼ˆ<code>replicas</code>ï¼‰</li>
<li>spec.replicas ä¸­çš„æ˜ç¡®çš„æƒé‡ç™¾åˆ†æ¯”ï¼Œè€Œä¸æ›´æ”¹æµé‡æƒé‡ï¼ˆ<code>weight</code>ï¼‰</li>
<li>æ˜¯å¦åŒ¹é…å½“å‰é‡‘ä¸é›€çš„<code>setWeight</code>æ­¥éª¤ï¼ˆ<code>matchTrafficWeightï¼štrueæˆ–false</code>ï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c"># æ˜¾å¼è®¡æ•°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setCanaryScale</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c"># spec.replicas çš„ç™¾åˆ†æ¯”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setCanaryScale</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c"># matchTrafficWeight è¿”å›ä¸ canary æµé‡æƒé‡åŒ¹é…çš„é»˜è®¤è¡Œä¸º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setCanaryScale</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">matchTrafficWeight</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨ä½¿ç”¨å…·æœ‰æ˜¾å¼å€¼çš„<code>setCanaryScale</code>çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸<code>setWeight</code>æ­¥éª¤ä¸€èµ·ä½¿ç”¨æ—¶ä¸æ­£ç¡®ï¼Œåˆ™å¿…é¡»å°å¿ƒã€‚å¦‚æœä¸æ­£ç¡®åœ°å®Œæˆï¼Œåˆ™ä¼šå°†ä¸å¹³è¡¡çš„æµé‡æ¯”ä¾‹å®šå‘åˆ°é‡‘ä¸é›€ï¼ˆä¸ Rollout çš„æ¯”ä¾‹æˆæ¯”ä¾‹ï¼‰ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸€ç»„æ­¥éª¤å°†å¯¼è‡´ 90ï¼…çš„æµé‡ä»…ç”± 10ï¼…çš„ Pod æä¾›æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c"># 1 é‡‘ä¸é›€ Podï¼ˆspec.replicas çš„ 10ï¼…ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setCanaryScale</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c"># 90ï¼…çš„æµé‡åˆ° 1 ä¸ªé‡‘ä¸é›€ Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">setWeight</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="nt">pause</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></div><p>ä¸Šè¿°æƒ…å†µæ˜¯ç”±äº<code>setWeight</code>åœ¨<code>setCanaryScale</code>ä¹‹åçš„æ›´æ”¹è¡Œä¸ºå¼•èµ·çš„ã€‚è¦é‡ç½®ï¼Œè¯·è®¾ç½®<code>matchTrafficWeightï¼štrue</code>ï¼Œå¹¶å°†æ¢å¤<code>setWeight</code>è¡Œä¸ºï¼Œå³ï¼Œåç»­<code>setWeight</code>å°†åˆ›å»ºä¸æµé‡æƒé‡åŒ¹é…çš„é‡‘ä¸é›€å‰¯æœ¬ã€‚</p>
<h2 id="åŠ¨æ€ç¨³å®šè§„æ¨¡å¸¦æµé‡è·¯ç”±">åŠ¨æ€ç¨³å®šè§„æ¨¡ï¼ˆå¸¦æµé‡è·¯ç”±ï¼‰</h2>
<p>ğŸ”” é‡è¦ï¼šä» v1.1 å¼€å§‹å¯ç”¨</p>
<p>åœ¨ä½¿ç”¨æµé‡è·¯ç”±æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¨³å®šçš„ ReplicaSet åœ¨æ›´æ–°æœŸé—´ä¿æŒç¼©æ”¾ä¸º 100ï¼…ã€‚è¿™å…·æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå³å¦‚æœå‘ç”Ÿä¸­æ­¢ï¼Œåˆ™å¯ä»¥ç«‹å³å°†æµé‡è½¬ç§»åˆ°ç¨³å®šçš„ ReplicaSet è€Œæ— éœ€å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯åœ¨æ›´æ–°æœŸé—´ï¼Œå°†æœ€ç»ˆå­˜åœ¨åŒå€æ•°é‡çš„å‰¯æœ¬ Podï¼ˆç±»ä¼¼äºè“ç»¿è‰²éƒ¨ç½²ï¼‰ï¼Œå› ä¸ºç¨³å®šçš„ ReplicaSet åœ¨æ•´ä¸ªæ›´æ–°æœŸé—´éƒ½è¢«ç¼©æ”¾ã€‚</p>
<p>å¯ä»¥é€šè¿‡åŠ¨æ€å‡å°‘ç¨³å®šçš„ ReplicaSet è§„æ¨¡æ¥å®ç°ï¼Œä»¥ä½¿å…¶åœ¨æµé‡æƒé‡å¢åŠ åˆ°é‡‘ä¸é›€æ—¶ç¼©å°ã€‚è¿™å¯¹äº Rollout å…·æœ‰é«˜å‰¯æœ¬è®¡æ•°å’Œèµ„æºæˆæœ¬æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæˆ–è€…åœ¨è£¸æœºæƒ…å†µä¸‹ä¸å¯èƒ½åˆ›å»ºé¢å¤–çš„èŠ‚ç‚¹å®¹é‡ä»¥å®¹çº³åŒå€å‰¯æœ¬çš„æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>å¯ä»¥é€šè¿‡å°†<code>canary.dynamicStableScale</code>æ ‡å¿—è®¾ç½®ä¸º true æ¥å¯ç”¨åŠ¨æ€ç¼©æ”¾ç¨³å®šçš„ ReplicaSetï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">dynamicStableScale</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œå¦‚æœè®¾ç½®äº†<code>dynamicStableScale</code>å¹¶ä¸” Rollout ä¸­æ­¢äº†ï¼Œåˆ™é‡‘ä¸é›€ ReplicaSet å°†åŠ¨æ€ç¼©å°ï¼Œå› ä¸ºæµé‡è½¬ç§»åˆ°äº†ç¨³å®šçš„ ReplicaSetã€‚å¦‚æœä½ å¸Œæœ›åœ¨ä¸­æ­¢æ—¶ä¿ç•™é‡‘ä¸é›€ ReplicaSet çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œåˆ™å¯ä»¥è®¾ç½®<code>abortScaleDownDelaySeconds</code>çš„æ˜¾å¼å€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">dynamicStableScale</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">abortScaleDownDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">600</span><span class="w">
</span></span></span></code></pre></div><h2 id="æ¨¡ä»¿æ»šåŠ¨æ›´æ–°">æ¨¡ä»¿æ»šåŠ¨æ›´æ–°</h2>
<p>å¦‚æœçœç•¥<code>steps</code>å­—æ®µï¼Œåˆ™é‡‘ä¸é›€ç­–ç•¥å°†æ¨¡ä»¿æ»šåŠ¨æ›´æ–°è¡Œä¸ºã€‚ä¸éƒ¨ç½²ç±»ä¼¼ï¼Œé‡‘ä¸é›€ç­–ç•¥å…·æœ‰<code>maxSurge</code>å’Œ<code>maxUnavailable</code>å­—æ®µï¼Œä»¥é…ç½® Rollout åº”å¦‚ä½•å‘æ–°ç‰ˆæœ¬æ¨è¿›ã€‚</p>
<h2 id="å…¶ä»–å¯é…ç½®ç‰¹æ€§">å…¶ä»–å¯é…ç½®ç‰¹æ€§</h2>
<p>ä»¥ä¸‹æ˜¯å°†ä¿®æ”¹é‡‘ä¸é›€ç­–ç•¥è¡Œä¸ºçš„å¯é€‰å­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">canary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">analysis</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">antiAffinity</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">canaryService</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">stableService</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l">stringOrInt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l">stringOrInt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">trafficRouting</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></span></span></code></pre></div><h3 id="analysis">analysis</h3>
<p>é…ç½®åœ¨ Rollout æœŸé—´æ‰§è¡Œçš„åå°åˆ†æã€‚å¦‚æœåˆ†æä¸æˆåŠŸï¼Œåˆ™ Rollout å°†ä¸­æ­¢ã€‚</p>
<p>é»˜è®¤ä¸º nil</p>
<h3 id="antiaffinity">antiAffinity</h3>
<p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Anti Affinity æ–‡æ¡£ã€‚</p>
<p>é»˜è®¤ä¸º nil</p>
<h3 id="canaryservice">canaryService</h3>
<p><code>canaryService</code>å¼•ç”¨å°†è¢«ä¿®æ”¹ä¸ºä»…å°†æµé‡å‘é€åˆ°é‡‘ä¸é›€ ReplicaSet çš„ Serviceã€‚è¿™ä½¿ç”¨æˆ·åªèƒ½å‡»ä¸­é‡‘ä¸é›€ ReplicaSetã€‚</p>
<p>é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</p>
<h3 id="stableservice">stableService</h3>
<p><code>stableService</code>æ˜¯ä¸€ä¸ªé€‰æ‹©å…·æœ‰ç¨³å®šç‰ˆæœ¬çš„ Podï¼Œå¹¶ä¸”ä¸ä¼šé€‰æ‹©ä»»ä½•å…·æœ‰é‡‘ä¸é›€ç‰ˆæœ¬çš„ Pod çš„ Service çš„åç§°ã€‚è¿™ä½¿ç”¨æˆ·åªèƒ½å‡»ä¸­ç¨³å®šçš„ ReplicaSetã€‚</p>
<p>é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</p>
<h3 id="maxsurge">maxSurge</h3>
<p><code>maxSurge</code> å®šä¹‰äº†å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥åˆ›å»ºçš„æœ€å¤§å‰¯æœ¬æ•°ï¼Œä»¥è¾¾åˆ°æœ€åä¸€æ¬¡ setWeight è®¾ç½®çš„æ­£ç¡®æ¯”ä¾‹ã€‚Max Surge å¯ä»¥æ˜¯æ•´æ•°æˆ–ç™¾åˆ†æ¯”å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ &ldquo;20%&quot;ï¼‰ã€‚</p>
<p>é»˜è®¤ä¸º &ldquo;25%&quot;ã€‚</p>
<h3 id="maxunavailable">maxUnavailable</h3>
<p>å‡çº§æœŸé—´å¯ä»¥ä¸å¯ç”¨çš„ Pod çš„æœ€å¤§æ•°é‡ã€‚å€¼å¯ä»¥æ˜¯ç»å¯¹æ•°ï¼ˆä¾‹å¦‚ï¼š5ï¼‰æˆ–æ‰€éœ€ Pod çš„ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ï¼š10%ï¼‰ã€‚å¦‚æœ MaxSurge ä¸º 0ï¼Œåˆ™ä¸èƒ½ä¸º 0ã€‚</p>
<p>é»˜è®¤ä¸º &ldquo;25%&quot;ã€‚</p>
<h3 id="trafficrouting">trafficRouting</h3>
<p>æµé‡ç®¡ç† è§„åˆ™ï¼Œç”¨äºæ§åˆ¶æ´»åŠ¨å’Œé‡‘ä¸é›€ç‰ˆæœ¬ä¹‹é—´çš„æµé‡ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™å°†ä½¿ç”¨é»˜è®¤çš„åŸºäºåŠ æƒ Pod å‰¯æœ¬çš„è·¯ç”±ã€‚</p>
<p>é»˜è®¤ä¸º nilã€‚</p>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/%E9%87%91%E4%B8%9D%E9%9B%80%E9%83%A8%E7%BD%B2/">é‡‘ä¸é›€éƒ¨ç½²</a>
  
  <a class="badge badge-light" href="/tag/%E9%83%A8%E7%BD%B2%E7%AD%96%E7%95%A5/">éƒ¨ç½²ç­–ç•¥</a>
  
  <a class="badge badge-light" href="/tag/argo-rollouts/">Argo Rollouts</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <a class="col-6 post-nav-item btn btn-lg mb-md-1" href="/argo-rollouts/rollout/deployment-strategies/bluegreen/" rel="next">
    <div class="meta-nav">ä¸Šä¸€é¡µ</div>
    <p>è“ç»¿éƒ¨ç½²ç­–ç•¥</p></a>
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>æœ€è¿‘æ›´æ–°äº 2024-03-06</p>

          





  

<p class="edit-page">
  <a href="https://github.com/rootsongjc/cloud-native-library//edit/master/content/argo-rollouts/rollout/deployment-strategies/canary.md">
    <i class="fas fa-pen pr-2"></i>ç¼–è¾‘æœ¬é¡µ
  </a>
</p>



          




          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">Â© 2017-2024 jimmysong.io all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="/js/vendor-bundle.min.5b2c48a98fb93f10e8d01cff2874cdf3.js"></script>




  

  
  

  

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
    
    
  










  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <div class="article-metadata search-hit-type">{{relpermalink}}</div>
          <a href="{{relpermalink}}">{{title}}</a>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>










  
  


<script src="/zh/js/wowchemy.min.a04788cdfce708339d31c0685377d64e.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">å¼•ç”¨</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> å¤åˆ¶
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> ä¸‹è½½
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

  <script src="/js/wowchemy-publication.af9327db0521d4a01354bfc8b77a4324.js" type="module"></script>
<script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>






<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>



<script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, 'å·²å¤åˆ¶')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>



<script>

function Collapse(e){
  var node = document.getElementById(e);
  if (node.className.indexOf('fa-angle-down') > -1){
    node.setAttribute("class", "fa-solid fa-angle-right");
    }else{
    node.setAttribute("class", "fa-solid fa-angle-down");
    }
}
</script>


</body>
</html>
